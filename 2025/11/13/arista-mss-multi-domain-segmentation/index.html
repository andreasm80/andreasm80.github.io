<!DOCTYPE html>
<html lang="en" dir="ltr" class="scroll-smooth" data-default-appearance="dark"
  data-auto-appearance="true"><head>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Arista MSS - Multi-Domain Segmentation &middot; blog.andreasm.io</title>
  <meta name="title" content="Arista MSS - Multi-Domain Segmentation &middot; blog.andreasm.io" />
  
  <meta name="description" content="Deploying Arista MSS in my lab and seeing it in action" />
  <meta name="keywords" content="networking, security, microsegmentation, zerotrust, " />
  
  
  <link rel="canonical" href="https://blog.andreasm.io/2025/11/13/arista-mss-multi-domain-segmentation/" />
  
  
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.48d290696564c2380c4233780f3fd414aa6e2b0b67ed916e9d918c48c05f5b20b641bf892fadd408e43ec21d2feb2ec1fe6fd1f021df2806a254977fe2f80a64.css"
    integrity="sha512-SNKQaWVkwjgMQjN4Dz/UFKpuKwtn7ZFunZGMSMBfWyC2Qb&#43;JL63UCOQ&#43;wh0v6y7B/m/R8CHfKAaiVJd/4vgKZA==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.a85bd6dc99d1fecae166deb56a1fee6375588c72533c4b8c690e4a9ec5a04174ff780e41e2ac770382a8e67818cb2b89766afa3e23965c9102424a080dafbb0c.js"
    integrity="sha512-qFvW3JnR/srhZt61ah/uY3VYjHJTPEuMaQ5KnsWgQXT/eA5B4qx3A4Ko5ngYyyuJdmr6PiOWXJECQkoIDa&#43;7DA=="></script>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.a2d78d78672e549fbfc972ece871725b5478ba0b65708dda20cb97ab80a865eae6d247e1b05a4aec6ebbf78647ec3233bad8b2609ed98eee53cd58aa17128bc7.js"
    integrity="sha512-oteNeGcuVJ&#43;/yXLs6HFyW1R4ugtlcI3aIMuXq4CoZerm0kfhsFpK7G6794ZH7DIzutiyYJ7Zju5TzViqFxKLxw==" data-copy="" data-copied=""></script>
  
  
  
  <script src="/lib/zoom/zoom.min.37d2094687372da3f7343a221a470f6b8806f7891aa46a5a03966af7f0ebd38b9fe536cb154e6ad28f006d184b294525a7c4054b6bbb4be62d8b453b42db99bd.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S&#43;Yti0U7QtuZvQ=="></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="https://blog.andreasm.io/2025/11/13/arista-mss-multi-domain-segmentation/">
  <meta property="og:site_name" content="blog.andreasm.io">
  <meta property="og:title" content="Arista MSS - Multi-Domain Segmentation">
  <meta property="og:description" content="What is Arista MSS and how does it work">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-11-13T08:17:20+01:00">
    <meta property="article:modified_time" content="2025-11-13T08:17:20+01:00">
    <meta property="article:tag" content="Networking">
    <meta property="article:tag" content="Security">
    <meta property="article:tag" content="Microsegmentation">
    <meta property="article:tag" content="Zerotrust">
    <meta property="og:image" content="https://blog.andreasm.io/2025/11/13/arista-mss-multi-domain-segmentation/feature-arista-networks.jpg">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://blog.andreasm.io/2025/11/13/arista-mss-multi-domain-segmentation/feature-arista-networks.jpg">
  <meta name="twitter:title" content="Arista MSS - Multi-Domain Segmentation">
  <meta name="twitter:description" content="What is Arista MSS and how does it work">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Arista MSS - Multi-Domain Segmentation",
    "headline": "Arista MSS - Multi-Domain Segmentation",
    "description": "What is Arista MSS and how does it work",
    "abstract": "Deploying Arista MSS in my lab and seeing it in action",
    "inLanguage": "en",
    "url" : "https:\/\/blog.andreasm.io\/2025\/11\/13\/arista-mss-multi-domain-segmentation\/",
    "author" : {
      "@type": "Person",
      "name": "Andreas Marqvardsen"
    },
    "copyrightYear": "2025",
    "dateCreated": "2025-11-13T08:17:20\u002b01:00",
    "datePublished": "2025-11-13T08:17:20\u002b01:00",
    
    "dateModified": "2025-11-13T08:17:20\u002b01:00",
    
    "keywords": ["networking","security","microsegmentation","zerotrust"],
    
    "mainEntityOfPage": "true",
    "wordCount": "8675"
  }]
  </script>


  
  
  <meta name="author" content="Andreas Marqvardsen" />
  
  
  
  <link href="mailto:andreas.marqvardsen[AT]gmail.com" rel="me" />
  
  
  <link href="https://blog.andreasm.io/" rel="me" />
  
  
  <link href="https://github.com/andreasm80" rel="me" />
  
  
  <link href="https://linkedin.com/in/andreas-marqvardsen" rel="me" />
  
  
  <link href="https://vmst.io/@andreasm" rel="me" />
  
  
  <link href="https://x.com/NATsoFast" rel="me" />
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>






















  
  

<script async src="https://www.googletagmanager.com/gtag/js?id=G-TVPYDVE8KR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TVPYDVE8KR');
</script>



  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a>
  </div>
  
  
  <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px]" style="z-index:100">
  <div id="menu-blur" class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div>
  <div class="relative max-w-[64rem] ml-auto mr-auto">
    <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3">
    
    
    
    <div>
        <a href="/" class="flex">
            <span class="sr-only">blog.andreasm.io</span>

            
            <img src="/ynwa2.png" width="300" height="342"
                class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt="blog.andreasm.io" />
            

        </a>
    </div>
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">blog.andreasm.io</a>
            

        </nav>
        <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

            
            
            
  <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Posts
    </p>
</a>



            
            
  <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        About
    </p>
</a>



            
            
  <a href="/categories/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Categories
    </p>
</a>



            
            
  <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Tags
    </p>
</a>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class="ltr:mr-14 rtl:ml-14 flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center space-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400" style="margin-right:5px">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 -mr-2 md:hidden">

        <label id="menu-button" class="block">
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li id="menu-close-button">
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                    
  <li class="mt-1">
    <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Posts
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            About
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/categories/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Categories
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Tags
        </p>
    </a>
</li>




                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>




<script>
    (function () {
        var $mainmenu = $('.main-menu');
        var path = window.location.pathname;
        $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
            $(e).children('p').addClass('active');
        });
    })();
</script>


  </div>
</div>
<script>
  window.addEventListener('scroll', function (e) {
    var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
    var background_blur = document.getElementById('menu-blur');
    background_blur.style.opacity = (scroll / 300);
  });
</script>

  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  
  
  
  
  
  


<div id="hero" class="h-[150px] md:h-[200px]"></div>



    
    <div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"
    style="background-image:url(/2025/11/13/arista-mss-multi-domain-segmentation/feature-arista-networks.jpg);">
    


    <div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal">
    </div>
    <div
        class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal">
    </div>
</div>

<div id="background-blur" class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div>
<script>
    window.addEventListener('scroll', function (e) {
        var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        var background_blur = document.getElementById('background-blur');
        background_blur.style.opacity = (scroll / 300)
    });
</script>

  
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/"
      >blog.andreasm.io</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline ">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/posts/"
      >Posts</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/2025/11/13/arista-mss-multi-domain-segmentation/"
      >Arista MSS - Multi-Domain Segmentation</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      Arista MSS - Multi-Domain Segmentation
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2025-11-13T08:17:20&#43;01:00">13 November 2025</time><span class="px-2 text-primary-500">&middot;</span><span>8675 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">41 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/networking/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Networking
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/security/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Security
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/microsegmentation/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    MicroSegmentation
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/zerotrust/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    ZeroTrust
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/datacenter/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Datacenter
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/campus/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Campus
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/networking/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Networking
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/security/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Security
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/microsegmentation/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Microsegmentation
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/zerotrust/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Zerotrust
  </span>
</span>
  </span>
  
  
  
  
</div>




    </div>

    
    
    
    
    

    

    
      
      
        
        
<div class="flex author">
  
    
    
      
    
    
      
      <img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width="96" height="96"
      alt="Andreas Marqvardsen" src="/profile.png" />
    
  
  <div class="place-self-center">
    
    <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
      Author
    </div>
    <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
      Andreas Marqvardsen
    </div>
    
    
    <div class="text-sm text-neutral-700 dark:text-neutral-400">Always curious, always learning</div>
    
    <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="mailto:andreas.marqvardsen[AT]gmail.com"
          target="_blank"
          aria-label="Email"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://blog.andreasm.io/"
          target="_blank"
          aria-label="Link"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M172.5 131.1C228.1 75.51 320.5 75.51 376.1 131.1C426.1 181.1 433.5 260.8 392.4 318.3L391.3 319.9C381 334.2 361 337.6 346.7 327.3C332.3 317 328.9 297 339.2 282.7L340.3 281.1C363.2 249 359.6 205.1 331.7 177.2C300.3 145.8 249.2 145.8 217.7 177.2L105.5 289.5C73.99 320.1 73.99 372 105.5 403.5C133.3 431.4 177.3 435 209.3 412.1L210.9 410.1C225.3 400.7 245.3 404 255.5 418.4C265.8 432.8 262.5 452.8 248.1 463.1L246.5 464.2C188.1 505.3 110.2 498.7 60.21 448.8C3.741 392.3 3.741 300.7 60.21 244.3L172.5 131.1zM467.5 380C411 436.5 319.5 436.5 263 380C213 330 206.5 251.2 247.6 193.7L248.7 192.1C258.1 177.8 278.1 174.4 293.3 184.7C307.7 194.1 311.1 214.1 300.8 229.3L299.7 230.9C276.8 262.1 280.4 306.9 308.3 334.8C339.7 366.2 390.8 366.2 422.3 334.8L534.5 222.5C566 191 566 139.1 534.5 108.5C506.7 80.63 462.7 76.99 430.7 99.9L429.1 101C414.7 111.3 394.7 107.1 384.5 93.58C374.2 79.2 377.5 59.21 391.9 48.94L393.5 47.82C451 6.731 529.8 13.25 579.8 63.24C636.3 119.7 636.3 211.3 579.8 267.7L467.5 380z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/andreasm80"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://linkedin.com/in/andreas-marqvardsen"
          target="_blank"
          aria-label="Linkedin"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://vmst.io/@andreasm"
          target="_blank"
          aria-label="Mastodon"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://x.com/NATsoFast"
          target="_blank"
          aria-label="X-Twitter"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
  </span>

</span></a
        >
      
    
  </div>

</div>
  </div>
</div>

      

      

      
      <div class="mb-5"></div>
      

    

  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
     <div
      class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
      <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]">

         <details open id="TOCView"
  class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-needed-to-get-started-with-mss">What is needed to get started with MSS?</a>
      <ul>
        <li><a href="#the-ztx-appliance-monitor-node">The ZTX appliance (monitor node)</a>
          <ul>
            <li><a href="#creating-the-virtual-machine-in-proxmox">Creating the virtual machine in Proxmox</a></li>
            <li><a href="#moving-the-cloudeos-to-monitor-mode">Moving the CloudEOS to Monitor Mode</a></li>
            <li><a href="#basic-configurations---management1-p2p-link-loopback">Basic configurations - Management1-p2p link-loopback</a></li>
            <li><a href="#onboarding-the-vztx-to-cloudvision">Onboarding the vZTX to CloudVision</a></li>
          </ul>
        </li>
        <li><a href="#my-arista-720xp-switch">My Arista 720XP switch</a>
          <ul>
            <li><a href="#connection-between-vztx-and-my-720xp">Connection between vZTX and my 720XP</a></li>
          </ul>
        </li>
        <li><a href="#cloudvision-preparations">CloudVision preparations</a>
          <ul>
            <li><a href="#security-domain-and-monitor-object">Security Domain and Monitor Object</a></li>
          </ul>
        </li>
        <li><a href="#my-lab">My lab</a></li>
      </ul>
    </li>
    <li><a href="#network-security-in-cloudvision">Network Security in CloudVision</a>
      <ul>
        <li><a href="#policy-manager">Policy Manager</a>
          <ul>
            <li><a href="#domains">Domains</a></li>
            <li><a href="#policies">Policies</a></li>
            <li><a href="#rules">Rules</a></li>
            <li><a href="#groups">Groups</a></li>
            <li><a href="#policy-objects">Policy Objects</a></li>
          </ul>
        </li>
        <li><a href="#policy-monitor">Policy Monitor</a></li>
        <li><a href="#policy-builder">Policy Builder</a></li>
      </ul>
    </li>
    <li><a href="#creating-network-policies-and-rules">Creating network policies and rules</a>
      <ul>
        <li><a href="#first-rules---dns-and-ntp-policy">First rules - DNS and NTP policy</a></li>
        <li><a href="#application-policy---web-and-application-servers">Application Policy - Web and Application Servers</a></li>
        <li><a href="#virtual-machines---same-host---same-vlan">Virtual machines - same host - same vlan</a>
          <ul>
            <li><a href="#arp-scenario-with-port-isolation">ARP scenario with port-isolation</a></li>
          </ul>
        </li>
        <li><a href="#application-policy---web-and-application-servers-1">Application Policy - Web and Application Servers</a></li>
        <li><a href="#monitor-for-potential-allow-rules-i-have-missed">Monitor for potential allow rules I have missed</a></li>
      </ul>
    </li>
    <li><a href="#some-useful-cli-commands">Some useful CLI commands</a>
      <ul>
        <li><a href="#on-the-vztx-monitor">On the vZTX monitor</a></li>
        <li><a href="#on-the-mss-switches">On the MSS Switches</a></li>
      </ul>
    </li>
    <li><a href="#outro">Outro</a>
      <ul>
        <li><a href="#sources">Sources</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-needed-to-get-started-with-mss">What is needed to get started with MSS?</a>
      <ul>
        <li><a href="#the-ztx-appliance-monitor-node">The ZTX appliance (monitor node)</a>
          <ul>
            <li><a href="#creating-the-virtual-machine-in-proxmox">Creating the virtual machine in Proxmox</a></li>
            <li><a href="#moving-the-cloudeos-to-monitor-mode">Moving the CloudEOS to Monitor Mode</a></li>
            <li><a href="#basic-configurations---management1-p2p-link-loopback">Basic configurations - Management1-p2p link-loopback</a></li>
            <li><a href="#onboarding-the-vztx-to-cloudvision">Onboarding the vZTX to CloudVision</a></li>
          </ul>
        </li>
        <li><a href="#my-arista-720xp-switch">My Arista 720XP switch</a>
          <ul>
            <li><a href="#connection-between-vztx-and-my-720xp">Connection between vZTX and my 720XP</a></li>
          </ul>
        </li>
        <li><a href="#cloudvision-preparations">CloudVision preparations</a>
          <ul>
            <li><a href="#security-domain-and-monitor-object">Security Domain and Monitor Object</a></li>
          </ul>
        </li>
        <li><a href="#my-lab">My lab</a></li>
      </ul>
    </li>
    <li><a href="#network-security-in-cloudvision">Network Security in CloudVision</a>
      <ul>
        <li><a href="#policy-manager">Policy Manager</a>
          <ul>
            <li><a href="#domains">Domains</a></li>
            <li><a href="#policies">Policies</a></li>
            <li><a href="#rules">Rules</a></li>
            <li><a href="#groups">Groups</a></li>
            <li><a href="#policy-objects">Policy Objects</a></li>
          </ul>
        </li>
        <li><a href="#policy-monitor">Policy Monitor</a></li>
        <li><a href="#policy-builder">Policy Builder</a></li>
      </ul>
    </li>
    <li><a href="#creating-network-policies-and-rules">Creating network policies and rules</a>
      <ul>
        <li><a href="#first-rules---dns-and-ntp-policy">First rules - DNS and NTP policy</a></li>
        <li><a href="#application-policy---web-and-application-servers">Application Policy - Web and Application Servers</a></li>
        <li><a href="#virtual-machines---same-host---same-vlan">Virtual machines - same host - same vlan</a>
          <ul>
            <li><a href="#arp-scenario-with-port-isolation">ARP scenario with port-isolation</a></li>
          </ul>
        </li>
        <li><a href="#application-policy---web-and-application-servers-1">Application Policy - Web and Application Servers</a></li>
        <li><a href="#monitor-for-potential-allow-rules-i-have-missed">Monitor for potential allow rules I have missed</a></li>
      </ul>
    </li>
    <li><a href="#some-useful-cli-commands">Some useful CLI commands</a>
      <ul>
        <li><a href="#on-the-vztx-monitor">On the vZTX monitor</a></li>
        <li><a href="#on-the-mss-switches">On the MSS Switches</a></li>
      </ul>
    </li>
    <li><a href="#outro">Outro</a>
      <ul>
        <li><a href="#sources">Sources</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>

<script>

  var margin = 200;
  var marginError = 50;

  (function () {
    var $window = $(window);
    var $toc = $('#TOCView');
    var tocHeight = $toc.height();

    function onResize() {
      var windowAndMarginHeight = $window.height() - margin;
      if(tocHeight >= windowAndMarginHeight) {
        $toc.css("overflow-y", "scroll")
        $toc.css("max-height", (windowAndMarginHeight + marginError) + "px")
      } else {
        $toc.css("overflow-y", "hidden")
        $toc.css("max-height", "9999999px")
      }
    }

    $window.on('resize', onResize);
    $(document).ready(onResize);
  })();



  (function () {
    var $toc = $('#TableOfContents');
    if ($toc.length > 0) {
      var $window = $(window);

      function onScroll() {
        var currentScroll = $window.scrollTop();
        var h = $('.anchor');
        var id = "";
        h.each(function (i, e) {
          e = $(e);
          if (e.offset().top - $(window).height()/3 <= currentScroll) {
            id = decodeURIComponent(e.attr('id'));
          }
        });
        var active = $toc.find('a.active');      
        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

        active.each(function (i, e) {
          
            $(e).removeClass('active');
          
        });
        $toc.find('a[href="#' + id + '"]').addClass('active')
        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
          $(e).children('a').parents('ul').show();          
        });
      }

      $window.on('scroll', onScroll);
      $(document).ready(function () {
        
        onScroll();
      });
    }
  })();


</script>
   </div>
      </div>
      

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          

<h1 class="relative group">Arista MSS - Multi-Domain Segmentation Services 
    <div id="arista-mss---multi-domain-segmentation-services" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#arista-mss---multi-domain-segmentation-services" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>Before I dive into how I configured and tested Arista MSS in my lab, I feel its kind of necessary to do a short introduction of MSS. What is it?</p>
<p>On a very high level, Arista Multi-Domain Segmentation Services is a solution to help you achieve Zero-Trust by allowing you to create microsegmention policies in your network fabric. This is regardless whether it is in your Campus, Datacenter or Branch/Edge.</p>
<p>From Arista&rsquo;s offical MSS <a href="https://www.arista.com/en/products/multi-domain-segmentation" target="_blank">web-page</a>:</p>
<blockquote>
<p>Arista MSS offers a switch-based microperimeter technology stack that preserves the best attributes of switch-based and host-based firewall micro-segmentation technologies and, at the same time, overcomes their main limitations while delivering a consistent, unified segmentation architecture end-to-end across multiple domains (from the campus/branch to the data center).</p>
</blockquote>
<blockquote>
<p>The following key principles of the Arista MSS architecture make it stand out compared to all other solutions in the market:</p>
<ol>
<li>Consistent architecture across multiple network domains (campus, branch, data center) predicated on a single EOS binary, common across all switching platforms, a single Arista CloudVision™ policy orchestration platform, and an aggregated Network Data Lake (Arista EOS NetDL™) infrastructure for state management and monitoring.</li>
<li>The only microperimeter (tag-based) segmentation solution in the industry that is both network and endpoint agnostic: it has no dependency on any network data plane or control plane protocols and at the same time it does not require any software agents on the endpoints.</li>
<li>A unified framework for micro- as well as macro-segmentation policies enabling security rules to be built around microperimeter objects as well as traditional network objects (subnets, VRFs), with the ability to enforce policies in the network or redirect traffic to any traditional security gateways.</li>
<li>Arista MSS offers a switch-based microperimeter technology stack that preserves the best attributes of switch-based and host-based firewall micro-segmentation technologies and, at the same time, overcomes their main limitations while delivering a consistent, unified segmentation architecture end-to-end across multiple domains (from the campus/branch to the data center).</li>
</ol>
</blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113154945141.png"
        alt="management"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113155024489.png"
        alt="arista-mss"
      />
      
    </figure>
</p>
<p>In my previous role at a software vendor as a Solution Engineer for many years helping customers with microsegmentation, zero-trust and microsegmentation is nothing new but an important security solution in todays IT landscape. I find the Arista MSS solution very interesting. The biggest differenciator with MSS is where the enforcement is done and how easy it is to get started and manage. In contrast to other solutions out there MSS will allow you to cover all needs from Campus, Datacenter all the way to the Branch/Edge, not leaving any gaps. MSS enforcement point is your switches, not an agent, not a software layer but right there where the traffic is and on the devices that are responsible for switching and routing your precious data, regardless of what kind and in which part of the network it is. Then there is performance, when using MSS it is actually line-rate performance which means no performance penalty when enabling an important security solution in your fabric.</p>
<p>So how does it work? Lets dig in and find out.</p>


<h2 class="relative group">What is needed to get started with MSS? 
    <div id="what-is-needed-to-get-started-with-mss" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#what-is-needed-to-get-started-with-mss" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>This blog will only cover three components needed to run MSS, a supported Arista Switch, the ZTX appliance and Arista CloudVision. I will not cover things such as license requirements. For more detailed list of requirements and features see the MSS Data Sheet <a href="https://www.arista.com/assets/data/pdf/Datasheets/Multi-Domain-Segmentation-Services-for-Zero-Trust-Networking.pdf" target="_blank">here</a> (page 5 for hardware and license requirements). Things like Data Sources will not be covered as I dont have things like vSphere (vCenter with VDS) and Arista AGNI (yet) available in my lab.</p>


<h3 class="relative group">The ZTX appliance (monitor node) 
    <div id="the-ztx-appliance-monitor-node" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#the-ztx-appliance-monitor-node" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<blockquote>
<p>The primary purpose of a Multi-domain Segmentation Services (MSS) Monitor Node is to provide visibility into app-to-app traffic in the network, and to develop non-intrusive MSS policies that are aligned with applications requirements. It is a baseline capability for any micro or macro segmentation solution and is a practical way to build and deploy policies. Configuring policies in terms of groups of end-points or prefixes is essential to simplify policy management and secure Data Center and Campus environments. The ZTX monitor node provides visibility into existing traffic needed to build such policies.</p>
</blockquote>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251114060532447.png"
        alt="ztx-figure"
      />
      
    </figure>
</p>
<p>Source: <a href="https://www.arista.com/assets/data/pdf/user-manual/um-books/MSS-Deployment-Guide.pdf" target="_blank">arista.com</a></p>
<p>The ZTX monitor comes in two flavours, a physical appliance (ZTX-7250S-16S) and a virtual appliance. I will use the virtual appliance, vZTX, in my lab. vZTX can run on ESXi or KVM. In my lab I am using Proxmox which is KVM. Choosing between the physical or virtual in a production environment comes down to scale and performance.</p>
<p><em>For more information on the ZTX deployment head over <a href="https://www.arista.com/assets/data/pdf/ZTX-7250S-Deployment-Guide.pdf" target="_blank">here</a>, it covers both the ZTX and vZTX and includes different supported toplogies.</em></p>
<p>There are some initial configurations that needs to be in place for the ZTX to work as intended, the steps below will go through these steps. Here are the things that needs to be done:</p>
<ul>
<li>Create the virtual machine in Proxmox with correct configuration so the CloudEOS image will boot</li>
<li>Moving the CloudEOS image into monitor mode</li>
<li>Basic configurations like username/password for SSH access and management</li>
<li>Out of Band Management interface</li>
<li>Peer to Peer link betwen the vZTX appliance and TOR switches (in my case my only 720XP).</li>
<li>Loopback interface</li>
<li>Some static routes (dynamic routing is also possible see <a href="https://www.arista.com/assets/data/pdf/ZTX-7250S-Deployment-Guide.pdf" target="_blank">this</a>) for the loopback addresses between vZTX and TOR switch</li>
<li>DNS</li>
<li>NTP &amp; Timezone</li>
<li>Onboarding the vZTX to CloudVision. Several of the step above can be configured and provisioned by CloudVision.</li>
</ul>


<h4 class="relative group">Creating the virtual machine in Proxmox 
    <div id="creating-the-virtual-machine-in-proxmox" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#creating-the-virtual-machine-in-proxmox" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>To get started with the vZTX appliance I have downloaded the <strong>CloudEOS64-4.35.0F.qcow2</strong> image and <strong>Aboot-veos-serial-8.0.2.iso</strong> from arista.com and uploaded the qcow2 image to my Proxmox /tmp folder and the iso image to my ISO Images storage.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251114074513277.png"
        alt="ISO Images"
      />
      
    </figure>
</p>
<p>Then I created a virtual machine in Proxmox with the following configurations <em>(I dont use more than two of the nics. 1 for mgmt and 1 for dataplane)</em>.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251114074146277.png"
        alt="vZTX-vm"
      />
      
    </figure>
</p>
<p>Notice the Serial Port, this must be added to the VM otherwise it will not boot.</p>
<p>The harddisk was imported using the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">qm importdisk <span class="m">7988</span> /tmp/CloudEOS64-4.35.0F.qcow2 raid-10-node02 -format raw
</span></span></code></pre></div><p><em>raid-10-node02 is my storage</em></p>

  



<div
  
    class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"
  >

  <span
    
      class="text-primary-400 ltr:pr-3 rtl:pl-3 flex items-center"
    >

    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M506.3 417l-213.3-364c-16.33-28-57.54-28-73.98 0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6C502.1 480 522.6 445 506.3 417zM232 168c0-13.25 10.75-24 24-24S280 154.8 280 168v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zM256 416c-17.36 0-31.44-14.08-31.44-31.44c0-17.36 14.07-31.44 31.44-31.44s31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg>

  </span>


  </span>

  <span
    
      class="dark:text-neutral-300"
    ><p>This is a lab, if using the vZTX in production there are some requirements that needs to be in place:</p>
<p>SR-IOV is a MUST in production (not supported otherwise), but in my lab I did not have any free NICs for this purpose so I had to use VIRTIO. Again, this is in my lab, and performance is not an absolute must. Unless I do something that limits my Internet speed, then I will have some explaining to do for my kids &#x1f604;</p>
</span>
</div>



<h4 class="relative group">Moving the CloudEOS to Monitor Mode 
    <div id="moving-the-cloudeos-to-monitor-mode" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#moving-the-cloudeos-to-monitor-mode" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>When the vZTX has been configured in Proxmox its time to power it up. It will boot up with a very simple config. Username defaults to admin, and there is no password or was the password admin? Dont remember.</p>
<p>Before I can use the CloudEOS image as my ZTX appliance the first thing that needs to be done is to move the CloudEOS into monitor mode after first boot. This is done by running the following commands:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Verify the veos-config before</span>
</span></span><span class="line"><span class="cl">vZTX# bash cat /mnt/flash/veos-config
</span></span><span class="line"><span class="cl"><span class="nv">MODE</span><span class="o">=</span>sfe
</span></span><span class="line"><span class="cl">vZTX#
</span></span></code></pre></div><p>Now perform the configuration:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">vZTX# configure
</span></span><span class="line"><span class="cl">vZTX<span class="o">(</span>config<span class="o">)</span><span class="c1"># firewall distributed instance</span>
</span></span><span class="line"><span class="cl">vZTX<span class="o">(</span>config-firewall-distributed-instance<span class="o">)</span><span class="c1"># no disabled</span>
</span></span><span class="line"><span class="cl">vZTX<span class="o">(</span>config-firewall-distributed-instance<span class="o">)</span><span class="c1"># end</span>
</span></span><span class="line"><span class="cl">vZTX# write
</span></span><span class="line"><span class="cl">vZTX# reload
</span></span></code></pre></div><p>When the switch boots back up login again and verify veos-config after the config above:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Verify the veos-config after</span>
</span></span><span class="line"><span class="cl">vZTX# bash cat /mnt/flash/veos-config
</span></span><span class="line"><span class="cl"><span class="nv">MODE</span><span class="o">=</span>sfe
</span></span><span class="line"><span class="cl"><span class="nv">platformRuby</span><span class="o">=</span>True
</span></span><span class="line"><span class="cl"><span class="nv">maxDatapathCores</span><span class="o">=</span><span class="m">2</span>
</span></span><span class="line"><span class="cl">vZTX# 
</span></span></code></pre></div><p>Thats it.</p>


<h4 class="relative group">Basic configurations - Management1-p2p link-loopback 
    <div id="basic-configurations---management1-p2p-link-loopback" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#basic-configurations---management1-p2p-link-loopback" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>Now I can proceed to do the other configurations like mgmt interface, hostname, DNS, NTP and p2p link to my 720XP switch. See below for my running-config:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreas-ztx1#show running-config
</span></span><span class="line"><span class="cl">! Command: show running-config
</span></span><span class="line"><span class="cl">! device: andreas-ztx1 <span class="o">(</span>CloudEOS, EOS-4.35.0F-cloud<span class="o">)</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">! boot system flash:/CloudEOS.swi
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">no aaa root
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">username admin privilege <span class="m">15</span> role network-admin secret sha512 &lt;hash-redacted&gt;
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">management api http-commands
</span></span><span class="line"><span class="cl">   no shutdown
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vrf MGMT
</span></span><span class="line"><span class="cl">      no shutdown
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">daemon TerminAttr
</span></span><span class="line"><span class="cl">   <span class="nb">exec</span> /usr/bin/TerminAttr -smashexcludes<span class="o">=</span>ale,flexCounter,hardware,kni,pulse,strata -cvaddr<span class="o">=</span>URL -cvauth<span class="o">=</span>token-secure,/tmp/cv-onboarding-token -taillogs -cvvrf<span class="o">=</span>MGMT -cvsourceintf<span class="o">=</span>Management1
</span></span><span class="line"><span class="cl">   no shutdown
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">switchport default mode routed
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">no service interface inactive port-id allocation disabled
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">transceiver qsfp default-mode 4x10G
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">service routing protocols model multi-agent
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">kernel software forwarding ecmp
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">hostname andreas-ztx1
</span></span><span class="line"><span class="cl">ip name-server vrf MGMT 10.100.1.7
</span></span><span class="line"><span class="cl">ip name-server vrf default 10.100.1.7
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">spanning-tree mode mstp
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">system l1
</span></span><span class="line"><span class="cl">   unsupported speed action error
</span></span><span class="line"><span class="cl">   unsupported error-correction action error
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">clock timezone Europe/Oslo
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vrf instance MGMT
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Ethernet1
</span></span><span class="line"><span class="cl">   no switchport
</span></span><span class="line"><span class="cl">   ip address 172.18.111.2/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Ethernet2
</span></span><span class="line"><span class="cl">   no switchport
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Loopback0
</span></span><span class="line"><span class="cl">   ip address 10.255.1.11/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Management1
</span></span><span class="line"><span class="cl">   description management
</span></span><span class="line"><span class="cl">   vrf MGMT
</span></span><span class="line"><span class="cl">   ip address 172.18.100.201/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">firewall distributed instance
</span></span><span class="line"><span class="cl">   no disabled
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip routing
</span></span><span class="line"><span class="cl">no ip routing vrf MGMT
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip route 0.0.0.0/0 172.18.111.1
</span></span><span class="line"><span class="cl">ip route vrf MGMT 0.0.0.0/0 172.18.100.2
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">arp aging timeout default <span class="m">180</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ntp local-interface vrf MGMT Management1
</span></span><span class="line"><span class="cl">ntp server vrf MGMT 10.100.1.7 prefer
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">end
</span></span></code></pre></div><p>Before onboarding the vZTX to CloudVision I did all the above configurations except:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">daemon TerminAttr
</span></span><span class="line"><span class="cl">   <span class="nb">exec</span> /usr/bin/TerminAttr -smashexcludes<span class="o">=</span>ale,flexCounter,hardware,kni,pulse,strata -cvaddr<span class="o">=</span>URL -cvauth<span class="o">=</span>token-secure,/tmp/cv-onboarding-token -taillogs -cvvrf<span class="o">=</span>MGMT -cvsourceintf<span class="o">=</span>Management1
</span></span><span class="line"><span class="cl">   no shutdown
</span></span><span class="line"><span class="cl">!
</span></span></code></pre></div><p>The TerminAttr config will be done as part of the CloudVision onboarding process. Just follow the guide in CloudVision.</p>
<p>The documentation is not stating that the Management interface MUST be in the default VRF, I created a dedicated MGMT vrf and placed it there. That is the only VRF I have configured. Then I configured interface Ethernet1 as the p2p link to my Arista 720XP switch, and a Loopback0 interface. This loopback interface will be used later when I configure MSS Monitor object in CloudVision later. Then a default route in the default VRF using my 720XP p2p link as gateway. I used a /24 subnet for these p2p links which is unnecessary.</p>
<p>Now my vZTX is ready configured with its necessary configuration and I can onboard it to CloudVision.</p>


<h4 class="relative group">Onboarding the vZTX to CloudVision 
    <div id="onboarding-the-vztx-to-cloudvision" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#onboarding-the-vztx-to-cloudvision" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>Go to Device and Inventory in Cloudvision and click on <em>+ Onboard Device</em>.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251115122213583.png"
        alt="onboard"
      />
      
    </figure>
</p>
<p>Then follow the steps outlined there:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251115122343884.png"
        alt="onboard_steps"
      />
      
    </figure>
</p>
<p>This may also be done using your preferred ZTP/bootstrap approach.</p>
<p>*Under the General Requirements it says: <em>Have the Streaming Agent extension installed (minimum version 1.19.5). Click <a href="https://www.arista.com/en/support/software-download" target="_blank">here</a> to download the Streaming Agent extension. If you already have the right minimum terminattr version on your EOS this can be skipped</em></p>
<p>My vZTX onboarded to CloudVision together with my 720XP:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113203605371.png"
        alt="my-devices"
      />
      
    </figure>
</p>


<h3 class="relative group">My Arista 720XP switch 
    <div id="my-arista-720xp-switch" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#my-arista-720xp-switch" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>On my Arista 720XP there is very little to do except to configure the necessary connectivity between the vZTX and the 720XP switch. For that I created a vlan interface using VLAN 1111:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">interface Vlan1111
</span></span><span class="line"><span class="cl">   description vZTX_tunnel_interface
</span></span><span class="line"><span class="cl">   ip address 172.18.111.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Loopback0
</span></span><span class="line"><span class="cl">   description vZTX_tunnel
</span></span><span class="line"><span class="cl">   ip address 10.255.1.10/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip route 10.255.1.11/32 172.18.111.2
</span></span></code></pre></div><p>A Loopback0 interface, a static route pointing to the vZTX Loopback0 interface (Dynamic routing is also possible). Thats it for the actual switch configuration needed on the 720XP.</p>

  



<div
  
    class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"
  >

  <span
    
      class="text-primary-400 ltr:pr-3 rtl:pl-3 flex items-center"
    >

    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M506.3 417l-213.3-364c-16.33-28-57.54-28-73.98 0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6C502.1 480 522.6 445 506.3 417zM232 168c0-13.25 10.75-24 24-24S280 154.8 280 168v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zM256 416c-17.36 0-31.44-14.08-31.44-31.44c0-17.36 14.07-31.44 31.44-31.44s31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg>

  </span>


  </span>

  <span
    
      class="dark:text-neutral-300"
    ><p>I got this error when I tried to apply certain rules in MSS on my 720XP:</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="images/image-20251118083125706.png" alt="cc_error" />
      
    </figure>
</p>
<p>After some more reading in this <a href="https://www.arista.com/assets/data/pdf/user-manual/um-books/MSS-Deployment-Guide.pdf" target="_blank">doc</a> on page 13, one need to add this config:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">traffic-policies
</span></span><span class="line"><span class="cl">   transforms interface prefix common source-destination
</span></span></code></pre></div><p>This can easily be added as part of your static configs in CloudVision. It will not be overwritten by MSS. It will be preserved.</p>
</span>
</div>

<p>Next up is CloudVision preparations</p>


<h4 class="relative group">Connection between vZTX and my 720XP 
    <div id="connection-between-vztx-and-my-720xp" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#connection-between-vztx-and-my-720xp" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>With the above configurations done on both the vZTX and my 720XP it looks like this:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251114101333854.png"
        alt="vZTX-720XP"
      />
      
    </figure>
</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#vZTX config:</span>
</span></span><span class="line"><span class="cl">interface Ethernet1
</span></span><span class="line"><span class="cl">   no switchport
</span></span><span class="line"><span class="cl">   ip address 172.18.111.2/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Loopback0
</span></span><span class="line"><span class="cl">   ip address 10.255.1.11/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip route 0.0.0.0/0 172.18.111.1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Arista 720XP switch:</span>
</span></span><span class="line"><span class="cl">interface Vlan1111
</span></span><span class="line"><span class="cl">   description vZTX_tunnel_interface
</span></span><span class="line"><span class="cl">   ip address 172.18.111.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Loopback0
</span></span><span class="line"><span class="cl">   description vZTX_tunnel
</span></span><span class="line"><span class="cl">   ip address 10.255.1.10/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip route 10.255.1.11/32 172.18.111.2
</span></span></code></pre></div>

<h3 class="relative group">CloudVision preparations 
    <div id="cloudvision-preparations" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#cloudvision-preparations" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>The necessary MSS specific configurations on both my vZTX appliance and Arista 720XP switch will be taken care of by the MSS Service Studio. I just need to follow some initial steps to get the devices onboarded to be &ldquo;MSS ready&rdquo; with the MSS Service Studio.</p>
<p>Everything MSS related is managed by Studios and Workspaces. When the initial config has been done with the MSS Studio, the rest can be done from the Network Security section in CloudVision:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113203356406.png"
        alt="network-security"
      />
      
    </figure>
</p>
<p>To make sure all the MSS related features in CloudVision is readily available in the UI they may have to be enabled. Head over to settings in CloudVision and Features and enable the following features:</p>
<ul>
<li>Network Security- MSS</li>
<li>Network Security - Fine-Grained Policy Monitor Loading</li>
<li>Workspace Island - optional</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113202728185.png"
        alt="cvp-features"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113202933052.png"
        alt="workspace-island"
      />
      
    </figure>
</p>
<p>Workspace Island is very useful when there are many changes that needs to be made, building, rebuilding and quickly see changes in your workspace is always there in the bottom of the screen. Readily available when you need to see what impact your changes has done etc.</p>
<p>Screenshot of the Island&hellip;</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113205549192.png"
        alt="workspace-island"
      />
      
    </figure>
</p>
<p>Then ofcourse the MSS related features in CloudVision (if not already enabled).</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113135132913.png"
        alt="mss-features"
      />
      
    </figure>
</p>
<p>I have already onboarded my 720XP switch into CloudVision and I have also onboarded my vZTX appliance into CloudVision with minimal (but necessary) configurations done (see previous chapter on preparing the vZTX).</p>
<p>I have decided to put all MGMT relevant stuff in a separate MGMT vrf.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113203605371.png"
        alt="my-devices"
      />
      
    </figure>
</p>
<p>Now I need to do the initial config to make my vZTX and 720XP MSS &ldquo;ready&rdquo;. This involves the Studio called &ldquo;MSS Service&rdquo; under Provisioning.</p>

  



<div
  
    class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"
  >

  <span
    
      class="text-primary-400 ltr:pr-3 rtl:pl-3 flex items-center"
    >

    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M506.3 417l-213.3-364c-16.33-28-57.54-28-73.98 0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6C502.1 480 522.6 445 506.3 417zM232 168c0-13.25 10.75-24 24-24S280 154.8 280 168v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zM256 416c-17.36 0-31.44-14.08-31.44-31.44c0-17.36 14.07-31.44 31.44-31.44s31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg>

  </span>


  </span>

  <span
    
      class="dark:text-neutral-300"
    ><p><em>As I am sharing the CvaaS instance with my colleagues I like to clone the Studios to my &ldquo;own&rdquo; Studios. Then I can do all the changes in my own Studios with my own selected devices without disrupting any of their studios and devices.</em></p>
<p><em>With the MSS Service Studio, this will not work.</em></p>
</span>
</div>

<p>Select the default &ldquo;MSS Studio&rdquo; and complete the two tasks needed there:</p>
<ol>
<li>Add a Security Domain</li>
<li>Add a Monitor Object</li>
</ol>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113214852204.png"
        alt="image-20251113214852204"
      />
      
    </figure>
</p>


<h4 class="relative group">Security Domain and Monitor Object 
    <div id="security-domain-and-monitor-object" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#security-domain-and-monitor-object" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>The first that needs to be added to the Studio is the device selection. Add your devices (in my case my one 720XP) here under Device Selection:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113215022288.png"
        alt="add-device-to_studio"
      />
      
    </figure>
</p>
<p>Then add a Security Domain: click <em>+Add Security Domain</em></p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113215114258.png"
        alt="security-domain"
      />
      
    </figure>
</p>
<p>Then type in the name of the domain and click plus to create:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113212002224.png"
        alt="create"
      />
      
    </figure>
</p>
<p>We need to click the &gt; to add the devices we want to be part of the Security Domain. The Security Domain is the collection of switches that you want to enable a set of shared rules and policies on. This can be a site, building, branch, edge or datacenter. We can have several security domains, assigned to different sets of switches.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113215240807.png"
        alt="click-arrow-&amp;gt;"
      />
      
    </figure>
</p>
<p>Click on the Security Domain name: security-domain:andreas-lab-domain and select the device from the dropdown menu:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113215418329.png"
        alt="add-dev-to-domain"
      />
      
    </figure>
</p>
<p>Go back by clicking at MSS Service in the blue text.</p>
<p>Next step is to add a Monitor Object:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113212452018.png"
        alt="monitor-objects"
      />
      
    </figure>
</p>
<p>Click + Add Monitor Object. This is quite straightforward. It will use the loopback interfaces configured on both the vZTX appliance but also the TOR switches that is part of the Security Domain. So in my lab I will use this information:</p>
<ul>
<li>Name: andreas-vztx</li>
<li>Exporter Interface: loopback0</li>
<li>Active Timeout: Default 1800000</li>
<li>Tunnel Destination IP: 10.255.1.11 (the loopback0 interface ip of my vZTX)</li>
<li>Tunnel Source Interface: looback0 (the loopback interface configured on all the tor switches in the security domain. Must be same interface on all)</li>
<li>Rate Limit: Default 100000</li>
</ul>
<p>Then under Monitor Cluster Click &ldquo;View&rdquo; and add the Monitor Node:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113215558215.png"
        alt="monitor-node"
      />
      
    </figure>
</p>
<p>Go back by clicking on MSS Service in the blue text.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113213526732.png"
        alt="monitor_object"
      />
      
    </figure>
</p>
<p>Now a very important task. When you are back in the MSS Studio. Go all the way upp and look for the blue lightning symbol.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113215718176.png"
        alt="lightning"
      />
      
    </figure>
</p>
<p>Click it! ( I assure you, its not dangerous)</p>
<p>It will start a wheel for a couple of seconds and a green notification will update you when it is ready.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113215911672.png"
        alt="auto-populate"
      />
      
    </figure>
</p>
<p>Do a <em>build</em> on the Workspace Island:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113215957973.png"
        alt="build"
      />
      
    </figure>
</p>
<p>Then do a <em>Review</em>:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113220103434.png"
        alt="review"
      />
      
    </figure>
</p>
<p>Submit the Workspace:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113220132657.png"
        alt="submit-workspace"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113213718400.png"
        alt="submitting"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113213735013.png"
        alt="success"
      />
      
    </figure>
</p>
<p>Now, one can head over to Network Security and start work some magic with MSS</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113220314462.png"
        alt="network-security"
      />
      
    </figure>
</p>
<p>Its now the fun begins.</p>


<h3 class="relative group">My lab 
    <div id="my-lab" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#my-lab" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>For better context, below is how my lab environment looks like.</p>
<p>My lab consists of two Proxmox servers forming a cluster using a qdevice (RPi) to form a quorom. These servers are both connected to the same Arista 720XP switch. My perimeter firewall is a virtual PfSense running as a virtual machine on the Proxmox servers.</p>
<p>The Arista 720XP holds all my VLANs, it does routing when routing is needed between VLANs, where gateway of last resort is my PfSense firewall. I dont do much filtering between my vlans through the PfSense except a wifi guest network.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251114084901247.png"
        alt="lab"
      />
      
    </figure>
</p>
<p>That means I have a bunch of virtual machines placed in different vlans serving different needs, they are free to communicate with each other, within the same VLAN but also VLAN to VLAN. In addition to the virtual machines, I also have a bunch of physical devices like wired devices and wifi devices that also freely communicate through my 720XP switch.</p>
<p>This is something MSS can be tasked to do something about.</p>


<h2 class="relative group">Network Security in CloudVision 
    <div id="network-security-in-cloudvision" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#network-security-in-cloudvision" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>There is a dedicated section for MSS in CloudVision called <em>Network Security</em>. This is where most tasks related to MSS like creating policies, rules, services, groups, monitor policies and devices are administered. When entering <em>Network Security</em> section in CloudVision I will be greeted by the MSS Dashboard. This will give me a quick glimpse of my MSS &ldquo;estate&rdquo;. From the amount of registered Monitoring Nodes and MSS Devices (MSS &ldquo;enabled&rdquo; switches) to events and policies related to these devices:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251117152241363.png"
        alt="mss-dashboard"
      />
      
    </figure>
</p>
<p>I can go into Policy Manager to find more relevant details about my MSS Devices and Monitor Nodes.</p>
<p>Under Domains I find my Security Domain <em>andreas-lab-domain</em> with my device selected:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113220638501.png"
        alt="sec-domain"
      />
      
    </figure>
</p>
<p>And under Policy Manager, Policy Objects I find my Monitor Object with my vZTX appliance assigned as Monitor Node:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251113220830377.png"
        alt="monitor-node"
      />
      
    </figure>
</p>
<p>But no rules and policies yet.</p>
<p>Let me quickly go over the different things in the Network Security view and explain what they are.</p>


<h3 class="relative group">Policy Manager 
    <div id="policy-manager" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#policy-manager" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>In the Policy Manager there are several sections:</p>
<ul>
<li>Domains</li>
<li>Policies</li>
<li>Rules</li>
<li>Groups</li>
<li>Policy Objects</li>
</ul>


<h4 class="relative group">Domains 
    <div id="domains" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#domains" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>Under <em>Domains</em> I can view my Security Domains, see details of the Security Domains which devices are part of the domain and any Policy assignements.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251117152930635.png"
        alt="domains"
      />
      
    </figure>
</p>


<h4 class="relative group">Policies 
    <div id="policies" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#policies" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>In <em>Policies</em> is where we define our rules to be applied. I can have many policies, but I can also have many rules in a policy.  A policy is a section where we define the rules should be &ldquo;applied to&rdquo;, what objects the rules involve. Like one do under NSX, a policy section in the distributed firewall is where the rules for an application or infrastructure services are defined. This is the same. A policy is a section where I define where I want the rules to be applied. A policy is typically named after what its intention is, eg <em>application A</em> or <em>infrastructure_services</em>. The only difference here with MSS Policy is I define the Policy per <strong>VRF</strong>.</p>
<p>From the NSX-T manager:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118085047919.png"
        alt="policies-rules"
      />
      
    </figure>
</p>
<p>When I create a policy in MSS, I give it a name, a description and map it which security domain and respective VRF in that domain.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118090546454.png"
        alt="mss-policy"
      />
      
    </figure>
</p>
<p>But there are still no rules yet.</p>


<h4 class="relative group">Rules 
    <div id="rules" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#rules" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>Under the Rules section is where I create and define the rules I want. When the rule has been created I can also assign the rule(s) to a policy, which is done under the Policy section.</p>
<p>A rule can look like this:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118091201349.png"
        alt="example-rule"
      />
      
    </figure>
</p>
<p>I give the rule a meaningful name, a description. Then I define what the <em>Source</em> is, which could be static ip-groups, dynamic groups from 3rd party sources like vCenter, ServiceNow etc. The same is true for the <em>Destination</em>. Then <em>Services</em> which services should this rule involve. These are ports and protocols created and defined under Policy Objects (later). Which <em>Direction</em> you are interested in, <em>Uni-directional</em> or <em>Bi-directional</em>. Then it is <em>Decap Type</em>:</p>
<ul>
<li><strong>Decap Type</strong>: This configuration determines how VXLAN encapsulated traffic is decapsulated, or has its VXLAN header removed. Select from the available options.:
<ul>
<li><strong>Allow All</strong>: Applies to traffic after its VXLAN header is removed, enabling full visibility into the original workload data</li>
<li><strong>VXLAN Decap Only</strong>: Dictates that traffic must be decapsulated of its VXLAN header before further processing, revealing the original workload data</li>
<li><strong>No VXLAN Decap</strong>: Applies to traffic without removing its VXLAN header, limiting visibility to outer network details</li>
</ul>
</li>
</ul>
<p>** <em>Source: CloudVision Help Center</em></p>
<p>Under <em>Rule Action</em> I can select Drop, Forward or Redirect.</p>
<p>Under Monitor Object I can tell MSS to create a &ldquo;monitor&rdquo; rule which will mirror the traffic to my vZTX for visibility but also rule recommendations.</p>
<p>When I have created a rule I can go to Policies and assign the rule to a policy like this:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118093437716.png"
        alt="manage"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118093257763.png"
        alt="assign-rule-to-policy"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118093336806.png"
        alt="assigned"
      />
      
    </figure>
</p>


<h4 class="relative group">Groups 
    <div id="groups" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#groups" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>Under *Groups&quot; I can add my static IP groups. Subnets, host ip addresses that I can use in my rules.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118092703211.png"
        alt="ip-groups"
      />
      
    </figure>
</p>
<p>I only have static groups, but MSS do support dynamic groups generated from sources like vCenter, ServiceNow etc. When I have created my groups, I can assign them to categories. This will improve how the rule recommendation creation later is done. To create categories and assign them click here:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118120202774.png"
        alt="categories"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118120254409.png"
        alt="create_assign"
      />
      
    </figure>
</p>
<p>I created two categories and assigned them to their ip group respectively:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118120330955.png"
        alt="categories_assigned"
      />
      
    </figure>
</p>


<h4 class="relative group">Policy Objects 
    <div id="policy-objects" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#policy-objects" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>Under Policy Objects is where I can add and define my services, redirect object (external firewall) to be used in my rules.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118092902878.png"
        alt="policy-objects"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118092942079.png"
        alt="dns-service"
      />
      
    </figure>
</p>


<h3 class="relative group">Policy Monitor 
    <div id="policy-monitor" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#policy-monitor" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>In the Policy Monitor view I can get the status of my defined policies, but also the state of my MSS enabled devices and utilization:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118094234463.png"
        alt="monitor_policies"
      />
      
    </figure>
</p>
<p>Monitor devices:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118094316187.png"
        alt="devices"
      />
      
    </figure>
</p>


<h3 class="relative group">Policy Builder 
    <div id="policy-builder" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#policy-builder" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>If have created a rule with a Monitor Object, I can view the policies being analyzed in here.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118094535100.png"
        alt="collecting"
      />
      
    </figure>
</p>
<p>This is a really neat feature as it can recommend rules based on the discoveries. If I have a look at the Collected Sessions for my one policy:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118094639246.png"
        alt="collected_sessions"
      />
      
    </figure>
</p>
<p>It does a really good job discovering both DNS and NTP requests to my two backed servers hosting DNS and NTP. This collection process should go for a while to discover as much as possible, and if I am satisfied I can go back to the Policy View again and let it create some rule recommendations.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118094831047.png"
        alt="generate_rules"
      />
      
    </figure>
</p>
<p>Below is just a quick suggestion of what it has discovered. More on this later</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118094942304.png"
        alt="proposed_rules"
      />
      
    </figure>
</p>
<p>I can even have a look at the collected session per flow:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118095041290.png"
        alt="collected_sessions_view"
      />
      
    </figure>
</p>
<p>To see what it has based this rule on per flow.</p>
<p>Now I can click submit rules and it will create a workspace with the suggested configurations to be sent to my switches.</p>


<h2 class="relative group">Creating network policies and rules 
    <div id="creating-network-policies-and-rules" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#creating-network-policies-and-rules" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>Now that I have gone through how things work with MSS and CloudVision, I can finally create some policies.</p>
<p>I will focus on doing it simple to begin with and create two policies. One policy where I allow DNS and NTP from a specific subnet to my two DNS,NTP servers and let the Policy Builder generate a rule for that.</p>
<p>My second policy will be focused on a simple http service running on two different  linux VMs, an application server on another VM the webserver are depending on. I will create a monitor policy to discover what they are doing between themselves and let Policy Builder generate some recommended rules. I will block unnecessary traffic between them.</p>
<p>Then I will also showcase that Arista MSS can even be used to isolate Virtual Machines hosted on the same physical hypervisor on the same VLAN. In my case I am using Proxmox with Linux Bridge.</p>


<h3 class="relative group">First rules - DNS and NTP policy 
    <div id="first-rules---dns-and-ntp-policy" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#first-rules---dns-and-ntp-policy" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>From the Policy Manager, Policies view I have created this Policy:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118112631439.png"
        alt="dns_policy"
      />
      
    </figure>
</p>
<p>I have created this rule under the Rules view and assigned it to my above policy:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118112737324.png"
        alt="dns_rule"
      />
      
    </figure>
</p>
<p>In this rule I using the following services and groups I have created under Policy Objects:</p>
<ul>
<li>Source: Static IP group <em>wifi-clients</em> = 172.18.6.0/24</li>
<li>Destination: Static IP group <em>DNS_NTP_servers</em> = 10.100.1.6/32, 10.100.1.7/32</li>
<li>Servic DNS: Protocol UDP, destination port 53, source port all</li>
<li>Service NTP: Protocl UDP, destination port 123, source port all</li>
<li>action is forward</li>
<li>monitor object is my vZTX appliance.</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118113152113.png"
        alt="objects"
      />
      
    </figure>
</p>
<p>So far no configuration has been done on my switch, nor my vZTX monitor node. The only traffic policy configuration is my <em>transform interface prefix common source-destination</em>.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118113856374.png"
        alt="switch-config"
      />
      
    </figure>
</p>
<p>Now I can go ahead and use the Worspace Island to build the configuration for me and have a look at what the changes will be.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118114059223.png"
        alt="changes"
      />
      
    </figure>
</p>
<p>There are 2 devices with proposed config changes. Lets build this workspace and see what these changes are:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118114224127.png"
        alt="vZTX"
      />
      
    </figure>
</p>
<p>The vZTX gets some new configuration, the gre tunnel to my 720XP switch.</p>
<p>My 720XP gets these configurations:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118114317162.png"
        alt="720xp"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118114355356.png"
        alt="720xp_2"
      />
      
    </figure>
</p>
<p>And above is the configurations it proposes for my 720XP. Ok lets submit this workspace and run the automatically created change control.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118114519620.png"
        alt="approve_run"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118114609932.png"
        alt="success"
      />
      
    </figure>
</p>
<p>Now lets head over to the Policy Builder and monitor the collected sessions:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118114646672.png"
        alt="policy_builder"
      />
      
    </figure>
</p>
<p>It has already captured both NTP and DNS requests:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118114742050.png"
        alt="dns_ntp_collection"
      />
      
    </figure>
</p>
<p>Looking good. Now I cant wait anymore. Let Policy Builder generate some rules</p>
<p>When clicking on the Generate button I can now select which categories it should base it rule generation on. I already have created my two categories which involves my source group and destination group.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118120657263.png"
        alt="categories_rules"
      />
      
    </figure>
</p>
<p>By selecting these two relevant categories, the rule proposal will be much more optimized in how it creates the rules. Lets have a look:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118120815409.png"
        alt="rules_proposed"
      />
      
    </figure>
</p>
<p>Yes, it no longer proposes a rule based on every IP it discovers, but the groups assigned to the categories.</p>
<p>Lets see what these rules will look like in terms of configuration changes on my switch. Click submit and then build on the Workspace Island:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118121009337.png"
        alt="changes"
      />
      
    </figure>
</p>
<p>24 lines added to the config. That is a lot more effecient than several hundreds of lines if going by every source IP.</p>
<p>Lets have a look at the review:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118121147095.png"
        alt="24_changes"
      />
      
    </figure>
</p>
<p>These are the changes. Submit and Approve the Change Control job.</p>
<p>In Policy Builder my two rule recommendations:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118121410751.png"
        alt="rule_recommendations"
      />
      
    </figure>
</p>
<p>But there, there is a but. I noticed it added these two rules in addition to my manually create monitor rule, see the last rule.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118120815409.png"
        alt="rules_proposed"
      />
      
    </figure>
</p>
<p>I can make it much more optimized in terms of the number of configuration lines on my switch by going back to Rules under Policy Manager, remove it from my policy and delete it:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118122031049.png"
        alt="delete_manual_rule"
      />
      
    </figure>
</p>
<p>This removes further 20 lines, why? Because I also remove the monitor rule. If I still want to monitor the newly created rules i need to add a monitor to them.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118122152254.png"
        alt="remove_20"
      />
      
    </figure>
</p>
<p>When it comes to the name of the rules, there seems to be no option to name them manually except going back and rename them after they have been applied created.</p>
<p>Lets see the changes:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118122800926.png"
        alt="changes"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251118122827560.png"
        alt="changes_2"
      />
      
    </figure>
</p>
<p>In my switch now I have this configuration:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">traffic-policies
</span></span><span class="line"><span class="cl">   vrf ALL
</span></span><span class="line"><span class="cl">      traffic-policy input dns_ntp_services physical
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set ipv4 prefix DNS_NTP_servers
</span></span><span class="line"><span class="cl">      10.100.1.6/32 10.100.1.7/32
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set ipv4 prefix wifi_clients
</span></span><span class="line"><span class="cl">      172.18.6.0/24
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set service DNS
</span></span><span class="line"><span class="cl">      protocol udp <span class="nb">source</span> port all destination port domain
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set service DNS-reverse
</span></span><span class="line"><span class="cl">      protocol udp <span class="nb">source</span> port domain destination port all
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set service NTP
</span></span><span class="line"><span class="cl">      protocol udp <span class="nb">source</span> port all destination port ntp
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set service NTP-reverse
</span></span><span class="line"><span class="cl">      protocol udp <span class="nb">source</span> port ntp destination port all
</span></span><span class="line"><span class="cl">   transforms interface prefix common source-destination
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   traffic-policy dns_ntp_services
</span></span><span class="line"><span class="cl">      !! Allow DNS and NTP requests to 10.100.1.6 and 10.100.1.7
</span></span><span class="line"><span class="cl">      description <span class="c1">#policy-id=256</span>
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match rule72 ipv4
</span></span><span class="line"><span class="cl">         <span class="nb">source</span> prefix field-set wifi_clients
</span></span><span class="line"><span class="cl">         destination prefix field-set DNS_NTP_servers
</span></span><span class="line"><span class="cl">         protocol service field-set NTP
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match rule72-reverse ipv4
</span></span><span class="line"><span class="cl">         <span class="nb">source</span> prefix field-set DNS_NTP_servers
</span></span><span class="line"><span class="cl">         destination prefix field-set wifi_clients
</span></span><span class="line"><span class="cl">         protocol service field-set NTP-reverse
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match rule73 ipv4
</span></span><span class="line"><span class="cl">         <span class="nb">source</span> prefix field-set wifi_clients
</span></span><span class="line"><span class="cl">         destination prefix field-set DNS_NTP_servers
</span></span><span class="line"><span class="cl">         protocol service field-set DNS
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match rule73-reverse ipv4
</span></span><span class="line"><span class="cl">         <span class="nb">source</span> prefix field-set DNS_NTP_servers
</span></span><span class="line"><span class="cl">         destination prefix field-set wifi_clients
</span></span><span class="line"><span class="cl">         protocol service field-set DNS-reverse
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span></code></pre></div><p>Now, I do not have any drop rules in place. So my above rules did not make it more strict in my environment. Lets create some drop rules too. For that I will use another environment involving three virtual machines where two of them works as a web-servers hosting a simple webpage and the third as the application server serving the web-pages.</p>


<h3 class="relative group">Application Policy - Web and Application Servers 
    <div id="application-policy---web-and-application-servers" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#application-policy---web-and-application-servers" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>In this scenario I will create an &ldquo;application&rdquo; focused policy. It will involve the three above mentioned virtual machines. I will apply rules allowing all of them to reach DNS and NTP, the clients will be allowed to reach the two web-servers only on HTTP while the two web-servers are not allowed to communicate with each other at all. But both web servers are allowed to reach the appserver1 on TCP:4567. All else is dropped.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251119114039240.png"
        alt="web-app-rules"
      />
      
    </figure>
</p>
<p>Before I start microsegmenting the web-application I have created a simple monitor rule to catch whats going on, presuming I dont know anything about the application and its dependencies:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251119081717750.png"
        alt="web-appserver"
      />
      
    </figure>
</p>
<p>This rule is very simple, it selects the three servers web01, web02 and appserver1 as source, destination and services are both any any.</p>
<p>Lets see what the Policy Builder discovers:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251119082352200.png"
        alt="observations"
      />
      
    </figure>
</p>
<p>I can see they are doing NTP and DNS requests to my my DNS servers, HTTP requests coming from a wifi client, both the web-servers requests the appserver1 over tcp 4567 and some HTTP to the internet, Ubuntu repositories for updates. Will I allow that? Not now, they can stay offline at the moment. They are too fragile to be connected to the big Internet anyways.</p>
<p>Okay, lets lock things down.</p>
<p>Based on the collected sessions I am pretty sure what this application needs, so I will create rules supporting that. Below is the rules I have created:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251119103656095.png"
        alt="rules_webapp"
      />
      
    </figure>
</p>
<p>And the order they are placed and enforced:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251119180235695.png"
        alt="rules_order"
      />
      
    </figure>
</p>
<p>In the following groups:</p>
<ul>
<li>web01_web02 = <em>10.100.99.51/32</em> &amp; <em>10.100.99.52/32</em> (web01 and web02)</li>
<li>appserver1 = 10.100.99.50/32 (appserver1)</li>
<li>Web-appserver1 = <em>10.100.99.51/32</em>, <em>10.100.99.52/32</em> (web01, web02) and 10.100.99.50/32 (appserver1)</li>
</ul>
<p>Now lets see if the rules works as intended. As I only have allowed HTTP to the web servers, and nothing to the appserver1, except http the application specific TCP port from the web server to the application server I have no option to do SSH to the servers. Only way to reach them now is through console.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#SSH to Web02</span>
</span></span><span class="line"><span class="cl">➜  ~ ssh andreasm@10.100.99.52
</span></span><span class="line"><span class="cl">ssh: connect to host 10.100.99.52 port 22: Operation timed out
</span></span></code></pre></div><p>Well that was a first test.. It is not possible to SSH to any of the 3 involved servers.</p>
<p>Lets create an allow rule only for SSH to all 3 servers to make it more comfortable to manage and access instead of console.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251119132243163.png"
        alt="allow_from_wifi_clients"
      />
      
    </figure>
</p>
<p>Adding this rule, I am allowing my laptop which is on wifi to connect directly to the web01, web02 and appserver1 via SSH.</p>
<p>Now some tests:</p>
<p>Can I reach any of the three servers from any other subnet than my wifi-client subnet?</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># From my linux management server in subnet 10.100.5.0/24</span>
</span></span><span class="line"><span class="cl">andreasm@linuxmgmt10:~$ ssh 10.100.99.50 <span class="c1">#appserver1</span>
</span></span><span class="line"><span class="cl">ssh: connect to host 10.100.99.50 port 22: Connection timed out
</span></span><span class="line"><span class="cl"><span class="c1"># From my laptop</span>
</span></span><span class="line"><span class="cl">➜  ~ ssh andreasm@10.100.99.51
</span></span><span class="line"><span class="cl">andreasm@10.100.99.51<span class="err">&#39;</span>s password:
</span></span><span class="line"><span class="cl">Welcome to Ubuntu 22.04.3 LTS <span class="o">(</span>GNU/Linux 5.15.0-87-generic x86_64<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> * Documentation:  https://help.ubuntu.com
</span></span><span class="line"><span class="cl"> * Management:     https://landscape.canonical.com
</span></span><span class="line"><span class="cl"> * Support:        https://ubuntu.com/advantage
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  System information as of Wed Nov <span class="m">19</span> 01:30:16 PM CET <span class="m">2025</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  System load:  0.0                Processes:              <span class="m">112</span>
</span></span><span class="line"><span class="cl">  Usage of /:   45.6% of 14.66GB   Users logged in:        <span class="m">0</span>
</span></span><span class="line"><span class="cl">  Memory usage: 7%                 IPv4 address <span class="k">for</span> ens18: 10.100.99.51
</span></span><span class="line"><span class="cl">  Swap usage:   0%
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Expanded Security Maintenance <span class="k">for</span> Applications is not enabled.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">255</span> updates can be applied immediately.
</span></span><span class="line"><span class="cl"><span class="m">177</span> of these updates are standard security updates.
</span></span><span class="line"><span class="cl">To see these additional updates run: apt list --upgradable
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Enable ESM Apps to receive additional future security updates.
</span></span><span class="line"><span class="cl">See https://ubuntu.com/esm or run: sudo pro status
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Last login: Wed Nov <span class="m">19</span> 10:39:59 <span class="m">2025</span>
</span></span><span class="line"><span class="cl">andreasm@web01:~$
</span></span></code></pre></div><p>By following the rules above, will I be able to reach the webpage on port 80 on both web01 and web02 from my laptop?</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#From my laptop using ip 172.18.6.138</span>
</span></span><span class="line"><span class="cl">➜  ~ curl http://10.100.99.52 <span class="c1">#web02</span>
</span></span><span class="line"><span class="cl">&lt;h1&gt;SUCCESS: Data retrieved from App Server <span class="o">(</span>appserver1<span class="o">)</span>&lt;/h1&gt;
</span></span><span class="line"><span class="cl">➜  ~ curl http://10.100.99.51 <span class="c1">#web01 </span>
</span></span><span class="line"><span class="cl">&lt;h1&gt;SUCCESS: Data retrieved from App Server <span class="o">(</span>appserver1<span class="o">)</span>&lt;/h1&gt;
</span></span></code></pre></div><p>Yes, it seems so. And I can clearly see that both the webservers are allowed to reach the appserver1 over TCP 4567.</p>
<p>Can my laptop reach the appserver on TCP 4567?</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># From my laptop</span>
</span></span><span class="line"><span class="cl">➜  ~ curl http://10.100.99.50:4567 <span class="c1">#appserver1</span>
</span></span><span class="line"><span class="cl">curl: <span class="o">(</span>28<span class="o">)</span> Failed to connect to 10.100.99.50 port <span class="m">4567</span> after <span class="m">75003</span> ms: Couldn<span class="err">&#39;</span>t connect to server
</span></span></code></pre></div><p>Can any of the three servers reach the internet?</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># From appserver1</span>
</span></span><span class="line"><span class="cl">andreasm@appserver1:~$ ping 8.8.8.8
</span></span><span class="line"><span class="cl">PING 8.8.8.8 <span class="o">(</span>8.8.8.8<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
</span></span><span class="line"><span class="cl">^C
</span></span><span class="line"><span class="cl">--- 8.8.8.8 ping statistics ---
</span></span><span class="line"><span class="cl"><span class="m">2</span> packets transmitted, <span class="m">0</span> received, 100% packet loss, <span class="nb">time</span> 1021ms
</span></span><span class="line"><span class="cl"><span class="c1"># From web01</span>
</span></span><span class="line"><span class="cl">andreasm@web01:~$ ping 8.8.8.8
</span></span><span class="line"><span class="cl">PING 8.8.8.8 <span class="o">(</span>8.8.8.8<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
</span></span><span class="line"><span class="cl">^C
</span></span><span class="line"><span class="cl">--- 8.8.8.8 ping statistics ---
</span></span><span class="line"><span class="cl"><span class="m">8</span> packets transmitted, <span class="m">0</span> received, 100% packet loss, <span class="nb">time</span> 7172ms
</span></span></code></pre></div><p>No, they cant.</p>
<p>Can they resolve?</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># From appserver1</span>
</span></span><span class="line"><span class="cl">andreasm@appserver1:~$ dig nrk.no @10.100.1.7
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">;</span> &lt;&lt;&gt;&gt; DiG 9.18.18-0ubuntu0.22.04.1-Ubuntu &lt;&lt;&gt;&gt; nrk.no @10.100.1.7
</span></span><span class="line"><span class="cl"><span class="p">;;</span> global options: +cmd
</span></span><span class="line"><span class="cl"><span class="p">;;</span> Got answer:
</span></span><span class="line"><span class="cl"><span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span class="m">29638</span>
</span></span><span class="line"><span class="cl"><span class="p">;;</span> flags: qr rd ra<span class="p">;</span> QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: <span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">;;</span> OPT PSEUDOSECTION:
</span></span><span class="line"><span class="cl"><span class="p">;</span> EDNS: version: 0, flags:<span class="p">;</span> udp: <span class="m">1232</span>
</span></span><span class="line"><span class="cl"><span class="p">;</span> COOKIE: 8b47dddfe7bae8dc01000000691dbd6fc58a61aa810fe209 <span class="o">(</span>good<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">;;</span> QUESTION SECTION:
</span></span><span class="line"><span class="cl"><span class="p">;</span>nrk.no.				IN	A
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">;;</span> ANSWER SECTION:
</span></span><span class="line"><span class="cl">nrk.no.			20	IN	A	213.136.45.8
</span></span><span class="line"><span class="cl">nrk.no.			20	IN	A	213.136.45.10
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">;;</span> Query time: <span class="m">40</span> msec
</span></span><span class="line"><span class="cl"><span class="p">;;</span> SERVER: 10.100.1.7#53<span class="o">(</span>10.100.1.7<span class="o">)</span> <span class="o">(</span>UDP<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">;;</span> WHEN: Wed Nov <span class="m">19</span> 13:51:59 CET <span class="m">2025</span>
</span></span><span class="line"><span class="cl"><span class="p">;;</span> MSG SIZE  rcvd: <span class="m">95</span>
</span></span></code></pre></div><p>Yes, they can.</p>
<p>Can I do SSH from any of the web servers to the appserver1?</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@web01:~$ ssh 10.100.99.50 <span class="c1">#appserver1</span>
</span></span><span class="line"><span class="cl">ssh: connect to host 10.100.99.50 port 22: Connection timed out
</span></span></code></pre></div><p>No, that is not possible. But can I do SSH or TCP 80 between the web01 and web02?</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@web01:~$ ssh 10.100.99.52
</span></span><span class="line"><span class="cl">andreasm@10.100.99.52<span class="err">&#39;</span>s password:
</span></span><span class="line"><span class="cl">Welcome to Ubuntu 22.04.3 LTS <span class="o">(</span>GNU/Linux 5.15.0-87-generic x86_64<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  System information as of Wed Nov <span class="m">19</span> 01:56:56 PM CET <span class="m">2025</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  System load:  0.0                Processes:              <span class="m">118</span>
</span></span><span class="line"><span class="cl">  Usage of /:   45.2% of 14.66GB   Users logged in:        <span class="m">1</span>
</span></span><span class="line"><span class="cl">  Memory usage: 8%                 IPv4 address <span class="k">for</span> ens18: 10.100.99.52
</span></span><span class="line"><span class="cl">  Swap usage:   0%
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">255</span> updates can be applied immediately.
</span></span><span class="line"><span class="cl"><span class="m">177</span> of these updates are standard security updates.
</span></span><span class="line"><span class="cl">To see these additional updates run: apt list --upgradable
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Last login: Wed Nov <span class="m">19</span> 12:23:26 <span class="m">2025</span> from 172.18.6.138
</span></span><span class="line"><span class="cl">andreasm@web02:~$
</span></span></code></pre></div><p>SSH was allowed between web01 and web02.. Ooooops.
What about port 80 beween? Were they not supposed to be completely isolated?</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@web01:~$ curl http://10.100.99.52
</span></span><span class="line"><span class="cl">&lt;h1&gt;SUCCESS: Data retrieved from App Server <span class="o">(</span>appserver1<span class="o">)</span>&lt;/h1&gt;
</span></span></code></pre></div><p>Ooops, again. Lets investigate why that happens</p>


<h3 class="relative group">Virtual machines - same host - same vlan 
    <div id="virtual-machines---same-host---same-vlan" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#virtual-machines---same-host---same-vlan" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>What happens is the following: If I happen to have multiple virtual machines on the same host in the same vlan, for vSphere hosts that is the same vDS portgroup, for Proxmox that is a Linux bridge or OVS switch, they will reach each other within the same switch as it is just layer 2. There is no need for them to exit the host to reach each other, it is done directly on the host. Well that is an issue when I have my rules enforced on the physical switch? My Arista switch will never see this traffic, and my policies will not be enforced. But have no fear, there is a way around it.</p>
<p><strong>The solution</strong></p>
<p>On vSphere with vDS one can use PVLAN. A Linux bridge do not support PVLAN, or at least does not have the concept of PVLAN. I have not investigated which possibilities there are within OVS.</p>
<p>If using Linux bridge as I am using in my Proxmox environment there is a simple solution to this. It is not involving PVLAN at all. I need to tell my bridge to isolate the ports for my respective nics on my respective virtual machines.
Port isolation on a Linux bridge is a strict rule where traffic cannot flow directly from one isolated port to another isolated port.</p>
<p>In Proxmox there are two ways to configure port isolation on a Linux bridge.</p>
<p><strong>Manually configure the bridge ports using cli, not preserved across vm reboots or host reboots:</strong></p>
<p>Find the ports you want to isolate, then execute a command to isolate the bridge:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@proxmox-02:/# bridge link show
</span></span><span class="line"><span class="cl">10: bond0: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu <span class="m">9000</span> master vmbr0 state forwarding priority <span class="m">32</span> cost <span class="m">100</span>
</span></span><span class="line"><span class="cl">13: bond1: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu <span class="m">1500</span> master vmbr1 state forwarding priority <span class="m">32</span> cost <span class="m">100</span>
</span></span><span class="line"><span class="cl">147: tap1503i0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu <span class="m">1500</span> master vmbr2vnet state forwarding priority <span class="m">32</span> cost <span class="m">2</span>
</span></span><span class="line"><span class="cl">149: vmbr0.299@vmbr0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">9000</span> master vlan299 state forwarding priority <span class="m">32</span> cost <span class="m">100</span>
</span></span><span class="line"><span class="cl">152: tap1510i0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu <span class="m">9000</span> master vlan299 state forwarding priority <span class="m">32</span> cost <span class="m">2</span>
</span></span><span class="line"><span class="cl">153: tap1501i0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu <span class="m">9000</span> master vlan299 state forwarding priority <span class="m">32</span> cost <span class="m">2</span>
</span></span><span class="line"><span class="cl">154: tap1502i0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu <span class="m">9000</span> master vlan299 state forwarding priority <span class="m">32</span> cost <span class="m">2</span>
</span></span><span class="line"><span class="cl">155: tap7988i0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu <span class="m">9000</span> master vmbr0 state forwarding priority <span class="m">32</span> cost <span class="m">2</span>
</span></span><span class="line"><span class="cl">156: tap7988i1: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu <span class="m">9000</span> master vmbr0 state forwarding priority <span class="m">32</span> cost <span class="m">2</span>
</span></span><span class="line"><span class="cl">157: tap7988i2: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu <span class="m">9000</span> master vmbr0 state forwarding priority <span class="m">32</span> cost <span class="m">2</span>
</span></span><span class="line"><span class="cl">158: tap5999i0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu <span class="m">9000</span> master vmbr0 state forwarding priority <span class="m">32</span> cost <span class="m">2</span>
</span></span><span class="line"><span class="cl">160: tap5997i0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu <span class="m">9000</span> master vmbr0 state forwarding priority <span class="m">32</span> cost <span class="m">2</span>
</span></span></code></pre></div><p>The tap is the ports you are looking for, unless you have enabled the firewall on the VM Nic. Then it is called <em>fwprXXXX@fwln@@@</em> instead. The number behind tap is the VM id. So if your VM has id 1502, then it should have an tap id like tap1502i0. The last digit &ldquo;0&rdquo; is the NIC number on the VM, you can have multiple nics, which will then be tap1502i1, tap1502i2 etc.</p>
<p>Now I can run the command to isolate this port:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@proxmox-02:/# bridge link <span class="nb">set</span> dev tap5999i0 isolated on <span class="c1">#web01</span>
</span></span><span class="line"><span class="cl">root@proxmox-02:/# bridge link <span class="nb">set</span> dev tap5997i0 isolated on <span class="c1">#web02</span>
</span></span></code></pre></div><p>Now I have isolated web1 and web02 on my Linux bridge. This blocks any attempt to communicate within the same bridge. The only way they can communicate now is out of the physical nic of my Proxmox host. This works fine, but there are some issues with that approach. The CLI approach is tedious and not permanent unless a startup script is made. Easy to use just for temporarily tests though.</p>
<p><strong>Using Proxmox SDN to enable port isolation via the GUI</strong></p>
<p>There is a graphical approach to achieve the same as above using Proxmox SDN. Proxmox SDN will use already existing bridges, you just need to configure a VLAN Zone, referring to your existing bridge:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251119154739590.png"
        alt="vlan-zone"
      />
      
    </figure>
</p>
<p>Then a VNET using the above created Zone and a VLAN tag:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251119155015550.png"
        alt="vnet"
      />
      
    </figure>
</p>
<p>If you notice here, the VNET has the option to &ldquo;globally&rdquo; Isolate all ports within the same VLAN using this VNET by selecting &ldquo;Isolate Ports&rdquo;.</p>
<p>Now I can just update my VMs to use this network instead:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251119155139187.png"
        alt="vm_vnet"
      />
      
    </figure>
</p>
<p>No need to enter the VLAN Tag as the VNET already carries the tag.</p>
<p>This approach is much easier and better to manage.</p>

  



<div
  
    class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"
  >

  <span
    
      class="text-primary-400 ltr:pr-3 rtl:pl-3 flex items-center"
    >

    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M506.3 417l-213.3-364c-16.33-28-57.54-28-73.98 0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6C502.1 480 522.6 445 506.3 417zM232 168c0-13.25 10.75-24 24-24S280 154.8 280 168v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zM256 416c-17.36 0-31.44-14.08-31.44-31.44c0-17.36 14.07-31.44 31.44-31.44s31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg>

  </span>


  </span>

  <span
    
      class="dark:text-neutral-300"
    ><p>When enabling port-isolation on Proxmox I noticed some degradation in performance in my Ubuntu VMs and you may want to tune the OS by disabling offload packet segmentation to get it back up to speed. Below are some things to adjust:</p>
<p>Disable offload packet segmentation on the VMs:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo ethtool -K ens18 tso off gso off gro off
</span></span></code></pre></div><p>With offloading disabled, it becomes more CPU reliant. Edit the VM Hardware and populate Multiqueue = amount of vCPUs.</p>
<p>
    <figure>
      <img class="my-0 rounded-md" loading="lazy" src="images/image-20251119181453453.png" alt="multiqueue" />
      
    </figure>
</p>
</span>
</div>

<p>Now that I have solved how to isolate and force virtual machines on same VLAN to exit via the physical nic. What happens if web01 and web02 lives on the same physical host, on the same L2 VLAN (broadcast domain), and has been isolated on the bridge and must &ldquo;talk&rdquo; to each other? The only way to to that is through the physical switch. It will be dropped. Why?</p>
<p>Lets discuss such a scenario below:</p>


<h4 class="relative group">ARP scenario with port-isolation 
    <div id="arp-scenario-with-port-isolation" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#arp-scenario-with-port-isolation" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>When using <strong>Port Isolation</strong> on the Proxmox Linux bridge it blocks web01 from talking directly to web02.</p>
<ul>
<li>web01 shouts (ARP): <em>&ldquo;Who has IP address B?&rdquo;</em></li>
<li>The bridge blocks this shout from going to web02.</li>
<li>However, the bridge <strong>does allow</strong> the shout to go out the &ldquo;Uplink&rdquo; port to my physical Arista switch.</li>
</ul>
<p>But when this ARP request is received on my pysical switch it is being dropped due to a rule of never forwarding a frame back out the same port it entered on.
My Arista switch sees the request and thinks, <em>&ldquo;Well I am not sending the frame using the same interface I received it on atleast, so if they need to find each other they have to do it without me involved. I can send it out on other ports in the vlan&rdquo;</em> The frame is never received. Result: Silence. Connection fails.</p>
<p>The solution: <strong>local-proxy-arp</strong></p>
<p>Meet my helpful neighbour, my Arista switch</p>
<p>Now the Arista switch receives the ARP request from VM A asking for VM B&rsquo;s MAC address.</p>
<ul>
<li><strong>With <code>local-proxy-arp</code>:</strong> The Arista switch sees the request and &ldquo;lies.&rdquo; It says: <em>&ldquo;I will handle this. Send the traffic to me.&rdquo;</em>. It will use its own mac-address to reply with.</li>
</ul>
<p>The &ldquo;Hairpin&rdquo; Detour:</p>
<p>Because my Arista switch responded with its <em>own</em> MAC address, the traffic takes a detour outside the server and back in.</p>
<ol>
<li><strong>web01</strong> sends the data destined for web02.</li>
<li>The data leaves Proxmox, goes up the cable to my <strong>Arista Switch</strong>.</li>
<li>My Arista switch receives the packet, looks at the destination IP (web02), and realizes it needs to go back out the <strong>same interface</strong> it came in on.</li>
<li>My Arista switch routes the packet back down the cable to Proxmox.</li>
<li>Proxmox receives it and delivers it to <strong>web02</strong>.</li>
</ol>


<h3 class="relative group">Application Policy - Web and Application Servers 
    <div id="application-policy---web-and-application-servers-1" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#application-policy---web-and-application-servers-1" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Now where were we.. Ah yes.. Is the web01 and web02 now isolated? Lets test. In the meantime I have added the &ldquo;ip local-proxy-arp&rdquo; on the VLAN interface 299 on my Arista switch.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">interface Vlan299
</span></span><span class="line"><span class="cl">   description test-isolation-vlan
</span></span><span class="line"><span class="cl">   vrf ALL
</span></span><span class="line"><span class="cl">   ip address 10.100.99.1/24
</span></span><span class="line"><span class="cl">   ip local-proxy-arp
</span></span></code></pre></div><p>Lets test if the web01 and web02 are now being enforced by the MSS rules.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># From web01 to web02 SSH and HTTP</span>
</span></span><span class="line"><span class="cl">andreasm@web01:~$ ssh 10.100.99.52
</span></span><span class="line"><span class="cl">ssh: connect to host 10.100.99.52 port 22: Connection timed out
</span></span><span class="line"><span class="cl">andreasm@web01:~$ curl http://10.100.99.52
</span></span><span class="line"><span class="cl">curl: <span class="o">(</span>28<span class="o">)</span> Failed to connect to 10.100.99.52 port <span class="m">80</span> after <span class="m">130774</span> ms: Connection timed out
</span></span><span class="line"><span class="cl"><span class="c1"># From web02 to web01 SSH and HTTP</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">andreasm@web02:~$ curl http://10.100.99.51
</span></span><span class="line"><span class="cl">curl: <span class="o">(</span>28<span class="o">)</span> Failed to connect to 10.100.99.51 port <span class="m">80</span> after <span class="m">129257</span> ms: Connection timed out
</span></span></code></pre></div><p>Now they are being restricted by the rules on my Arista switch.</p>
<p>For reference, this is how my traffic-policies configuration looks like on my 720XP switch:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">traffic-policies
</span></span><span class="line"><span class="cl">   vrf ALL
</span></span><span class="line"><span class="cl">      traffic-policy input vrf_all_home physical
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set ipv4 prefix DNS_NTP_servers
</span></span><span class="line"><span class="cl">      10.100.1.6/32 10.100.1.7/32
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set ipv4 prefix appserver1
</span></span><span class="line"><span class="cl">      10.100.99.50/32
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set ipv4 prefix web-appserver1
</span></span><span class="line"><span class="cl">      10.100.99.50/32 10.100.99.51/32 10.100.99.52/32
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set ipv4 prefix web01_web02
</span></span><span class="line"><span class="cl">      10.100.99.51/32 10.100.99.52/32
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set ipv4 prefix wifi_clients
</span></span><span class="line"><span class="cl">      172.18.6.0/24
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set service DNS
</span></span><span class="line"><span class="cl">      protocol udp <span class="nb">source</span> port all destination port domain
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set service DNS-reverse
</span></span><span class="line"><span class="cl">      protocol udp <span class="nb">source</span> port domain destination port all
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set service HTTP
</span></span><span class="line"><span class="cl">      protocol tcp <span class="nb">source</span> port all destination port www
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set service HTTP-reverse
</span></span><span class="line"><span class="cl">      protocol tcp <span class="nb">source</span> port www destination port all
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set service NTP
</span></span><span class="line"><span class="cl">      protocol udp <span class="nb">source</span> port all destination port ntp
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set service NTP-reverse
</span></span><span class="line"><span class="cl">      protocol udp <span class="nb">source</span> port ntp destination port all
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set service SSH
</span></span><span class="line"><span class="cl">      protocol tcp <span class="nb">source</span> port all destination port ssh
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set service SSH-reverse
</span></span><span class="line"><span class="cl">      protocol tcp <span class="nb">source</span> port ssh destination port all
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set service appserver1-tcp
</span></span><span class="line"><span class="cl">      protocol tcp <span class="nb">source</span> port all destination port <span class="m">4567</span>
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   field-set service appserver1-tcp-reverse
</span></span><span class="line"><span class="cl">      protocol tcp <span class="nb">source</span> port <span class="m">4567</span> destination port all
</span></span><span class="line"><span class="cl">   transforms interface prefix common source-destination
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   traffic-policy vrf_all_home
</span></span><span class="line"><span class="cl">      !! Allow DNS and NTP requests to 10.100.1.6 and 10.100.1.7
</span></span><span class="line"><span class="cl">      description <span class="c1">#policy-id=256</span>
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match allow_all_NTP ipv4
</span></span><span class="line"><span class="cl">         destination prefix field-set DNS_NTP_servers
</span></span><span class="line"><span class="cl">         protocol service field-set NTP
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match allow_all_NTP-reverse ipv4
</span></span><span class="line"><span class="cl">         <span class="nb">source</span> prefix field-set DNS_NTP_servers
</span></span><span class="line"><span class="cl">         protocol service field-set NTP-reverse
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match allow_all_DNS ipv4
</span></span><span class="line"><span class="cl">         destination prefix field-set DNS_NTP_servers
</span></span><span class="line"><span class="cl">         protocol service field-set DNS
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match allow_all_DNS-reverse ipv4
</span></span><span class="line"><span class="cl">         <span class="nb">source</span> prefix field-set DNS_NTP_servers
</span></span><span class="line"><span class="cl">         protocol service field-set DNS-reverse
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match drop_http_between_webservers ipv4
</span></span><span class="line"><span class="cl">         !! drop HTTP
</span></span><span class="line"><span class="cl">         <span class="nb">source</span> prefix field-set web01_web02
</span></span><span class="line"><span class="cl">         destination prefix field-set web01_web02
</span></span><span class="line"><span class="cl">         protocol service field-set HTTP
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span><span class="line"><span class="cl">            drop
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match drop_http_between_webservers-reverse ipv4
</span></span><span class="line"><span class="cl">         !! drop HTTP
</span></span><span class="line"><span class="cl">         <span class="nb">source</span> prefix field-set web01_web02
</span></span><span class="line"><span class="cl">         destination prefix field-set web01_web02
</span></span><span class="line"><span class="cl">         protocol service field-set HTTP-reverse
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span><span class="line"><span class="cl">            drop
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match clients_to_webservers ipv4
</span></span><span class="line"><span class="cl">         !! HTTP to webservers
</span></span><span class="line"><span class="cl">         destination prefix field-set web01_web02
</span></span><span class="line"><span class="cl">         protocol service field-set HTTP
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match clients_to_webservers-reverse ipv4
</span></span><span class="line"><span class="cl">         !! HTTP to webservers
</span></span><span class="line"><span class="cl">         <span class="nb">source</span> prefix field-set web01_web02
</span></span><span class="line"><span class="cl">         protocol service field-set HTTP-reverse
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match ssh_to_web-app_servers ipv4
</span></span><span class="line"><span class="cl">         !! ssh access to web app servers
</span></span><span class="line"><span class="cl">         <span class="nb">source</span> prefix field-set wifi_clients
</span></span><span class="line"><span class="cl">         destination prefix field-set web-appserver1
</span></span><span class="line"><span class="cl">         protocol service field-set SSH
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match ssh_to_web-app_servers-reverse ipv4
</span></span><span class="line"><span class="cl">         !! ssh access to web app servers
</span></span><span class="line"><span class="cl">         <span class="nb">source</span> prefix field-set web-appserver1
</span></span><span class="line"><span class="cl">         destination prefix field-set wifi_clients
</span></span><span class="line"><span class="cl">         protocol service field-set SSH-reverse
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match web-to-appserver1 ipv4
</span></span><span class="line"><span class="cl">         !! allow webservers to appserver1
</span></span><span class="line"><span class="cl">         <span class="nb">source</span> prefix field-set web01_web02
</span></span><span class="line"><span class="cl">         destination prefix field-set appserver1
</span></span><span class="line"><span class="cl">         protocol service field-set appserver1-tcp
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match web-to-appserver1-reverse ipv4
</span></span><span class="line"><span class="cl">         !! allow webservers to appserver1
</span></span><span class="line"><span class="cl">         <span class="nb">source</span> prefix field-set appserver1
</span></span><span class="line"><span class="cl">         destination prefix field-set web01_web02
</span></span><span class="line"><span class="cl">         protocol service field-set appserver1-tcp-reverse
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match drop_all_else_web-app ipv4
</span></span><span class="line"><span class="cl">         !! Drop_all_else
</span></span><span class="line"><span class="cl">         <span class="nb">source</span> prefix field-set web-appserver1
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span><span class="line"><span class="cl">            drop
</span></span><span class="line"><span class="cl">      !
</span></span><span class="line"><span class="cl">      match drop_all_else_web-app-reverse ipv4
</span></span><span class="line"><span class="cl">         !! Drop_all_else
</span></span><span class="line"><span class="cl">         destination prefix field-set web-appserver1
</span></span><span class="line"><span class="cl">         !
</span></span><span class="line"><span class="cl">         actions
</span></span><span class="line"><span class="cl">            count
</span></span><span class="line"><span class="cl">            drop
</span></span><span class="line"><span class="cl">      !
</span></span></code></pre></div><p>Lets just display a diagram how how my VMs are interacting with each other in combination with the hardware they are running on.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251119192154779.png"
        alt="flow-diagram"
      />
      
    </figure>
</p>
<p>On Proxmox02 the linux bridge on vlan 299 is not involved other than block all intra traffic and forcing all traffic out to my switch where the MSS policies are in place.</p>


<h3 class="relative group">Monitor for potential allow rules I have missed 
    <div id="monitor-for-potential-allow-rules-i-have-missed" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#monitor-for-potential-allow-rules-i-have-missed" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>What if I have been in a rush and forgot something? The app does not work after all.</p>
<p>Lets enable monitoring on the &ldquo;drop else rule&rdquo; and let it tell me whats going on.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2025/11/13/arista-mss-multi-domain-segmentation/images/image-20251119182435172.png"
        alt="collected_sessions"
      />
      
    </figure>
</p>
<p>I can clearly see the SSH and HTTP attempts beings stopped (as expected) but also that my poor VMs are trying desperately to go to Internet and fetch some needed updates, but they are being stopped. Is there a way to help them out?</p>
<p>Redirect rules, I did mention aboive what if the VMs needs to go to the internet?</p>


<h2 class="relative group">Some useful CLI commands 
    <div id="some-useful-cli-commands" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#some-useful-cli-commands" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>In this section I will quickly list some useful CLI command in relation to MSS.</p>


<h3 class="relative group">On the vZTX monitor 
    <div id="on-the-vztx-monitor" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#on-the-vztx-monitor" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreas-ztx1#show interfaces status
</span></span><span class="line"><span class="cl">Port       Name       Status       Vlan     Duplex Speed  Type         Flags Encapsulation
</span></span><span class="line"><span class="cl">Et1                   connected    routed   full   unconf 10/100/1000
</span></span><span class="line"><span class="cl">Et2                   connected    routed   full   unconf 10/100/1000
</span></span><span class="line"><span class="cl">Ma1        management connected    routed   a-full a-1G   10/100/1000
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreas-ztx1#show interfaces tunnel <span class="m">0</span>
</span></span><span class="line"><span class="cl">Tunnel0 is up, line protocol is up <span class="o">(</span>connected<span class="o">)</span>
</span></span><span class="line"><span class="cl">  Hardware is Tunnel, address is 0000.0000.0000
</span></span><span class="line"><span class="cl">  Tunnel <span class="nb">source</span> 10.255.1.11, destination 10.255.1.10
</span></span><span class="line"><span class="cl">  Tunnel protocol/transport GRE/IP
</span></span><span class="line"><span class="cl">  Hardware forwarding enabled
</span></span><span class="line"><span class="cl">  Tunnel transport MTU <span class="m">1476</span> bytes <span class="o">(</span>default<span class="o">)</span>
</span></span><span class="line"><span class="cl">  Tunnel underlay VRF <span class="s2">&#34;default&#34;</span>
</span></span><span class="line"><span class="cl">  Don<span class="err">&#39;</span>t Fragment bit: copied from inner header
</span></span><span class="line"><span class="cl">  Up <span class="m">2</span> minutes, <span class="m">11</span> seconds
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreas-ztx1#show flow tracking firewall distributed
</span></span><span class="line"><span class="cl">Flow Tracking Status
</span></span><span class="line"><span class="cl">  Type: Distributed Firewall
</span></span><span class="line"><span class="cl">  Running: yes, enabled by the <span class="s1">&#39;flow tracking firewall distributed&#39;</span> <span class="nb">command</span>
</span></span><span class="line"><span class="cl">  Tracker: flowtrkr
</span></span><span class="line"><span class="cl">    Active interval: <span class="m">1800000</span> ms
</span></span><span class="line"><span class="cl">    Inactive timeout: <span class="m">15000</span> ms
</span></span><span class="line"><span class="cl">    Groups: ICMPv4, IPv4
</span></span><span class="line"><span class="cl">    Exporter: exp
</span></span><span class="line"><span class="cl">      VRF: default
</span></span><span class="line"><span class="cl">      Local interface: Loopback0 <span class="o">(</span>10.255.1.11<span class="o">)</span>
</span></span><span class="line"><span class="cl">      Export format: IPFIX version 10, MTU <span class="m">9152</span>
</span></span><span class="line"><span class="cl">      DSCP: <span class="m">0</span>
</span></span><span class="line"><span class="cl">      Template interval: <span class="m">3600000</span> ms
</span></span><span class="line"><span class="cl">      Collectors:
</span></span><span class="line"><span class="cl">        127.0.0.1 port <span class="m">4739</span>
</span></span><span class="line"><span class="cl">    Active Ingress Interfaces:
</span></span><span class="line"><span class="cl">      Tu0
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreas-ztx1#show firewall distributed instance session-table
</span></span><span class="line"><span class="cl">Legend
</span></span><span class="line"><span class="cl">eph - Ephemeral port
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Sessions: <span class="m">75</span>
</span></span><span class="line"><span class="cl">VRF     Proto    Source/              Fwd/Rev         Fwd/Rev         Fwd/Rev Complete Half-Open          Start Time
</span></span><span class="line"><span class="cl">                 Destination          Src VTEP IP        Pkts           Bytes
</span></span><span class="line"><span class="cl">------- -------- -------------------- ------------ ---------- --------------- -------- --------- --------------------
</span></span><span class="line"><span class="cl">default UDP      10.160.1.115:43538   10.255.1.10           <span class="m">1</span>              <span class="m">87</span>        <span class="m">0</span>         <span class="m">1</span> 2025-11-19 18:53:40
</span></span><span class="line"><span class="cl">                 10.100.1.7:53        10.255.1.10           <span class="m">1</span>             <span class="m">141</span>
</span></span><span class="line"><span class="cl">default UDP      172.18.199.202:51841 10.255.1.10           <span class="m">1</span>              <span class="m">71</span>        <span class="m">0</span>         <span class="m">1</span> 2025-11-19 18:53:45
</span></span><span class="line"><span class="cl">                 10.100.1.7:53        10.255.1.10           <span class="m">1</span>             <span class="m">155</span>
</span></span><span class="line"><span class="cl">default UDP      172.18.4.220:eph     10.255.1.10          <span class="m">13</span>             <span class="m">904</span>       <span class="m">12</span>         <span class="m">0</span> 2025-11-19 18:52:49
</span></span><span class="line"><span class="cl">                 10.100.1.6:53        10.255.1.10          <span class="m">13</span>            <span class="m">1628</span>
</span></span><span class="line"><span class="cl">default UDP      172.18.199.202:63375 10.255.1.10           <span class="m">1</span>              <span class="m">71</span>        <span class="m">0</span>         <span class="m">1</span> 2025-11-19 18:53:49
</span></span><span class="line"><span class="cl">                 10.100.1.7:53        10.255.1.10           <span class="m">1</span>             <span class="m">155</span>
</span></span><span class="line"><span class="cl">default UDP      172.18.199.202:61817 10.255.1.10           <span class="m">1</span>              <span class="m">71</span>        <span class="m">0</span>         <span class="m">1</span> 2025-11-19 18:53:43
</span></span><span class="line"><span class="cl">                 10.100.1.7:53        10.255.1.10           <span class="m">1</span>             <span class="m">155</span>
</span></span><span class="line"><span class="cl">default UDP      10.160.1.113:43726   10.255.1.10           <span class="m">1</span>              <span class="m">87</span>        <span class="m">0</span>         <span class="m">1</span> 2025-11-19 18:53:36
</span></span><span class="line"><span class="cl">                 10.100.1.7:53        10.255.1.10           <span class="m">1</span>             <span class="m">103</span>
</span></span><span class="line"><span class="cl">default UDP      172.18.199.202:51217 10.255.1.10           <span class="m">1</span>              <span class="m">71</span>        <span class="m">0</span>         <span class="m">1</span> 2025-11-19 18:53:45
</span></span><span class="line"><span class="cl">                 10.100.1.7:53        10.255.1.10           <span class="m">1</span>             <span class="m">155</span>
</span></span><span class="line"><span class="cl">default UDP      172.18.199.202:50857 10.255.1.10           <span class="m">1</span>              <span class="m">71</span>        <span class="m">0</span>         <span class="m">1</span> 2025-11-19 18:53:45
</span></span><span class="line"><span class="cl">                 10.100.1.7:53        10.255.1.10           <span class="m">1</span>             <span class="m">155</span>
</span></span><span class="line"><span class="cl">default UDP      172.18.199.202:51406 10.255.1.10           <span class="m">1</span>              <span class="m">71</span>        <span class="m">0</span>         <span class="m">1</span> 2025-11-19 18:53:50
</span></span><span class="line"><span class="cl">                 10.100.1.7:53        10.255.1.10           <span class="m">1</span>             <span class="m">155</span>
</span></span><span class="line"><span class="cl">default UDP      10.160.1.115:48036   10.255.1.10           <span class="m">1</span>              <span class="m">87</span>        <span class="m">0</span>         <span class="m">1</span> 2025-11-19 18:53:40
</span></span><span class="line"><span class="cl">                 10.100.1.7:53        10.255.1.10           <span class="m">1</span>             <span class="m">103</span>
</span></span><span class="line"><span class="cl">default UDP      172.18.6.138:48785   10.255.1.10           <span class="m">1</span>              <span class="m">60</span>        <span class="m">0</span>         <span class="m">1</span> 2025-11-19 18:53:43
</span></span><span class="line"><span class="cl">                 10.100.1.7:53        10.255.1.10           <span class="m">1</span>              <span class="m">76</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreas-ztx1#show platform sfe counters <span class="p">|</span> nz
</span></span><span class="line"><span class="cl">Name                                                  Owner                             Counter Type Unit    Count
</span></span><span class="line"><span class="cl">----------------------------------------------------- --------------------------------- ------------ ------- ---------
</span></span><span class="line"><span class="cl">IPv4_Flow_Cache_Inserts                               -                                 module       flows   <span class="m">23846</span>
</span></span><span class="line"><span class="cl">Tx_PMD_et2-q_out_pkts-6                               Tx_PMD_et2                        module       packets <span class="m">12363</span>
</span></span><span class="line"><span class="cl">Tx_PMD_et2-q_out_bytes-6                              Tx_PMD_et2                        module       bytes   <span class="m">2633319</span>
</span></span><span class="line"><span class="cl">Tx_VKNI_et2-q_out_pkts-0                              Tx_VKNI_et2                       module       packets <span class="m">182338</span>
</span></span><span class="line"><span class="cl">Tx_VKNI_et2-q_out_bytes-0                             Tx_VKNI_et2                       module       bytes   <span class="m">21662140</span>
</span></span><span class="line"><span class="cl">Tx_VKNI_et2-q_out_pkts-3                              Tx_VKNI_et2                       module       packets <span class="m">2839244</span>
</span></span><span class="line"><span class="cl">Tx_VKNI_et2-q_out_bytes-3                             Tx_VKNI_et2                       module       bytes   <span class="m">181712832</span>
</span></span><span class="line"><span class="cl">L2Classify_Ethernet2-Ingress_Hdr_Check_Drop_Pkts      L2Classify_Ethernet2              module       packets <span class="m">38063</span>
</span></span><span class="line"><span class="cl">L2Classify_Ethernet2-In_Runt_Pkts                     L2Classify_Ethernet2              module       packets <span class="m">145</span>
</span></span><span class="line"><span class="cl">L2Classify_Ethernet2-Vlan_Drop_Pkts                   L2Classify_Ethernet2              module       packets <span class="m">8868886</span>
</span></span><span class="line"><span class="cl">L2Classify_Ethernet2-Bad_Router_Mac_Pkts              L2Classify_Ethernet2              module       packets <span class="m">27949</span>
</span></span><span class="line"><span class="cl">Tx_PMD_et1-q_out_pkts-1                               Tx_PMD_et1                        module       packets <span class="m">119</span>
</span></span><span class="line"><span class="cl">Tx_PMD_et1-q_out_bytes-1                              Tx_PMD_et1                        module       bytes   <span class="m">11590</span>
</span></span><span class="line"><span class="cl">Tx_PMD_et1-q_out_pkts-6                               Tx_PMD_et1                        module       packets <span class="m">16943</span>
</span></span><span class="line"><span class="cl">Tx_PMD_et1-q_out_bytes-6                              Tx_PMD_et1                        module       bytes   <span class="m">2825679</span>
</span></span><span class="line"><span class="cl">Tx_VKNI_et1-q_out_pkts-2                              Tx_VKNI_et1                       module       packets <span class="m">117</span>
</span></span><span class="line"><span class="cl">Tx_VKNI_et1-q_out_bytes-2                             Tx_VKNI_et1                       module       bytes   <span class="m">14688</span>
</span></span><span class="line"><span class="cl">Tx_VKNI_et1-q_out_pkts-3                              Tx_VKNI_et1                       module       packets <span class="m">4578</span>
</span></span><span class="line"><span class="cl">Tx_VKNI_et1-q_out_bytes-3                             Tx_VKNI_et1                       module       bytes   <span class="m">274680</span>
</span></span><span class="line"><span class="cl">Tunnel-Global-tun_decap_drop_pkts                     Ip4TunDemux                       module       packets <span class="m">133</span>
</span></span><span class="line"><span class="cl">Tunnel-0-in_ucast_pkts                                Ip4TunDemux                       module       packets <span class="m">1858</span>
</span></span><span class="line"><span class="cl">Tunnel-0-in_bytes                                     Ip4TunDemux                       module       bytes   <span class="m">200714</span>
</span></span><span class="line"><span class="cl">IpfixFt-NoFcMdPkts                                    IpfixFtIngress_tu0                module       packets <span class="m">231</span>
</span></span><span class="line"><span class="cl">IpfixFt-NewFcUd                                       IpfixFtIngress_tu0                module       packets <span class="m">858</span>
</span></span><span class="line"><span class="cl">IpfixFt-DropModePkts                                  IpfixFtIngress_tu0                module       packets <span class="m">1858</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreas-ztx1#show agent sfe threads flow cache scan counters
</span></span><span class="line"><span class="cl">Purged count: <span class="m">23849</span>
</span></span><span class="line"><span class="cl">IPFIX <span class="nb">export</span> count: <span class="m">8351</span>
</span></span><span class="line"><span class="cl">IPFIX failed <span class="nb">export</span> count: <span class="m">0</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreas-ztx1#bash bessctl show flow-cache stats
</span></span><span class="line"><span class="cl">Flow Count:      <span class="m">97</span>
</span></span><span class="line"><span class="cl">Num Buckets:     <span class="m">1048576</span>
</span></span><span class="line"><span class="cl">Max Keys:        <span class="m">1048576</span>
</span></span><span class="line"><span class="cl">Permanent Keys:  <span class="m">0</span>
</span></span><span class="line"><span class="cl">Purgeable Keys:   <span class="m">97</span>
</span></span><span class="line"><span class="cl">Ephemeral Keys:   <span class="m">47</span>
</span></span><span class="line"><span class="cl">Ephemeral Summary Keys:   <span class="m">22</span>
</span></span><span class="line"><span class="cl">Ephemeral Purge Timeout<span class="o">(</span>sec<span class="o">)</span>:   <span class="m">65</span>
</span></span><span class="line"><span class="cl">Ephemeral Source Starting Port:   <span class="m">49152</span>
</span></span><span class="line"><span class="cl">Ephemeral Destination Starting Port:   <span class="m">49152</span>
</span></span><span class="line"><span class="cl">Low Memory Mode: False
</span></span><span class="line"><span class="cl">Purge Timeout<span class="o">(</span>sec<span class="o">)</span>: <span class="m">10</span>
</span></span><span class="line"><span class="cl">Tcp Half-Open Purge Timeout<span class="o">(</span>sec<span class="o">)</span>: <span class="m">10</span>
</span></span><span class="line"><span class="cl">Tcp Idle Purge Timeout<span class="o">(</span>sec<span class="o">)</span>: <span class="m">60</span>
</span></span></code></pre></div>

<h3 class="relative group">On the MSS Switches 
    <div id="on-the-mss-switches" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#on-the-mss-switches" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm-720xp-home<span class="o">(</span>config<span class="o">)</span><span class="c1">#show traffic-policy ?</span>
</span></span><span class="line"><span class="cl">  WORD       Traffic policy name
</span></span><span class="line"><span class="cl">  field-set  Traffic policy field <span class="nb">set</span>
</span></span><span class="line"><span class="cl">  interface  Policy applied on interface
</span></span><span class="line"><span class="cl">  protocol   protocol
</span></span><span class="line"><span class="cl">  vlan       Policy applied on VLAN
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm-720xp-home<span class="o">(</span>config<span class="o">)</span><span class="c1">#show traffic-policy vlan detail</span>
</span></span><span class="line"><span class="cl">Traffic policy vrf_all_home
</span></span><span class="line"><span class="cl">   Configured on VLANs:
</span></span><span class="line"><span class="cl">   Applied on VLANs <span class="k">for</span> IPv4 traffic:
</span></span><span class="line"><span class="cl">   Applied on VLANs <span class="k">for</span> IPv6 traffic:
</span></span><span class="line"><span class="cl">   Total number of rules configured: <span class="m">16</span>
</span></span><span class="line"><span class="cl">      match allow_all_NTP ipv4
</span></span><span class="line"><span class="cl">         Destination prefix: field-set DNS_NTP_servers <span class="o">(</span>Prefixes: 2, Except prefixes: 0<span class="o">)</span>
</span></span><span class="line"><span class="cl">         Service: field-set NTP <span class="o">(</span>Protocols: 1<span class="o">)</span>
</span></span><span class="line"><span class="cl">         Actions: Count: <span class="m">0</span> packets
</span></span><span class="line"><span class="cl">      match allow_all_NTP-reverse ipv4
</span></span><span class="line"><span class="cl">         Source prefix: field-set DNS_NTP_servers <span class="o">(</span>Prefixes: 2, Except prefixes: 0<span class="o">)</span>
</span></span><span class="line"><span class="cl">         Service: field-set NTP-reverse <span class="o">(</span>Protocols: 1<span class="o">)</span>
</span></span><span class="line"><span class="cl">         Actions: Count: <span class="m">0</span> packets
</span></span><span class="line"><span class="cl">      match allow_all_DNS ipv4
</span></span><span class="line"><span class="cl">         Destination prefix: field-set DNS_NTP_servers <span class="o">(</span>Prefixes: 2, Except prefixes: 0<span class="o">)</span>
</span></span><span class="line"><span class="cl">         Service: field-set DNS <span class="o">(</span>Protocols: 1<span class="o">)</span>
</span></span><span class="line"><span class="cl">         Actions: Count: <span class="m">0</span> packets
</span></span><span class="line"><span class="cl">                  Mirror session andreas-vztx-ALL
</span></span><span class="line"><span class="cl">      match allow_all_DNS-reverse ipv4
</span></span><span class="line"><span class="cl">         Source prefix: field-set DNS_NTP_servers <span class="o">(</span>Prefixes: 2, Except prefixes: 0<span class="o">)</span>
</span></span><span class="line"><span class="cl">         Service: field-set DNS-reverse <span class="o">(</span>Protocols: 1<span class="o">)</span>
</span></span><span class="line"><span class="cl">         Actions: Count: <span class="m">0</span> packets
</span></span><span class="line"><span class="cl">                  Mirror session andreas-vztx-ALL
</span></span><span class="line"><span class="cl">      match drop_http_between_webservers ipv4
</span></span><span class="line"><span class="cl">         Source prefix: field-set web01_web02 <span class="o">(</span>Prefixes: 2, Except prefixes: 0<span class="o">)</span>
</span></span><span class="line"><span class="cl">         Destination prefix: field-set web01_web02 <span class="o">(</span>Prefixes: 2, Except prefixes: 0<span class="o">)</span>
</span></span><span class="line"><span class="cl">         Service: field-set HTTP <span class="o">(</span>Protocols: 1<span class="o">)</span>
</span></span><span class="line"><span class="cl">         Actions: Drop
</span></span><span class="line"><span class="cl">                  Count: <span class="m">0</span> packets
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm-720xp-home<span class="o">(</span>config<span class="o">)</span><span class="c1">#show traffic-policy interface summary</span>
</span></span><span class="line"><span class="cl">Traffic policy vrf_all_home
</span></span><span class="line"><span class="cl">   description <span class="c1">#policy-id=256</span>
</span></span><span class="line"><span class="cl">   Configured on input <span class="k">for</span> VRFs: ALL
</span></span><span class="line"><span class="cl">   Applied on input <span class="k">for</span> IPv4 traffic in VRFs: ALL
</span></span><span class="line"><span class="cl">   Applied on input <span class="k">for</span> IPv6 traffic in VRFs: ALL
</span></span><span class="line"><span class="cl">   Configured on input of interfaces:
</span></span><span class="line"><span class="cl">   Applied on input of interfaces <span class="k">for</span> IPv4 traffic:
</span></span><span class="line"><span class="cl">   Applied on input of interfaces <span class="k">for</span> IPv6 traffic:
</span></span><span class="line"><span class="cl">   Total number of rules configured: <span class="m">16</span>
</span></span><span class="line"><span class="cl">      match allow_all_NTP ipv4
</span></span><span class="line"><span class="cl">      match allow_all_NTP-reverse ipv4
</span></span><span class="line"><span class="cl">      match allow_all_DNS ipv4
</span></span><span class="line"><span class="cl">      match allow_all_DNS-reverse ipv4
</span></span><span class="line"><span class="cl">      match drop_http_between_webservers ipv4
</span></span><span class="line"><span class="cl">      match drop_http_between_webservers-reverse ipv4
</span></span><span class="line"><span class="cl">      match clients_to_webservers ipv4
</span></span><span class="line"><span class="cl">      match clients_to_webservers-reverse ipv4
</span></span><span class="line"><span class="cl">      match ssh_to_web-app_servers ipv4
</span></span><span class="line"><span class="cl">      match ssh_to_web-app_servers-reverse ipv4
</span></span><span class="line"><span class="cl">      match web-to-appserver1 ipv4
</span></span><span class="line"><span class="cl">      match web-to-appserver1-reverse ipv4
</span></span><span class="line"><span class="cl">      match drop_all_else_web-app ipv4
</span></span><span class="line"><span class="cl">      match drop_all_else_web-app-reverse ipv4
</span></span><span class="line"><span class="cl">      match ipv4-all-default ipv4
</span></span><span class="line"><span class="cl">      match ipv6-all-default ipv6
</span></span></code></pre></div>

<h2 class="relative group">Outro 
    <div id="outro" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#outro" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>This has been a very interesting experience. MSS is easy to get started with. It is more or less there just waiting for you to enable it. A big benefit, apart from easy administration, is the idea that I can cover my whole estate with policies, across the board with no gaps. In the DC, in the Campus, different Campus&rsquo;es, Branch offices all from same management UI (CloudVision). Instead of bringing the traffic into my DC I can police the traffic at the edge, where it is. I have to do a follow up post when I also get some Arista Wifi in the house. Then I hopefully can utilize the integration of AGNI in MSS too. MSS also supports redirect rules to 3rd party firewalls for further inspection which I did not have the time to look at this time.  If MSS is in place, there is no place to hide. It will be enforced by the traffic-policies on the Arista switches. Performance wise there is no better place to enforce it than on the switches themselves. They are made for it and at line-rate performance.. Well it cant really be any better.</p>
<p>Recommend material to have a look at:</p>
<p>Arists MSS on <a href="https://www.youtube.com/watch?v=WyR3oqnCu4w" target="_blank">YouTube</a></p>


<h3 class="relative group">Sources 
    <div id="sources" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#sources" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li><a href="https://www.arista.com/en/products/multi-domain-segmentation/" target="_blank">Arista Multi-Domain Segmentaton - homepage</a></li>
<li><a href="https://www.arista.com/en/products/multi-domain-segmentation/literature" target="_blank">Arista Multi-Domain Segmentation - literature</a></li>
<li><a href="https://www.arista.com/assets/data/pdf/ZTX-7250S-Deployment-Guide.pdf" target="_blank">ZTX Deployment Guide</a></li>
<li><a href="https://www.arista.com/assets/data/pdf/user-manual/um-books/MSS-Deployment-Guide.pdf" target="_blank">MSS Deployment Guide</a></li>
<li><a href="https://www.arista.com/assets/data/pdf/Datasheets/Multi-Domain-Segmentation-Services-for-Zero-Trust-Networking.pdf" target="_blank">MSS Data-Sheet</a></li>
<li><a href="https://www.arista.com/assets/data/pdf/Whitepapers/MSS-Segmentation-Technical-WP.pdf" target="_blank">MSS Whitepaper</a></li>
</ul>

          
          
          
        </div>
        
        

        
        
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://blog.andreasm.io/2025/11/13/arista-mss-multi-domain-segmentation/&amp;title=Arista%20MSS%20-%20Multi-Domain%20Segmentation"
      title="Share on LinkedIn"
      aria-label="Share on LinkedIn"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://twitter.com/intent/tweet/?url=https://blog.andreasm.io/2025/11/13/arista-mss-multi-domain-segmentation/&amp;text=Arista%20MSS%20-%20Multi-Domain%20Segmentation"
      title="Tweet on Twitter"
      aria-label="Tweet on Twitter"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://s2f.kytta.dev/?text=Arista%20MSS%20-%20Multi-Domain%20Segmentation%20https://blog.andreasm.io/2025/11/13/arista-mss-multi-domain-segmentation/"
      title=""
      aria-label=""
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="mailto:?body=https://blog.andreasm.io/2025/11/13/arista-mss-multi-domain-segmentation/&amp;subject=Arista%20MSS%20-%20Multi-Domain%20Segmentation"
      title="Send via email"
      aria-label="Send via email"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>


    </a>
      
    
  </section>


        


<h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2>
<section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3">
  
  

  <a href="/2023/12/18/a-quick-glance-at-cilium-cni/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/2023/12/18/a-quick-glance-at-cilium-cni/feature-cilium.jpg);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/2023/12/18/a-quick-glance-at-cilium-cni/">A Quick Glance at Cilium CNI</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2023-12-18T11:49:56&#43;01:00">18 December 2023</time><span class="px-2 text-primary-500">&middot;</span><span>8012 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">38 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/cni/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    CNI
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/networking/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Networking
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/security/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Security
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/monitoring/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Monitoring
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/ebpf/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    EBPF
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/cilium/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Cilium
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/cni/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Cni
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/networking/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Networking
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/ebpf/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Ebpf
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
        <div class="py-1 prose dark:prose-invert">
          In this post I will deploy Cilium in my k8s cluster and test some features and how it is to manage
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
  

  <a href="/2022/03/13/managing-your-antrea-k8s-clusters-running-in-vmc-from-your-on-prem-nsx-manager/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/2022/03/13/managing-your-antrea-k8s-clusters-running-in-vmc-from-your-on-prem-nsx-manager/feature-VMware-on-AWS-3-2_transp.png);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/2022/03/13/managing-your-antrea-k8s-clusters-running-in-vmc-from-your-on-prem-nsx-manager/">Managing your Antrea K8s clusters running in VMC from your on-prem NSX Manager</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2022-03-13T00:00:00&#43;00:00">13 March 2022</time><span class="px-2 text-primary-500">&middot;</span><span>3345 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">16 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/vmware-cloud/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    VMware-Cloud
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/networking/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Networking
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/security/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Security
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/antrea/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Antrea
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/nsx/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Nsx
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/vmconaws/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Vmconaws
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/security/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Security
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
        <div class="py-1 prose dark:prose-invert">
          This week I was fortunate to get hold of a VMC on AWS environment and wanted to test out the possibility of managing my K8s security policies from my on-prem NSX manager by utilizing the integration of Antrea in NSX.
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
  

  <a href="/2021/10/19/vmware-nsx-ids-ips/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/2021/10/19/vmware-nsx-ids-ips/feature-icon-prod-nsx-ids-ips-rgb-400px.svg);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/2021/10/19/vmware-nsx-ids-ips/">VMware NSX IDS & IPS</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2021-10-19T00:00:00&#43;00:00">19 October 2021</time><span class="px-2 text-primary-500">&middot;</span><span>2186 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">11 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/networking/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Networking
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/security/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Security
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/nsx/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Nsx
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/ids/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Ids
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/ips/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Ips
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/security/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Security
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
        <div class="py-1 prose dark:prose-invert">
          This post will go through the IDS/IPS built-in feature of the NSX distributed firewall.
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
</section>

  
      </div>
     
      
      
        
        
          
          
        
      <script>
        var oid = "views_posts\/2025-11-13-arista-mss\/index.md"
        var oid_likes = "likes_posts\/2025-11-13-arista-mss\/index.md"
      </script>
      
      
      <script type="text/javascript" src="/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js" integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q&#43;oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script>
      
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/2025/03/13/adding-netbox-to-my-pipeline/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Adding Netbox to my pipeline</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2025-03-13T10:14:47&#43;01:00">13 March 2025</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top" title="Scroll to top">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
    <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex flex-col list-none sm:flex-row">
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/tags/"
            title="">
            
            Tags
          </a>
        </li>
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/categories/"
            title="">
            
            Categories
          </a>
        </li>
        
      </ul>
    </nav>
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      &copy;
      2025
      Andreas Marqvardsen
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js" integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="https://blog.andreasm.io/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
