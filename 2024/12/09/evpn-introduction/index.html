<!DOCTYPE html>
<html lang="en" dir="ltr" class="scroll-smooth" data-default-appearance="dark"
  data-auto-appearance="true"><head>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>EVPN introduction &middot; blog.andreasm.io</title>
  <meta name="title" content="EVPN introduction &middot; blog.andreasm.io" />
  
  <meta name="description" content="First post in a series of posts covering EVPN and getting to know EVPN with Arista EOS" />
  <meta name="keywords" content="evpn, networking, multi-tenancy, vxlan, overlay, " />
  
  
  <link rel="canonical" href="https://blog.andreasm.io/2024/12/09/evpn-introduction/" />
  
  
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.48d290696564c2380c4233780f3fd414aa6e2b0b67ed916e9d918c48c05f5b20b641bf892fadd408e43ec21d2feb2ec1fe6fd1f021df2806a254977fe2f80a64.css"
    integrity="sha512-SNKQaWVkwjgMQjN4Dz/UFKpuKwtn7ZFunZGMSMBfWyC2Qb&#43;JL63UCOQ&#43;wh0v6y7B/m/R8CHfKAaiVJd/4vgKZA==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.a85bd6dc99d1fecae166deb56a1fee6375588c72533c4b8c690e4a9ec5a04174ff780e41e2ac770382a8e67818cb2b89766afa3e23965c9102424a080dafbb0c.js"
    integrity="sha512-qFvW3JnR/srhZt61ah/uY3VYjHJTPEuMaQ5KnsWgQXT/eA5B4qx3A4Ko5ngYyyuJdmr6PiOWXJECQkoIDa&#43;7DA=="></script>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.a2d78d78672e549fbfc972ece871725b5478ba0b65708dda20cb97ab80a865eae6d247e1b05a4aec6ebbf78647ec3233bad8b2609ed98eee53cd58aa17128bc7.js"
    integrity="sha512-oteNeGcuVJ&#43;/yXLs6HFyW1R4ugtlcI3aIMuXq4CoZerm0kfhsFpK7G6794ZH7DIzutiyYJ7Zju5TzViqFxKLxw==" data-copy="" data-copied=""></script>
  
  
  
  <script src="/lib/zoom/zoom.min.37d2094687372da3f7343a221a470f6b8806f7891aa46a5a03966af7f0ebd38b9fe536cb154e6ad28f006d184b294525a7c4054b6bbb4be62d8b453b42db99bd.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S&#43;Yti0U7QtuZvQ=="></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="https://blog.andreasm.io/2024/12/09/evpn-introduction/">
  <meta property="og:site_name" content="blog.andreasm.io">
  <meta property="og:title" content="EVPN introduction">
  <meta property="og:description" content="What is EVPN? An introduction to EVPN">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-12-09T14:55:58+01:00">
    <meta property="article:modified_time" content="2024-12-09T14:55:58+01:00">
    <meta property="article:tag" content="Evpn">
    <meta property="article:tag" content="Networking">
    <meta property="article:tag" content="Multi-Tenancy">
    <meta property="article:tag" content="Vxlan">
    <meta property="article:tag" content="Overlay">
    <meta property="og:image" content="https://blog.andreasm.io/2024/12/09/evpn-introduction/feature-arista-networks.jpg">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://blog.andreasm.io/2024/12/09/evpn-introduction/feature-arista-networks.jpg">
  <meta name="twitter:title" content="EVPN introduction">
  <meta name="twitter:description" content="What is EVPN? An introduction to EVPN">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "EVPN introduction",
    "headline": "EVPN introduction",
    "description": "What is EVPN? An introduction to EVPN",
    "abstract": "First post in a series of posts covering EVPN and getting to know EVPN with Arista EOS",
    "inLanguage": "en",
    "url" : "https:\/\/blog.andreasm.io\/2024\/12\/09\/evpn-introduction\/",
    "author" : {
      "@type": "Person",
      "name": "Andreas Marqvardsen"
    },
    "copyrightYear": "2024",
    "dateCreated": "2024-12-09T14:55:58\u002b01:00",
    "datePublished": "2024-12-09T14:55:58\u002b01:00",
    
    "dateModified": "2024-12-09T14:55:58\u002b01:00",
    
    "keywords": ["evpn","networking","multi-tenancy","vxlan","overlay"],
    
    "mainEntityOfPage": "true",
    "wordCount": "9172"
  }]
  </script>


  
  
  <meta name="author" content="Andreas Marqvardsen" />
  
  
  
  <link href="mailto:andreas.marqvardsen[AT]gmail.com" rel="me" />
  
  
  <link href="https://blog.andreasm.io/" rel="me" />
  
  
  <link href="https://github.com/andreasm80" rel="me" />
  
  
  <link href="https://linkedin.com/in/andreas-marqvardsen" rel="me" />
  
  
  <link href="https://vmst.io/@andreasm" rel="me" />
  
  
  <link href="https://x.com/NATsoFast" rel="me" />
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>






















  
  

<script async src="https://www.googletagmanager.com/gtag/js?id=G-TVPYDVE8KR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TVPYDVE8KR');
</script>



  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a>
  </div>
  
  
  <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px]" style="z-index:100">
  <div id="menu-blur" class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div>
  <div class="relative max-w-[64rem] ml-auto mr-auto">
    <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3">
    
    
    
    <div>
        <a href="/" class="flex">
            <span class="sr-only">blog.andreasm.io</span>

            
            <img src="/ynwa2.png" width="300" height="342"
                class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt="blog.andreasm.io" />
            

        </a>
    </div>
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">blog.andreasm.io</a>
            

        </nav>
        <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

            
            
            
  <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Posts
    </p>
</a>



            
            
  <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        About
    </p>
</a>



            
            
  <a href="/categories/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Categories
    </p>
</a>



            
            
  <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Tags
    </p>
</a>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class="ltr:mr-14 rtl:ml-14 flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center space-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400" style="margin-right:5px">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 -mr-2 md:hidden">

        <label id="menu-button" class="block">
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li id="menu-close-button">
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                    
  <li class="mt-1">
    <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Posts
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            About
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/categories/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Categories
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Tags
        </p>
    </a>
</li>




                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>




<script>
    (function () {
        var $mainmenu = $('.main-menu');
        var path = window.location.pathname;
        $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
            $(e).children('p').addClass('active');
        });
    })();
</script>


  </div>
</div>
<script>
  window.addEventListener('scroll', function (e) {
    var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
    var background_blur = document.getElementById('menu-blur');
    background_blur.style.opacity = (scroll / 300);
  });
</script>

  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  
  
  
  
  
  


<div id="hero" class="h-[150px] md:h-[200px]"></div>



    
    <div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"
    style="background-image:url(/2024/12/09/evpn-introduction/feature-arista-networks.jpg);">
    


    <div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal">
    </div>
    <div
        class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal">
    </div>
</div>

<div id="background-blur" class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div>
<script>
    window.addEventListener('scroll', function (e) {
        var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        var background_blur = document.getElementById('background-blur');
        background_blur.style.opacity = (scroll / 300)
    });
</script>

  
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/"
      >blog.andreasm.io</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline ">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/posts/"
      >Posts</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/2024/12/09/evpn-introduction/"
      >EVPN introduction</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      EVPN introduction
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-12-09T14:55:58&#43;01:00">9 December 2024</time><span class="px-2 text-primary-500">&middot;</span><span>9172 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">44 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/networking/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Networking
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/evpn/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    EVPN
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/encapsulation/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Encapsulation
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/overlay/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Overlay
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/evpn/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Evpn
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/networking/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Networking
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/multi-tenancy/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Multi-Tenancy
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/vxlan/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Vxlan
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/overlay/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Overlay
  </span>
</span>
  </span>
  
  
  
  
</div>




    </div>

    
    
    
    
    

    

    
      
      
        
        
<div class="flex author">
  
    
    
      
    
    
      
      <img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width="96" height="96"
      alt="Andreas Marqvardsen" src="/profile.png" />
    
  
  <div class="place-self-center">
    
    <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
      Author
    </div>
    <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
      Andreas Marqvardsen
    </div>
    
    
    <div class="text-sm text-neutral-700 dark:text-neutral-400">Always curious, always learning</div>
    
    <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="mailto:andreas.marqvardsen[AT]gmail.com"
          target="_blank"
          aria-label="Email"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://blog.andreasm.io/"
          target="_blank"
          aria-label="Link"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M172.5 131.1C228.1 75.51 320.5 75.51 376.1 131.1C426.1 181.1 433.5 260.8 392.4 318.3L391.3 319.9C381 334.2 361 337.6 346.7 327.3C332.3 317 328.9 297 339.2 282.7L340.3 281.1C363.2 249 359.6 205.1 331.7 177.2C300.3 145.8 249.2 145.8 217.7 177.2L105.5 289.5C73.99 320.1 73.99 372 105.5 403.5C133.3 431.4 177.3 435 209.3 412.1L210.9 410.1C225.3 400.7 245.3 404 255.5 418.4C265.8 432.8 262.5 452.8 248.1 463.1L246.5 464.2C188.1 505.3 110.2 498.7 60.21 448.8C3.741 392.3 3.741 300.7 60.21 244.3L172.5 131.1zM467.5 380C411 436.5 319.5 436.5 263 380C213 330 206.5 251.2 247.6 193.7L248.7 192.1C258.1 177.8 278.1 174.4 293.3 184.7C307.7 194.1 311.1 214.1 300.8 229.3L299.7 230.9C276.8 262.1 280.4 306.9 308.3 334.8C339.7 366.2 390.8 366.2 422.3 334.8L534.5 222.5C566 191 566 139.1 534.5 108.5C506.7 80.63 462.7 76.99 430.7 99.9L429.1 101C414.7 111.3 394.7 107.1 384.5 93.58C374.2 79.2 377.5 59.21 391.9 48.94L393.5 47.82C451 6.731 529.8 13.25 579.8 63.24C636.3 119.7 636.3 211.3 579.8 267.7L467.5 380z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/andreasm80"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://linkedin.com/in/andreas-marqvardsen"
          target="_blank"
          aria-label="Linkedin"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://vmst.io/@andreasm"
          target="_blank"
          aria-label="Mastodon"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://x.com/NATsoFast"
          target="_blank"
          aria-label="X-Twitter"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
  </span>

</span></a
        >
      
    
  </div>

</div>
  </div>
</div>

      

      

      
      <div class="mb-5"></div>
      

    

  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
     <div
      class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
      <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]">

         <details open id="TOCView"
  class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#layer-2-over-layer-3">Layer 2 over layer 3</a></li>
    <li><a href="#evpn-bgp-and-network-virtualization-overlay---control-plane-vs-dataplane">EVPN, BGP and Network Virtualization Overlay - control plane vs dataplane</a>
      <ul>
        <li><a href="#mp-bgp">MP-BGP</a></li>
        <li><a href="#vxlan---the-dataplane">VXLAN - the dataplane</a></li>
      </ul>
    </li>
    <li><a href="#how-is-evpn-configured-with-arista-eos">How is EVPN configured with Arista EOS</a>
      <ul>
        <li><a href="#the-underlay">The underlay</a>
          <ul>
            <li><a href="#peer-to-peer-links">Peer to Peer links</a></li>
            <li><a href="#bgp-in-the-underlay">BGP in the underlay</a></li>
          </ul>
        </li>
        <li><a href="#the-overlay">The overlay</a>
          <ul>
            <li><a href="#bgp-in-the-overlay">BGP in the overlay</a></li>
            <li><a href="#vxlan-configurations">VXLAN configurations</a></li>
            <li><a href="#adding-layer-2-networks-using-vxlan">Adding layer 2 networks using VXLAN</a></li>
            <li><a href="#integrated-routing-and-bridging-irb">Integrated routing and bridging (IRB)</a></li>
          </ul>
        </li>
        <li><a href="#complete-configurations">Complete configurations</a></li>
        <li><a href="#verify-configurations-and-a-quick-look-at-the-routes">Verify configurations and a quick look at the routes</a></li>
      </ul>
    </li>
    <li><a href="#sources">Sources</a></li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#layer-2-over-layer-3">Layer 2 over layer 3</a></li>
    <li><a href="#evpn-bgp-and-network-virtualization-overlay---control-plane-vs-dataplane">EVPN, BGP and Network Virtualization Overlay - control plane vs dataplane</a>
      <ul>
        <li><a href="#mp-bgp">MP-BGP</a></li>
        <li><a href="#vxlan---the-dataplane">VXLAN - the dataplane</a></li>
      </ul>
    </li>
    <li><a href="#how-is-evpn-configured-with-arista-eos">How is EVPN configured with Arista EOS</a>
      <ul>
        <li><a href="#the-underlay">The underlay</a>
          <ul>
            <li><a href="#peer-to-peer-links">Peer to Peer links</a></li>
            <li><a href="#bgp-in-the-underlay">BGP in the underlay</a></li>
          </ul>
        </li>
        <li><a href="#the-overlay">The overlay</a>
          <ul>
            <li><a href="#bgp-in-the-overlay">BGP in the overlay</a></li>
            <li><a href="#vxlan-configurations">VXLAN configurations</a></li>
            <li><a href="#adding-layer-2-networks-using-vxlan">Adding layer 2 networks using VXLAN</a></li>
            <li><a href="#integrated-routing-and-bridging-irb">Integrated routing and bridging (IRB)</a></li>
          </ul>
        </li>
        <li><a href="#complete-configurations">Complete configurations</a></li>
        <li><a href="#verify-configurations-and-a-quick-look-at-the-routes">Verify configurations and a quick look at the routes</a></li>
      </ul>
    </li>
    <li><a href="#sources">Sources</a></li>
  </ul>
</nav>
  </div>
</details>

<script>

  var margin = 200;
  var marginError = 50;

  (function () {
    var $window = $(window);
    var $toc = $('#TOCView');
    var tocHeight = $toc.height();

    function onResize() {
      var windowAndMarginHeight = $window.height() - margin;
      if(tocHeight >= windowAndMarginHeight) {
        $toc.css("overflow-y", "scroll")
        $toc.css("max-height", (windowAndMarginHeight + marginError) + "px")
      } else {
        $toc.css("overflow-y", "hidden")
        $toc.css("max-height", "9999999px")
      }
    }

    $window.on('resize', onResize);
    $(document).ready(onResize);
  })();



  (function () {
    var $toc = $('#TableOfContents');
    if ($toc.length > 0) {
      var $window = $(window);

      function onScroll() {
        var currentScroll = $window.scrollTop();
        var h = $('.anchor');
        var id = "";
        h.each(function (i, e) {
          e = $(e);
          if (e.offset().top - $(window).height()/3 <= currentScroll) {
            id = decodeURIComponent(e.attr('id'));
          }
        });
        var active = $toc.find('a.active');      
        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

        active.each(function (i, e) {
          
            $(e).removeClass('active');
          
        });
        $toc.find('a[href="#' + id + '"]').addClass('active')
        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
          $(e).children('a').parents('ul').show();          
        });
      }

      $window.on('scroll', onScroll);
      $(document).ready(function () {
        
        onScroll();
      });
    }
  })();


</script>
   </div>
      </div>
      

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          

<h1 class="relative group">Ethernet Virtual Private Network 
    <div id="ethernet-virtual-private-network" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#ethernet-virtual-private-network" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>This post marks the begining of a series I am covering on EVPN. The first informational RFC(<a href="https://datatracker.ietf.org/doc/rfc7209/" target="_blank">RFC7209</a>) for EVPN was posted May 2014. It is just a coincidence that EVPN is now on its 10th year and I am writing this blog series. As I have the pleasure of working together with some of the best in the industry, which is motivating on its own, I highly encourage everyone to have a look at this <a href="https://youtu.be/QIfClRUl3Bg?si=0I_bhpR3S05iwTp9" target="_blank">video</a> from my colleague Johan where he takes us brilliantly through EVPN&rsquo;s 10 year history.</p>
<p>As this blog series will evolve I will cover EVPN and its different Route Types and EVPN gateways to get a better understanding of what they are, and why they are needed. But first, a quick introduction to EVPN in general. What is EVPN, what is EVPN&rsquo;s responsibilities in the datacenter, and why EVPN. Lets go ahead and try to cast some light on this.</p>


<h2 class="relative group">Layer 2 over layer 3 
    <div id="layer-2-over-layer-3" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#layer-2-over-layer-3" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>As the datacenter networking (and campus to a certain degree) has evolved from the traditional core, distribution and access topology to the much more scalable layer 3 spine-leaf topology, the need for layer 2 did not disappear. MAC mobility/vMotion of virtual machines, application requirements like cluster services, iot devices etc are examples that rely on layer 2 reachability. The move away from large broadcast domains in the networks to IP fabric solved a lot of challenges in terms of scalability, performance and resilience. In its own it was a case closed for any loops, broadcast storms scenarios and poor utilization. Though many services in your network still relies on layer 2 though, so how to solve that in a pure layer 3 IP fabric like spine-leaf?</p>
<p>Existing services as VPLS and Ethernet L2VPN existed, but had its limitations.</p>
<p>To quote the RFC7209:</p>
<blockquote>
<p>The widespread adoption of Ethernet L2VPN services and the advent of
new applications for the technology (e.g., data center interconnect)
have culminated in a new set of requirements that are not readily
addressable by the current Virtual Private LAN Service (VPLS)
solution.  In particular, multihoming with all-active forwarding is
not supported, and there&rsquo;s no existing solution to leverage
Multipoint-to-Multipoint (MP2MP) Label Switched Paths (LSPs) for
optimizing the delivery of multi-destination frames.  Furthermore,
the provisioning of VPLS, even in the context of BGP-based auto-
discovery, requires network operators to specify various network
parameters on top of the access configuration.  This document
specifies the requirements for an Ethernet VPN (EVPN) solution, which
addresses the above issues.</p>
</blockquote>


<h2 class="relative group">EVPN, BGP and Network Virtualization Overlay - control plane vs dataplane 
    <div id="evpn-bgp-and-network-virtualization-overlay---control-plane-vs-dataplane" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#evpn-bgp-and-network-virtualization-overlay---control-plane-vs-dataplane" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>What is EVPN? The short answer is that EVPN is an extension to BGP. But that doesn&rsquo;t help much does it? Lets see if I can go a bit deeper.</p>
<p>In a spine-leaf fabric all switches are connected using layer 3 links. If all the services connected to the fabric can do fine with layer 3 and be in their own IP subnet, I am fine. Traffic is routed as needed and full reachability is taken care of.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/12/09/evpn-introduction/images/image-20241219095711506.png"
        alt="l3-reachability"
      />
      
    </figure>
</p>
<p>If I need to extend layer 2 beyond any leaf I am not so fine.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/12/09/evpn-introduction/images/image-20241219100258542.png"
        alt="layer2"
      />
      
    </figure>
</p>
<p>Without any form of mechanisms like overlay control-/and dataplane I am not able to extend my layer 2 network beyond a single leaf. So if I need layer 2 reachability across leafs in the same fabric I need mechanisms that can handle layer 2 over layer 3. The first thing we need is a protocol to create overlay networks that can tunnel, or simulate, layer 2 subnets over layer 3, this can be VXLAN as an example.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/12/09/evpn-introduction/images/image-20241219101030140.png"
        alt="vxlan-encapsulation"
      />
      
    </figure>
</p>
<p>By having protocols like VXLAN to create overlay networks in place it provides the ability to extend my layer 2 subnets across my layer 3 fabric. Managing this at scale though can be hard if not the right mechanisms is in place to accommodate a very dynamic environment such as vm sprawl, multiple tenants etc, we need something that can manage the reachability information in a clever, controlled and scalable way and something that understands network virtualization overlay.</p>
<p>I can use static routes then? Well, in theory, I could, but that would defeat the purpose of scalability and simpler management, leaving no reason to build a spine-leaf fabric to begin with.</p>
<p>BGP? Yes, it is a very good start. But I cant use regular BGP.</p>
<p>Regular BGP (<a href="https://datatracker.ietf.org/doc/html/rfc4271" target="_blank">RFC4271</a>):</p>
<blockquote>
<p>The only three pieces of information carried by BGP-4 [BGP-4] that
are IPv4 specific are (a) the NEXT_HOP attribute (expressed as an
IPv4 address), (b) AGGREGATOR (contains an IPv4 address), and (c)
NLRI (expressed as IPv4 address prefixes).</p>
</blockquote>
<p>Source: <a href="https://datatracker.ietf.org/doc/html/rfc4760" target="_blank">https://datatracker.ietf.org/doc/html/rfc4760</a></p>
<p>As regular BGP can only handle IP addresses and IP prefixes it is not sufficient. We need something that can handle a richer set of reachability information, to be able to handle network reachability information when using overlay protocols like VXLAN.</p>
<p>In a spine-leaf fabric these layer 2 networks can be referred to as tenants, virtualized network segments or VPN instances. The need for multiple tenants could be to allow several layer 2 networks sharing the same physical underlay fabric, multiple customers and services sharing the same fabric and even overlapping layer 2 subnets. EVPN allows for these tenants to be configured and isloated in the shared fabric as it enables BGP to have MAC addresses and MAC plus IP addresses as routing entries. In a regular layer 2 switch network, the switches learn how to forward traffic by looking at the Ethernet Frame&rsquo;s MAC headers. An Ethernet Frame consists of a source MAC header and destination MAC header. With an overlay protocol like VXLAN, the standard Ethernet frame is encapsulated adding some additional headers including the source and destination mac address per hop in the underlay, see short explanation below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Ping between two clients attached to two separate leaf switches leaf1a and leaf2a - mac src and mac dst</span>
</span></span><span class="line"><span class="cl">1st hop <span class="o">(</span>leaf1a<span class="o">)</span>: mac src leaf1a -&gt; mac dst spine2
</span></span><span class="line"><span class="cl">2nd hop <span class="o">(</span>spine2<span class="o">)</span>: mac src spine2 -&gt; mac dst leaf2a
</span></span></code></pre></div><p>And the source and destination IP in the vxlan header will be the source and destination ip of the VTEPS:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Ping between two clients attached to two separate leaf switches leaf1a and leaf2a - src IP and dst IP</span>
</span></span><span class="line"><span class="cl">1st hop <span class="o">(</span>leaf1a<span class="o">)</span>: src IP vxlan loopback interface leaf1a -&gt; dst IP vxlan loopback interface leaf2a
</span></span><span class="line"><span class="cl">2nd hop <span class="o">(</span>spine2<span class="o">)</span>: src IP vxlan loopback interface leaf1a -&gt; dst IP vxlan loopback interface leaf2a
</span></span></code></pre></div><p>For more explanation: see my <a href="https://blog.andreasm.io/2024/11/08/overlay-on-overlay-arista-in-the-underlay/#let-see-some-triple-encapsulation-in-action" target="_blank">previous post on overlay</a></p>
<p>With EVPN we have a way to capture this additional information and add it to the routing table dynamically allowing the VXLAN tunnels to be established to relevant peers (VTEPS). The peers in VXLAN are called VTEPs, VXLAN Tunnel End Points.</p>
<p>After the first informational <a href="https://datatracker.ietf.org/doc/rfc7209/" target="_blank">RFC7209</a> that specified the intention and requirements with EVPN, just under a year later, the initial EVPN standard <a href="https://datatracker.ietf.org/doc/rfc7432/" target="_blank">RFC7432</a> was posted. The initial EVPN standard (RFC7432) was written with MPLS in mind, however some years later (2018) the <a href="https://datatracker.ietf.org/doc/rfc8365/" target="_blank">RFC8365</a> was posted describing how EVPN can be used as a network virtualization overlay in combinaton with various encapsulation options like VXLAN, NVGRE, MPLS over GRE and even Geneve. Now why do I mention these RFCs in addtion to the initial RFC7209 from 2014? Well stay tuned to get some clarity on this point.</p>
<p>First, EVPN stands for Ethernet VPN. EVPN is capable of managing both layer 2 (Ethernet MAC) and IP (layer 3) reachability information. That means EVPN is <strong>not</strong> the carrier of the actual ethernet frames or IP packets, it just informs the interested parties whats the source and destination. And to do that, it uses BGP or rather MP-BGP (Multi-Protocol BGP <a href="https://datatracker.ietf.org/doc/html/rfc4760" target="_blank">RFC4760</a> an extension to the regular BGP). One of the benefits of BGP is that it does not rely on flood-and-learn in the dataplane, but uses instead a control-plane based learning allowing to restrict who learns what and the ability to apply policies. This reduces unnecessary flooding and is much more scalable. Wasn&rsquo;t this a post about EVPN? Well EVPN uses BGP as its control plane, and the extension to BGP, MP-BGP, makes BGP capable of handle the advertising of additional EVPN routes. Suddenly there is MP-BGP into the mix?</p>


<h3 class="relative group">MP-BGP 
    <div id="mp-bgp" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#mp-bgp" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Yes, it is. MP-BGP extends BGP to carry multiple address families, which is needed to handle overlay encapsulation that comes with the use of e.g VXLAN.</p>
<blockquote>
<p>To provide backward compatibility, as well as to simplify
introduction of the multiprotocol capabilities into BGP-4, this
document uses two new attributes, Multiprotocol Reachable NLRI
(MP_REACH_NLRI) and Multiprotocol Unreachable NLRI (MP_UNREACH_NLRI).
The first one (MP_REACH_NLRI) is used to carry the set of reachable
destinations together with the next hop information to be used for
forwarding to these destinations.  The second one (MP_UNREACH_NLRI)
is used to carry the set of unreachable destinations.  Both of these
attributes are optional and non-transitive.  This way, a BGP speaker
that doesn&rsquo;t support the multiprotocol capabilities will just ignore
the information carried in these attributes and will not pass it to
other BGP speakers.</p>
</blockquote>
<blockquote>
<p>Multiprotocol Reachable NLRI - MP_REACH_NLRI (Type Code 14):</p>
<p>This is an optional non-transitive attribute that can be used for the
following purposes:</p>
<p>(a) to advertise a feasible route to a peer</p>
<p>(b) to permit a router to advertise the Network Layer address of the
router that should be used as the next hop to the destinations
listed in the Network Layer Reachability Information field of the
MP_NLRI attribute.</p>
<p>The attribute is encoded as shown below:</p>
</blockquote>
<p>Source: <a href="https://datatracker.ietf.org/doc/html/rfc4760" target="_blank">https://datatracker.ietf.org/doc/html/rfc4760</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">        MP-BGP Reachable NLRI
</span></span><span class="line"><span class="cl">        +---------------------------------------------------------+
</span></span><span class="line"><span class="cl">        <span class="p">|</span> Address Family Identifier <span class="o">(</span><span class="m">2</span> octets<span class="o">)</span>                    <span class="p">|</span>
</span></span><span class="line"><span class="cl">        +---------------------------------------------------------+
</span></span><span class="line"><span class="cl">        <span class="p">|</span> Subsequent Address Family Identifier <span class="o">(</span><span class="m">1</span> octet<span class="o">)</span>          <span class="p">|</span>
</span></span><span class="line"><span class="cl">        +---------------------------------------------------------+
</span></span><span class="line"><span class="cl">        <span class="p">|</span> Length of Next Hop Network Address <span class="o">(</span><span class="m">1</span> octet<span class="o">)</span>            <span class="p">|</span>
</span></span><span class="line"><span class="cl">        +---------------------------------------------------------+
</span></span><span class="line"><span class="cl">        <span class="p">|</span> Network Address of Next Hop <span class="o">(</span>variable<span class="o">)</span>                  <span class="p">|</span>
</span></span><span class="line"><span class="cl">        +---------------------------------------------------------+
</span></span><span class="line"><span class="cl">        <span class="p">|</span> Reserved <span class="o">(</span><span class="m">1</span> octet<span class="o">)</span>                                      <span class="p">|</span>
</span></span><span class="line"><span class="cl">        +---------------------------------------------------------+
</span></span><span class="line"><span class="cl">        <span class="p">|</span> Network Layer Reachability Information <span class="o">(</span>variable<span class="o">)</span>       <span class="p">|</span>
</span></span><span class="line"><span class="cl">        +---------------------------------------------------------+
</span></span></code></pre></div><p>EVPN will use MP-BGP to add new BGP Network Layer Reachability Information (NLRI), the EVPN NLRI. This is where we will get a set of different EVPN route types, which I will cover in separate posts later.
The EVPN NLRI is carried in BGP using MP-BGP with an Address Family Identifier of 25 (L2VPN) and a Subsequent Address Family Identifier of 70 (EVPN).</p>
<p>The different route types of EVPN will be covered in detail in their own as part of this EVPN blog post series.</p>
<p>I will just quickly use EVPN route type 2, MAC/IP advertisement, as an example for clarification of how this fits in.</p>
<p>This is how a EVPN MAC/IP, route type 2, advertisement specific NLRI consists of (scroll down inside code viewer to see all):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">                +---------------------------------------+
</span></span><span class="line"><span class="cl">                <span class="p">|</span>  RD <span class="o">(</span><span class="m">8</span> octets<span class="o">)</span>                        <span class="p">|</span>
</span></span><span class="line"><span class="cl">                +---------------------------------------+
</span></span><span class="line"><span class="cl">                <span class="p">|</span>Ethernet Segment Identifier <span class="o">(</span><span class="m">10</span> octets<span class="o">)</span><span class="p">|</span>
</span></span><span class="line"><span class="cl">                +---------------------------------------+
</span></span><span class="line"><span class="cl">                <span class="p">|</span>  Ethernet Tag ID <span class="o">(</span><span class="m">4</span> octets<span class="o">)</span>           <span class="p">|</span>
</span></span><span class="line"><span class="cl">                +---------------------------------------+
</span></span><span class="line"><span class="cl">                <span class="p">|</span>  MAC Address Length <span class="o">(</span><span class="m">1</span> octet<span class="o">)</span>         <span class="p">|</span>
</span></span><span class="line"><span class="cl">                +---------------------------------------+
</span></span><span class="line"><span class="cl">                <span class="p">|</span>  MAC Address <span class="o">(</span><span class="m">6</span> octets<span class="o">)</span>               <span class="p">|</span>
</span></span><span class="line"><span class="cl">                +---------------------------------------+
</span></span><span class="line"><span class="cl">                <span class="p">|</span>  IP Address Length <span class="o">(</span><span class="m">1</span> octet<span class="o">)</span>          <span class="p">|</span>
</span></span><span class="line"><span class="cl">                +---------------------------------------+
</span></span><span class="line"><span class="cl">                <span class="p">|</span>  IP Address <span class="o">(</span>0, 4, or <span class="m">16</span> octets<span class="o">)</span>      <span class="p">|</span>
</span></span><span class="line"><span class="cl">                +---------------------------------------+
</span></span><span class="line"><span class="cl">                <span class="p">|</span>  MPLS Label1 <span class="o">(</span><span class="m">3</span> octets<span class="o">)</span>               <span class="p">|</span>
</span></span><span class="line"><span class="cl">                +---------------------------------------+
</span></span><span class="line"><span class="cl">                <span class="p">|</span>  MPLS Label2 <span class="o">(</span><span class="m">0</span> or <span class="m">3</span> octets<span class="o">)</span>          <span class="p">|</span>
</span></span><span class="line"><span class="cl">                +---------------------------------------+
</span></span></code></pre></div><p>All fields above are necessary to describe the complete EVPN route, though the fields Ethernet Segment Identifier, MPLS Label 1 and MPLS Label 2 are all in the NLRI, but not part of the route prefix used for route uniqueness. If reading the RFC7432:</p>
<blockquote>
<p><em><em>For the purpose of BGP route key processing, only the Ethernet Tag</em>
<em>ID, MAC Address Length, MAC Address, IP Address Length, and IP</em>
<em>Address fields are considered to be part of the prefix in the NLRI.</em>
<em>The Ethernet Segment Identifier, MPLS Label1, and MPLS Label2 fields</em>
<em>are to be treated as route attributes as opposed to being part of the</em>
&ldquo;route&rdquo;.  Both the IP and MAC address lengths are in bits.</em></p>
</blockquote>
<p>This can be a bit confusing. In terms of BGP they are not to be seen as attributes in a traditional &ldquo;BGP sense&rdquo; like AS_PATH or COMMUNITY etc.
Note: Even though there are two fields called MPLS Label 1 and 2 does not mean EVPN is not multi-protocol aware. Overlay related information like VNI is carried through EVPN extended communities defined here:</p>
<blockquote>
<p>In order to indicate which type of data-plane encapsulation (i.e.,
VXLAN, NVGRE, MPLS, or MPLS in GRE) is to be used, the BGP
Encapsulation Extended Community defined in [RFC5512] is included
with all EVPN routes (i.e., MAC Advertisement, Ethernet A-D per EVI,
Ethernet A-D per ESI, IMET, and Ethernet Segment) advertised by an
egress PE.  Five new values have been assigned by IANA to extend the
list of encapsulation types defined in [RFC5512]; they are listed in
Section 11.</p>
</blockquote>
<p>Now the RFC5512 referred to above has been updated with RFC9012:</p>
<blockquote>
<p>This document defines a BGP path attribute known as the &ldquo;Tunnel
Encapsulation attribute&rdquo;, which can be used with BGP UPDATEs of
various Subsequent Address Family Identifiers (SAFIs) to provide
information needed to create tunnels and their corresponding
encapsulation headers.  It provides encodings for a number of tunnel
types, along with procedures for choosing between alternate tunnels
and routing packets into tunnels.</p>
</blockquote>
<p>So EVPN just solved extending layer 2 networks its own? Well no. I mentioned the RFC7432 and RFC8365 earlier.  EVPN is not the &ldquo;carrier&rdquo; of the layer 2 networks, EVPN is the control-plane, the single control-plane for multiple network virtualization overlays (VXLAN, MPLS over GRE, Geneve). We also need something that can transport these networks. We need something that creates a tunnel for our layer 2 ethernet frames, to be able to actually transport these layer 2 networks over layer 3. This can be VXLAN (RFC8365) or MPLS over GRE (<a href="https://datatracker.ietf.org/doc/html/rfc4023" target="_blank">RFC4023</a>). EVPN may also be referred to as EVPN-VXLAN, EVPN-MPLS or BGP-EVPN. I have already covered VXLAN to some extent in this <a href="https://blog.andreasm.io/2024/11/08/overlay-on-overlay-arista-in-the-underlay/#overlay-in-the-underlay" target="_blank">post</a>. But a quick section on VXLAN will probably make sense. <em>I will mainly focus on EVPN-VXLAN in this blog series.</em></p>


<h3 class="relative group">VXLAN - the dataplane 
    <div id="vxlan---the-dataplane" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#vxlan---the-dataplane" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Now we understand what EVPN does right? Not quite.
TL;DR:
Well it has the ability to segment and isolate tenants (layer 2) effectively using a single control plane, BGP, in a shared layer 3 spine-leaf fabric and VXLAN (or Geneve, NVGRE) as the dataplane creating the tunnels between the involved VTEPS (leafs). This allows for an effective, scalable and controllable way to transport layer 2 over layer 3.</p>


<h2 class="relative group">How is EVPN configured with Arista EOS 
    <div id="how-is-evpn-configured-with-arista-eos" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#how-is-evpn-configured-with-arista-eos" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>To configure EVPN with VXLAN in Arista switches in a spine leaf there are two distinctions that needs to be made. First we have the underlay, that is where all the peer to peer links (routed interfaces) between the spines and leafs are configured. These are the carriers for whatever communication goes between any leaf in the fabric. The second is the overlay, this is where we will have our overlay networks configured, carrying all our layer 2 networks over the layer 3 peer to peer links configured in the underlay. Common for both the underlay and the overlay is BGP, as BGP is configured in both underlay and overlay. This could also be OSPF but why have two different routing protocols when one can just one to handle both the underlay and overlay for simpler management. For this section I have 2 spines and 4 leafs that I will configure EVPN and VXLAN on.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/12/09/evpn-introduction/images/image-20241219133604129.png"
        alt="fabric"
      />
      
    </figure>
</p>
<p>Lets start by configuring the underlay in a fabric consisting of 2 spines and 4 leafs.</p>


<h3 class="relative group">The underlay 
    <div id="the-underlay" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#the-underlay" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>In the underlay I need to configure both the ptp links, but also the underlay BGP configuration, starting with the peer to peer links for my BGP in the underlay to have something to peer with.</p>


<h4 class="relative group">Peer to Peer links 
    <div id="peer-to-peer-links" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#peer-to-peer-links" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>As I have 6 switches in total, I need to allocate 16 ipv4 addresses for the ptp links. There will be one uplink from every leaf to every spine. To save on IP addresses I will define the submask for these links as small as possible and it should only make room for 2 ip addresses per link (1 for the leaf uplink and 1 for the spine downlink to respective leaf (spine leaf &ldquo;pair&rdquo;)), and that should be a /31 netmask. It may make sense to reserve a range for all the potential future expansion in the same range for several reasons. As in my example below I will be using 10.255.255.x/31 for each ptp interface, this may again be carved out of a bigger /24 subnet giving me a total of 256 addresses. 256 addresses? 0 and 255 are broadcast aren&rsquo;t it? Arista EOS supports the <a href="https://datatracker.ietf.org/doc/rfc3021/" target="_blank">RFC3021</a> which states the following:</p>
<blockquote>
<p>With ever-increasing pressure to conserve IP address space on the
Internet, it makes sense to consider where relatively minor changes
can be made to fielded practice to improve numbering efficiency.  One
such change, proposed by this document, is to halve the amount of
address space assigned to point-to-point links (common throughout the
Internet infrastructure) by allowing the use of 31-bit subnet masks
in a very limited way.</p>
</blockquote>
<p>This means I can perfectly well use .0 as a useable address as long as it is a /31 submask wich gives me exactly two useable addresses, perfect fit for a peer to peer link.</p>
<p>Each interface on every switch used for these peer to peer links should look like this, from my spine-1:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">interface Ethernet1
</span></span><span class="line"><span class="cl">   description P2P_LINK_TO_VEOS-DC1-LEAF1A_Ethernet1
</span></span><span class="line"><span class="cl">   mtu <span class="m">9214</span>
</span></span><span class="line"><span class="cl">   no switchport
</span></span><span class="line"><span class="cl">   ip address 10.255.255.0/31
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Ethernet2
</span></span><span class="line"><span class="cl">   description P2P_LINK_TO_VEOS-DC1-LEAF1B_Ethernet1
</span></span><span class="line"><span class="cl">   mtu <span class="m">9214</span>
</span></span><span class="line"><span class="cl">   no switchport
</span></span><span class="line"><span class="cl">   ip address 10.255.255.4/31
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Ethernet3
</span></span><span class="line"><span class="cl">   description P2P_LINK_TO_VEOS-DC1-LEAF2A_Ethernet1
</span></span><span class="line"><span class="cl">   mtu <span class="m">9214</span>
</span></span><span class="line"><span class="cl">   no switchport
</span></span><span class="line"><span class="cl">   ip address 10.255.255.8/31
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Ethernet4
</span></span><span class="line"><span class="cl">   description P2P_LINK_TO_VEOS-DC1-LEAF2B_Ethernet1
</span></span><span class="line"><span class="cl">   mtu <span class="m">9214</span>
</span></span><span class="line"><span class="cl">   no switchport
</span></span><span class="line"><span class="cl">   ip address 10.255.255.12/31
</span></span><span class="line"><span class="cl">!
</span></span></code></pre></div><p><em>Notice the .0 in Ethernet1?</em></p>
<p>The same config is done on my spine 2 using other ip addresses obviously. For the leafs the peer to peer links looks like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">interface Ethernet1
</span></span><span class="line"><span class="cl">   description P2P_LINK_TO_VEOS-DC1-SPINE1_Ethernet1
</span></span><span class="line"><span class="cl">   mtu <span class="m">9214</span>
</span></span><span class="line"><span class="cl">   no switchport
</span></span><span class="line"><span class="cl">   ip address 10.255.255.1/31
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Ethernet2
</span></span><span class="line"><span class="cl">   description P2P_LINK_TO_VEOS-DC1-SPINE2_Ethernet1
</span></span><span class="line"><span class="cl">   mtu <span class="m">9214</span>
</span></span><span class="line"><span class="cl">   no switchport
</span></span><span class="line"><span class="cl">   ip address 10.255.255.3/31
</span></span><span class="line"><span class="cl">!
</span></span></code></pre></div><p>The same is done on the remaing leafs accordingly.</p>
<p>Here is the ip table for all the PTP links I am using:</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Node</th>
<th>Node Interface</th>
<th>Leaf IP Address</th>
<th>Peer Type</th>
<th>Peer Node</th>
<th>Peer Interface</th>
<th>Peer IP Address</th>
</tr>
</thead>
<tbody>
<tr>
<td>l3leaf</td>
<td>veos-dc1-leaf1a</td>
<td>Ethernet1</td>
<td>10.255.255.1/31</td>
<td>spine</td>
<td>veos-dc1-spine1</td>
<td>Ethernet1</td>
<td>10.255.255.0/31</td>
</tr>
<tr>
<td>l3leaf</td>
<td>veos-dc1-leaf1a</td>
<td>Ethernet2</td>
<td>10.255.255.3/31</td>
<td>spine</td>
<td>veos-dc1-spine2</td>
<td>Ethernet1</td>
<td>10.255.255.2/31</td>
</tr>
<tr>
<td>l3leaf</td>
<td>veos-dc1-leaf1b</td>
<td>Ethernet1</td>
<td>10.255.255.5/31</td>
<td>spine</td>
<td>veos-dc1-spine1</td>
<td>Ethernet2</td>
<td>10.255.255.4/31</td>
</tr>
<tr>
<td>l3leaf</td>
<td>veos-dc1-leaf1b</td>
<td>Ethernet2</td>
<td>10.255.255.7/31</td>
<td>spine</td>
<td>veos-dc1-spine2</td>
<td>Ethernet2</td>
<td>10.255.255.6/31</td>
</tr>
<tr>
<td>l3leaf</td>
<td>veos-dc1-leaf2a</td>
<td>Ethernet1</td>
<td>10.255.255.9/31</td>
<td>spine</td>
<td>veos-dc1-spine1</td>
<td>Ethernet3</td>
<td>10.255.255.8/31</td>
</tr>
<tr>
<td>l3leaf</td>
<td>veos-dc1-leaf2a</td>
<td>Ethernet2</td>
<td>10.255.255.11/31</td>
<td>spine</td>
<td>veos-dc1-spine2</td>
<td>Ethernet3</td>
<td>10.255.255.10/31</td>
</tr>
<tr>
<td>l3leaf</td>
<td>veos-dc1-leaf2b</td>
<td>Ethernet1</td>
<td>10.255.255.13/31</td>
<td>spine</td>
<td>veos-dc1-spine1</td>
<td>Ethernet4</td>
<td>10.255.255.12/31</td>
</tr>
<tr>
<td>l3leaf</td>
<td>veos-dc1-leaf2b</td>
<td>Ethernet2</td>
<td>10.255.255.15/31</td>
<td>spine</td>
<td>veos-dc1-spine2</td>
<td>Ethernet4</td>
<td>10.255.255.14/31</td>
</tr>
</tbody>
</table>


<h4 class="relative group">BGP in the underlay 
    <div id="bgp-in-the-underlay" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#bgp-in-the-underlay" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>Next up is the BGP part that is responsible for exchanging routes in the underlay. This BGP configuration is quite straightforward and minimal.</p>
<p>On the spine my underlay BGP configuration looks like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Loopback0
</span></span><span class="line"><span class="cl">   description EVPN_Overlay_Peering
</span></span><span class="line"><span class="cl">   ip address 10.255.0.1/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">   seq <span class="m">10</span> permit 10.255.0.0/27 eq <span class="m">32</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">route-map RM-CONN-2-BGP permit <span class="m">10</span>
</span></span><span class="line"><span class="cl">   match ip address prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">router bgp <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   router-id 10.255.0.1
</span></span><span class="line"><span class="cl">   no bgp default ipv4-unicast
</span></span><span class="line"><span class="cl">   maximum-paths <span class="m">4</span> ecmp <span class="m">4</span>
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS peer group
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS password <span class="m">7</span> 7x4B4rnJhZB438m9+BrBfQ<span class="o">==</span>
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS send-community
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS maximum-routes <span class="m">12000</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.1 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.1 remote-as <span class="m">65111</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.1 description veos-dc1-leaf1a_Ethernet1
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.5 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.5 remote-as <span class="m">65112</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.5 description veos-dc1-leaf1b_Ethernet1
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.9 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.9 remote-as <span class="m">65113</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.9 description veos-dc1-leaf2a_Ethernet1
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.13 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.13 remote-as <span class="m">65114</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.13 description veos-dc1-leaf2b_Ethernet1
</span></span><span class="line"><span class="cl">   redistribute connected route-map RM-CONN-2-BGP
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   address-family ipv4
</span></span><span class="line"><span class="cl">      neighbor IPv4-UNDERLAY-PEERS activate
</span></span></code></pre></div><p>And similarly on my leaf1a:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">interface Loopback0
</span></span><span class="line"><span class="cl">   description EVPN_Overlay_Peering
</span></span><span class="line"><span class="cl">   ip address 10.255.0.3/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">   seq <span class="m">10</span> permit 10.255.0.0/27 eq <span class="m">32</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">route-map RM-CONN-2-BGP permit <span class="m">10</span>
</span></span><span class="line"><span class="cl">   match ip address prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">router bgp <span class="m">65111</span>
</span></span><span class="line"><span class="cl">   router-id 10.255.0.3
</span></span><span class="line"><span class="cl">   no bgp default ipv4-unicast
</span></span><span class="line"><span class="cl">   maximum-paths <span class="m">4</span> ecmp <span class="m">4</span>
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS peer group
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS password <span class="m">7</span> 7x4B4rnJhZB438m9+BrBfQ<span class="o">==</span>
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS send-community
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS maximum-routes <span class="m">12000</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.0 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.0 remote-as <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.0 description veos-dc1-spine1_Ethernet1
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.2 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.2 remote-as <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.2 description veos-dc1-spine2_Ethernet1
</span></span><span class="line"><span class="cl">   redistribute connected route-map RM-CONN-2-BGP
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   address-family ipv4
</span></span><span class="line"><span class="cl">      neighbor IPv4-UNDERLAY-PEERS activate
</span></span></code></pre></div><p>The added Loopback0 interface is used for BGP EVPN sessions as we will see a bit later in the BGP summary and routes. Then the IP prefix is created and mapped to the route map telling BGP only redistribute the EVPN overlay loopback interfaces subnet. There is no need to redistribute the underlay peer to peer links as they are directly connected. The sole reason for using BGP also in the underlay (plus all the benefits of using BGP, scalability, robustness, less management overhead) is to achieve reachability of Loopback0 as a stable endpoint for EVPN BGP sessions.</p>
<p>Later on I will add another Loopback interface (Loopback1) for VXLAN and a corresponding prefix-list on my leaf switches, which is also part of the underlay configuration. I have not added it yet as I want to add it in the VXLAN section. This additional Loopback interface is part of the BGP in the underlay and being redistributed there.</p>
<p>AS table:</p>
<table>
<thead>
<tr>
<th>Device</th>
<th>AS</th>
</tr>
</thead>
<tbody>
<tr>
<td>Spine 1</td>
<td>AS 65110</td>
</tr>
<tr>
<td>Spine 2</td>
<td>AS 65110</td>
</tr>
<tr>
<td>Leaf1a</td>
<td>AS 65111</td>
</tr>
<tr>
<td>Leaf1b</td>
<td>AS 65112</td>
</tr>
<tr>
<td>Leaf2a</td>
<td>AS 65113</td>
</tr>
<tr>
<td>Leaf2b</td>
<td>AS 65114</td>
</tr>
</tbody>
</table>
<p>When configured in all my switches lets have a look at the BGP status from my spine 1:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">veos-dc1-spine1#show bgp summary
</span></span><span class="line"><span class="cl">BGP summary information <span class="k">for</span> VRF default
</span></span><span class="line"><span class="cl">Router identifier 10.255.0.1, <span class="nb">local</span> AS number <span class="m">65110</span>
</span></span><span class="line"><span class="cl">Neighbor               AS Session State AFI/SAFI                AFI/SAFI State   NLRI Rcd   NLRI Acc
</span></span><span class="line"><span class="cl">------------- ----------- ------------- ----------------------- -------------- ---------- ----------
</span></span><span class="line"><span class="cl">10.255.255.1        <span class="m">65111</span> Established   IPv4 Unicast            Negotiated              <span class="m">2</span>          <span class="m">2</span>
</span></span><span class="line"><span class="cl">10.255.255.5        <span class="m">65112</span> Established   IPv4 Unicast            Negotiated              <span class="m">2</span>          <span class="m">2</span>
</span></span><span class="line"><span class="cl">10.255.255.9        <span class="m">65113</span> Established   IPv4 Unicast            Negotiated              <span class="m">2</span>          <span class="m">2</span>
</span></span><span class="line"><span class="cl">10.255.255.13       <span class="m">65114</span> Established   IPv4 Unicast            Negotiated              <span class="m">2</span>          <span class="m">2</span>
</span></span></code></pre></div><p>Thats it for the underlay configurations. Next up is the overlay parts.</p>


<h3 class="relative group">The overlay 
    <div id="the-overlay" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#the-overlay" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Now the more interesting parts are up, BGP in the overlay, loopback interfaces and VXLAN configurations.</p>


<h4 class="relative group">BGP in the overlay 
    <div id="bgp-in-the-overlay" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#bgp-in-the-overlay" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>Configuring BGP in the overlay will just build on top of already existing BGP config, I do not need to create any additional BGP router AS&rsquo;es. Its all about adding the necessary overlay config to support EVPN.</p>
<p>On my spine 1 I have added these configurations, in addition to the already configured BGP settings:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Loopback0
</span></span><span class="line"><span class="cl">   description EVPN_Overlay_Peering
</span></span><span class="line"><span class="cl">   ip address 10.255.0.1/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">   seq <span class="m">10</span> permit 10.255.0.0/27 eq <span class="m">32</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">route-map RM-CONN-2-BGP permit <span class="m">10</span>
</span></span><span class="line"><span class="cl">   match ip address prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">router bgp <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS peer group <span class="c1">#Added</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS next-hop-unchanged <span class="c1">#Added</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS update-source Loopback0 <span class="c1">#Added</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS bfd <span class="c1">#Added</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS ebgp-multihop <span class="m">3</span> <span class="c1">#Added</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS password <span class="m">7</span> <span class="nv">Q4fqtbqcZ7oQuKfuWtNGRQ</span><span class="o">==</span> <span class="c1">#Added</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS send-community <span class="c1">#Added</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS maximum-routes <span class="m">0</span> <span class="c1">#Added</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.3 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.3 remote-as <span class="m">65111</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.3 description veos-dc1-leaf1a
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.4 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.4 remote-as <span class="m">65112</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.4 description veos-dc1-leaf1b
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.5 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.5 remote-as <span class="m">65113</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.5 description veos-dc1-leaf2a
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.6 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.6 remote-as <span class="m">65114</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.6 description veos-dc1-leaf2b
</span></span><span class="line"><span class="cl">   redistribute connected route-map RM-CONN-2-BGP
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   address-family evpn <span class="c1">#Added</span>
</span></span><span class="line"><span class="cl">      neighbor EVPN-OVERLAY-PEERS activate <span class="c1">#Added</span>
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   address-family ipv4
</span></span><span class="line"><span class="cl">      no neighbor EVPN-OVERLAY-PEERS activate
</span></span><span class="line"><span class="cl">!
</span></span></code></pre></div><p>A short explanation of what is added:</p>
<p>All the <em>EVPN-OVERLAY-PEERS</em> are added to BGP using their respective Loopback interfaces added in the &ldquo;BGP underlay section&rdquo; and AS numbers accordingly. Then the EVPN address family is added and the EVPN-OVERLAY-PEERS group is added. The same group is negated under the address family ipv4.</p>
<p>The complete BGP related config on spine 1 looks like this now:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">interface Loopback0
</span></span><span class="line"><span class="cl">   description EVPN_Overlay_Peering
</span></span><span class="line"><span class="cl">   ip address 10.255.0.1/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">   seq <span class="m">10</span> permit 10.255.0.0/27 eq <span class="m">32</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">route-map RM-CONN-2-BGP permit <span class="m">10</span>
</span></span><span class="line"><span class="cl">   match ip address prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">router bgp <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   router-id 10.255.0.1
</span></span><span class="line"><span class="cl">   no bgp default ipv4-unicast
</span></span><span class="line"><span class="cl">   maximum-paths <span class="m">4</span> ecmp <span class="m">4</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS peer group
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS next-hop-unchanged
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS update-source Loopback0
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS bfd
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS ebgp-multihop <span class="m">3</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS password <span class="m">7</span> <span class="nv">Q4fqtbqcZ7oQuKfuWtNGRQ</span><span class="o">==</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS send-community
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS maximum-routes <span class="m">0</span>
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS peer group
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS password <span class="m">7</span> 7x4B4rnJhZB438m9+BrBfQ<span class="o">==</span>
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS send-community
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS maximum-routes <span class="m">12000</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.3 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.3 remote-as <span class="m">65111</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.3 description veos-dc1-leaf1a
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.4 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.4 remote-as <span class="m">65112</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.4 description veos-dc1-leaf1b
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.5 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.5 remote-as <span class="m">65113</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.5 description veos-dc1-leaf2a
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.6 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.6 remote-as <span class="m">65114</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.6 description veos-dc1-leaf2b
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.1 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.1 remote-as <span class="m">65111</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.1 description veos-dc1-leaf1a_Ethernet1
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.5 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.5 remote-as <span class="m">65112</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.5 description veos-dc1-leaf1b_Ethernet1
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.9 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.9 remote-as <span class="m">65113</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.9 description veos-dc1-leaf2a_Ethernet1
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.13 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.13 remote-as <span class="m">65114</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.13 description veos-dc1-leaf2b_Ethernet1
</span></span><span class="line"><span class="cl">   redistribute connected route-map RM-CONN-2-BGP
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   address-family evpn
</span></span><span class="line"><span class="cl">      neighbor EVPN-OVERLAY-PEERS activate
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   address-family ipv4
</span></span><span class="line"><span class="cl">      no neighbor EVPN-OVERLAY-PEERS activate
</span></span><span class="line"><span class="cl">      neighbor IPv4-UNDERLAY-PEERS activate
</span></span></code></pre></div><p>Similarly on my leaf1a the additional BGP config:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">interface Loopback0
</span></span><span class="line"><span class="cl">   description EVPN_Overlay_Peering
</span></span><span class="line"><span class="cl">   ip address 10.255.0.3/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">   seq <span class="m">10</span> permit 10.255.0.0/27 eq <span class="m">32</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">route-map RM-CONN-2-BGP permit <span class="m">10</span>
</span></span><span class="line"><span class="cl">   match ip address prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">router bgp <span class="m">65111</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS peer group
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS update-source Loopback0
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS bfd
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS ebgp-multihop <span class="m">3</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS password <span class="m">7</span> <span class="nv">Q4fqtbqcZ7oQuKfuWtNGRQ</span><span class="o">==</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS send-community
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS maximum-routes <span class="m">0</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.1 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.1 remote-as <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.1 description veos-dc1-spine1
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.2 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.2 remote-as <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.2 description veos-dc1-spine2
</span></span><span class="line"><span class="cl">   redistribute connected route-map RM-CONN-2-BGP
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   address-family evpn
</span></span><span class="line"><span class="cl">      neighbor EVPN-OVERLAY-PEERS activate
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   address-family ipv4
</span></span><span class="line"><span class="cl">      no neighbor EVPN-OVERLAY-PEERS activate
</span></span><span class="line"><span class="cl">      neighbor IPv4-UNDERLAY-PEERS activate
</span></span></code></pre></div><p>Then the full BGP related config on my leaf1a:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">interface Loopback0
</span></span><span class="line"><span class="cl">   description EVPN_Overlay_Peering
</span></span><span class="line"><span class="cl">   ip address 10.255.0.3/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">   seq <span class="m">10</span> permit 10.255.0.0/27 eq <span class="m">32</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">route-map RM-CONN-2-BGP permit <span class="m">10</span>
</span></span><span class="line"><span class="cl">   match ip address prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">router bgp <span class="m">65111</span>
</span></span><span class="line"><span class="cl">   router-id 10.255.0.3
</span></span><span class="line"><span class="cl">   no bgp default ipv4-unicast
</span></span><span class="line"><span class="cl">   maximum-paths <span class="m">4</span> ecmp <span class="m">4</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS peer group
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS update-source Loopback0
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS bfd
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS ebgp-multihop <span class="m">3</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS password <span class="m">7</span> <span class="nv">Q4fqtbqcZ7oQuKfuWtNGRQ</span><span class="o">==</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS send-community
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS maximum-routes <span class="m">0</span>
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS peer group
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS password <span class="m">7</span> 7x4B4rnJhZB438m9+BrBfQ<span class="o">==</span>
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS send-community
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS maximum-routes <span class="m">12000</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.1 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.1 remote-as <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.1 description veos-dc1-spine1
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.2 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.2 remote-as <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.2 description veos-dc1-spine2
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.0 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.0 remote-as <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.0 description veos-dc1-spine1_Ethernet1
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.2 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.2 remote-as <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.2 description veos-dc1-spine2_Ethernet1
</span></span><span class="line"><span class="cl">   redistribute connected route-map RM-CONN-2-BGP
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   address-family evpn
</span></span><span class="line"><span class="cl">      neighbor EVPN-OVERLAY-PEERS activate
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   address-family ipv4
</span></span><span class="line"><span class="cl">      no neighbor EVPN-OVERLAY-PEERS activate
</span></span><span class="line"><span class="cl">      neighbor IPv4-UNDERLAY-PEERS activate
</span></span></code></pre></div><p>The BGP EVPN loopback0 interfaces on all my devices for context and reference:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">### Loopback Interfaces (BGP EVPN Peering)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">|</span> Loopback Pool <span class="p">|</span> Available Addresses <span class="p">|</span> Assigned addresses <span class="p">|</span> Assigned Address % <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ------------- <span class="p">|</span> ------------------- <span class="p">|</span> ------------------ <span class="p">|</span> ------------------ <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> 10.255.0.0/27 <span class="p">|</span> <span class="m">32</span> <span class="p">|</span> <span class="m">6</span> <span class="p">|</span> 18.75 % <span class="p">|</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### Loopback0 Interfaces Node Allocation</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">|</span> POD <span class="p">|</span> Node <span class="p">|</span> Loopback0 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> --- <span class="p">|</span> ---- <span class="p">|</span> --------- <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> VEOS_FABRIC <span class="p">|</span> veos-dc1-leaf1a <span class="p">|</span> 10.255.0.3/32 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> VEOS_FABRIC <span class="p">|</span> veos-dc1-leaf1b <span class="p">|</span> 10.255.0.4/32 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> VEOS_FABRIC <span class="p">|</span> veos-dc1-leaf2a <span class="p">|</span> 10.255.0.5/32 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> VEOS_FABRIC <span class="p">|</span> veos-dc1-leaf2b <span class="p">|</span> 10.255.0.6/32 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> VEOS_FABRIC <span class="p">|</span> veos-dc1-spine1 <span class="p">|</span> 10.255.0.1/32 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> VEOS_FABRIC <span class="p">|</span> veos-dc1-spine2 <span class="p">|</span> 10.255.0.2/32 <span class="p">|</span>
</span></span></code></pre></div><p>When showing ip bgp summary on spine 1 after all switches are configured:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">veos-dc1-spine1#show ip bgp summary
</span></span><span class="line"><span class="cl">BGP summary information <span class="k">for</span> VRF default
</span></span><span class="line"><span class="cl">Router identifier 10.255.0.1, <span class="nb">local</span> AS number <span class="m">65110</span>
</span></span><span class="line"><span class="cl">Neighbor Status Codes: m - Under maintenance
</span></span><span class="line"><span class="cl">  Description              Neighbor      V AS           MsgRcvd   MsgSent  InQ OutQ  Up/Down State   PfxRcd PfxAcc
</span></span><span class="line"><span class="cl">  veos-dc1-leaf1a_Ethernet 10.255.255.1  <span class="m">4</span> <span class="m">65111</span>          <span class="m">45087</span>     <span class="m">45068</span>    <span class="m">0</span>    <span class="m">0</span>   26d15h Estab   <span class="m">2</span>      <span class="m">2</span>
</span></span><span class="line"><span class="cl">  veos-dc1-leaf1b_Ethernet 10.255.255.5  <span class="m">4</span> <span class="m">65112</span>          <span class="m">45139</span>     <span class="m">45097</span>    <span class="m">0</span>    <span class="m">0</span>   16d23h Estab   <span class="m">2</span>      <span class="m">2</span>
</span></span><span class="line"><span class="cl">  veos-dc1-leaf2a_Ethernet 10.255.255.9  <span class="m">4</span> <span class="m">65113</span>          <span class="m">45046</span>     <span class="m">45081</span>    <span class="m">0</span>    <span class="m">0</span>   26d15h Estab   <span class="m">2</span>      <span class="m">2</span>
</span></span><span class="line"><span class="cl">  veos-dc1-leaf2b_Ethernet 10.255.255.13 <span class="m">4</span> <span class="m">65114</span>          <span class="m">45096</span>     <span class="m">45138</span>    <span class="m">0</span>    <span class="m">0</span>   26d14h Estab   <span class="m">2</span>      <span class="m">2</span>
</span></span></code></pre></div><p>And on leaf1a:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">veos-dc1-leaf1a#show ip bgp summary
</span></span><span class="line"><span class="cl">BGP summary information <span class="k">for</span> VRF default
</span></span><span class="line"><span class="cl">Router identifier 10.255.0.3, <span class="nb">local</span> AS number <span class="m">65111</span>
</span></span><span class="line"><span class="cl">Neighbor Status Codes: m - Under maintenance
</span></span><span class="line"><span class="cl">  Description              Neighbor     V AS           MsgRcvd   MsgSent  InQ OutQ  Up/Down State   PfxRcd PfxAcc
</span></span><span class="line"><span class="cl">  veos-dc1-spine1_Ethernet 10.255.255.0 <span class="m">4</span> <span class="m">65110</span>          <span class="m">45056</span>     <span class="m">45078</span>    <span class="m">0</span>    <span class="m">0</span>   26d15h Estab   <span class="m">7</span>      <span class="m">7</span>
</span></span><span class="line"><span class="cl">  veos-dc1-spine2_Ethernet 10.255.255.2 <span class="m">4</span> <span class="m">65110</span>          <span class="m">45056</span>     <span class="m">45080</span>    <span class="m">0</span>    <span class="m">0</span>   26d15h Estab   <span class="m">7</span>      <span class="m">7</span>
</span></span></code></pre></div><p>Now the BGP is configured in both the underlay and the overlay and the EVPN address family is activated. Next up is VXLAN and some networks in the overlay.</p>


<h4 class="relative group">VXLAN configurations 
    <div id="vxlan-configurations" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#vxlan-configurations" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>Now it is time to configure the dataplane, where my layer 2 networks reside. For that I need to configure VXLAN. The VXLAN configurations will only involve the leaf switches as they are the only VTEPs being configured in my spine/leaf fabric.</p>
<p>On my leaf1a switch I have added the following VXLAN configuration:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Loopback1
</span></span><span class="line"><span class="cl">   description VTEP_VXLAN_Tunnel_Source
</span></span><span class="line"><span class="cl">   ip address 10.255.1.3/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">   seq <span class="m">20</span> permit 10.255.1.0/27 eq <span class="m">32</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vxlan1
</span></span><span class="line"><span class="cl">   description veos-dc1-leaf1a_VTEP
</span></span><span class="line"><span class="cl">   vxlan source-interface Loopback1
</span></span><span class="line"><span class="cl">   vxlan udp-port <span class="m">4789</span>
</span></span></code></pre></div><p>I have added another loopback interface (Loopback1) which will serve as the VTEP IP address, then the general VXLAN configuration, description, source-interface and udp-port. Note also that I have added another prefix to my route map PL-LOOPBACKS-EVPN-OVERLAY to distribute the VTEP IP addresses in the underlay. As mentioned above these Loopback interfaces are considered part of the underlay configuration.</p>
<p>I could have achieved the same with just one loopback interface for both EVPN and VXLAN but best practice is to have a dedicated loopback for EVPN and a dedicated loopback for VXLAN.</p>
<p>The VXLAN loopback1 interface for all my leaf switches for reference:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">### VTEP Loopback VXLAN Tunnel Source Interfaces (VTEPs Only)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">|</span> VTEP Loopback Pool <span class="p">|</span> Available Addresses <span class="p">|</span> Assigned addresses <span class="p">|</span> Assigned Address % <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> --------------------- <span class="p">|</span> ------------------- <span class="p">|</span> ------------------ <span class="p">|</span> ------------------ <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> 10.255.1.0/27 <span class="p">|</span> <span class="m">32</span> <span class="p">|</span> <span class="m">4</span> <span class="p">|</span> 12.5 % <span class="p">|</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### VTEP Loopback Node allocation</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">|</span> POD <span class="p">|</span> Node <span class="p">|</span> Loopback1 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> --- <span class="p">|</span> ---- <span class="p">|</span> --------- <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> VEOS_FABRIC <span class="p">|</span> veos-dc1-leaf1a <span class="p">|</span> 10.255.1.3/32 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> VEOS_FABRIC <span class="p">|</span> veos-dc1-leaf1b <span class="p">|</span> 10.255.1.4/32 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> VEOS_FABRIC <span class="p">|</span> veos-dc1-leaf2a <span class="p">|</span> 10.255.1.5/32 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> VEOS_FABRIC <span class="p">|</span> veos-dc1-leaf2b <span class="p">|</span> 10.255.1.6/32 <span class="p">|</span>
</span></span></code></pre></div><p>The same configuration is applied to the rest of the leaf switches accordingly (except for loopback1 ip address, which is unique).</p>
<p>The VXLAN configuration is done, but I have not added any networks. Next up is adding networks, or overlay networks and informing EVPN about them</p>


<h4 class="relative group">Adding layer 2 networks using VXLAN 
    <div id="adding-layer-2-networks-using-vxlan" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#adding-layer-2-networks-using-vxlan" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>Now that VXLAN is configured, I need to create some networks. When creating layer 2 subnets using VXLAN they are often referred to as virtualized layer 2 or simply overlay subnets. In VXLAN these layer 2 subnets are placed in segments or VXLAN segments where VNI (VXLAN Network Identifier) is used as the identifier for the respective segment, not VLAN. VXLAN provides a 24-bit VNI meaning we can have a total of 16 million segments in a VXLAN fabric. This does not mean 16 million per VTEP, but across different VTEPS in the same fabric. The reason for this is because there is a 1:1 mapping between VLAN and VNI (more info on this later). So to create a layer 2 network I will have to map a VLAN to a VNI. Lets have a look at my configuration below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">11</span>
</span></span><span class="line"><span class="cl">   name VRF10_VLAN11
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vxlan1
</span></span><span class="line"><span class="cl">   description veos-dc1-leaf1b_VTEP
</span></span><span class="line"><span class="cl">   vxlan source-interface Loopback1
</span></span><span class="line"><span class="cl">   vxlan udp-port <span class="m">4789</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">11</span> vni <span class="m">10011</span>
</span></span></code></pre></div><p>To keep it very simple I have in my config above added one vlan, <em>VLAN 11</em>. Then in my VXLAN configuration I am doing a VLAN to VNI mapping:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">   vxlan vlan <span class="m">11</span> vni <span class="m">10011</span>
</span></span></code></pre></div><p>The VNI number can be anything from 1 to 16777215. The VLAN to VNI mappings are called L2VNI. There is no SVI (Switch Virtual Interface) configured, no gateway so a pure layer 2 and reachability is isolated inside this broadcast domain.</p>
<p>If I take a look at my VLAN 11 on leaf1a after the VLAN to VNI mapping:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">veos-dc1-leaf1a#show vlan <span class="m">11</span>
</span></span><span class="line"><span class="cl">VLAN  Name                             Status    Ports
</span></span><span class="line"><span class="cl">----- -------------------------------- --------- -------------------------------
</span></span><span class="line"><span class="cl"><span class="m">11</span>    VRF10_VLAN11                     active    Cpu, Et5, Et6, Vx1 <span class="c1"># notice the Vx1 </span>
</span></span></code></pre></div><p>The vxlan1 interface has been added.</p>
<p>When a server is attached to <em>leaf1a</em> in VLAN 11 in subnet 10.20.11.0/24 and this VLAN is mapped to VNI 10011 and it wants to do an ICMP request to another server attached to <em>leaf2b</em> using the same VLAN , same subnet and same VNI mapping they are in the same layer 2 broadcast domain and there will be no routing in the overlay. In the underlay there will ofcourse be some routing done as explained earlier. The responsibility of VXLAN in this case is encapsulating the ethernet frame on leaf1a (source or ingress vtep) and decapsulate it on leaf2b (destination or egress vtep) before it is delivered to server 2, also called <em>bridging</em>.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/12/09/evpn-introduction/images/image-20250109103322001.png"
        alt="vlan:vni mapping"
      />
      
    </figure>
</p>
<p>But will this work? How does the VTEP leaf1a know that I do have a server 2 on the same subnet on leaf2b? Well here is where the control plane comes into play, BGP. BGP advertises the Loopback0 and Loopback1 (EVPN and VXLAN) in the underlay for reachability.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">veos-dc1-leaf1a#show vxlan vtep detail
</span></span><span class="line"><span class="cl">Remote VTEPS <span class="k">for</span> Vxlan1:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">VTEP             Learned Via         MAC Address Learning       Tunnel Type<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">---------------- ------------------- -------------------------- --------------
</span></span><span class="line"><span class="cl">10.255.1.4       control plane       control plane              flood, unicast
</span></span><span class="line"><span class="cl">10.255.1.5       control plane       control plane              flood, unicast
</span></span><span class="line"><span class="cl">10.255.1.6       control plane       control plane              flood, unicast
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Total number of remote VTEPS:  <span class="m">3</span>
</span></span></code></pre></div><p>That is why I dont configure any static peering in my VXLAN configuration, BGP is handling this in the control plane. Right now though, my VLAN 11 is not being advertised anywhere so it will not be possible for Server 1 and Server 2 to reach each other. I need to configure BGP to advertise the VLAN 11 to VNI 10011 mapping in my overlay so the VTEPs can form a tunnel and span this layer 2 subnet across my layer 3 spine leaf fabric.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"> router bgp <span class="m">65111</span>
</span></span><span class="line"><span class="cl">   router-id 10.255.0.3
</span></span><span class="line"><span class="cl">&lt;----redacted---&gt;
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">11</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.3:10011
</span></span><span class="line"><span class="cl">      route-target both 10011:10011
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span></code></pre></div><p>The tunnel between leaf1a and leaf2b is established dynamically meaning its not only until any VTEP is advertising the same VNI in BGP and there is an ARP request from a source to another destination in the same VNI (L2VNI) the VXLAN tunnel is established. No flood and learn, but MAC addresses learnt locally are advertised to EVPN peers.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/12/09/evpn-introduction/images/image-20250109144322247.png"
        alt="bgp-evpn-table"
      />
      
    </figure>
</p>
<p><em>I mentioned that VNI uses 24-bit and can create 16777215 segments. The maximum number of VLANs on a single switch is 4094, even less if factoring in VLANS that are system/internally reserved. So to be able to achieve  4094&lt; (max 16777215) VNIs or VXLAN segments it is fully possible to map different same VLAN to a different VNI, but this cant be done on the same switch or VTEP. In a spine leaf fabric with several leafs and every leaf is a VTEP they can have a different range of VNI mapped to same VLAN individually, creating their own layer 2 broadcast domains. In the illustration below I have 4 leafs where each &ldquo;pair&rdquo; of leafs have been configured using a set of VLAN to VNI mappings. Leaf pair leaf1a and leaf1b maps VLAN 10,20 and 30 to VNIs 10010, 10020 and 10030 while the other leaf pair leaf2a and leaf2b maps VLAN 10,20 and 30 to VNIs 20010, 20020 and 20030:</em></p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/12/09/evpn-introduction/images/image-20250109150301864.png"
        alt="vlan-vni-mappings"
      />
      
    </figure>
</p>
<p>Thats it for L2VNI, but what if I want to route between L2VNIs?</p>


<h4 class="relative group">Integrated routing and bridging (IRB) 
    <div id="integrated-routing-and-bridging-irb" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#integrated-routing-and-bridging-irb" aria-label="Anchor">#</a>
    </span>        
    
</h4>
<p>In a traditional network with a lot of north south traffic it made sense to have a &ldquo;nortbound&rdquo; centralized gateway to both maintain isolation and apply policies. In todays modern datacenter that traffic pattern has changed to become dominantly east-west due to the distributed nature of the applications like virtual machines and containers (e.g Kubernetes clusters). There is no longer one big server handling many roles at the same time, but instead many virtual machines and often a huge amount of containers must work together to provide the &ldquo;full&rdquo; application. This change is a natural evolution in the datacenter where scalability, performance and management is key. For these VMs and containers to &ldquo;interact&rdquo; network is critical in both performance and reliability. Having a centralized router/gateway such a scenario may not be so optimal. Therefore we need to have a solution that can provide &ldquo;de-centralized&rdquo; routing or distributed routing.</p>
<p>Distributed routing means in this case that all my switches with VTEPS can become a default gateway for my VXLAN segments, where routing is done between L2VNIs (inter-subnet routing) without exiting the VXLAN fabric at line-rate and in the first hop, close to my application.</p>
<p>With VXLAN it is possible to configure exactly this behavior, instead of just doing regular L2VNIs it is also possible to do L3VNI using an extension in VXLAN called Integrated Routing and Bridging (<a href="https://datatracker.ietf.org/doc/html/draft-sajassi-l2vpn-evpn-inter-subnet-forwarding-05" target="_blank">IETF draft</a>). Integrated Routing and Bridging can be configured two ways, asymmetric IRB or symmetric IRB.</p>


<h5 class="relative group">Asymmetric IRB 
    <div id="asymmetric-irb" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#asymmetric-irb" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<p>In asymmetric IRB, the ingress VTEP performs both the routing and bridging tasks. When a packet moves between subnets, the ingress VTEP routes the packet to the destination subnet and then encapsulates it with the corresponding VXLAN VNI. The egress VTEP simply decapsulates the packet and forwards it based on layer 2 information. Each VTEP must maintain information about all tenant hosts, including their MAC and IP bindings. This necessitates that every VTEP be a member of all tenant subnets/VNIs and have associated SVIs with anycast IPs for each subnet. That is the only way for VXLAN to route L2VNIs withouth a L3VNI.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/12/09/evpn-introduction/images/image-20250109215737293.png"
        alt="asymmetric-irb"
      />
      
    </figure>
</p>
<p>Due to the need for each VTEP to handle all tenant subnets, asymmetric IRB can face scalability challenges, especially in large multi-tenant environments.</p>


<h5 class="relative group">Symmetric IRB 
    <div id="symmetric-irb" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#symmetric-irb" aria-label="Anchor">#</a>
    </span>        
    
</h5>
<p>In symmetric IRB both ingress and egress VTEPs participate in routing. When a packet traverses subnets, the ingress VTEP routes the packet from the source subnet to an intermediate IP-VRF. The packet is then VXLAN encapsulated and sent to the egress VTEP, which routes it from the IP-VRF to the destination subnet. With an L3VNI configured, I no longer need to have all the other VTEPs VNIs configured across all VTEPS, it can route from eg, VNI10010 to VNI 10020 located on a remote tep using the L3VNI (VRF).</p>
<p>VTEPs need to be configured with an IP-VRF that interconnects all subnets. This model allows for better scalability as each VTEP doesn&rsquo;t need to maintain complete information about all tenant hosts.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/12/09/evpn-introduction/images/image-20250109221110154.png"
        alt="symmetric-irb"
      />
      
    </figure>
</p>
<p>Symmetric IRB offers improved scalability and flexibility, making it more suitable for large-scale deployments with multiple tenants.</p>
<div style="border-left: 4px solid #2196F3; background-color: #E3F2FD; padding: 10px; margin: 10px 0; color: #0000FF;"> <strong>Info:</strong>
Arista supports both asymmetric and symmetric IRB!
 </div>
<p>For more information on how this works in Arista EOS see <a href="https://www.arista.com/en/um-eos/eos-integrated-routing-and-bridging" target="_blank">here</a></p>
<p>In my lab I am using symmetrical IRB. I have two VRFs mapped to their own unique VNI (L3VNIs). VRF20 is mapped to VNI:10 and VRF21 is mapped to VNI:11. Almost all VLANs and VNIs (L2VNIs) are configured on all leafs, except VLAN14 which is only configured on leaf2b (in VRF20). I am not prone to scaling issues in my lab when it comes to the amount VNIs and mac address tables, and even though most or all VNIs are represented on my leafs I still use symmetrical IRB due to the nature of having L3VNIs (VRF) configured. Without a L3VNI it has to do asymmetric IRB (ingress vtep does all the routing and bridging). Anycast gateway is configured and VLAN to VNI mapping is done and added to my BGP configuration.</p>
<p>See the config below for leaf1a and leaf2b.</p>
<p>Leaf1a:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">11</span>
</span></span><span class="line"><span class="cl">   name VRF10_VLAN11
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan 12-13
</span></span><span class="line"><span class="cl">   name VRF10_VLAN12
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">21</span>
</span></span><span class="line"><span class="cl">   name VRF11_VLAN21
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">22</span>
</span></span><span class="line"><span class="cl">   name VRF11_VLAN22
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">23</span>
</span></span><span class="line"><span class="cl">   name VRF11_VLAN23
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">1079</span>
</span></span><span class="line"><span class="cl">   name VRF10_VLAN1079_WAN
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">3401</span>
</span></span><span class="line"><span class="cl">   name L2_VLAN3401
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">3402</span>
</span></span><span class="line"><span class="cl">   name L2_VLAN3402
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vrf instance VRF20
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vrf instance VRF21
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan11
</span></span><span class="line"><span class="cl">   description VRF10_VLAN11
</span></span><span class="line"><span class="cl">   vrf VRF20
</span></span><span class="line"><span class="cl">   ip address virtual 10.20.11.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan12
</span></span><span class="line"><span class="cl">   description VRF10_VLAN12
</span></span><span class="line"><span class="cl">   vrf VRF20
</span></span><span class="line"><span class="cl">   ip address virtual 10.20.12.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan13
</span></span><span class="line"><span class="cl">   description VRF10_VLAN12
</span></span><span class="line"><span class="cl">   vrf VRF20
</span></span><span class="line"><span class="cl">   ip address virtual 10.20.13.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan21
</span></span><span class="line"><span class="cl">   description VRF11_VLAN21
</span></span><span class="line"><span class="cl">   mtu <span class="m">9194</span>
</span></span><span class="line"><span class="cl">   vrf VRF21
</span></span><span class="line"><span class="cl">   ip address virtual 10.21.21.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan22
</span></span><span class="line"><span class="cl">   description VRF11_VLAN22
</span></span><span class="line"><span class="cl">   mtu <span class="m">9194</span>
</span></span><span class="line"><span class="cl">   vrf VRF21
</span></span><span class="line"><span class="cl">   ip address virtual 10.21.22.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan23
</span></span><span class="line"><span class="cl">   description VRF11_VLAN23
</span></span><span class="line"><span class="cl">   mtu <span class="m">9194</span>
</span></span><span class="line"><span class="cl">   vrf VRF21
</span></span><span class="line"><span class="cl">   ip address virtual 10.21.23.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan1079
</span></span><span class="line"><span class="cl">   description VRF10_VLAN1079_WAN
</span></span><span class="line"><span class="cl">   vrf VRF20
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vxlan1
</span></span><span class="line"><span class="cl">   description veos-dc1-leaf1b_VTEP
</span></span><span class="line"><span class="cl">   vxlan source-interface Loopback1
</span></span><span class="line"><span class="cl">   vxlan udp-port <span class="m">4789</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">11</span> vni <span class="m">10011</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">12</span> vni <span class="m">10012</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">13</span> vni <span class="m">10013</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">21</span> vni <span class="m">10021</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">22</span> vni <span class="m">10022</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">23</span> vni <span class="m">10023</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">1079</span> vni <span class="m">11079</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">3401</span> vni <span class="m">13401</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">3402</span> vni <span class="m">13402</span>
</span></span><span class="line"><span class="cl">   vxlan vrf VRF20 vni <span class="m">10</span>
</span></span><span class="line"><span class="cl">   vxlan vrf VRF21 vni <span class="m">11</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip virtual-router mac-address 00:1c:73:00:00:99
</span></span><span class="line"><span class="cl">ip address virtual source-nat vrf VRF20 address 10.255.10.4
</span></span><span class="line"><span class="cl">ip address virtual source-nat vrf VRF21 address 10.255.11.4
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip routing
</span></span><span class="line"><span class="cl">no ip routing vrf MGMT
</span></span><span class="line"><span class="cl">ip routing vrf VRF20
</span></span><span class="line"><span class="cl">ip routing vrf VRF21
</span></span></code></pre></div><p>Leaf2b:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">vlan <span class="m">11</span>
</span></span><span class="line"><span class="cl">   name VRF10_VLAN11
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan 12-13
</span></span><span class="line"><span class="cl">   name VRF10_VLAN12
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">14</span>
</span></span><span class="line"><span class="cl">   name VRF10_VLAN14
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">21</span>
</span></span><span class="line"><span class="cl">   name VRF11_VLAN21
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">22</span>
</span></span><span class="line"><span class="cl">   name VRF11_VLAN22
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">23</span>
</span></span><span class="line"><span class="cl">   name VRF11_VLAN23
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">1079</span>
</span></span><span class="line"><span class="cl">   name VRF10_VLAN1079_WAN
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">3401</span>
</span></span><span class="line"><span class="cl">   name L2_VLAN3401
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">3402</span>
</span></span><span class="line"><span class="cl">   name L2_VLAN3402
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vrf instance VRF20
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vrf instance VRF21
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Ethernet1
</span></span><span class="line"><span class="cl">   description P2P_LINK_TO_VEOS-DC1-SPINE1_Ethernet4
</span></span><span class="line"><span class="cl">   mtu <span class="m">9194</span>
</span></span><span class="line"><span class="cl">   no switchport
</span></span><span class="line"><span class="cl">   ip address 10.255.255.13/31
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Ethernet2
</span></span><span class="line"><span class="cl">   description P2P_LINK_TO_VEOS-DC1-SPINE2_Ethernet4
</span></span><span class="line"><span class="cl">   mtu <span class="m">9194</span>
</span></span><span class="line"><span class="cl">   no switchport
</span></span><span class="line"><span class="cl">   ip address 10.255.255.15/31
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Ethernet5
</span></span><span class="line"><span class="cl">   description dc1-leaf2b-client4_CLIENT4
</span></span><span class="line"><span class="cl">   switchport trunk native vlan <span class="m">14</span>
</span></span><span class="line"><span class="cl">   switchport trunk allowed vlan 11-14,21-22
</span></span><span class="line"><span class="cl">   switchport mode trunk
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Ethernet6
</span></span><span class="line"><span class="cl">   description leaf2b-wan-u1_u1-vrf10
</span></span><span class="line"><span class="cl">   mtu <span class="m">1500</span>
</span></span><span class="line"><span class="cl">   switchport trunk allowed vlan <span class="m">1079</span>
</span></span><span class="line"><span class="cl">   switchport mode trunk
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Loopback0
</span></span><span class="line"><span class="cl">   description EVPN_Overlay_Peering
</span></span><span class="line"><span class="cl">   ip address 10.255.0.6/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Loopback1
</span></span><span class="line"><span class="cl">   description VTEP_VXLAN_Tunnel_Source
</span></span><span class="line"><span class="cl">   ip address 10.255.1.6/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Loopback10
</span></span><span class="line"><span class="cl">   description VRF20_VTEP_DIAGNOSTICS
</span></span><span class="line"><span class="cl">   vrf VRF20
</span></span><span class="line"><span class="cl">   ip address 10.255.10.6/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Loopback11
</span></span><span class="line"><span class="cl">   description VRF21_VTEP_DIAGNOSTICS
</span></span><span class="line"><span class="cl">   vrf VRF21
</span></span><span class="line"><span class="cl">   ip address 10.255.11.6/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan11
</span></span><span class="line"><span class="cl">   description VRF10_VLAN11
</span></span><span class="line"><span class="cl">   vrf VRF20
</span></span><span class="line"><span class="cl">   ip address virtual 10.20.11.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan12
</span></span><span class="line"><span class="cl">   description VRF10_VLAN12
</span></span><span class="line"><span class="cl">   vrf VRF20
</span></span><span class="line"><span class="cl">   ip address virtual 10.20.12.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan13
</span></span><span class="line"><span class="cl">   description VRF10_VLAN12
</span></span><span class="line"><span class="cl">   vrf VRF20
</span></span><span class="line"><span class="cl">   ip address virtual 10.20.13.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan14
</span></span><span class="line"><span class="cl">   description VRF10_VLAN14
</span></span><span class="line"><span class="cl">   vrf VRF20
</span></span><span class="line"><span class="cl">   ip address virtual 10.20.14.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan21
</span></span><span class="line"><span class="cl">   description VRF11_VLAN21
</span></span><span class="line"><span class="cl">   mtu <span class="m">9194</span>
</span></span><span class="line"><span class="cl">   vrf VRF21
</span></span><span class="line"><span class="cl">   ip address virtual 10.21.21.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan22
</span></span><span class="line"><span class="cl">   description VRF11_VLAN22
</span></span><span class="line"><span class="cl">   mtu <span class="m">9194</span>
</span></span><span class="line"><span class="cl">   vrf VRF21
</span></span><span class="line"><span class="cl">   ip address virtual 10.21.22.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan23
</span></span><span class="line"><span class="cl">   description VRF11_VLAN23
</span></span><span class="line"><span class="cl">   mtu <span class="m">9194</span>
</span></span><span class="line"><span class="cl">   vrf VRF21
</span></span><span class="line"><span class="cl">   ip address virtual 10.21.23.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan1079
</span></span><span class="line"><span class="cl">   description VRF10_VLAN1079_WAN
</span></span><span class="line"><span class="cl">   vrf VRF20
</span></span><span class="line"><span class="cl">   ip address 10.179.0.2/29
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vxlan1
</span></span><span class="line"><span class="cl">   description veos-dc1-leaf2b_VTEP
</span></span><span class="line"><span class="cl">   vxlan source-interface Loopback1
</span></span><span class="line"><span class="cl">   vxlan udp-port <span class="m">4789</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">11</span> vni <span class="m">10011</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">12</span> vni <span class="m">10012</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">13</span> vni <span class="m">10013</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">14</span> vni <span class="m">10014</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">21</span> vni <span class="m">10021</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">22</span> vni <span class="m">10022</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">23</span> vni <span class="m">10023</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">1079</span> vni <span class="m">11079</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">3401</span> vni <span class="m">13401</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">3402</span> vni <span class="m">13402</span>
</span></span><span class="line"><span class="cl">   vxlan vrf VRF20 vni <span class="m">10</span>
</span></span><span class="line"><span class="cl">   vxlan vrf VRF21 vni <span class="m">11</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip virtual-router mac-address 00:1c:73:00:00:99
</span></span><span class="line"><span class="cl">ip address virtual source-nat vrf VRF20 address 10.255.10.6
</span></span><span class="line"><span class="cl">ip address virtual source-nat vrf VRF21 address 10.255.11.6
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip routing
</span></span><span class="line"><span class="cl">ip routing vrf VRF20
</span></span><span class="line"><span class="cl">ip routing vrf VRF21
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">   seq <span class="m">10</span> permit 10.255.0.0/27 eq <span class="m">32</span>
</span></span><span class="line"><span class="cl">   seq <span class="m">20</span> permit 10.255.1.0/27 eq <span class="m">32</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">route-map RM-CONN-2-BGP permit <span class="m">10</span>
</span></span><span class="line"><span class="cl">   match ip address prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">router bfd
</span></span><span class="line"><span class="cl">   multihop interval <span class="m">300</span> min-rx <span class="m">300</span> multiplier <span class="m">3</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">router bgp <span class="m">65114</span>
</span></span><span class="line"><span class="cl">   router-id 10.255.0.6
</span></span><span class="line"><span class="cl">   no bgp default ipv4-unicast
</span></span><span class="line"><span class="cl">   maximum-paths <span class="m">4</span> ecmp <span class="m">4</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS peer group
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS update-source Loopback0
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS bfd
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS ebgp-multihop <span class="m">3</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS password <span class="m">7</span> <span class="nv">Q4fqtbqcZ7oQuKfuWtNGRQ</span><span class="o">==</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS send-community
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS maximum-routes <span class="m">0</span>
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS peer group
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS password <span class="m">7</span> 7x4B4rnJhZB438m9+BrBfQ<span class="o">==</span>
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS send-community
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS maximum-routes <span class="m">12000</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.1 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.1 remote-as <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.1 description veos-dc1-spine1
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.2 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.2 remote-as <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.2 description veos-dc1-spine2
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.12 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.12 remote-as <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.12 description veos-dc1-spine1_Ethernet4
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.14 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.14 remote-as <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.14 description veos-dc1-spine2_Ethernet4
</span></span><span class="line"><span class="cl">   redistribute connected route-map RM-CONN-2-BGP
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">11</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.6:10011
</span></span><span class="line"><span class="cl">      route-target both 10011:10011
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">12</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.6:10012
</span></span><span class="line"><span class="cl">      route-target both 10012:10012
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">13</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.6:10013
</span></span><span class="line"><span class="cl">      route-target both 10013:10013
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">14</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.6:10014
</span></span><span class="line"><span class="cl">      route-target both 10014:10014
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">21</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.6:10021
</span></span><span class="line"><span class="cl">      route-target both 10021:10021
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">22</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.6:10022
</span></span><span class="line"><span class="cl">      route-target both 10022:10022
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">23</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.6:10023
</span></span><span class="line"><span class="cl">      route-target both 10023:10023
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">1079</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.6:11079
</span></span><span class="line"><span class="cl">      route-target both 11079:11079
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">3401</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.6:13401
</span></span><span class="line"><span class="cl">      route-target both 13401:13401
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">3402</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.6:13402
</span></span><span class="line"><span class="cl">      route-target both 13402:13402
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   address-family evpn
</span></span><span class="line"><span class="cl">      neighbor EVPN-OVERLAY-PEERS activate
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   address-family ipv4
</span></span><span class="line"><span class="cl">      no neighbor EVPN-OVERLAY-PEERS activate
</span></span><span class="line"><span class="cl">      neighbor IPv4-UNDERLAY-PEERS activate
</span></span><span class="line"><span class="cl">      neighbor pfsense01 activate
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vrf VRF20
</span></span><span class="line"><span class="cl">      rd 10.255.0.6:10
</span></span><span class="line"><span class="cl">      route-target import evpn 10:10
</span></span><span class="line"><span class="cl">      route-target <span class="nb">export</span> evpn 10:10
</span></span><span class="line"><span class="cl">      router-id 10.255.0.6
</span></span><span class="line"><span class="cl">      redistribute connected
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vrf VRF21
</span></span><span class="line"><span class="cl">      rd 10.255.0.6:11
</span></span><span class="line"><span class="cl">      route-target import evpn 11:11
</span></span><span class="line"><span class="cl">      route-target <span class="nb">export</span> evpn 11:11
</span></span><span class="line"><span class="cl">      router-id 10.255.0.6
</span></span><span class="line"><span class="cl">      redistribute connected
</span></span><span class="line"><span class="cl">!
</span></span></code></pre></div>

<h3 class="relative group">Complete configurations 
    <div id="complete-configurations" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#complete-configurations" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Below I will provide the full relevant configuration for spine-1 and leaf1a for easier reference:</p>
<p>spine-1:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">interface Ethernet1
</span></span><span class="line"><span class="cl">   description P2P_LINK_TO_VEOS-DC1-LEAF1A_Ethernet1
</span></span><span class="line"><span class="cl">   mtu <span class="m">9194</span>
</span></span><span class="line"><span class="cl">   no switchport
</span></span><span class="line"><span class="cl">   ip address 10.255.255.0/31
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Ethernet2
</span></span><span class="line"><span class="cl">   description P2P_LINK_TO_VEOS-DC1-LEAF1B_Ethernet1
</span></span><span class="line"><span class="cl">   mtu <span class="m">9194</span>
</span></span><span class="line"><span class="cl">   no switchport
</span></span><span class="line"><span class="cl">   ip address 10.255.255.4/31
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Ethernet3
</span></span><span class="line"><span class="cl">   description P2P_LINK_TO_VEOS-DC1-LEAF2A_Ethernet1
</span></span><span class="line"><span class="cl">   mtu <span class="m">9194</span>
</span></span><span class="line"><span class="cl">   no switchport
</span></span><span class="line"><span class="cl">   ip address 10.255.255.8/31
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Ethernet4
</span></span><span class="line"><span class="cl">   description P2P_LINK_TO_VEOS-DC1-LEAF2B_Ethernet1
</span></span><span class="line"><span class="cl">   mtu <span class="m">9194</span>
</span></span><span class="line"><span class="cl">   no switchport
</span></span><span class="line"><span class="cl">   ip address 10.255.255.12/31
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Loopback0
</span></span><span class="line"><span class="cl">   description EVPN_Overlay_Peering
</span></span><span class="line"><span class="cl">   ip address 10.255.0.1/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">   seq <span class="m">10</span> permit 10.255.0.0/27 eq <span class="m">32</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">route-map RM-CONN-2-BGP permit <span class="m">10</span>
</span></span><span class="line"><span class="cl">   match ip address prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">router bfd
</span></span><span class="line"><span class="cl">   multihop interval <span class="m">300</span> min-rx <span class="m">300</span> multiplier <span class="m">3</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">router bgp <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   router-id 10.255.0.1
</span></span><span class="line"><span class="cl">   no bgp default ipv4-unicast
</span></span><span class="line"><span class="cl">   maximum-paths <span class="m">4</span> ecmp <span class="m">4</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS peer group
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS next-hop-unchanged
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS update-source Loopback0
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS bfd
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS ebgp-multihop <span class="m">3</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS password <span class="m">7</span> <span class="nv">Q4fqtbqcZ7oQuKfuWtNGRQ</span><span class="o">==</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS send-community
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS maximum-routes <span class="m">0</span>
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS peer group
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS password <span class="m">7</span> 7x4B4rnJhZB438m9+BrBfQ<span class="o">==</span>
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS send-community
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS maximum-routes <span class="m">12000</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.3 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.3 remote-as <span class="m">65111</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.3 description veos-dc1-leaf1a
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.4 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.4 remote-as <span class="m">65112</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.4 description veos-dc1-leaf1b
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.5 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.5 remote-as <span class="m">65113</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.5 description veos-dc1-leaf2a
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.6 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.6 remote-as <span class="m">65114</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.6 description veos-dc1-leaf2b
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.1 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.1 remote-as <span class="m">65111</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.1 description veos-dc1-leaf1a_Ethernet1
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.5 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.5 remote-as <span class="m">65112</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.5 description veos-dc1-leaf1b_Ethernet1
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.9 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.9 remote-as <span class="m">65113</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.9 description veos-dc1-leaf2a_Ethernet1
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.13 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.13 remote-as <span class="m">65114</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.13 description veos-dc1-leaf2b_Ethernet1
</span></span><span class="line"><span class="cl">   redistribute connected route-map RM-CONN-2-BGP
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   address-family evpn
</span></span><span class="line"><span class="cl">      neighbor EVPN-OVERLAY-PEERS activate
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   address-family ipv4
</span></span><span class="line"><span class="cl">      no neighbor EVPN-OVERLAY-PEERS activate
</span></span><span class="line"><span class="cl">      neighbor IPv4-UNDERLAY-PEERS activate
</span></span></code></pre></div><p>Leaf1a configuration:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">vlan <span class="m">11</span>
</span></span><span class="line"><span class="cl">   name VRF10_VLAN11
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan 12-13
</span></span><span class="line"><span class="cl">   name VRF10_VLAN12
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">21</span>
</span></span><span class="line"><span class="cl">   name VRF11_VLAN21
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">22</span>
</span></span><span class="line"><span class="cl">   name VRF11_VLAN22
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">23</span>
</span></span><span class="line"><span class="cl">   name VRF11_VLAN23
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">1079</span>
</span></span><span class="line"><span class="cl">   name VRF10_VLAN1079_WAN
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">3401</span>
</span></span><span class="line"><span class="cl">   name L2_VLAN3401
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vlan <span class="m">3402</span>
</span></span><span class="line"><span class="cl">   name L2_VLAN3402
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vrf instance VRF20
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">vrf instance VRF21
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Ethernet1
</span></span><span class="line"><span class="cl">   description P2P_LINK_TO_VEOS-DC1-SPINE1_Ethernet1
</span></span><span class="line"><span class="cl">   mtu <span class="m">9194</span>
</span></span><span class="line"><span class="cl">   no switchport
</span></span><span class="line"><span class="cl">   ip address 10.255.255.1/31
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Ethernet2
</span></span><span class="line"><span class="cl">   description P2P_LINK_TO_VEOS-DC1-SPINE2_Ethernet1
</span></span><span class="line"><span class="cl">   mtu <span class="m">9194</span>
</span></span><span class="line"><span class="cl">   no switchport
</span></span><span class="line"><span class="cl">   ip address 10.255.255.3/31
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Ethernet5
</span></span><span class="line"><span class="cl">   description dc1-leaf1a-client1_CLIENT1
</span></span><span class="line"><span class="cl">   switchport trunk native vlan <span class="m">11</span>
</span></span><span class="line"><span class="cl">   switchport trunk allowed vlan 11-13,21-22
</span></span><span class="line"><span class="cl">   switchport mode trunk
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Ethernet6
</span></span><span class="line"><span class="cl">   description dc1-leaf1a-client1-vxlan_CLIENT1-VXLAN
</span></span><span class="line"><span class="cl">   switchport trunk native vlan <span class="m">21</span>
</span></span><span class="line"><span class="cl">   switchport trunk allowed vlan 11-13,21-23
</span></span><span class="line"><span class="cl">   switchport mode trunk
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Loopback0
</span></span><span class="line"><span class="cl">   description EVPN_Overlay_Peering
</span></span><span class="line"><span class="cl">   ip address 10.255.0.3/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Loopback1
</span></span><span class="line"><span class="cl">   description VTEP_VXLAN_Tunnel_Source
</span></span><span class="line"><span class="cl">   ip address 10.255.1.3/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Loopback10
</span></span><span class="line"><span class="cl">   description VRF20_VTEP_DIAGNOSTICS
</span></span><span class="line"><span class="cl">   vrf VRF20
</span></span><span class="line"><span class="cl">   ip address 10.255.10.3/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Loopback11
</span></span><span class="line"><span class="cl">   description VRF21_VTEP_DIAGNOSTICS
</span></span><span class="line"><span class="cl">   vrf VRF21
</span></span><span class="line"><span class="cl">   ip address 10.255.11.3/32
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan11
</span></span><span class="line"><span class="cl">   description VRF10_VLAN11
</span></span><span class="line"><span class="cl">   vrf VRF20
</span></span><span class="line"><span class="cl">   ip address virtual 10.20.11.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan12
</span></span><span class="line"><span class="cl">   description VRF10_VLAN12
</span></span><span class="line"><span class="cl">   vrf VRF20
</span></span><span class="line"><span class="cl">   ip address virtual 10.20.12.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan13
</span></span><span class="line"><span class="cl">   description VRF10_VLAN12
</span></span><span class="line"><span class="cl">   vrf VRF20
</span></span><span class="line"><span class="cl">   ip address virtual 10.20.13.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan21
</span></span><span class="line"><span class="cl">   description VRF11_VLAN21
</span></span><span class="line"><span class="cl">   mtu <span class="m">9194</span>
</span></span><span class="line"><span class="cl">   vrf VRF21
</span></span><span class="line"><span class="cl">   ip address virtual 10.21.21.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan22
</span></span><span class="line"><span class="cl">   description VRF11_VLAN22
</span></span><span class="line"><span class="cl">   mtu <span class="m">9194</span>
</span></span><span class="line"><span class="cl">   vrf VRF21
</span></span><span class="line"><span class="cl">   ip address virtual 10.21.22.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan23
</span></span><span class="line"><span class="cl">   description VRF11_VLAN23
</span></span><span class="line"><span class="cl">   mtu <span class="m">9194</span>
</span></span><span class="line"><span class="cl">   vrf VRF21
</span></span><span class="line"><span class="cl">   ip address virtual 10.21.23.1/24
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vlan1079
</span></span><span class="line"><span class="cl">   description VRF10_VLAN1079_WAN
</span></span><span class="line"><span class="cl">   vrf VRF20
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">interface Vxlan1
</span></span><span class="line"><span class="cl">   description veos-dc1-leaf1a_VTEP
</span></span><span class="line"><span class="cl">   vxlan source-interface Loopback1
</span></span><span class="line"><span class="cl">   vxlan udp-port <span class="m">4789</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">11</span> vni <span class="m">10011</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">12</span> vni <span class="m">10012</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">13</span> vni <span class="m">10013</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">21</span> vni <span class="m">10021</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">22</span> vni <span class="m">10022</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">23</span> vni <span class="m">10023</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">1079</span> vni <span class="m">11079</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">3401</span> vni <span class="m">13401</span>
</span></span><span class="line"><span class="cl">   vxlan vlan <span class="m">3402</span> vni <span class="m">13402</span>
</span></span><span class="line"><span class="cl">   vxlan vrf VRF20 vni <span class="m">10</span>
</span></span><span class="line"><span class="cl">   vxlan vrf VRF21 vni <span class="m">11</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip virtual-router mac-address 00:1c:73:00:00:99
</span></span><span class="line"><span class="cl">ip address virtual source-nat vrf VRF20 address 10.255.10.3
</span></span><span class="line"><span class="cl">ip address virtual source-nat vrf VRF21 address 10.255.11.3
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip routing
</span></span><span class="line"><span class="cl">ip routing vrf VRF20
</span></span><span class="line"><span class="cl">ip routing vrf VRF21
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">ip prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">   seq <span class="m">10</span> permit 10.255.0.0/27 eq <span class="m">32</span>
</span></span><span class="line"><span class="cl">   seq <span class="m">20</span> permit 10.255.1.0/27 eq <span class="m">32</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">route-map RM-CONN-2-BGP permit <span class="m">10</span>
</span></span><span class="line"><span class="cl">   match ip address prefix-list PL-LOOPBACKS-EVPN-OVERLAY
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">router bfd
</span></span><span class="line"><span class="cl">   multihop interval <span class="m">300</span> min-rx <span class="m">300</span> multiplier <span class="m">3</span>
</span></span><span class="line"><span class="cl">!
</span></span><span class="line"><span class="cl">router bgp <span class="m">65111</span>
</span></span><span class="line"><span class="cl">   router-id 10.255.0.3
</span></span><span class="line"><span class="cl">   no bgp default ipv4-unicast
</span></span><span class="line"><span class="cl">   maximum-paths <span class="m">4</span> ecmp <span class="m">4</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS peer group
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS update-source Loopback0
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS bfd
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS ebgp-multihop <span class="m">3</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS password <span class="m">7</span> <span class="nv">Q4fqtbqcZ7oQuKfuWtNGRQ</span><span class="o">==</span>
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS send-community
</span></span><span class="line"><span class="cl">   neighbor EVPN-OVERLAY-PEERS maximum-routes <span class="m">0</span>
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS peer group
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS password <span class="m">7</span> 7x4B4rnJhZB438m9+BrBfQ<span class="o">==</span>
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS send-community
</span></span><span class="line"><span class="cl">   neighbor IPv4-UNDERLAY-PEERS maximum-routes <span class="m">12000</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.1 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.1 remote-as <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.1 description veos-dc1-spine1
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.2 peer group EVPN-OVERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.2 remote-as <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.0.2 description veos-dc1-spine2
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.0 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.0 remote-as <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.0 description veos-dc1-spine1_Ethernet1
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.2 peer group IPv4-UNDERLAY-PEERS
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.2 remote-as <span class="m">65110</span>
</span></span><span class="line"><span class="cl">   neighbor 10.255.255.2 description veos-dc1-spine2_Ethernet1
</span></span><span class="line"><span class="cl">   redistribute connected route-map RM-CONN-2-BGP
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">11</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.3:10011
</span></span><span class="line"><span class="cl">      route-target both 10011:10011
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">12</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.3:10012
</span></span><span class="line"><span class="cl">      route-target both 10012:10012
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">13</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.3:10013
</span></span><span class="line"><span class="cl">      route-target both 10013:10013
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">21</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.3:10021
</span></span><span class="line"><span class="cl">      route-target both 10021:10021
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">22</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.3:10022
</span></span><span class="line"><span class="cl">      route-target both 10022:10022
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">23</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.3:10023
</span></span><span class="line"><span class="cl">      route-target both 10023:10023
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">1079</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.3:11079
</span></span><span class="line"><span class="cl">      route-target both 11079:11079
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">3401</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.3:13401
</span></span><span class="line"><span class="cl">      route-target both 13401:13401
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vlan <span class="m">3402</span>
</span></span><span class="line"><span class="cl">      rd 10.255.0.3:13402
</span></span><span class="line"><span class="cl">      route-target both 13402:13402
</span></span><span class="line"><span class="cl">      redistribute learned
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   address-family evpn
</span></span><span class="line"><span class="cl">      neighbor EVPN-OVERLAY-PEERS activate
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   address-family ipv4
</span></span><span class="line"><span class="cl">      no neighbor EVPN-OVERLAY-PEERS activate
</span></span><span class="line"><span class="cl">      neighbor IPv4-UNDERLAY-PEERS activate
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vrf VRF20
</span></span><span class="line"><span class="cl">      rd 10.255.0.3:10
</span></span><span class="line"><span class="cl">      route-target import evpn 10:10
</span></span><span class="line"><span class="cl">      route-target <span class="nb">export</span> evpn 10:10
</span></span><span class="line"><span class="cl">      router-id 10.255.0.3
</span></span><span class="line"><span class="cl">      redistribute connected
</span></span><span class="line"><span class="cl">   !
</span></span><span class="line"><span class="cl">   vrf VRF21
</span></span><span class="line"><span class="cl">      rd 10.255.0.3:11
</span></span><span class="line"><span class="cl">      route-target import evpn 11:11
</span></span><span class="line"><span class="cl">      route-target <span class="nb">export</span> evpn 11:11
</span></span><span class="line"><span class="cl">      router-id 10.255.0.3
</span></span><span class="line"><span class="cl">      redistribute connected
</span></span><span class="line"><span class="cl">!
</span></span></code></pre></div>

<h3 class="relative group">Verify configurations and a quick look at the routes 
    <div id="verify-configurations-and-a-quick-look-at-the-routes" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#verify-configurations-and-a-quick-look-at-the-routes" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Below I will provide some commands to verify BGP-EVPN and VXLAN configurations. Then have a quick look at the routes being advertised.</p>
<p>Show vxlan interface:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">veos-dc1-leaf1a#show interfaces vxlan <span class="m">1</span>
</span></span><span class="line"><span class="cl">Vxlan1 is up, line protocol is up <span class="o">(</span>connected<span class="o">)</span>
</span></span><span class="line"><span class="cl">  Hardware is Vxlan
</span></span><span class="line"><span class="cl">  Description: veos-dc1-leaf1a_VTEP
</span></span><span class="line"><span class="cl">  Source interface is Loopback1 and is active with 10.255.1.3
</span></span><span class="line"><span class="cl">  Listening on UDP port <span class="m">4789</span>
</span></span><span class="line"><span class="cl">  Replication/Flood Mode is headend with Flood List Source: EVPN
</span></span><span class="line"><span class="cl">  Remote MAC learning via EVPN
</span></span><span class="line"><span class="cl">  VNI mapping to VLANs
</span></span><span class="line"><span class="cl">  Static VLAN to VNI mapping is
</span></span><span class="line"><span class="cl">    <span class="o">[</span>11, 10011<span class="o">]</span>       <span class="o">[</span>12, 10012<span class="o">]</span>       <span class="o">[</span>13, 10013<span class="o">]</span>       <span class="o">[</span>21, 10021<span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">[</span>22, 10022<span class="o">]</span>       <span class="o">[</span>23, 10023<span class="o">]</span>       <span class="o">[</span>1079, 11079<span class="o">]</span>     <span class="o">[</span>3401, 13401<span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">[</span>3402, 13402<span class="o">]</span>
</span></span><span class="line"><span class="cl">  Dynamic VLAN to VNI mapping <span class="k">for</span> <span class="s1">&#39;evpn&#39;</span> is
</span></span><span class="line"><span class="cl">    <span class="o">[</span>4097, 10<span class="o">]</span>        <span class="o">[</span>4098, 11<span class="o">]</span>
</span></span><span class="line"><span class="cl">  Note: All Dynamic VLANs used by VCS are internal VLANs.
</span></span><span class="line"><span class="cl">        Use <span class="s1">&#39;show vxlan vni&#39;</span> <span class="k">for</span> details.
</span></span><span class="line"><span class="cl">  Static VRF to VNI mapping is
</span></span><span class="line"><span class="cl">   <span class="o">[</span>VRF20, 10<span class="o">]</span>
</span></span><span class="line"><span class="cl">   <span class="o">[</span>VRF21, 11<span class="o">]</span>
</span></span><span class="line"><span class="cl">  Headend replication flood vtep list is:
</span></span><span class="line"><span class="cl">    <span class="m">11</span> 10.255.1.6      10.255.1.5      10.255.1.4
</span></span><span class="line"><span class="cl">    <span class="m">12</span> 10.255.1.6      10.255.1.5      10.255.1.4
</span></span><span class="line"><span class="cl">    <span class="m">13</span> 10.255.1.6      10.255.1.5      10.255.1.4
</span></span><span class="line"><span class="cl">    <span class="m">21</span> 10.255.1.6      10.255.1.5      10.255.1.4
</span></span><span class="line"><span class="cl">    <span class="m">22</span> 10.255.1.6      10.255.1.5      10.255.1.4
</span></span><span class="line"><span class="cl">    <span class="m">23</span> 10.255.1.6      10.255.1.5      10.255.1.4
</span></span><span class="line"><span class="cl">  <span class="m">1079</span> 10.255.1.6      10.255.1.5      10.255.1.4
</span></span><span class="line"><span class="cl">  <span class="m">3401</span> 10.255.1.6      10.255.1.5      10.255.1.4
</span></span><span class="line"><span class="cl">  <span class="m">3402</span> 10.255.1.6      10.255.1.5      10.255.1.4
</span></span><span class="line"><span class="cl">  Shared Router MAC is 0000.0000.0000
</span></span></code></pre></div><p>VNI to VLAN mapping leaf1a:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">veos-dc1-leaf1a#show vxlan vni
</span></span><span class="line"><span class="cl">VNI to VLAN Mapping <span class="k">for</span> Vxlan1
</span></span><span class="line"><span class="cl">VNI         VLAN       Source       Interface       802.1Q Tag
</span></span><span class="line"><span class="cl">----------- ---------- ------------ --------------- ----------
</span></span><span class="line"><span class="cl"><span class="m">10011</span>       <span class="m">11</span>         static       Ethernet5       <span class="m">11</span>
</span></span><span class="line"><span class="cl">                                    Ethernet6       <span class="m">11</span>
</span></span><span class="line"><span class="cl">                                    Vxlan1          <span class="m">11</span>
</span></span><span class="line"><span class="cl"><span class="m">10012</span>       <span class="m">12</span>         static       Ethernet5       <span class="m">12</span>
</span></span><span class="line"><span class="cl">                                    Ethernet6       <span class="m">12</span>
</span></span><span class="line"><span class="cl">                                    Vxlan1          <span class="m">12</span>
</span></span><span class="line"><span class="cl"><span class="m">10013</span>       <span class="m">13</span>         static       Ethernet5       <span class="m">13</span>
</span></span><span class="line"><span class="cl">                                    Ethernet6       <span class="m">13</span>
</span></span><span class="line"><span class="cl">                                    Vxlan1          <span class="m">13</span>
</span></span><span class="line"><span class="cl"><span class="m">10021</span>       <span class="m">21</span>         static       Ethernet5       <span class="m">21</span>
</span></span><span class="line"><span class="cl">                                    Ethernet6       <span class="m">21</span>
</span></span><span class="line"><span class="cl">                                    Vxlan1          <span class="m">21</span>
</span></span><span class="line"><span class="cl"><span class="m">10022</span>       <span class="m">22</span>         static       Ethernet5       <span class="m">22</span>
</span></span><span class="line"><span class="cl">                                    Ethernet6       <span class="m">22</span>
</span></span><span class="line"><span class="cl">                                    Vxlan1          <span class="m">22</span>
</span></span><span class="line"><span class="cl"><span class="m">10023</span>       <span class="m">23</span>         static       Ethernet6       <span class="m">23</span>
</span></span><span class="line"><span class="cl">                                    Vxlan1          <span class="m">23</span>
</span></span><span class="line"><span class="cl"><span class="m">11079</span>       <span class="m">1079</span>       static       Vxlan1          <span class="m">1079</span>
</span></span><span class="line"><span class="cl"><span class="m">13401</span>       <span class="m">3401</span>       static       Vxlan1          <span class="m">3401</span>
</span></span><span class="line"><span class="cl"><span class="m">13402</span>       <span class="m">3402</span>       static       Vxlan1          <span class="m">3402</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">VNI to dynamic VLAN Mapping <span class="k">for</span> Vxlan1
</span></span><span class="line"><span class="cl">VNI       VLAN       VRF         Source
</span></span><span class="line"><span class="cl">--------- ---------- ----------- ------------
</span></span><span class="line"><span class="cl"><span class="m">10</span>        <span class="m">4097</span>       VRF20       evpn
</span></span><span class="line"><span class="cl"><span class="m">11</span>        <span class="m">4098</span>       VRF21       evpn
</span></span></code></pre></div><p>Show vxlan flood vtep:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">veos-dc1-leaf1a#show vxlan flood vtep
</span></span><span class="line"><span class="cl">          VXLAN Flood VTEP Table
</span></span><span class="line"><span class="cl">--------------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">VLANS                            Ip Address
</span></span><span class="line"><span class="cl">-----------------------------   ------------------------------------------------
</span></span><span class="line"><span class="cl">11-13,21-23,1079,3401-3402      10.255.1.4      10.255.1.5      10.255.1.6
</span></span></code></pre></div><p>Show vxlan address-table:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">veos-dc1-leaf1a#show vxlan address-table
</span></span><span class="line"><span class="cl">          Vxlan Mac Address Table
</span></span><span class="line"><span class="cl">----------------------------------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">VLAN  Mac Address     Type      Prt  VTEP             Moves   Last Move
</span></span><span class="line"><span class="cl">----  -----------     ----      ---  ----             -----   ---------
</span></span><span class="line"><span class="cl">  <span class="m">12</span>  22f5.d0e1.1e17  EVPN      Vx1  10.255.1.4       <span class="m">1</span>       0:03:57 ago
</span></span><span class="line"><span class="cl">  <span class="m">12</span>  bc24.11ca.c703  EVPN      Vx1  10.255.1.4       <span class="m">1</span>       <span class="m">37</span> days, 19:47:32 ago
</span></span><span class="line"><span class="cl">  <span class="m">13</span>  bc24.116d.964b  EVPN      Vx1  10.255.1.5       <span class="m">1</span>       <span class="m">45</span> days, 18:31:55 ago
</span></span><span class="line"><span class="cl">  <span class="m">22</span>  bc24.11b8.1363  EVPN      Vx1  10.255.1.4       <span class="m">1</span>       <span class="m">37</span> days, 19:57:39 ago
</span></span><span class="line"><span class="cl">  <span class="m">23</span>  bc24.115f.7497  EVPN      Vx1  10.255.1.5       <span class="m">1</span>       <span class="m">45</span> days, 14:03:13 ago
</span></span><span class="line"><span class="cl"><span class="m">1079</span>  bc24.110b.c61f  EVPN      Vx1  10.255.1.6       <span class="m">1</span>       <span class="m">46</span> days, 22:22:27 ago
</span></span><span class="line"><span class="cl">Total Remote Mac Addresses <span class="k">for</span> this criterion: <span class="m">6</span>
</span></span></code></pre></div><p>Show arp for vxlan interface:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">veos-dc1-leaf1a#show arp interface vxlan <span class="m">1</span>
</span></span><span class="line"><span class="cl">Address         Age <span class="o">(</span>sec<span class="o">)</span>  Hardware Addr   Interface
</span></span><span class="line"><span class="cl">veos-dc1-leaf1a#show arp vrf VRF20 interface vxlan <span class="m">1</span>
</span></span><span class="line"><span class="cl">Address         Age <span class="o">(</span>sec<span class="o">)</span>  Hardware Addr   Interface
</span></span><span class="line"><span class="cl">10.20.12.10             -  bc24.11ca.c703  Vlan12, Vxlan1
</span></span><span class="line"><span class="cl">10.20.13.10             -  bc24.116d.964b  Vlan13, Vxlan1
</span></span><span class="line"><span class="cl">veos-dc1-leaf1a#show arp vrf VRF21 interface vxlan <span class="m">1</span>
</span></span><span class="line"><span class="cl">Address         Age <span class="o">(</span>sec<span class="o">)</span>  Hardware Addr   Interface
</span></span><span class="line"><span class="cl">10.21.22.10             -  bc24.11b8.1363  Vlan22, Vxlan1
</span></span><span class="line"><span class="cl">10.21.23.10             -  bc24.115f.7497  Vlan23, Vxlan1
</span></span></code></pre></div><p>Show ip route to a remote destination IP:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">veos-dc1-leaf1a#show ip route vrf VRF20 10.20.14.11
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">VRF: VRF20
</span></span><span class="line"><span class="cl">Source Codes:
</span></span><span class="line"><span class="cl">       C - connected, S - static, K - kernel,
</span></span><span class="line"><span class="cl">       O - OSPF, IA - OSPF inter area, E1 - OSPF external <span class="nb">type</span> 1,
</span></span><span class="line"><span class="cl">       E2 - OSPF external <span class="nb">type</span> 2, N1 - OSPF NSSA external <span class="nb">type</span> 1,
</span></span><span class="line"><span class="cl">       N2 - OSPF NSSA external type2, B - Other BGP Routes,
</span></span><span class="line"><span class="cl">       B I - iBGP, B E - eBGP, R - RIP, I L1 - IS-IS level 1,
</span></span><span class="line"><span class="cl">       I L2 - IS-IS level 2, O3 - OSPFv3, A B - BGP Aggregate,
</span></span><span class="line"><span class="cl">       A O - OSPF Summary, NG - Nexthop Group Static Route,
</span></span><span class="line"><span class="cl">       V - VXLAN Control Service, M - Martian,
</span></span><span class="line"><span class="cl">       DH - DHCP client installed default route,
</span></span><span class="line"><span class="cl">       DP - Dynamic Policy Route, L - VRF Leaked,
</span></span><span class="line"><span class="cl">       G  - gRIBI, RC - Route Cache Route,
</span></span><span class="line"><span class="cl">       CL - CBF Leaked Route
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> B E      10.20.14.11/32 <span class="o">[</span>200/0<span class="o">]</span>
</span></span><span class="line"><span class="cl">           via VTEP 10.255.1.6 VNI <span class="m">10</span> router-mac bc:24:11:5e:4a:59 local-interface Vxlan1
</span></span></code></pre></div><p>Show bgp evpn detail:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">veos-dc1-leaf1a#show bgp evpn detail
</span></span><span class="line"><span class="cl">BGP routing table information <span class="k">for</span> VRF default
</span></span><span class="line"><span class="cl">Router identifier 10.255.0.3, <span class="nb">local</span> AS number <span class="m">65111</span>
</span></span><span class="line"><span class="cl">BGP routing table entry <span class="k">for</span> ip-prefix 10.20.14.0/24, Route Distinguisher: 10.255.0.6:10
</span></span><span class="line"><span class="cl"> Paths: <span class="m">2</span> available
</span></span><span class="line"><span class="cl">  <span class="m">65110</span> <span class="m">65114</span>
</span></span><span class="line"><span class="cl">    10.255.1.6 from 10.255.0.2 <span class="o">(</span>10.255.0.2<span class="o">)</span>
</span></span><span class="line"><span class="cl">      Origin IGP, metric -, localpref 100, weight 0, tag 0, valid, external, ECMP head, ECMP, best, ECMP contributor
</span></span><span class="line"><span class="cl">      Extended Community: Route-Target-AS:10:10 TunnelEncap:tunnelTypeVxlan EvpnRouterMac:bc:24:11:5e:4a:59
</span></span><span class="line"><span class="cl">      VNI: <span class="m">10</span>
</span></span><span class="line"><span class="cl">  <span class="m">65110</span> <span class="m">65114</span>
</span></span><span class="line"><span class="cl">    10.255.1.6 from 10.255.0.1 <span class="o">(</span>10.255.0.1<span class="o">)</span>
</span></span><span class="line"><span class="cl">      Origin IGP, metric -, localpref 100, weight 0, tag 0, valid, external, ECMP, ECMP contributor
</span></span><span class="line"><span class="cl">      Extended Community: Route-Target-AS:10:10 TunnelEncap:tunnelTypeVxlan EvpnRouterMac:bc:24:11:5e:4a:59
</span></span><span class="line"><span class="cl">      VNI: <span class="m">10</span>
</span></span></code></pre></div><p>In the next posts I will cover the different EVPN route types.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">veos-dc1-leaf1a#show bgp evpn route-type ?
</span></span><span class="line"><span class="cl">  auto-discovery    Filter by Ethernet auto-discovery <span class="o">(</span>A-D<span class="o">)</span> route <span class="o">(</span><span class="nb">type</span> 1<span class="o">)</span>
</span></span><span class="line"><span class="cl">  count             Route-type based path count
</span></span><span class="line"><span class="cl">  ethernet-segment  Filter by Ethernet segment route <span class="o">(</span><span class="nb">type</span> 4<span class="o">)</span>
</span></span><span class="line"><span class="cl">  imet              Filter by inclusive multicast Ethernet tag route <span class="o">(</span><span class="nb">type</span> 3<span class="o">)</span>
</span></span><span class="line"><span class="cl">  ip-prefix         Filter by IP prefix route <span class="o">(</span><span class="nb">type</span> 5<span class="o">)</span>
</span></span><span class="line"><span class="cl">  join-sync         Filter by multicast join sync route <span class="o">(</span><span class="nb">type</span> 7<span class="o">)</span>
</span></span><span class="line"><span class="cl">  leave-sync        Filter by multicast leave sync route <span class="o">(</span><span class="nb">type</span> 8<span class="o">)</span>
</span></span><span class="line"><span class="cl">  mac-ip            Filter by MAC/IP advertisement route <span class="o">(</span><span class="nb">type</span> 2<span class="o">)</span>
</span></span><span class="line"><span class="cl">  smet              Filter by selective multicast Ethernet tag route <span class="o">(</span><span class="nb">type</span> 6<span class="o">)</span>
</span></span><span class="line"><span class="cl">  spmsi             Filter by selective PMSI auto discovery route <span class="o">(</span><span class="nb">type</span> 10<span class="o">)</span>
</span></span></code></pre></div>

<h2 class="relative group">Sources 
    <div id="sources" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#sources" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<ul>
<li>IETF RFC7209 <a href="https://datatracker.ietf.org/doc/rfc7209/" target="_blank">https://datatracker.ietf.org/doc/rfc7209/</a></li>
<li>IETF RFC7432 <a href="https://datatracker.ietf.org/doc/rfc7432/" target="_blank">https://datatracker.ietf.org/doc/rfc7432/</a></li>
<li>IETF RFC8365 <a href="https://datatracker.ietf.org/doc/rfc8365/" target="_blank">https://datatracker.ietf.org/doc/rfc8365/</a></li>
<li>IETF RFC9012 <a href="https://datatracker.ietf.org/doc/rfc9012/" target="_blank">https://datatracker.ietf.org/doc/rfc9012/</a></li>
<li>IETF RFC4760 <a href="https://datatracker.ietf.org/doc/html/rfc4760" target="_blank">https://datatracker.ietf.org/doc/html/rfc4760</a></li>
<li>IETF RFC9014 <a href="https://datatracker.ietf.org/doc/rfc9014/" target="_blank">https://datatracker.ietf.org/doc/rfc9014/</a></li>
<li>IETF draft-ietf-bess-evpn-geneve-08 <a href="https://datatracker.ietf.org/doc/html/draft-ietf-bess-evpn-geneve-08" target="_blank">https://datatracker.ietf.org/doc/html/draft-ietf-bess-evpn-geneve-08</a></li>
<li>IETF RFC2858 <a href="https://datatracker.ietf.org/doc/html/rfc2858" target="_blank">https://datatracker.ietf.org/doc/html/rfc2858</a></li>
<li>IETF RFC4271 <a href="https://datatracker.ietf.org/doc/html/rfc4271" target="_blank">https://datatracker.ietf.org/doc/html/rfc4271</a></li>
<li>IETF RFC4023 <a href="https://datatracker.ietf.org/doc/html/rfc4023" target="_blank">https://datatracker.ietf.org/doc/html/rfc4023</a></li>
<li>IETF RFC7348 <a href="https://datatracker.ietf.org/doc/html/rfc7348" target="_blank">https://datatracker.ietf.org/doc/html/rfc7348</a></li>
<li>IETF RFC3021 <a href="https://datatracker.ietf.org/doc/rfc3021/" target="_blank">https://datatracker.ietf.org/doc/rfc3021/</a></li>
<li>Arista Networks <a href="https://www.arista.com/en/um-eos/eos-evpn-overview" target="_blank">https://www.arista.com/en/um-eos/eos-evpn-overview</a></li>
<li>Arista Networks <a href="https://www.arista.com/en/um-eos/eos-integrated-routing-and-bridging" target="_blank">https://www.arista.com/en/um-eos/eos-integrated-routing-and-bridging</a></li>
</ul>

          
          
          
        </div>
        
        

        
        
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://blog.andreasm.io/2024/12/09/evpn-introduction/&amp;title=EVPN%20introduction"
      title="Share on LinkedIn"
      aria-label="Share on LinkedIn"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://twitter.com/intent/tweet/?url=https://blog.andreasm.io/2024/12/09/evpn-introduction/&amp;text=EVPN%20introduction"
      title="Tweet on Twitter"
      aria-label="Tweet on Twitter"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://s2f.kytta.dev/?text=EVPN%20introduction%20https://blog.andreasm.io/2024/12/09/evpn-introduction/"
      title=""
      aria-label=""
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="mailto:?body=https://blog.andreasm.io/2024/12/09/evpn-introduction/&amp;subject=EVPN%20introduction"
      title="Send via email"
      aria-label="Send via email"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>


    </a>
      
    
  </section>


        


<h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2>
<section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3">
  
  

  <a href="/2024/11/08/overlay-on-overlay-arista-in-the-underlay/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/2024/11/08/overlay-on-overlay-arista-in-the-underlay/feature-arista-networks.jpg);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/2024/11/08/overlay-on-overlay-arista-in-the-underlay/">Overlay on overlay - Arista in the underlay</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-11-08T08:56:51&#43;01:00">8 November 2024</time><span class="px-2 text-primary-500">&middot;</span><span>10127 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">48 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/networking/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Networking
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/eos/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    EOS
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/arista/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Arista
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/overlay/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Overlay
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/encapsulation/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Encapsulation
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/topologies/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Topologies
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/networking/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Networking
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/eos/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    EOS
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/arista/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Arista
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/overlay/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Overlay
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/encapsulation/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Encapsulation
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/topologies/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Topologies
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
        <div class="py-1 prose dark:prose-invert">
          Describing typical deployments where we end up with double encapsulation, how to monitor, troubleshoot
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
  

  <a href="/2024/08/22/arista-cloudvision-and-avd-using-containerlab/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/2024/08/22/arista-cloudvision-and-avd-using-containerlab/feature-arista-networks.jpg);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/2024/08/22/arista-cloudvision-and-avd-using-containerlab/">Arista Cloudvision and AVD using Containerlab</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-08-22T21:26:33&#43;02:00">22 August 2024</time><span class="px-2 text-primary-500">&middot;</span><span>6812 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">32 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/networking/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Networking
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/provisioning/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Provisioning
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/automation/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Automation
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/ceos/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    CEOS
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/veos/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    VEOS
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/arista/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Arista
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/networking/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Networking
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/provisioning/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Provisioning
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/automation/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Automation
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/arista/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Arista
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/veos/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Veos
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/ceos/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Ceos
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/containerlab/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Containerlab
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
        <div class="py-1 prose dark:prose-invert">
          Using Containerlab to provision cEOS containers for AVD and CloudVision
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
  

  <a href="/2024/06/10/arista-automated-configuration-using-ansible/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/2024/06/10/arista-automated-configuration-using-ansible/feature-arista-networks.jpg);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/2024/06/10/arista-automated-configuration-using-ansible/">Arista Automated Configuration using Ansible</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-06-10T07:51:41&#43;02:00">10 June 2024</time><span class="px-2 text-primary-500">&middot;</span><span>11243 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">53 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/networking/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Networking
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/provisioning/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Provisioning
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/automation/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Automation
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/networking/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Networking
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/provisioning/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Provisioning
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/automation/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Automation
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
        <div class="py-1 prose dark:prose-invert">
          In this post I will deploy Arista vEOS from zero to a full Spine-Leaf topology using Arista ZeroTouch Provisining and Ansible
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
</section>

  
      </div>
     
      
      
        
        
          
          
        
      <script>
        var oid = "views_posts\/2024-12-09-evpn-and-route-types\/index.md"
        var oid_likes = "likes_posts\/2024-12-09-evpn-and-route-types\/index.md"
      </script>
      
      
      <script type="text/javascript" src="/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js" integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q&#43;oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script>
      
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/2024/11/08/overlay-on-overlay-arista-in-the-underlay/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Overlay on overlay - Arista in the underlay</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2024-11-08T08:56:51&#43;01:00">8 November 2024</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/2025/02/11/ci/cd-with-arista-validated-design/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >CI/CD with Arista Validated Design</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2025-02-11T10:35:40&#43;01:00">11 February 2025</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top" title="Scroll to top">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
    <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex flex-col list-none sm:flex-row">
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/tags/"
            title="">
            
            Tags
          </a>
        </li>
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/categories/"
            title="">
            
            Categories
          </a>
        </li>
        
      </ul>
    </nav>
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      &copy;
      2025
      Andreas Marqvardsen
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js" integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="https://blog.andreasm.io/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
