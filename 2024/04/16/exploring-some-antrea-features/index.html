<!DOCTYPE html>
<html lang="en" dir="ltr" class="scroll-smooth" data-default-appearance="dark"
  data-auto-appearance="true"><head>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Exploring some Antrea Features &middot; blog.andreasm.io</title>
  <meta name="title" content="Exploring some Antrea Features &middot; blog.andreasm.io" />
  
  <meta name="description" content="In this post I will go through a couple of Antrea features I find interesting, some new features and some older features" />
  <meta name="keywords" content="antrea, kubernetes, cni, " />
  
  
  <link rel="canonical" href="https://blog.andreasm.io/2024/04/16/exploring-some-antrea-features/" />
  
  
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.48d290696564c2380c4233780f3fd414aa6e2b0b67ed916e9d918c48c05f5b20b641bf892fadd408e43ec21d2feb2ec1fe6fd1f021df2806a254977fe2f80a64.css"
    integrity="sha512-SNKQaWVkwjgMQjN4Dz/UFKpuKwtn7ZFunZGMSMBfWyC2Qb&#43;JL63UCOQ&#43;wh0v6y7B/m/R8CHfKAaiVJd/4vgKZA==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.a85bd6dc99d1fecae166deb56a1fee6375588c72533c4b8c690e4a9ec5a04174ff780e41e2ac770382a8e67818cb2b89766afa3e23965c9102424a080dafbb0c.js"
    integrity="sha512-qFvW3JnR/srhZt61ah/uY3VYjHJTPEuMaQ5KnsWgQXT/eA5B4qx3A4Ko5ngYyyuJdmr6PiOWXJECQkoIDa&#43;7DA=="></script>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.a2d78d78672e549fbfc972ece871725b5478ba0b65708dda20cb97ab80a865eae6d247e1b05a4aec6ebbf78647ec3233bad8b2609ed98eee53cd58aa17128bc7.js"
    integrity="sha512-oteNeGcuVJ&#43;/yXLs6HFyW1R4ugtlcI3aIMuXq4CoZerm0kfhsFpK7G6794ZH7DIzutiyYJ7Zju5TzViqFxKLxw==" data-copy="" data-copied=""></script>
  
  
  
  <script src="/lib/zoom/zoom.min.37d2094687372da3f7343a221a470f6b8806f7891aa46a5a03966af7f0ebd38b9fe536cb154e6ad28f006d184b294525a7c4054b6bbb4be62d8b453b42db99bd.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S&#43;Yti0U7QtuZvQ=="></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="https://blog.andreasm.io/2024/04/16/exploring-some-antrea-features/">
  <meta property="og:site_name" content="blog.andreasm.io">
  <meta property="og:title" content="Exploring some Antrea Features">
  <meta property="og:description" content="A walkthrough on new and some older features in Antrea">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-16T09:25:28+02:00">
    <meta property="article:modified_time" content="2024-04-16T09:25:28+02:00">
    <meta property="article:tag" content="Antrea">
    <meta property="article:tag" content="Kubernetes">
    <meta property="article:tag" content="Cni">
    <meta property="og:image" content="https://blog.andreasm.io/2024/04/16/exploring-some-antrea-features/feature-antrea-1.png">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://blog.andreasm.io/2024/04/16/exploring-some-antrea-features/feature-antrea-1.png">
  <meta name="twitter:title" content="Exploring some Antrea Features">
  <meta name="twitter:description" content="A walkthrough on new and some older features in Antrea">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Exploring some Antrea Features",
    "headline": "Exploring some Antrea Features",
    "description": "A walkthrough on new and some older features in Antrea",
    "abstract": "In this post I will go through a couple of Antrea features I find interesting, some new features and some older features",
    "inLanguage": "en",
    "url" : "https:\/\/blog.andreasm.io\/2024\/04\/16\/exploring-some-antrea-features\/",
    "author" : {
      "@type": "Person",
      "name": "Andreas Marqvardsen"
    },
    "copyrightYear": "2024",
    "dateCreated": "2024-04-16T09:25:28\u002b02:00",
    "datePublished": "2024-04-16T09:25:28\u002b02:00",
    
    "dateModified": "2024-04-16T09:25:28\u002b02:00",
    
    "keywords": ["antrea","kubernetes","cni"],
    
    "mainEntityOfPage": "true",
    "wordCount": "6097"
  }]
  </script>


  
  
  <meta name="author" content="Andreas Marqvardsen" />
  
  
  
  <link href="mailto:andreas.marqvardsen[AT]gmail.com" rel="me" />
  
  
  <link href="https://blog.andreasm.io/" rel="me" />
  
  
  <link href="https://github.com/andreasm80" rel="me" />
  
  
  <link href="https://linkedin.com/in/andreas-marqvardsen" rel="me" />
  
  
  <link href="https://vmst.io/@andreasm" rel="me" />
  
  
  <link href="https://x.com/NATsoFast" rel="me" />
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>






















  
  

<script async src="https://www.googletagmanager.com/gtag/js?id=G-TVPYDVE8KR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TVPYDVE8KR');
</script>



  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a>
  </div>
  
  
  <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px]" style="z-index:100">
  <div id="menu-blur" class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div>
  <div class="relative max-w-[64rem] ml-auto mr-auto">
    <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3">
    
    
    
    <div>
        <a href="/" class="flex">
            <span class="sr-only">blog.andreasm.io</span>

            
            <img src="/ynwa2.png" width="300" height="342"
                class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt="blog.andreasm.io" />
            

        </a>
    </div>
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">blog.andreasm.io</a>
            

        </nav>
        <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

            
            
            
  <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Posts
    </p>
</a>



            
            
  <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        About
    </p>
</a>



            
            
  <a href="/categories/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Categories
    </p>
</a>



            
            
  <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Tags
    </p>
</a>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class="ltr:mr-14 rtl:ml-14 flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center space-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400" style="margin-right:5px">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 -mr-2 md:hidden">

        <label id="menu-button" class="block">
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li id="menu-close-button">
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                    
  <li class="mt-1">
    <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Posts
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            About
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/categories/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Categories
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Tags
        </p>
    </a>
</li>




                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>




<script>
    (function () {
        var $mainmenu = $('.main-menu');
        var path = window.location.pathname;
        $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
            $(e).children('p').addClass('active');
        });
    })();
</script>


  </div>
</div>
<script>
  window.addEventListener('scroll', function (e) {
    var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
    var background_blur = document.getElementById('menu-blur');
    background_blur.style.opacity = (scroll / 300);
  });
</script>

  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  
  
  
  
  
  


<div id="hero" class="h-[150px] md:h-[200px]"></div>



    
    <div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"
    style="background-image:url(/2024/04/16/exploring-some-antrea-features/feature-antrea-1.png);">
    


    <div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal">
    </div>
    <div
        class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal">
    </div>
</div>

<div id="background-blur" class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div>
<script>
    window.addEventListener('scroll', function (e) {
        var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        var background_blur = document.getElementById('background-blur');
        background_blur.style.opacity = (scroll / 300)
    });
</script>

  
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/"
      >blog.andreasm.io</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline ">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/posts/"
      >Posts</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/2024/04/16/exploring-some-antrea-features/"
      >Exploring some Antrea Features</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      Exploring some Antrea Features
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-04-16T09:25:28&#43;02:00">16 April 2024</time><span class="px-2 text-primary-500">&middot;</span><span>6097 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">29 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/cni/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    CNI
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/antrea/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Antrea
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/antrea/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Antrea
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/cni/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Cni
  </span>
</span>
  </span>
  
  
  
  
</div>




    </div>

    
    
    
    
    

    

    
      
      
        
        
<div class="flex author">
  
    
    
      
    
    
      
      <img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width="96" height="96"
      alt="Andreas Marqvardsen" src="/profile.png" />
    
  
  <div class="place-self-center">
    
    <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
      Author
    </div>
    <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
      Andreas Marqvardsen
    </div>
    
    
    <div class="text-sm text-neutral-700 dark:text-neutral-400">Always curious, always learning</div>
    
    <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="mailto:andreas.marqvardsen[AT]gmail.com"
          target="_blank"
          aria-label="Email"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://blog.andreasm.io/"
          target="_blank"
          aria-label="Link"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M172.5 131.1C228.1 75.51 320.5 75.51 376.1 131.1C426.1 181.1 433.5 260.8 392.4 318.3L391.3 319.9C381 334.2 361 337.6 346.7 327.3C332.3 317 328.9 297 339.2 282.7L340.3 281.1C363.2 249 359.6 205.1 331.7 177.2C300.3 145.8 249.2 145.8 217.7 177.2L105.5 289.5C73.99 320.1 73.99 372 105.5 403.5C133.3 431.4 177.3 435 209.3 412.1L210.9 410.1C225.3 400.7 245.3 404 255.5 418.4C265.8 432.8 262.5 452.8 248.1 463.1L246.5 464.2C188.1 505.3 110.2 498.7 60.21 448.8C3.741 392.3 3.741 300.7 60.21 244.3L172.5 131.1zM467.5 380C411 436.5 319.5 436.5 263 380C213 330 206.5 251.2 247.6 193.7L248.7 192.1C258.1 177.8 278.1 174.4 293.3 184.7C307.7 194.1 311.1 214.1 300.8 229.3L299.7 230.9C276.8 262.1 280.4 306.9 308.3 334.8C339.7 366.2 390.8 366.2 422.3 334.8L534.5 222.5C566 191 566 139.1 534.5 108.5C506.7 80.63 462.7 76.99 430.7 99.9L429.1 101C414.7 111.3 394.7 107.1 384.5 93.58C374.2 79.2 377.5 59.21 391.9 48.94L393.5 47.82C451 6.731 529.8 13.25 579.8 63.24C636.3 119.7 636.3 211.3 579.8 267.7L467.5 380z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/andreasm80"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://linkedin.com/in/andreas-marqvardsen"
          target="_blank"
          aria-label="Linkedin"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://vmst.io/@andreasm"
          target="_blank"
          aria-label="Mastodon"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://x.com/NATsoFast"
          target="_blank"
          aria-label="X-Twitter"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
  </span>

</span></a
        >
      
    
  </div>

</div>
  </div>
</div>

      

      

      
      <div class="mb-5"></div>
      

    

  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
     <div
      class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
      <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]">

         <details open id="TOCView"
  class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#antrea-egress-using-vlan---new-in-antrea-v1150">Antrea Egress using VLAN - new in Antrea v.1.15.0</a>
      <ul>
        <li><a href="#how-to-configure-antrea-egress-using-vlan">How to configure Antrea Egress using VLAN</a></li>
        <li><a href="#antrea-egress-failover">Antrea Egress failover</a></li>
      </ul>
    </li>
    <li><a href="#kube-proxy-vs-antrea-proxy">Kube-Proxy vs Antrea Proxy</a>
      <ul>
        <li><a href="#antreaproxy-and-kube-proxy-together">AntreaProxy AND Kube-Proxy together</a></li>
        <li><a href="#antreaproxy-all">AntreaProxy All</a></li>
      </ul>
    </li>
    <li><a href="#antrea-serviceexternalip">Antrea ServiceExternalIP</a>
      <ul>
        <li><a href="#serviceexternalip-using-kube-proxy-and-ipvs-ip-virtual-server">ServiceExternalIP using Kube-Proxy and IPVS (IP Virtual Server)</a></li>
        <li><a href="#serviceexternalip-using-only-antreaproxy">ServiceExternalIP using only AntreaProxy.</a></li>
      </ul>
    </li>
    <li><a href="#l7flowexporter---new-in-antrea-v1150">L7FlowExporter - new in Antrea v.1.15.0</a></li>
    <li><a href="#node-networkpolicy-and-externalnode-policy">Node NetworkPolicy and ExternalNode Policy</a>
      <ul>
        <li><a href="#node-networkpolicy---new-in-antrea-v115">Node NetworkPolicy - new in Antrea v1.15</a></li>
        <li><a href="#externalnode-policy">ExternalNode Policy</a></li>
      </ul>
    </li>
    <li><a href="#outro">Outro</a></li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#antrea-egress-using-vlan---new-in-antrea-v1150">Antrea Egress using VLAN - new in Antrea v.1.15.0</a>
      <ul>
        <li><a href="#how-to-configure-antrea-egress-using-vlan">How to configure Antrea Egress using VLAN</a></li>
        <li><a href="#antrea-egress-failover">Antrea Egress failover</a></li>
      </ul>
    </li>
    <li><a href="#kube-proxy-vs-antrea-proxy">Kube-Proxy vs Antrea Proxy</a>
      <ul>
        <li><a href="#antreaproxy-and-kube-proxy-together">AntreaProxy AND Kube-Proxy together</a></li>
        <li><a href="#antreaproxy-all">AntreaProxy All</a></li>
      </ul>
    </li>
    <li><a href="#antrea-serviceexternalip">Antrea ServiceExternalIP</a>
      <ul>
        <li><a href="#serviceexternalip-using-kube-proxy-and-ipvs-ip-virtual-server">ServiceExternalIP using Kube-Proxy and IPVS (IP Virtual Server)</a></li>
        <li><a href="#serviceexternalip-using-only-antreaproxy">ServiceExternalIP using only AntreaProxy.</a></li>
      </ul>
    </li>
    <li><a href="#l7flowexporter---new-in-antrea-v1150">L7FlowExporter - new in Antrea v.1.15.0</a></li>
    <li><a href="#node-networkpolicy-and-externalnode-policy">Node NetworkPolicy and ExternalNode Policy</a>
      <ul>
        <li><a href="#node-networkpolicy---new-in-antrea-v115">Node NetworkPolicy - new in Antrea v1.15</a></li>
        <li><a href="#externalnode-policy">ExternalNode Policy</a></li>
      </ul>
    </li>
    <li><a href="#outro">Outro</a></li>
  </ul>
</nav>
  </div>
</details>

<script>

  var margin = 200;
  var marginError = 50;

  (function () {
    var $window = $(window);
    var $toc = $('#TOCView');
    var tocHeight = $toc.height();

    function onResize() {
      var windowAndMarginHeight = $window.height() - margin;
      if(tocHeight >= windowAndMarginHeight) {
        $toc.css("overflow-y", "scroll")
        $toc.css("max-height", (windowAndMarginHeight + marginError) + "px")
      } else {
        $toc.css("overflow-y", "hidden")
        $toc.css("max-height", "9999999px")
      }
    }

    $window.on('resize', onResize);
    $(document).ready(onResize);
  })();



  (function () {
    var $toc = $('#TableOfContents');
    if ($toc.length > 0) {
      var $window = $(window);

      function onScroll() {
        var currentScroll = $window.scrollTop();
        var h = $('.anchor');
        var id = "";
        h.each(function (i, e) {
          e = $(e);
          if (e.offset().top - $(window).height()/3 <= currentScroll) {
            id = decodeURIComponent(e.attr('id'));
          }
        });
        var active = $toc.find('a.active');      
        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

        active.each(function (i, e) {
          
            $(e).removeClass('active');
          
        });
        $toc.find('a[href="#' + id + '"]').addClass('active')
        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
          $(e).children('a').parents('ul').show();          
        });
      }

      $window.on('scroll', onScroll);
      $(document).ready(function () {
        
        onScroll();
      });
    }
  })();


</script>
   </div>
      </div>
      

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          

<h1 class="relative group">Antrea FeatureGates 
    <div id="antrea-featuregates" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#antrea-featuregates" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>In this post, I will highlight a couple of Antrea features that I&rsquo;d like to discuss. I will explain how to configure them, why they are useful, and how to use them. Below is some of the features I will cover</p>
<ul>
<li>Egress using VLAN</li>
<li>AntreaProxy</li>
<li>ServiceExternalIP</li>
<li>L7FLowExporter</li>
<li>NodeNetwork Policy</li>
<li>ExternalNode Policy</li>
</ul>
<p>As usual, head over to the official Antrea <a href="https://antrea.io/docs/v1.15.1/" target="_blank">documentation</a> and Antrea <a href="https://github.com/antrea-io/antrea/blob/main/docs/feature-gates.md" target="_blank">Github</a> repo for more information. This post will focus on the upstream version v1.15.1 of Antrea available on Github, my Kubernetes clusters will also be using upstream Kubernetes version 1.28.5+ running on Ubuntu nodes.</p>
<p>Antrea FeatureGates is enabled/disabled using your Helm value file, or editing the Antrea ConfigMap. To quickly get a status over the feature gates, use the <em>antctl</em> cli tool:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~$ antctl get featuregates
</span></span><span class="line"><span class="cl">Antrea Agent Feature Gates
</span></span><span class="line"><span class="cl">FEATUREGATE                     STATUS       VERSION
</span></span><span class="line"><span class="cl">AntreaIPAM                      Disabled     ALPHA
</span></span><span class="line"><span class="cl">AntreaPolicy                    Enabled      BETA
</span></span><span class="line"><span class="cl">AntreaProxy                     Enabled      GA
</span></span><span class="line"><span class="cl">CleanupStaleUDPSvcConntrack     Disabled     ALPHA
</span></span><span class="line"><span class="cl">Egress                          Enabled      BETA
</span></span><span class="line"><span class="cl">EgressSeparateSubnet            Enabled      ALPHA
</span></span><span class="line"><span class="cl">EgressTrafficShaping            Disabled     ALPHA
</span></span><span class="line"><span class="cl">EndpointSlice                   Enabled      GA
</span></span><span class="line"><span class="cl">ExternalNode                    Disabled     ALPHA
</span></span><span class="line"><span class="cl">FlowExporter                    Disabled     ALPHA
</span></span><span class="line"><span class="cl">IPsecCertAuth                   Disabled     ALPHA
</span></span><span class="line"><span class="cl">L7FlowExporter                  Disabled     ALPHA
</span></span><span class="line"><span class="cl">L7NetworkPolicy                 Disabled     ALPHA
</span></span><span class="line"><span class="cl">LoadBalancerModeDSR             Disabled     ALPHA
</span></span><span class="line"><span class="cl">Multicast                       Enabled      BETA
</span></span><span class="line"><span class="cl">Multicluster                    Disabled     ALPHA
</span></span><span class="line"><span class="cl">NetworkPolicyStats              Enabled      BETA
</span></span><span class="line"><span class="cl">NodeNetworkPolicy               Disabled     ALPHA
</span></span><span class="line"><span class="cl">NodePortLocal                   Enabled      GA
</span></span><span class="line"><span class="cl">SecondaryNetwork                Disabled     ALPHA
</span></span><span class="line"><span class="cl">ServiceExternalIP               Enabled      ALPHA
</span></span><span class="line"><span class="cl">SupportBundleCollection         Disabled     ALPHA
</span></span><span class="line"><span class="cl">TopologyAwareHints              Enabled      BETA
</span></span><span class="line"><span class="cl">Traceflow                       Enabled      BETA
</span></span><span class="line"><span class="cl">TrafficControl                  Disabled     ALPHA
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Antrea Controller Feature Gates
</span></span><span class="line"><span class="cl">FEATUREGATE                 STATUS       VERSION
</span></span><span class="line"><span class="cl">AdminNetworkPolicy          Disabled     ALPHA
</span></span><span class="line"><span class="cl">AntreaIPAM                  Disabled     ALPHA
</span></span><span class="line"><span class="cl">AntreaPolicy                Enabled      BETA
</span></span><span class="line"><span class="cl">Egress                      Enabled      BETA
</span></span><span class="line"><span class="cl">IPsecCertAuth               Disabled     ALPHA
</span></span><span class="line"><span class="cl">L7NetworkPolicy             Disabled     ALPHA
</span></span><span class="line"><span class="cl">Multicast                   Enabled      BETA
</span></span><span class="line"><span class="cl">Multicluster                Disabled     ALPHA
</span></span><span class="line"><span class="cl">NetworkPolicyStats          Enabled      BETA
</span></span><span class="line"><span class="cl">NodeIPAM                    Enabled      BETA
</span></span><span class="line"><span class="cl">ServiceExternalIP           Enabled      ALPHA
</span></span><span class="line"><span class="cl">SupportBundleCollection     Disabled     ALPHA
</span></span><span class="line"><span class="cl">Traceflow                   Enabled      BETA
</span></span></code></pre></div>

<h2 class="relative group">Antrea Egress using VLAN - new in Antrea v.1.15.0 
    <div id="antrea-egress-using-vlan---new-in-antrea-v1150" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#antrea-egress-using-vlan---new-in-antrea-v1150" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>I have already covered Antrea Egress in another post <a href="https://blog.andreasm.io/2023/02/20/antrea-egress/" target="_blank">here</a>, where I use Daemonset to install FRR on the worker nodes. This allowed me to advertise the Egress addresses using BGP using a different subnet than the nodes themselves. Back then Antrea did not have support for Egress subnets in different network than the nodes. Now, in Antrea <a href="https://github.com/antrea-io/antrea/releases/tag/v1.15.0" target="_blank">v1.15.0</a> there is support in Antrea Egress to use different subnets. This is a welcome update in Antrea.</p>
<p>Before configuring Antrea Egress, the default behaviour for a pod when &ldquo;egressing&rdquo; or communicating externally outside its Kubernetes cluster is that its source address (POD CIDR) is translated using SNAT to the Kubernetes node the pod is currently running on. See below diagram:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240417103049244.png"
        alt="pod-ext-snat"
      />
      
    </figure>
</p>
<p>Each time a pod needs to communicate outside its k8s node it will get the IP address from the node it is currently residing on.</p>
<p>With Antrea Egress I can specify a specific IP address from a pool (ExternalIPPool) I confgure for the pods to use (for the ones I need Egress configured on). Before Antrea v1.15.0 I could only use the same subnet as the Kubernetes nodes were using, meaning I had to reserve a range in that subnet for Egress usage to avoid IP overlap, unless I did some DIY stuff like static routes or as in my post <a href="https://blog.andreasm.io/2023/02/20/antrea-egress/" target="_blank">here</a>. Now with Antrea v1.15.0 Antrea supports Egress on a different subnet, it even supports using a optional VLAN tag like this:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240417103628196.png"
        alt="egress-vlan"
      />
      
    </figure>
</p>
<p>I assign a VLAN tag in the ExternalIPPool which uses the same physical interface as the node itself is configured with, like eth0/ens18 etc). This require my node to be placed on a network that allows vlan trunks/in guest tagging, and allows me to easily separate the Egress subnets from the node subnet and specifying different subnets for my Egresses. In simple terms, what it does is creating a vlan interface on the nodes I decide to use as Egress nodes. Like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">11: antrea-ext.181@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc noqueue state UP mode DEFAULT group default
</span></span><span class="line"><span class="cl">    link/ether bc:24:11:1d:82:f5 brd ff:ff:ff:ff:ff:ff 
</span></span></code></pre></div><p>This then gives me the option create Antrea Egress IP Pools with different subnets, separating them using VLAN, for my pods to use when in need of reaching out externally. **This means I can have my nodes residing on its own VLAN, and my Antrea Egress pools separated on completely different VLANs than my nodes. **</p>
<p>In the diagram below I have configured Antrea Egress with an ExternalIPPool using VLAN and a subnet defined to be 172.18.181.0/24. The nodes themselves reside on the subnet 10.160.1.0/24. So when I apply the Egress resource on a pod (using label selectors) it will grab a free IP from the ExternalIPPool and use an address from that subnet (172.18.181.0/24) when exiting the node. The other pods not configured with Egress resources will still use SNAT and translate their IP into the residing pods ip address (10.160.1.0/24).  This gives me great flexibility not only to control which pods needs to use Egress, but also the flexibility to specify dedicated IP addresses for certain pods to use when egressing, and I can even specify multiple different subnets (see note [here]((which may incur additional management overhead))) using several Antrea Egress IP pools and achieve additional separation to meet different requirements. Controlling access via my firewall makes life much easier as I can allow a specific pod/IP to reach certain services in one part of my environment, where another pod with another subnet defined reach other parts of my environment. Using VLAN also eliminate the need of configuring BGP from my worker nodes to my BGP routers (which may incur additional management overhead), a VLAN is often simpler to create and manage.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240418085954372.png"
        alt="pod-egress-vs-snat"
      />
      
    </figure>
</p>
<p>A very simple illustration on how my network is configured, for better context.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240417160828960.png"
        alt="network"
      />
      
    </figure>
</p>
<p>All my nodes are configured on a virtual port group using VLAN 216, using subnet 10.160.1.0/24 and my Egress pool is configured using VLAN 181. My switch is both L2 and L3, its configured with gateway interfaces for some of my networks and routes between the networks configured on the switch. All networks outside the switch is routed to my firewall using BGP.</p>


<h3 class="relative group">How to configure Antrea Egress using VLAN 
    <div id="how-to-configure-antrea-egress-using-vlan" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#how-to-configure-antrea-egress-using-vlan" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Now that I have explained how this new Antrea Egress works, its time to show how to configure it in my Kubernetes cluster.</p>
<p>The first requirement is that Antrea is on version 1.15.x. To check that execute the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~$ k <span class="nb">exec</span> -it -n kube-system antrea-controller-c47585dbf-6vdsl antctl version
</span></span><span class="line"><span class="cl">kubectl <span class="nb">exec</span> <span class="o">[</span>POD<span class="o">]</span> <span class="o">[</span>COMMAND<span class="o">]</span> is DEPRECATED and will be removed in a future version. Use kubectl <span class="nb">exec</span> <span class="o">[</span>POD<span class="o">]</span> -- <span class="o">[</span>COMMAND<span class="o">]</span> instead.
</span></span><span class="line"><span class="cl">antctlVersion: v1.15.1
</span></span><span class="line"><span class="cl">controllerVersion: v1.15.1
</span></span></code></pre></div><p>Then make sure you have configured the following feature gates in the Antrea configMap:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">antrea-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kube-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">antrea-agent.conf</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    featureGates:
</span></span></span><span class="line"><span class="cl"><span class="sd">      Egress: true
</span></span></span><span class="line"><span class="cl"><span class="sd">      EgressSeparateSubnet: true</span><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">antrea-controller.conf</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    featureGates:
</span></span></span><span class="line"><span class="cl"><span class="sd">      Egress: true</span><span class="w">    
</span></span></span></code></pre></div><p>After editing the Antrea configMap, restart the Antrea controller and agents so they can fetch the updated configMap:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">k rollout restart -n kube-system deployment/antrea-controller
</span></span><span class="line"><span class="cl">k delete pods -n kube-system -l <span class="nv">component</span><span class="o">=</span>antrea-agent
</span></span></code></pre></div><p>Now I need to create and apply an ExternalIPPool:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">crd.antrea.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ExternalIPPool</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">egress-vlan-external-ip-pool</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ipRanges</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">start</span><span class="p">:</span><span class="w"> </span><span class="m">172.18.181.40</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">end</span><span class="p">:</span><span class="w"> </span><span class="m">172.18.181.50</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">subnetInfo</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w"> </span><span class="m">172.18.181.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">prefixLength</span><span class="p">:</span><span class="w"> </span><span class="m">24</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">vlan</span><span class="p">:</span><span class="w"> </span><span class="m">181</span><span class="w"> </span><span class="c"># notice the VLAN setting here - this is a different VLAN than my nodes are using.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">egress-role</span><span class="p">:</span><span class="w"> </span><span class="l">egress-node</span><span class="w">
</span></span></span></code></pre></div><p>I am using a nodeSelector matching on the label egress-role=egress-node. So I will need to label the nodes I want to be used as Egress nodes, or all of them. The Egress object will failover to the next available node if the active one fails and if I have more than one node labeled accordingly. I can quickly showcase that a bit later.</p>
<p>If I check for any ExternalIPPools I should have one applied now:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get externalippools.crd.antrea.io
</span></span><span class="line"><span class="cl">NAME                           TOTAL   USED   AGE
</span></span><span class="line"><span class="cl">egress-vlan-external-ip-pool   <span class="m">11</span>      <span class="m">0</span>      23h
</span></span></code></pre></div><p>Then I will label my nodes:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">k label nodes k8s-node-vm-1-cl-02 egress-role<span class="o">=</span>egress-node
</span></span><span class="line"><span class="cl">k label nodes k8s-node-vm-2-cl-02 egress-role<span class="o">=</span>egress-node
</span></span><span class="line"><span class="cl">k label nodes k8s-node-vm-3-cl-02 egress-role<span class="o">=</span>egress-node
</span></span></code></pre></div><p>Now my three control plane nodes can be used as Egress nodes.</p>
<p>I can now apply the Egress resource itself, refering to my ExternalIPPool above, where I will select an Ubuntu pod I already have running:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">crd.antrea.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Egress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">egress-vlan</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">appliedTo</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">podSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">egress-1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">externalIPPool</span><span class="p">:</span><span class="w"> </span><span class="l">egress-vlan-external-ip-pool</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">status</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">egressNode</span><span class="p">:</span><span class="w"> </span><span class="l">k8s-node-vm-2-cl-02</span><span class="w">
</span></span></span></code></pre></div><p>In the appliedTo field I am using podSelector without namespace, so it is a clusterwide selection for any pods using the label app=egress-1. Then I select which ExternalIPPool to use. I am also specifying the preferred node as the Egress node, but as we will see later, if that one becomes unavailable it will failover to next available node.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get egress
</span></span><span class="line"><span class="cl">NAME          EGRESSIP        AGE   NODE
</span></span><span class="line"><span class="cl">egress-vlan   172.18.181.40   23h   k8s-node-vm-2-cl-02
</span></span></code></pre></div><p>And the ExternalIPPool now shows me:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get externalippools.crd.antrea.io
</span></span><span class="line"><span class="cl">NAME                           TOTAL   USED   AGE
</span></span><span class="line"><span class="cl">egress-vlan-external-ip-pool   <span class="m">11</span>      <span class="m">1</span>      23h
</span></span></code></pre></div><p>If I enter bash of my Ubuntu pod now and ping an external vm, it will use the IP address above (172.18.181.40).</p>
<p>Lets see:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240418150642586.png"
        alt="ping-with-egress"
      />
      
    </figure>
</p>
<p>And just to show that my nodes are using subnet 10.160.1.0/24:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get nodes -o wide
</span></span><span class="line"><span class="cl">NAME                  STATUS   ROLES           AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION       CONTAINER-RUNTIME
</span></span><span class="line"><span class="cl">k8s-cp-vm-1-cl-02     Ready    control-plane   66d   v1.28.5   10.160.1.21   &lt;none&gt;        Ubuntu 22.04.3 LTS   5.15.0-102-generic   containerd://1.7.13
</span></span><span class="line"><span class="cl">k8s-cp-vm-2-cl-02     Ready    control-plane   66d   v1.28.5   10.160.1.22   &lt;none&gt;        Ubuntu 22.04.3 LTS   5.15.0-102-generic   containerd://1.7.13
</span></span><span class="line"><span class="cl">k8s-cp-vm-3-cl-02     Ready    control-plane   66d   v1.28.5   10.160.1.23   &lt;none&gt;        Ubuntu 22.04.3 LTS   5.15.0-102-generic   containerd://1.7.13
</span></span><span class="line"><span class="cl">k8s-node-vm-1-cl-02   Ready    &lt;none&gt;          66d   v1.28.5   10.160.1.25   &lt;none&gt;        Ubuntu 22.04.3 LTS   5.15.0-102-generic   containerd://1.7.13
</span></span><span class="line"><span class="cl">k8s-node-vm-2-cl-02   Ready    &lt;none&gt;          66d   v1.28.5   10.160.1.26   &lt;none&gt;        Ubuntu 22.04.3 LTS   5.15.0-102-generic   containerd://1.7.13
</span></span><span class="line"><span class="cl">k8s-node-vm-3-cl-02   Ready    &lt;none&gt;          66d   v1.28.5   10.160.1.27   &lt;none&gt;        Ubuntu 22.04.3 LTS   5.15.0-102-generic   containerd://1.7.13
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get pod -n egress -owide
</span></span><span class="line"><span class="cl">NAME                            READY   STATUS    RESTARTS   AGE   IP           NODE                  NOMINATED NODE   READINESS GATES
</span></span><span class="line"><span class="cl">ubuntu-20-04-59d474f9df-dv9ms   1/1     Running   <span class="m">0</span>          28h   10.30.67.5   k8s-node-vm-1-cl-02   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>Thats it. Works beautifully.</p>
<p>On the node that is currently my Egress node, I will now have a interface called <strong>antrea-ext.181@eth0</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ubuntu@k8s-node-vm-2-cl-02:~$ ip link
</span></span><span class="line"><span class="cl">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="m">65536</span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="cl">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class="line"><span class="cl">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel state UP mode DEFAULT group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="cl">    link/ether bc:24:11:1d:82:f5 brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">    altname enp0s18
</span></span><span class="line"><span class="cl">3: kube-ipvs0: &lt;BROADCAST,NOARP&gt; mtu <span class="m">1500</span> qdisc noop state DOWN mode DEFAULT group default
</span></span><span class="line"><span class="cl">    link/ether d6:a1:1d:13:12:8e brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">4: ovs-system: &lt;BROADCAST,MULTICAST&gt; mtu <span class="m">1500</span> qdisc noop state DOWN mode DEFAULT group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="cl">    link/ether 6a:31:ff:05:ab:b1 brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">5: genev_sys_6081: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">65000</span> qdisc noqueue master ovs-system state UNKNOWN mode DEFAULT group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="cl">    link/ether 1a:53:a9:d8:ba:e2 brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">6: antrea-gw0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1450</span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="cl">    link/ether 62:d1:4b:2d:7b:4d brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">7: antrea-egress0: &lt;BROADCAST,NOARP&gt; mtu <span class="m">1500</span> qdisc noop state DOWN mode DEFAULT group default
</span></span><span class="line"><span class="cl">    link/ether 72:a2:89:52:08:32 brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">9: yelb-db--81d702@if2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1450</span> qdisc noqueue master ovs-system state UP mode DEFAULT group default
</span></span><span class="line"><span class="cl">    link/ether e6:8d:cb:ac:21:66 brd ff:ff:ff:ff:ff:ff link-netns cni-28ac3a0f-cfd6-4823-286a-2334edb7a11c
</span></span><span class="line"><span class="cl">10: yelb-app-1534fc@if2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1450</span> qdisc noqueue master ovs-system state UP mode DEFAULT group default
</span></span><span class="line"><span class="cl">    link/ether c6:97:db:c1:97:dd brd ff:ff:ff:ff:ff:ff link-netns cni-3fd6788c-d5e8-8a41-4a2b-e9d622c43a9e
</span></span><span class="line"><span class="cl">11: antrea-ext.181@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc noqueue state UP mode DEFAULT group default
</span></span><span class="line"><span class="cl">    link/ether bc:24:11:1d:82:f5 brd ff:ff:ff:ff:ff:ff
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ubuntu@k8s-node-vm-2-cl-02:~$ ip addr
</span></span><span class="line"><span class="cl">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="m">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="cl">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class="line"><span class="cl">    inet 127.0.0.1/8 scope host lo
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">    inet6 ::1/128 scope host
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel state UP group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="cl">    link/ether bc:24:11:1d:82:f5 brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">    altname enp0s18
</span></span><span class="line"><span class="cl">    inet 10.160.1.26/24 brd 10.160.1.255 scope global eth0
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">    inet6 fe80::be24:11ff:fe1d:82f5/64 scope link
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">8: antrea-ext.181@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc noqueue state UP group default
</span></span><span class="line"><span class="cl">    link/ether bc:24:11:1d:82:f5 brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">    inet 172.18.181.40/24 brd 172.18.181.255 scope global antrea-ext.181
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">    inet6 fe80::be24:11ff:fe1d:82f5/64 scope link
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span></code></pre></div><div class="notice info">
<p>This interface uses a real VLAN tag. So the port group and the underlaying switch this node is connected to must allow VLAN tags.</p>
</div>
<p>Just a comment to the above. In my environment I am using Proxmox to host my Kubernetes nodes. I am tagging the &ldquo;port-group&rdquo; the actual VM is residing on, but I am also allowing certain other VLANs as trunks on the same port. So if I do &ldquo;guest&rdquo; tagging, aka tagging inside the VM the port group needs to respect and forward that tag. The way I solved this with Proxmox was to edit the VM config adding the &ldquo;trunks=181;216&rdquo; in the line below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">net0: <span class="nv">virtio</span><span class="o">=</span>BC:24:11:1D:82:F5,bridge<span class="o">=</span>vmbr0,firewall<span class="o">=</span>0,tag<span class="o">=</span>216,trunks<span class="o">=</span>181<span class="p">;</span><span class="m">216</span>
</span></span></code></pre></div><p>The VM needs to be powercycled for this to take effect.</p>


<h3 class="relative group">Antrea Egress failover 
    <div id="antrea-egress-failover" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#antrea-egress-failover" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>As mentioned above, if my current Egress node fails the Egress gateway will move over to next available node. Let me poweroff the current Egress node and see what happens:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Before powering off</span>
</span></span><span class="line"><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get egress
</span></span><span class="line"><span class="cl">NAME          EGRESSIP        AGE   NODE
</span></span><span class="line"><span class="cl">egress-vlan   172.18.181.40   23h   k8s-node-vm-2-cl-02
</span></span><span class="line"><span class="cl"><span class="c1"># After powered off</span>
</span></span><span class="line"><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get egress
</span></span><span class="line"><span class="cl">NAME          EGRESSIP        AGE   NODE
</span></span><span class="line"><span class="cl">egress-vlan   172.18.181.40   23h   k8s-node-vm-3-cl-02
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Node status</span>
</span></span><span class="line"><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get nodes
</span></span><span class="line"><span class="cl">NAME                  STATUS     ROLES           AGE   VERSION
</span></span><span class="line"><span class="cl">k8s-cp-vm-1-cl-02     Ready      control-plane   66d   v1.28.5
</span></span><span class="line"><span class="cl">k8s-cp-vm-2-cl-02     Ready      control-plane   66d   v1.28.5
</span></span><span class="line"><span class="cl">k8s-cp-vm-3-cl-02     Ready      control-plane   66d   v1.28.5
</span></span><span class="line"><span class="cl">k8s-node-vm-1-cl-02   Ready      &lt;none&gt;          66d   v1.28.5
</span></span><span class="line"><span class="cl">k8s-node-vm-2-cl-02   NotReady   &lt;none&gt;          66d   v1.28.5
</span></span><span class="line"><span class="cl">k8s-node-vm-3-cl-02   Ready      &lt;none&gt;          66d   v1.28.5
</span></span></code></pre></div><p>The failover is pretty quick too.</p>
<p>As soon as the node-2 is back online again the Egress will revert back again, because I have declared it to be on the node-2 in my ExternalIPPool config:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get egress -w
</span></span><span class="line"><span class="cl">NAME          EGRESSIP        AGE   NODE
</span></span><span class="line"><span class="cl">egress-vlan   172.18.181.40   23h   k8s-node-vm-3-cl-02
</span></span><span class="line"><span class="cl">egress-vlan   172.18.181.40   23h   k8s-node-vm-2-cl-02
</span></span></code></pre></div>

<h2 class="relative group">Kube-Proxy vs Antrea Proxy 
    <div id="kube-proxy-vs-antrea-proxy" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#kube-proxy-vs-antrea-proxy" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>This chapter is kind of important to cover before I continue with the next Antrea features as this may have impact on how some of these features operate, and can operate. One should have some understanding of Kube-Proxy and Antrea-Proxy</p>
<p>Comparing kube-proxy and AntreaProxy involves looking at how each handles service traffic management within a Kubernetes cluster.</p>
<p><strong>Kube-Proxy</strong></p>
<ul>
<li>Kube-proxy is running in the Kubernetes cluster as Daemonsets - Kube-Proxy runs in Userspace</li>
</ul>
<ul>
<li>
<p>Kube-proxy is a default component in Kubernetes responsible for IP address translation and load balancing services within the cluster.</p>
</li>
<li>
<p>It can use iptables or IPVS (nftables alpha in k8s 1.29), each with different performance characteristics.</p>
</li>
<li>
<p>The iptables mode is commonly used due to its reliability and moderate performance, managing rules that route traffic to backend pods. IPtables runs in userspace.</p>
</li>
<li>
<p>IPVS mode is known for better performance in large-scale environments because it handles traffic at the kernel level with less overhead than iptables. IPVS runs in Kernelspace</p>
</li>
<li>
<p>While kube-proxy is suitable for many Kubernetes environments, its performance can degrade as the number of services and endpoints increases, especially in iptables mode.</p>
</li>
<li>
<p>Deeply integrated into Kubernetes, kube-proxy watches the Kubernetes API for changes to services and endpoints and updates its rules accordingly.</p>
</li>
</ul>
<p><strong>AntreaProxy</strong></p>
<ul>
<li>
<p>AntreaProxy is part of the Antrea CNI, designed to handle all Kubernetes service traffic using Open vSwitch (OVS) for more efficient packet processing.</p>
</li>
<li>
<p>When enabled, it can completely replace kube-proxy by managing service traffic routing directly at the data plane level within each node.</p>
</li>
<li>
<p>Handles traffic using OVS, which can be more efficient in packet processing compared to traditional iptables. This is beneficial for high-throughput and low-latency network environments.</p>
</li>
<li>
<p>Designed to offer better scalability and performance in large-scale Kubernetes deployments due to its efficient handling of traffic at the OVS level.</p>
</li>
<li>
<p>Integrates with Kubernetes but requires Antrea as the CNI. It monitors the Kubernetes API for changes to services and endpoints, similar to kube-proxy, but uses OVS flow rules instead of IPVS or iptables.</p>
</li>
</ul>
<p><strong>Key Differences</strong></p>
<ul>
<li><strong>Traffic Handling</strong>: Kube-proxy can use iptables or IPVS to manage traffic, which involves modifying Linux networking rules. AntreaProxy uses OVS to direct traffic, which can bypass some of the overhead associated with iptables or IPVS.</li>
<li><strong>Dependency</strong>: Kube-proxy is a standalone component within Kubernetes, while AntreaProxy is part of the Antrea CNI and requires its installation.</li>
<li><strong>Performance and Scalability</strong>: AntreaProxy generally offers better performance and scalability due to its use of OVS, particularly in environments with high numbers of services and endpoints.</li>
</ul>
<p>The choice between kube-proxy and AntreaProxy often comes down to the specific requirements of a Kubernetes deployment, such as scale, performance, and the preferred networking approach.</p>


<h3 class="relative group">AntreaProxy AND Kube-Proxy together 
    <div id="antreaproxy-and-kube-proxy-together" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#antreaproxy-and-kube-proxy-together" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>AntreaProxy is enabled by default since Antrea version v0.11. When the Antrea feature gate <em>antreaProxy</em> is set to <em>true</em> Antrea will provide service loadbalancing for ClusterIP services in OVS instead of using kube-proxy and only applies to traffic coming from pods to ClusterIP services. This means we still need to have Kube-Proxy for other services, such as NodePort (external to cluster service) and node to all cluster services (including hostNetwork pods). This is a default setup. Antrea can also act as the only proxy in a Kubernetes cluster, more on that in a chapter later.</p>
<p>When traffic enters the Kubernetes cluster, eg serviceType Loadbalancer or NodePort, or node to service it will be handled by kube-proxy. Traffic originating from a pod to a cluster-service will be handled by AntreaProxy.</p>
<p>An illustration of what AntreaProxy handles when the feature gate AntreaProxy is set to true:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240422103533076.png"
        alt="antreaproxy-enabled"
      />
      
    </figure>
</p>
<p><em>Stipulated lines illustrates the actual packet-flow, while the non-stipulated lines indicate which component being involved in the Kubernetes cluster to &ldquo;prepare&rdquo; for the forwarding of the packet from the yelb-ui pod to the yelb-app service.</em></p>
<p>The below diagrams explains what kube-proxy handles when the AntreaProxy is enabled:</p>
<p><strong>Node to service</strong></p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240422103454372.png"
        alt="node-to-service"
      />
      
    </figure>
</p>
<p><strong>External to service</strong></p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240422103643126.png"
        alt="external-to-service"
      />
      
    </figure>
</p>
<p>With both AntreaProxy and kube-proxy enabled at the same time we end up having two daemons with each their ruleset to forward traffic inside the Kubernetes cluster like this:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240429085611322.png"
        alt="antproxy-kubeproxy"
      />
      
    </figure>
</p>


<h3 class="relative group">AntreaProxy All 
    <div id="antreaproxy-all" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#antreaproxy-all" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>As mentioned above, there is no need to have both kube-proxy and AntreaProxy. One can remove kube-proxy completely. AntreaProxy can handle all services, external and internal, node to service, external to service, NodePort etc.</p>
<p>To enable AntreaProxy all the following feature-gate needs to be enabled:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">antrea-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kube-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">antreaProxy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">proxyAll</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><p>With AntreaProxy all is enabled kube-proxy is not automatically removed (if one have a Kubernetes cluster with kube-proxy deployed). So in a cluster with kube-proxy already running, there is a couple of steps that needs to be done to remove kube-proxy and enable AntreaProxy all.</p>
<p>If one enables AntreaProxy:all and Kube-Proxy is still there, Kube-Proxy will take precedence. There is two ways to delete kube-proxy, during cluster bootstrap (<code>kubeadm init --skip-phases=addon/kube-proxy</code>) or post cluster bootstrap. Below I will go through how to delete kube-proxy on a already running cluster with kube-proxy already deployed.</p>
<p>I will follow the offical documentation from Antrea Github repo [here](kubectl -n kube-system delete ds/kube-proxy):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Delete the kube-proxy DaemonSet</span>
</span></span><span class="line"><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ kubectl -n kube-system delete ds/kube-proxy
</span></span><span class="line"><span class="cl">daemonset.apps <span class="s2">&#34;kube-proxy&#34;</span> deleted
</span></span><span class="line"><span class="cl"><span class="c1"># Delete the kube-proxy ConfigMap to prevent kube-proxy from being re-deployed</span>
</span></span><span class="line"><span class="cl"><span class="c1"># by kubeadm during &#34;upgrade apply&#34;. This workaround will not take effect for</span>
</span></span><span class="line"><span class="cl"><span class="c1"># kubeadm versions older than v1.19 as the following patch is required:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://github.com/kubernetes/kubernetes/pull/89593</span>
</span></span><span class="line"><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ kubectl -n kube-system delete cm/kube-proxy
</span></span><span class="line"><span class="cl">configmap <span class="s2">&#34;kube-proxy&#34;</span> deleted
</span></span><span class="line"><span class="cl"><span class="c1"># Delete existing kube-proxy rules; there are several options for doing that</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Option 1 (if using kube-proxy in iptables mode), run the following on each Node:</span>
</span></span><span class="line"><span class="cl">iptables-save <span class="p">|</span> grep -v KUBE <span class="p">|</span> iptables-restore
</span></span><span class="line"><span class="cl"><span class="c1"># This option is not valid for me as I use IPVS</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Option 2 (any mode), restart all Nodes # I chose this option</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Option 3 (any mode), run the following on each Node:</span>
</span></span><span class="line"><span class="cl">kube-proxy --cleanup 
</span></span><span class="line"><span class="cl"><span class="c1"># You can create a DaemonSet to easily run the above command on all Nodes, using</span>
</span></span><span class="line"><span class="cl"><span class="c1"># the kube-proxy container image</span>
</span></span></code></pre></div><p>After the steps above (icluding the restart of all nodes) I will need to edit the Antrea ConfigMap with the following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">antrea-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kube-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">antrea-agent.conf</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    kubeAPIServerOverride: &#34;https://k8s-dev-cluster-3.domain.int&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">    antreaProxy:
</span></span></span><span class="line"><span class="cl"><span class="sd">      proxyAll: true</span><span class="w">    
</span></span></span></code></pre></div><p>Last step is to restart the Antrea controller and Antrea agents and see if they come up again.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">k rollout restart -n kube-system deployment/antrea-controller
</span></span><span class="line"><span class="cl">k delete pods -n kube-system -l <span class="nv">component</span><span class="o">=</span>antrea-agent
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get pods -A
</span></span><span class="line"><span class="cl">NAMESPACE     NAME                                        READY   STATUS    RESTARTS        AGE
</span></span><span class="line"><span class="cl">kube-system   antrea-agent-7pc6r                          2/2     Running   <span class="m">0</span>               37s
</span></span><span class="line"><span class="cl">kube-system   antrea-agent-b6c58                          2/2     Running   <span class="m">0</span>               37s
</span></span><span class="line"><span class="cl">kube-system   antrea-agent-pj62z                          2/2     Running   <span class="m">0</span>               37s
</span></span><span class="line"><span class="cl">kube-system   antrea-agent-rcckh                          2/2     Running   <span class="m">0</span>               37s
</span></span><span class="line"><span class="cl">kube-system   antrea-agent-tftv5                          2/2     Running   <span class="m">0</span>               37s
</span></span><span class="line"><span class="cl">kube-system   antrea-agent-twpfs                          2/2     Running   <span class="m">0</span>               38s
</span></span><span class="line"><span class="cl">kube-system   antrea-controller-6bd6b9569c-vhx7n          1/1     Running   <span class="m">0</span>               50s
</span></span></code></pre></div><p>No kube-proxy pods:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get pods -A
</span></span><span class="line"><span class="cl">NAMESPACE     NAME                                        READY   STATUS    RESTARTS        AGE
</span></span><span class="line"><span class="cl">kube-system   antrea-agent-7pc6r                          2/2     Running   <span class="m">0</span>               72s
</span></span><span class="line"><span class="cl">kube-system   antrea-agent-b6c58                          2/2     Running   <span class="m">0</span>               72s
</span></span><span class="line"><span class="cl">kube-system   antrea-agent-pj62z                          2/2     Running   <span class="m">0</span>               72s
</span></span><span class="line"><span class="cl">kube-system   antrea-agent-rcckh                          2/2     Running   <span class="m">0</span>               72s
</span></span><span class="line"><span class="cl">kube-system   antrea-agent-tftv5                          2/2     Running   <span class="m">0</span>               72s
</span></span><span class="line"><span class="cl">kube-system   antrea-agent-twpfs                          2/2     Running   <span class="m">0</span>               73s
</span></span><span class="line"><span class="cl">kube-system   antrea-controller-6bd6b9569c-vhx7n          1/1     Running   <span class="m">0</span>               85s
</span></span><span class="line"><span class="cl">kube-system   coredns-77f7cc69db-jnh6m                    1/1     Running   <span class="m">1</span> <span class="o">(</span>9m36s ago<span class="o">)</span>   21h
</span></span><span class="line"><span class="cl">kube-system   coredns-77f7cc69db-wb5qs                    1/1     Running   <span class="m">1</span> <span class="o">(</span>9m3s ago<span class="o">)</span>    21h
</span></span><span class="line"><span class="cl">kube-system   dns-autoscaler-8576bb9f5b-5n7hv             1/1     Running   <span class="m">1</span> <span class="o">(</span>9m36s ago<span class="o">)</span>   21h
</span></span><span class="line"><span class="cl">kube-system   kube-apiserver-k8s-cp-vm-1-cl-03            1/1     Running   <span class="m">3</span> <span class="o">(</span>8m55s ago<span class="o">)</span>   21h
</span></span><span class="line"><span class="cl">kube-system   kube-apiserver-k8s-cp-vm-2-cl-03            1/1     Running   <span class="m">2</span> <span class="o">(</span>9m36s ago<span class="o">)</span>   21h
</span></span><span class="line"><span class="cl">kube-system   kube-apiserver-k8s-cp-vm-3-cl-03            1/1     Running   <span class="m">2</span> <span class="o">(</span>9m3s ago<span class="o">)</span>    21h
</span></span><span class="line"><span class="cl">kube-system   kube-controller-manager-k8s-cp-vm-1-cl-03   1/1     Running   <span class="m">4</span> <span class="o">(</span>9m16s ago<span class="o">)</span>   21h
</span></span><span class="line"><span class="cl">kube-system   kube-controller-manager-k8s-cp-vm-2-cl-03   1/1     Running   <span class="m">4</span> <span class="o">(</span>9m36s ago<span class="o">)</span>   21h
</span></span><span class="line"><span class="cl">kube-system   kube-controller-manager-k8s-cp-vm-3-cl-03   1/1     Running   <span class="m">4</span> <span class="o">(</span>9m3s ago<span class="o">)</span>    21h
</span></span><span class="line"><span class="cl">kube-system   kube-scheduler-k8s-cp-vm-1-cl-03            1/1     Running   <span class="m">3</span> <span class="o">(</span>8m45s ago<span class="o">)</span>   21h
</span></span><span class="line"><span class="cl">kube-system   kube-scheduler-k8s-cp-vm-2-cl-03            1/1     Running   <span class="m">2</span> <span class="o">(</span>9m36s ago<span class="o">)</span>   21h
</span></span><span class="line"><span class="cl">kube-system   kube-scheduler-k8s-cp-vm-3-cl-03            1/1     Running   <span class="m">3</span> <span class="o">(</span>9m3s ago<span class="o">)</span>    21h
</span></span></code></pre></div><p>No &ldquo;kube-ipvs0&rdquo; interface:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ubuntu@k8s-node-vm-1-cl-03:~$ ip addr
</span></span><span class="line"><span class="cl">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="m">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="cl">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class="line"><span class="cl">    inet 127.0.0.1/8 scope host lo
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">    inet6 ::1/128 scope host
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel state UP group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="cl">    link/ether bc:24:11:f4:ee:ef brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">    altname enp0s18
</span></span><span class="line"><span class="cl">    inet 10.160.1.35/24 brd 10.160.1.255 scope global eth0
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">    inet6 fe80::be24:11ff:fef4:eeef/64 scope link
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">3: ovs-system: &lt;BROADCAST,MULTICAST&gt; mtu <span class="m">1500</span> qdisc noop state DOWN group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="cl">    link/ether ee:a3:e7:de:7d:3c brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">4: genev_sys_6081: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">65000</span> qdisc noqueue master ovs-system state UNKNOWN group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="cl">    link/ether e6:09:e7:ee:1f:fc brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">    inet6 fe80::64c1:4aff:fe4d:f8b2/64 scope link
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">5: antrea-gw0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1450</span> qdisc noqueue state UNKNOWN group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="cl">    link/ether 62:78:99:77:56:60 brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">    inet 10.40.68.1/24 brd 10.40.68.255 scope global antrea-gw0
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">    inet6 fe80::6078:99ff:fe77:5660/64 scope link
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">6: antrea-egress0: &lt;BROADCAST,NOARP&gt; mtu <span class="m">1500</span> qdisc noop state DOWN group default
</span></span><span class="line"><span class="cl">    link/ether 3e:77:85:e2:e2:1a brd ff:ff:ff:ff:ff:ff
</span></span></code></pre></div><p>With that out of the way, lets continue on the Antrea features.</p>


<h2 class="relative group">Antrea ServiceExternalIP 
    <div id="antrea-serviceexternalip" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#antrea-serviceexternalip" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>ServiceExternalIP is a feature in Antrea to provide external IP addresses for serviceType LoadBalancer. This feature is useful when there is no external/cloud/3rd party loadbalancer available to provide these external IP addresses.</p>
<p>Today ServiceExternalIP supports ip addresses allocated from the same subnet (L2) as the Kubernetes nodes, by reserving a range of addresses for this use. It also supports a different subnet (L3) than the Kubernetes nodes themselves but one have to define static routes (host routes x.x.x.x/32) in the underlaying router/gateway to one or several of the nodes in your Kubernetes Cluster.  After I apply a service using ServiceExternalIP all nodes will be aware of this IP address and handle requests to the service regardless of which host receives them.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># worker node 2</span>
</span></span><span class="line"><span class="cl">ubuntu@k8s-node-vm-2-cl-02:~$ ip addr
</span></span><span class="line"><span class="cl">3: kube-ipvs0: &lt;BROADCAST,NOARP&gt; mtu <span class="m">1500</span> qdisc noop state DOWN group default
</span></span><span class="line"><span class="cl">    link/ether d6:a1:1d:13:12:8e brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">    inet 10.169.1.40/32 scope global kube-ipvs0 <span class="c1"># IP from my ExternalIPPool</span>
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># worker node 1</span>
</span></span><span class="line"><span class="cl">ubuntu@k8s-node-vm-1-cl-02:~$ ip addr
</span></span><span class="line"><span class="cl">3: kube-ipvs0: &lt;BROADCAST,NOARP&gt; mtu <span class="m">1500</span> qdisc noop state DOWN group default
</span></span><span class="line"><span class="cl">    link/ether a6:bf:87:cc:53:cc brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">    inet 10.169.1.40/32 scope global kube-ipvs0
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever <span class="c1"># IP from my ExternalIPPool</span>
</span></span></code></pre></div><p>And here one can see IPVS is handling this IP and is available on all nodes (if using kube-proxy with IPVS). So creating a static route and pointing to any of my Kubernetes nodes will get me to the service.</p>
<div class="notice info">
<p>When it comes to failure of a node and this happens to be the node you defined as the nexthop you will ofcourse loose access. One could add several routes using cost/distance, but this will not always solve the issue as the router/switch does not really know that the node is gone. It will be kept in the ARP table, and as long as its there (it may be drained after a while), the switch will continue forward traffic to it. This may ofcourse depend on router/switch also which features are implemented and can be used using static routes. There is no BFD, and a VM is not actually disconnecting anything if it goes down.</p>
</div>
<p>ServiceExternalIP will work with Kube-Proxy using IPVS or IPTables and AntreaProxy where there is no Kube-Proxy.  If using Kube-Proxy with IPVS <em>strictARP</em> must be enabled in the kube-proxy config:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># configMap kube-proxy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">config.conf</span><span class="p">:</span><span class="w"> </span><span class="p">|-</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    apiVersion: kubeproxy.config.k8s.io/v1alpha1
</span></span></span><span class="line"><span class="cl"><span class="sd">    ipvs:
</span></span></span><span class="line"><span class="cl"><span class="sd">      excludeCIDRs: []
</span></span></span><span class="line"><span class="cl"><span class="sd">      minSyncPeriod: 0s
</span></span></span><span class="line"><span class="cl"><span class="sd">      scheduler: rr
</span></span></span><span class="line"><span class="cl"><span class="sd">      strictARP: true # set to true
</span></span></span><span class="line"><span class="cl"><span class="sd">      syncPeriod: 30s
</span></span></span><span class="line"><span class="cl"><span class="sd">      tcpFinTimeout: 0s
</span></span></span><span class="line"><span class="cl"><span class="sd">      tcpTimeout: 0s
</span></span></span><span class="line"><span class="cl"><span class="sd">      udpTimeout: 0s</span><span class="w">    
</span></span></span></code></pre></div><p>Below I will go through ServiceExternalIP using kube-proxy and only AntreaProxy</p>


<h3 class="relative group">ServiceExternalIP using Kube-Proxy and IPVS (IP Virtual Server) 
    <div id="serviceexternalip-using-kube-proxy-and-ipvs-ip-virtual-server" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#serviceexternalip-using-kube-proxy-and-ipvs-ip-virtual-server" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>When using kube-proxy with IPVS kube-proxy sets up and manage the IPVS rules. IPVS residing in the Linux Kernel is then responsible for directing incoming traffic to backend pods, as in my digram below the Yelb-UI pods.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240419131227703.png"
        alt="kube-proxy-ipvs"
      />
      
    </figure>
</p>
<p><em>Kube-proxy listens on incoming traffic, IPVS forwards the traffic to the corresponding backend-pods.</em></p>
<p>The service and corresponding endpoints:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k describe svc -n yelb yelb-ui
</span></span><span class="line"><span class="cl">Name:                     yelb-ui
</span></span><span class="line"><span class="cl">Namespace:                yelb
</span></span><span class="line"><span class="cl">Labels:                   <span class="nv">app</span><span class="o">=</span>yelb-ui
</span></span><span class="line"><span class="cl">                          <span class="nv">tier</span><span class="o">=</span>frontend
</span></span><span class="line"><span class="cl">Annotations:              service.antrea.io/external-ip-pool: service-external-ip-pool
</span></span><span class="line"><span class="cl">Selector:                 <span class="nv">app</span><span class="o">=</span>yelb-ui,tier<span class="o">=</span>frontend
</span></span><span class="line"><span class="cl">Type:                     LoadBalancer
</span></span><span class="line"><span class="cl">IP Family Policy:         SingleStack
</span></span><span class="line"><span class="cl">IP Families:              IPv4
</span></span><span class="line"><span class="cl">IP:                       10.30.48.237
</span></span><span class="line"><span class="cl">IPs:                      10.30.48.237
</span></span><span class="line"><span class="cl">LoadBalancer Ingress:     10.169.1.40
</span></span><span class="line"><span class="cl">Port:                     &lt;unset&gt;  80/TCP
</span></span><span class="line"><span class="cl">TargetPort:               80/TCP
</span></span><span class="line"><span class="cl">NodePort:                 &lt;unset&gt;  32611/TCP
</span></span><span class="line"><span class="cl">Endpoints:                10.30.67.5:80,10.30.68.6:80,10.30.69.2:80
</span></span><span class="line"><span class="cl">Session Affinity:         None
</span></span><span class="line"><span class="cl">External Traffic Policy:  Cluster
</span></span><span class="line"><span class="cl">Events:                   &lt;none&gt;
</span></span></code></pre></div><p>The pods, representing the endpoints:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get pods -n yelb -owide
</span></span><span class="line"><span class="cl">NAME                            READY   STATUS    RESTARTS      AGE     IP           NODE                  NOMINATED NODE   READINESS GATES
</span></span><span class="line"><span class="cl">yelb-ui-f544fc74f-mb5m6         1/1     Running   <span class="m">0</span>             41m     10.30.68.6   k8s-node-vm-2-cl-02   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">yelb-ui-f544fc74f-pztht         1/1     Running   <span class="m">0</span>             2m37s   10.30.67.5   k8s-node-vm-1-cl-02   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">yelb-ui-f544fc74f-r48rx         1/1     Running   <span class="m">0</span>             2m37s   10.30.69.2   k8s-node-vm-3-cl-02   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>The IPVS loadbalancing in action:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ubuntu@k8s-node-vm-1-cl-02:~$ sudo ipvsadm -l
</span></span><span class="line"><span class="cl">IP Virtual Server version 1.2.1 <span class="o">(</span><span class="nv">size</span><span class="o">=</span>4096<span class="o">)</span>
</span></span><span class="line"><span class="cl">Prot LocalAddress:Port Scheduler Flags
</span></span><span class="line"><span class="cl">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn
</span></span><span class="line"><span class="cl">TCP  k8s-node-vm-1-cl-02:32611 rr
</span></span><span class="line"><span class="cl">  -&gt; 10-30-67-5.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="cl">  -&gt; 10-30-68-6.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="cl">  -&gt; 10-30-69-2.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="cl">TCP  k8s-node-vm-1-cl-02.cluster. rr
</span></span><span class="line"><span class="cl">  -&gt; 10-30-67-5.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="cl">  -&gt; 10-30-68-6.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="cl">  -&gt; 10-30-69-2.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="cl">TCP  k8s-node-vm-1-cl-02:http rr
</span></span><span class="line"><span class="cl">  -&gt; 10-30-67-5.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="cl">  -&gt; 10-30-68-6.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="cl">  -&gt; 10-30-69-2.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># All IPs involved in the yelb-ui service, pod, service etc</span>
</span></span><span class="line"><span class="cl">ubuntu@k8s-node-vm-3-cl-02:~$ sudo ipvsadm -L -n
</span></span><span class="line"><span class="cl">IP Virtual Server version 1.2.1 <span class="o">(</span><span class="nv">size</span><span class="o">=</span>4096<span class="o">)</span>
</span></span><span class="line"><span class="cl">Prot LocalAddress:Port Scheduler Flags
</span></span><span class="line"><span class="cl">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn
</span></span><span class="line"><span class="cl">TCP  10.30.63.48:80 rr
</span></span><span class="line"><span class="cl">  -&gt; 10.30.68.3:80                Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="cl">TCP  10.30.69.1:31925 rr
</span></span><span class="line"><span class="cl">  -&gt; 10.30.68.3:80                Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="cl">TCP  10.160.1.27:31925 rr
</span></span><span class="line"><span class="cl">  -&gt; 10.30.68.3:80                Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="cl">TCP  10.169.1.40:80 rr
</span></span><span class="line"><span class="cl">  -&gt; 10.30.68.3:80                Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="cl">UDP  10.30.0.3:53 rr
</span></span><span class="line"><span class="cl">  -&gt; 10.30.65.3:53                Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">1</span>
</span></span><span class="line"><span class="cl">  -&gt; 10.30.66.2:53                Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">1</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get pods -n yelb -owide
</span></span><span class="line"><span class="cl">NAME                            READY   STATUS    RESTARTS      AGE    IP           NODE                  NOMINATED NODE   READINESS GATES
</span></span><span class="line"><span class="cl">redis-server-84f4bf49b5-lstpm   1/1     Running   <span class="m">2</span> <span class="o">(</span>4d ago<span class="o">)</span>    71d    10.30.67.4   k8s-node-vm-1-cl-02   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">yelb-appserver-6dc7cd98-4c6s5   1/1     Running   <span class="m">5</span> <span class="o">(</span>98m ago<span class="o">)</span>   71d    10.30.68.4   k8s-node-vm-2-cl-02   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">yelb-db-84d6f6fc6c-dlp68        1/1     Running   <span class="m">5</span> <span class="o">(</span>98m ago<span class="o">)</span>   71d    10.30.68.2   k8s-node-vm-2-cl-02   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">yelb-ui-f544fc74f-vm2b2         1/1     Running   <span class="m">1</span> <span class="o">(</span>98m ago<span class="o">)</span>   123m   10.30.68.3   k8s-node-vm-2-cl-02   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>Next chapter will cover how this looks with AntreaProxy all.</p>


<h3 class="relative group">ServiceExternalIP using only AntreaProxy. 
    <div id="serviceexternalip-using-only-antreaproxy" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#serviceexternalip-using-only-antreaproxy" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Using ServiceExternalIP with only AntreaProxy there will be no IPVS, no kube-proxy involved. All rules will be configured in OVS. If there is no kube-proxy configured in the cluster there is no pre-reqs (as above) that needs to be done. To get some insight in how that looks I will dump some output below.</p>
<p>The service and the corresponding endpoints:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~$ k describe svc -n yelb yelb-ui
</span></span><span class="line"><span class="cl">Name:                     yelb-ui
</span></span><span class="line"><span class="cl">Namespace:                yelb
</span></span><span class="line"><span class="cl">Labels:                   <span class="nv">app</span><span class="o">=</span>yelb-ui
</span></span><span class="line"><span class="cl">                          <span class="nv">tier</span><span class="o">=</span>frontend
</span></span><span class="line"><span class="cl">Annotations:              service.antrea.io/external-ip-pool: service-external-ip-pool
</span></span><span class="line"><span class="cl">Selector:                 <span class="nv">app</span><span class="o">=</span>yelb-ui,tier<span class="o">=</span>frontend
</span></span><span class="line"><span class="cl">Type:                     LoadBalancer
</span></span><span class="line"><span class="cl">IP Family Policy:         SingleStack
</span></span><span class="line"><span class="cl">IP Families:              IPv4
</span></span><span class="line"><span class="cl">IP:                       10.40.30.39
</span></span><span class="line"><span class="cl">IPs:                      10.40.30.39
</span></span><span class="line"><span class="cl">LoadBalancer Ingress:     10.160.1.40
</span></span><span class="line"><span class="cl">Port:                     &lt;unset&gt;  80/TCP
</span></span><span class="line"><span class="cl">TargetPort:               80/TCP
</span></span><span class="line"><span class="cl">NodePort:                 &lt;unset&gt;  31535/TCP
</span></span><span class="line"><span class="cl">Endpoints:                10.40.67.4:80,10.40.68.3:80,10.40.69.6:80
</span></span><span class="line"><span class="cl">Session Affinity:         None
</span></span><span class="line"><span class="cl">External Traffic Policy:  Cluster
</span></span><span class="line"><span class="cl">Events:                   &lt;none&gt;
</span></span></code></pre></div><p>The pods representing the endpoints:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~$ k get pods -n yelb -owide
</span></span><span class="line"><span class="cl">NAME                            READY   STATUS    RESTARTS   AGE     IP           NODE                  NOMINATED NODE   READINESS GATES
</span></span><span class="line"><span class="cl">redis-server-84f4bf49b5-j6g8x   1/1     Running   <span class="m">0</span>          5d22h   10.40.69.3   k8s-node-vm-3-cl-03   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">yelb-appserver-6dc7cd98-wlflx   1/1     Running   <span class="m">0</span>          5d22h   10.40.69.2   k8s-node-vm-3-cl-03   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">yelb-db-84d6f6fc6c-qr2kv        1/1     Running   <span class="m">0</span>          5d22h   10.40.67.2   k8s-node-vm-2-cl-03   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">yelb-ui-f544fc74f-d84gd         1/1     Running   <span class="m">0</span>          56s     10.40.69.6   k8s-node-vm-3-cl-03   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">yelb-ui-f544fc74f-kvvht         1/1     Running   <span class="m">0</span>          5d22h   10.40.67.4   k8s-node-vm-2-cl-03   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">yelb-ui-f544fc74f-xqhrk         1/1     Running   <span class="m">0</span>          56s     10.40.68.3   k8s-node-vm-1-cl-03   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>Output from IPVS:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ubuntu@k8s-node-vm-1-cl-03:~$ sudo ipvsadm -l
</span></span><span class="line"><span class="cl">IP Virtual Server version 1.2.1 <span class="o">(</span><span class="nv">size</span><span class="o">=</span>4096<span class="o">)</span>
</span></span><span class="line"><span class="cl">Prot LocalAddress:Port Scheduler Flags
</span></span><span class="line"><span class="cl">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn
</span></span></code></pre></div><p>So much empty..</p>
<p>How does the OVS tables look like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># endpoint pod 1:</span>
</span></span><span class="line"><span class="cl">root@k8s-node-vm-1-cl-03:/# ovs-ofctl dump-flows br-int <span class="p">|</span> grep 10.40.68.3
</span></span><span class="line"><span class="cl"> <span class="nv">cookie</span><span class="o">=</span>0x1010000000000, <span class="nv">duration</span><span class="o">=</span>433.630s, <span class="nv">table</span><span class="o">=</span>1, <span class="nv">n_packets</span><span class="o">=</span>4, <span class="nv">n_bytes</span><span class="o">=</span>168, <span class="nv">idle_age</span><span class="o">=</span>428, <span class="nv">priority</span><span class="o">=</span>200,arp,in_port<span class="o">=</span>4,arp_spa<span class="o">=</span>10.40.68.3,arp_sha<span class="o">=</span>6e:4d:5b:e4:99:c9 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,2<span class="o">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">cookie</span><span class="o">=</span>0x1010000000000, <span class="nv">duration</span><span class="o">=</span>433.630s, <span class="nv">table</span><span class="o">=</span>4, <span class="nv">n_packets</span><span class="o">=</span>25, <span class="nv">n_bytes</span><span class="o">=</span>4443, <span class="nv">idle_age</span><span class="o">=</span>2, <span class="nv">priority</span><span class="o">=</span>200,ip,in_port<span class="o">=</span>4,dl_src<span class="o">=</span>6e:4d:5b:e4:99:c9,nw_src<span class="o">=</span>10.40.68.3 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,5<span class="o">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">cookie</span><span class="o">=</span>0x1030000000000, <span class="nv">duration</span><span class="o">=</span>427.300s, <span class="nv">table</span><span class="o">=</span>12, <span class="nv">n_packets</span><span class="o">=</span>1, <span class="nv">n_bytes</span><span class="o">=</span>78, <span class="nv">idle_age</span><span class="o">=</span>10, <span class="nv">priority</span><span class="o">=</span>200,tcp,reg3<span class="o">=</span>0xa284403,reg4<span class="o">=</span>0x20050/0x7ffff <span class="nv">actions</span><span class="o">=</span>ct<span class="o">(</span>commit,table<span class="o">=</span>13,zone<span class="o">=</span>65520,nat<span class="o">(</span><span class="nv">dst</span><span class="o">=</span>10.40.68.3:80<span class="o">)</span>,exec<span class="o">(</span>load:0x1-&gt;NXM_NX_CT_MARK<span class="o">[</span>4<span class="o">]</span>,move:NXM_NX_REG0<span class="o">[</span>0..3<span class="o">]</span>-&gt;NXM_NX_CT_MARK<span class="o">[</span>0..3<span class="o">]))</span>
</span></span><span class="line"><span class="cl"> <span class="nv">cookie</span><span class="o">=</span>0x1010000000000, <span class="nv">duration</span><span class="o">=</span>433.630s, <span class="nv">table</span><span class="o">=</span>17, <span class="nv">n_packets</span><span class="o">=</span>28, <span class="nv">n_bytes</span><span class="o">=</span>5264, <span class="nv">idle_age</span><span class="o">=</span>2, <span class="nv">priority</span><span class="o">=</span>200,ip,reg0<span class="o">=</span>0x200/0x200,nw_dst<span class="o">=</span>10.40.68.3 <span class="nv">actions</span><span class="o">=</span>mod_dl_src:62:78:99:77:56:60,mod_dl_dst:6e:4d:5b:e4:99:c9,resubmit<span class="o">(</span>,19<span class="o">)</span>
</span></span><span class="line"><span class="cl"> <span class="nv">cookie</span><span class="o">=</span>0x1030000000000, <span class="nv">duration</span><span class="o">=</span>427.300s, <span class="nv">table</span><span class="o">=</span>20, <span class="nv">n_packets</span><span class="o">=</span>0, <span class="nv">n_bytes</span><span class="o">=</span>0, <span class="nv">idle_age</span><span class="o">=</span>427, <span class="nv">priority</span><span class="o">=</span>190,ct_state<span class="o">=</span>+new+trk,ip,nw_src<span class="o">=</span>10.40.68.3,nw_dst<span class="o">=</span>10.40.68.3 <span class="nv">actions</span><span class="o">=</span>ct<span class="o">(</span>commit,table<span class="o">=</span>21,zone<span class="o">=</span>65520,exec<span class="o">(</span>load:0x1-&gt;NXM_NX_CT_MARK<span class="o">[</span>5<span class="o">]</span>,load:0x1-&gt;NXM_NX_CT_MARK<span class="o">[</span>6<span class="o">]))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># endpoint pod 2:</span>
</span></span><span class="line"><span class="cl">root@k8s-node-vm-1-cl-03:/# ovs-ofctl dump-flows br-int <span class="p">|</span> grep 10.40.67.4
</span></span><span class="line"><span class="cl"> <span class="nv">cookie</span><span class="o">=</span>0x1030000000000, <span class="nv">duration</span><span class="o">=</span>512942.550s, <span class="nv">table</span><span class="o">=</span>12, <span class="nv">n_packets</span><span class="o">=</span>18, <span class="nv">n_bytes</span><span class="o">=</span>1404, <span class="nv">idle_age</span><span class="o">=</span>65534, <span class="nv">hard_age</span><span class="o">=</span>65534, <span class="nv">priority</span><span class="o">=</span>200,tcp,reg3<span class="o">=</span>0xa284304,reg4<span class="o">=</span>0x20050/0x7ffff <span class="nv">actions</span><span class="o">=</span>ct<span class="o">(</span>commit,table<span class="o">=</span>13,zone<span class="o">=</span>65520,nat<span class="o">(</span><span class="nv">dst</span><span class="o">=</span>10.40.67.4:80<span class="o">)</span>,exec<span class="o">(</span>load:0x1-&gt;NXM_NX_CT_MARK<span class="o">[</span>4<span class="o">]</span>,move:NXM_NX_REG0<span class="o">[</span>0..3<span class="o">]</span>-&gt;NXM_NX_CT_MARK<span class="o">[</span>0..3<span class="o">]))</span>
</span></span></code></pre></div>

<h2 class="relative group">L7FlowExporter - new in Antrea v.1.15.0 
    <div id="l7flowexporter---new-in-antrea-v1150" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#l7flowexporter---new-in-antrea-v1150" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>FlowExport in Antrea is something I have covered previously <a href="https://blog.andreasm.io/2023/06/01/managing-antrea-in-vsphere-with-tanzu/#flow-exporter---ipfix" target="_blank">here</a>, but this time I would like to have a look at the new Layer7 FlowExport. Lets configure it and see some flows with Layer7 information.</p>
<p>To be able to use the L7FlowExporter and get the additional L7 flow information I need to enable the <code>L7FlowExporter</code> feature gate. So in my Antrea configMap:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">antrea-agent.conf</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">      L7FlowExporter: true      </span><span class="w">      
</span></span></span></code></pre></div><p>Restart Antrea controller and agents:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~$ k edit configmaps -n kube-system antrea-config
</span></span><span class="line"><span class="cl">configmap/antrea-config edited
</span></span><span class="line"><span class="cl">andreasm@linuxmgmt01:~$ k rollout restart -n kube-system deployment/antrea-controller
</span></span><span class="line"><span class="cl">deployment.apps/antrea-controller restarted
</span></span><span class="line"><span class="cl">andreasm@linuxmgmt01:~$ k delete pods -n kube-system -l <span class="nv">component</span><span class="o">=</span>antrea-agent
</span></span><span class="line"><span class="cl">pod <span class="s2">&#34;antrea-agent-4wtgw&#34;</span> deleted
</span></span><span class="line"><span class="cl">pod <span class="s2">&#34;antrea-agent-8gjvw&#34;</span> deleted
</span></span><span class="line"><span class="cl">pod <span class="s2">&#34;antrea-agent-h72qd&#34;</span> deleted
</span></span><span class="line"><span class="cl">pod <span class="s2">&#34;antrea-agent-lg52n&#34;</span> deleted
</span></span><span class="line"><span class="cl">pod <span class="s2">&#34;antrea-agent-z8knw&#34;</span> deleted
</span></span><span class="line"><span class="cl">pod <span class="s2">&#34;antrea-agent-zf9l6&#34;</span> deleted
</span></span></code></pre></div><p>To further enable the L7 flow information I need to annotate either my pods or a whole namespace with the following key: <code>visibility.antrea.io/l7-export=X</code> the values can be ngress, egress or both as it depends on which direction I want the L7 flow information. In the example below I will annotate my Ubuntu pod using the value <code>both</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">visibility.antrea.io/l7-export</span><span class="p">:</span><span class="w"> </span><span class="l">both</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-20-04</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># or just annotate the pod directly</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">k annotate pod -n egress ubuntu-20-04-59d474f9df-dv9ms visibility.antrea.io/l7-export=both</span><span class="w">
</span></span></span></code></pre></div><p>Let see what kind of information I get when I try to access a web page using HTTP from the Ubuntu pod itself.</p>
<p>I will use Theia as my tool to receive and visualize my IPFIX flows, I have already covered Theia <a href="https://blog.andreasm.io/2023/06/01/managing-antrea-in-vsphere-with-tanzu/#theia" target="_blank">here</a>.</p>
<div class="notice info">
<p>When enabling the L7FlowExport the current Theia installation does not have the correct columns in place in the Clickhouse DB leading to FlowAggregator pod failing. It will complain about the missing columns. The following tables <em>default.flows</em> and <em>default.flows_local</em> needs to add the following columns:</p>
<ul>
<li>appProtocolName</li>
<li>httpVals</li>
<li>egressNodeName</li>
</ul>
<p>Inside the chi-clickhouse-clickhouse-0-0-0 pod execute the following:</p>
<p>root@chi-clickhouse-clickhouse-0-0-0:/# clickhouse-client</p>
<p>chi-clickhouse-clickhouse-0-0-0.chi-clickhouse-clickhouse-0-0.flow-visibility.svc.cluster.local :) ALTER TABLE default.flows ADD COLUMN appProtocolName String;</p>
<p>Repeat for the other two columns, in both tables</p>
</div>
<p>Screenshot from the Grafana dashboard:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240503134419288.png"
        alt="http-flow-information"
      />
      
    </figure>
</p>
<p>I can see the HTTP protocol and the httpVals column is displaying this information:</p>
<pre tabindex="0"><code>{&#34;0&#34;:{&#34;hostname&#34;:&#34;www.vg.no&#34;,&#34;url&#34;:&#34;/&#34;,&#34;http_user_agent&#34;:&#34;curl/7.68.0&#34;,&#34;http_content_type&#34;:&#34;&#34;,&#34;http_method&#34;:&#34;GET&#34;,&#34;protocol&#34;:&#34;HTTP/1.1&#34;,&#34;status&#34;:301,&#34;length&#34;:0}}
</code></pre><p>I have remove a lot of columns in the screenshot above for clarity. For more information on Flow-Export head over <a href="https://antrea.io/docs/v2.0.0/docs/network-flow-visibility/#flow-exporter" target="_blank">here</a> and <a href="https://github.com/antrea-io/antrea/blob/main/docs/network-flow-visibility.md" target="_blank">here</a>.</p>


<h2 class="relative group">Node NetworkPolicy and ExternalNode Policy 
    <div id="node-networkpolicy-and-externalnode-policy" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#node-networkpolicy-and-externalnode-policy" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>In this section I will have a look at two features that makes it possible to secure the Kubernetes nodes themselves using Antrea and external nodes, not being a Kubernetes node but a VM outside of the Kubernetes cluster. There can be many usecases for such a feature. If there is no physical firewall in between the segments or the nodes, still we need to enforce some kind of security to restrict certain lateral movement between nodes and or other VMs or bare-metal servers in the environment. Being able to do microsegmentation is important.</p>


<h3 class="relative group">Node NetworkPolicy - new in Antrea v1.15 
    <div id="node-networkpolicy---new-in-antrea-v115" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#node-networkpolicy---new-in-antrea-v115" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240505115441833.png"
        alt="node-policy-1"
      />
      
    </figure>
</p>
<p>The diagram above tries to illustrate a communication pattern where the Kubernetes nodes is hosting a service running on port 80/TCP and some external resources is trying to reach those services. I will define a policy that will only allow access originating from certain subnets and drop all else. If I am exposing the service using an external LoadBalancer I could potentially restrict access to this service coming only from the LoadBalancer itself, nothing else. Lets have a look at the rule itself and apply it in i a real Kubernetes cluster.</p>
<p>The example rule I am using in this case is taken from the official Antrea documentation <a href="https://github.com/antrea-io/antrea/blob/main/docs/antrea-node-network-policy.md" target="_blank">here</a> with some modifications by me.</p>
<p>The rule (notice the kind, it is a ClusterNetworkPolicy):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">crd.antrea.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterNetworkPolicy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">restrict-http-to-node</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l">application</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">appliedTo</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">nodeSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">matchExpressions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;kubernetes.io/hostname&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;In&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;k8s-node-vm-1-cl-02&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;k8s-node-vm-2-cl-02&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;k8s-node-vm-3-cl-02&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ingress</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">allow-cidr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l">Allow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">from</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">ipBlock</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="m">10.100.5.0</span><span class="l">/24</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">ipBlock</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="m">172.18.6.0</span><span class="l">/24</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">drop-other</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l">Drop</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></div><p>The policy above will be applied to all nodes having the key/value label <code>kubernetes.io/hostname: k8s-worker-node</code>allowing port 80/TCP from 10.100.5.0/24 and 172.18.6.0/24 and  block all else trying to reach port 80/TCP.</p>
<p>Now before I can go ahead and apply this policy and I need to enable the feature gate NodeNetworkPolicy:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">antrea-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kube-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">antrea-agent.conf</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    featureGates:
</span></span></span><span class="line"><span class="cl"><span class="sd">      NodeNetworkPolicy: true</span><span class="w">    
</span></span></span></code></pre></div><p>Restart all Antrea pods:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~$ k delete pods -n kube-system -l <span class="nv">app</span><span class="o">=</span>antrea
</span></span><span class="line"><span class="cl">pod <span class="s2">&#34;antrea-agent-gz9nt&#34;</span> deleted
</span></span><span class="line"><span class="cl">pod <span class="s2">&#34;antrea-agent-mcck5&#34;</span> deleted
</span></span><span class="line"><span class="cl">pod <span class="s2">&#34;antrea-agent-qqr6l&#34;</span> deleted
</span></span><span class="line"><span class="cl">pod <span class="s2">&#34;antrea-agent-spmz8&#34;</span> deleted
</span></span><span class="line"><span class="cl">pod <span class="s2">&#34;antrea-agent-vnll7&#34;</span> deleted
</span></span><span class="line"><span class="cl">pod <span class="s2">&#34;antrea-agent-xrr2p&#34;</span> deleted
</span></span><span class="line"><span class="cl">pod <span class="s2">&#34;antrea-controller-576fdb765-h7tbc&#34;</span> deleted
</span></span></code></pre></div><p>After the policy has been applied I can check easily if it is in effect by using the command below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2/antrea-policies$ k get acnp
</span></span><span class="line"><span class="cl">NAME                    TIER          PRIORITY   DESIRED NODES   CURRENT NODES   AGE
</span></span><span class="line"><span class="cl">restrict-http-to-node   application   <span class="m">5</span>          <span class="m">3</span>               <span class="m">3</span>               16m
</span></span></code></pre></div><p>My cluster consists of 3 control plane nodes and 3 worker nodes. I can see my policy as been applied to at least 3, which I assume is my worker nodes. Lets dig into that deeper a bit later. But lets see if the policy is being enforced.</p>
<p>From my laptop or from my linux vm, from both subnets that should be allowed:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt01:~$ curl http://10.169.1.40
</span></span><span class="line"><span class="cl">&lt;!doctype html&gt;
</span></span><span class="line"><span class="cl">&lt;html&gt;
</span></span><span class="line"><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="cl">    &lt;meta <span class="nv">charset</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span>&gt;
</span></span><span class="line"><span class="cl">    &lt;title&gt;Yelb&lt;/title&gt;
</span></span><span class="line"><span class="cl">    &lt;base <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;/&#34;</span>&gt;
</span></span><span class="line"><span class="cl">    &lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">&#34;viewport&#34;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&#34;width=device-width, initial-scale=1&#34;</span>&gt;
</span></span><span class="line"><span class="cl">    &lt;link <span class="nv">rel</span><span class="o">=</span><span class="s2">&#34;icon&#34;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;image/x-icon&#34;</span> <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;favicon.ico?v=2&#34;</span>&gt;
</span></span><span class="line"><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="cl">&lt;yelb&gt;Loading...&lt;/yelb&gt;
</span></span><span class="line"><span class="cl">&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;inline.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;styles.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;scripts.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;vendor.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;main.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/html&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># From my laptop</span>
</span></span><span class="line"><span class="cl">andreasm@laptop:~$ curl http://10.169.1.40
</span></span><span class="line"><span class="cl">&lt;!doctype html&gt;
</span></span><span class="line"><span class="cl">&lt;html&gt;
</span></span><span class="line"><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="cl">    &lt;meta <span class="nv">charset</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span>&gt;
</span></span><span class="line"><span class="cl">    &lt;title&gt;Yelb&lt;/title&gt;
</span></span><span class="line"><span class="cl">    &lt;base <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;/&#34;</span>&gt;
</span></span><span class="line"><span class="cl">    &lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">&#34;viewport&#34;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&#34;width=device-width, initial-scale=1&#34;</span>&gt;
</span></span><span class="line"><span class="cl">    &lt;link <span class="nv">rel</span><span class="o">=</span><span class="s2">&#34;icon&#34;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;image/x-icon&#34;</span> <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;favicon.ico?v=2&#34;</span>&gt;
</span></span><span class="line"><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="cl">&lt;yelb&gt;Loading...&lt;/yelb&gt;
</span></span><span class="line"><span class="cl">&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;inline.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;styles.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;scripts.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;vendor.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;main.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/html&gt;
</span></span></code></pre></div><p>From any other subnet (other machines) from any other subnet not defined as allowed:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@linuxmgmt02:~$ ip addr
</span></span><span class="line"><span class="cl">2: ens18: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel state UP group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="cl">    link/ether f6:97:82:3b:9a:9e brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">    inet 172.18.5.40/24 brd 172.18.5.255 scope global ens18
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">       
</span></span><span class="line"><span class="cl">andreasm@linuxmgmt02:~$ curl http://10.169.1.40
</span></span><span class="line"><span class="cl">curl: <span class="o">(</span>28<span class="o">)</span> Failed to connect to 10.169.1.40 port 80: Connection timed out
</span></span></code></pre></div><p>Another example can be to drop certain ports between the nodes in a Kubernetes cluster itself with an example policy like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">crd.antrea.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterNetworkPolicy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">egress-drop-node-to-node</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l">application</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">appliedTo</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">nodeSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">matchExpressions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;kubernetes.io/hostname&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;In&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;k8s-node-vm-1-cl-02&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;k8s-node-vm-2-cl-02&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;k8s-node-vm-3-cl-02&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">egress</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">drop-22</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l">Drop</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">to</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">nodeSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">matchExpressions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;kubernetes.io/hostname&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;In&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;k8s-node-vm-1-cl-02&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;k8s-node-vm-2-cl-02&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;k8s-node-vm-3-cl-02&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">22</span><span class="w">
</span></span></span></code></pre></div><p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240505140038911.png"
        alt="node-2-node-ssh"
      />
      
    </figure>
</p>
<p>Now if I try to reach the any of my Kubernetes worker nodes from any of my Kubernetes nodes using SSH:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># node 1 to node 2 over SSH</span>
</span></span><span class="line"><span class="cl">ubuntu@k8s-node-vm-1-cl-02:~$ ssh ubuntu@10.160.1.26
</span></span><span class="line"><span class="cl">ssh: connect to host 10.160.1.26 port 22: Connection timed out
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># node 1 to any other machine over SSH</span>
</span></span><span class="line"><span class="cl">ubuntu@k8s-node-vm-1-cl-02:~$ ssh andreasm@10.100.5.10
</span></span><span class="line"><span class="cl">The authenticity of host <span class="s1">&#39;10.100.5.10 (10.100.5.10)&#39;</span> can<span class="err">&#39;</span>t be established.
</span></span><span class="line"><span class="cl">ED25519 key fingerprint is SHA256:Ue0UyrCk679JwN8QbaRLviCdEfxg7lnu+3RXVryujA8.
</span></span><span class="line"><span class="cl">This key is not known by any other names
</span></span><span class="line"><span class="cl">Are you sure you want to <span class="k">continue</span> connecting <span class="o">(</span>yes/no/<span class="o">[</span>fingerprint<span class="o">])</span>?
</span></span></code></pre></div><p>Play around with this new feature making it possible to also apply and enforce security policies on the nodes themselves opens up for a much more granual and controlled environment if one have these requirements. On edge usecases this can also be very valuable.</p>


<h3 class="relative group">ExternalNode Policy 
    <div id="externalnode-policy" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#externalnode-policy" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>I just want to highlight this feature in its own chapter as I feel it is relevant, and may be a very good combination with the NodePolicy feature. A Kubernetes cluster with its running workload is often depending on external backend services, like external DB/DNS/NTP services hosted somewhere else in the datacenter.</p>
<p>With Antrea ExternalNode policy it is possible to manage security policies on non Kubernetes workload, like any regular virtual machine or bare-metal server using Antrea NetworkPolicy from your Kubernetes/API. See illustration below:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240505143235685.png"
        alt="external-node"
      />
      
    </figure>
</p>
<p>For information on how to configure this, head over to the following pages <a href="https://github.com/antrea-io/antrea/blob/main/docs/external-node.md" target="_blank">here</a> and <a href="https://github.com/antrea-io/antrea/blob/main/docs/external-node.md#install-antrea-agent-on-vm" target="_blank">here</a>.</p>


<h2 class="relative group">Outro 
    <div id="outro" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#outro" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>Thats it for this time. Some features I find interesting in Antrea, head over to the official Antrea docs page <a href="antrea.io">here</a> and Github repo <a href="https://github.com/antrea-io/antrea/tree/main" target="_blank">here</a> for always updated and more information. Speaking of updated information, in time of writing this blog post Antrea 2.0 is released!
<a href="https://github.com/antrea-io/antrea/releases/tag/v2.0.0" target="_blank">Antrea v2.0</a></p>

          
          
          
        </div>
        
        

        
        
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://blog.andreasm.io/2024/04/16/exploring-some-antrea-features/&amp;title=Exploring%20some%20Antrea%20Features"
      title="Share on LinkedIn"
      aria-label="Share on LinkedIn"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://twitter.com/intent/tweet/?url=https://blog.andreasm.io/2024/04/16/exploring-some-antrea-features/&amp;text=Exploring%20some%20Antrea%20Features"
      title="Tweet on Twitter"
      aria-label="Tweet on Twitter"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://s2f.kytta.dev/?text=Exploring%20some%20Antrea%20Features%20https://blog.andreasm.io/2024/04/16/exploring-some-antrea-features/"
      title=""
      aria-label=""
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="mailto:?body=https://blog.andreasm.io/2024/04/16/exploring-some-antrea-features/&amp;subject=Exploring%20some%20Antrea%20Features"
      title="Send via email"
      aria-label="Send via email"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>


    </a>
      
    
  </section>


        


<h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2>
<section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3">
  
  

  <a href="/2023/06/21/securing-kubernetes-clusters-with-antrea-network-policies/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/2023/06/21/securing-kubernetes-clusters-with-antrea-network-policies/feature-antrea-1.png);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/2023/06/21/securing-kubernetes-clusters-with-antrea-network-policies/">Securing Kubernetes clusters with Antrea Network Policies</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2023-06-21T10:01:46&#43;02:00">21 June 2023</time><span class="px-2 text-primary-500">&middot;</span><span>6048 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">29 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/cni/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    CNI
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/antrea/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Antrea
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/security/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Security
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/tmc/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    TMC
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/tanzu-mission-control/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Tanzu Mission Control
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/security/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Security
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/cni/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Cni
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/antrea/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Antrea
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/tmc/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Tmc
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
        <div class="py-1 prose dark:prose-invert">
          In this post I will go through how to utilize Antrea Network policies with Tanzu Mission Control and a little bit NSX. So jump in and hopefully get some ideas how what we can do with Antrea Network Policies and how to use them.
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
  

  <a href="/2023/09/25/antrea-multi-cluster-in-tkg-and-vsphere-with-tanzu/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/2023/09/25/antrea-multi-cluster-in-tkg-and-vsphere-with-tanzu/feature-antrea-1.png);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/2023/09/25/antrea-multi-cluster-in-tkg-and-vsphere-with-tanzu/">Antrea Multi-cluster - in TKG and vSphere with Tanzu</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2023-09-25T10:59:30&#43;02:00">25 September 2023</time><span class="px-2 text-primary-500">&middot;</span><span>11466 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">54 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/cni/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    CNI
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/antrea/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Antrea
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/tanzu/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Tanzu
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/antrea/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Antrea
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/cni/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Cni
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/multi-cluster/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Multi-Cluster
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
        <div class="py-1 prose dark:prose-invert">
          In this post I will go through how to configure and use the Antrea feature gate Multi-cluster in both TKGs and TKG
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
  

  <a href="/2024/02/04/argo-cd-vsphere-with-tanzu/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/2024/02/04/argo-cd-vsphere-with-tanzu/feature-argocd.png);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/2024/02/04/argo-cd-vsphere-with-tanzu/">Argo CD & vSphere with Tanzu</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-02-04T11:28:21&#43;01:00">4 February 2024</time><span class="px-2 text-primary-500">&middot;</span><span>4554 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">22 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/tanzu/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Tanzu
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/argocd/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    ArgoCD
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/avi/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    AVI
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/vsphere/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    VSphere
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/gitops/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Gitops
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/automation/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Automation
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/antrea/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Antrea
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/gitops/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Gitops
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/argocd/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Argocd
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/vsphere/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Vsphere
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/tanzu/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Tanzu
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/ako/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Ako
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/avi/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Avi
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/antrea/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Antrea
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
        <div class="py-1 prose dark:prose-invert">
          In this post I am using ArgoCD bootstrapping Tanzu Kubernetes Clusters with AKO and Antrea configs
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
</section>

  
      </div>
     
      
      
        
        
          
          
        
      <script>
        var oid = "views_posts\/2024-04-16-antrea-feature-update\/index.md"
        var oid_likes = "likes_posts\/2024-04-16-antrea-feature-update\/index.md"
      </script>
      
      
      <script type="text/javascript" src="/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js" integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q&#43;oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script>
      
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/2024/04/08/vsphere-with-tanzu-avi-and-multiple-supervisors/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >vSphere with Tanzu - Avi and Multiple Supervisors</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2024-04-08T14:56:56&#43;02:00">8 April 2024</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/2024/06/10/arista-automated-configuration-using-ansible/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Arista Automated Configuration using Ansible</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2024-06-10T07:51:41&#43;02:00">10 June 2024</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top" title="Scroll to top">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
    <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex flex-col list-none sm:flex-row">
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/tags/"
            title="">
            
            Tags
          </a>
        </li>
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/categories/"
            title="">
            
            Categories
          </a>
        </li>
        
      </ul>
    </nav>
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      &copy;
      2025
      Andreas Marqvardsen
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js" integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="https://blog.andreasm.io/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
