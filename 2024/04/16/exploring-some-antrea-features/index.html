
<!DOCTYPE html>
<html
  lang="en"
  data-figures=""
  
    class="page"
  
  
  
    data-mode="dim"
  >
  <head>
<title>Exploring some Antrea Features | From 0.985mhz... to several Ghz</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TVPYDVE8KR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-TVPYDVE8KR');
</script>



  
<meta property="og:locale" content="en" />

<meta property="og:type" content="article">
<meta name="description" content="A walkthrough on new and some older features in Antrea" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="">
<meta name="twitter:title" content="Exploring some Antrea Features" />
<meta name="twitter:image" content="https://blog.andreasm.io/2024/04/16/exploring-some-antrea-features/images/antrea-stacked-color3.webp"/>
<meta property="og:url" content="https://blog.andreasm.io/2024/04/16/exploring-some-antrea-features/" />
<meta property="og:title" content="Exploring some Antrea Features" />
<meta property="og:description" content="A walkthrough on new and some older features in Antrea" />
<meta property="og:image" content="https://blog.andreasm.io/2024/04/16/exploring-some-antrea-features/images/antrea-stacked-color3.webp" />
  <meta name="keywords" content="nsx,vmware,networking,infrastucture,lodbalancing,tanzu,security,cni,antrea,cilium,kubernetes" />

<link rel="apple-touch-icon" sizes="180x180" href="https://blog.andreasm.io/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.andreasm.io/icons/favicon-32x32.png">
<link rel="manifest" href="https://blog.andreasm.io/icons/site.webmanifest">

<link rel="canonical" href="https://blog.andreasm.io/2024/04/16/exploring-some-antrea-features/">



<link rel="preload" href="https://blog.andreasm.io/css/styles.6c67fa3a7f5290a2facfb027358dd2bdb5450d04b8de427c8a74d79f524a7fb716b470b14b6ba95f1b7cf3aa9a2219a7294a6adeaf16a1080f432eae45d8c03c.css" integrity = "sha512-bGf6On9SkKL6z7AnNY3SvbVFDQS43kJ8inTXn1JKf7cWtHCxS2upXxt886qaIhmnKUpq3q8WoQgPQy6uRdjAPA==" as="style" crossorigin="anonymous">



<link rel="preload" href="https://blog.andreasm.io/en/js/bundle.5548d358738600c857a1f05f0459418da7143d4426c66a08bf3f15ded1b39dd2136bf104a559247a909fc4dcc45b8e06bad0870ece4c71ee5303d30550def8bd.js" as="script" integrity=
"sha512-VUjTWHOGAMhXofBfBFlBjacUPUQmxmoIvz8V3tGzndITa/EEpVkkepCfxNzEW44GutCHDs5Mce5TA9MFUN74vQ==" crossorigin="anonymous">


<link rel="stylesheet" type="text/css" href="https://blog.andreasm.io/css/styles.6c67fa3a7f5290a2facfb027358dd2bdb5450d04b8de427c8a74d79f524a7fb716b470b14b6ba95f1b7cf3aa9a2219a7294a6adeaf16a1080f432eae45d8c03c.css" integrity="sha512-bGf6On9SkKL6z7AnNY3SvbVFDQS43kJ8inTXn1JKf7cWtHCxS2upXxt886qaIhmnKUpq3q8WoQgPQy6uRdjAPA==" crossorigin="anonymous">


  </head>
  <body
    data-code="15"
    data-lines="false"
    id="documentTop"
    data-lang="en"
  >

<header class="nav_header" >
  <nav class="nav"><a href='https://blog.andreasm.io/' class="nav_brand nav_item" title="From 0.985mhz... to several Ghz">
  <img src="https://blog.andreasm.io/quote3.png" class="logo" alt="From 0.985mhz... to several Ghz">
  <div class="nav_close">
    <div><svg class="icon">
  <title>open-menu</title>
  <use xlink:href="#open-menu"></use>
</svg>
<svg class="icon">
  <title>closeme</title>
  <use xlink:href="#closeme"></use>
</svg>
</div>
  </div>
</a>

    <div class='nav_body nav_body_left'>
      
      
      
        

  <div class="nav_parent">
    <a href="https://blog.andreasm.io/" class="nav_item" title="Home">Home </a>
  </div>
  <div class="nav_parent">
    <a href="https://blog.andreasm.io/about/" class="nav_item" title="About">About </a>
  </div>
      
<div class='follow'>
    
  <a href="https://blog.andreasm.io/index.xml">
    <svg class="icon">
  <title>rss</title>
  <use xlink:href="#rss"></use>
</svg>

  </a>
<div class="color_mode">
  <input type="checkbox" class="color_choice" id="mode">
</div>

</div>

    </div>
  </nav>
</header>

    <main>
  
<div class="grid-inverse wrap content">
  <article class="post_content">
    <h1 class="post_title">Exploring some Antrea Features</h1>
  <div class="post_meta">
    <span><svg class="icon">
  <title>calendar</title>
  <use xlink:href="#calendar"></use>
</svg>
</span>
    <span class="post_date">
      16-04-2024</span>
    <span class="post_time"> · 30 min read</span><span>&nbsp;· <a href='https://blog.andreasm.io/tags/antrea/' title="antrea" class="post_tag button button_translucent">antrea
        </a><a href='https://blog.andreasm.io/tags/kubernetes/' title="kubernetes" class="post_tag button button_translucent">kubernetes
        </a><a href='https://blog.andreasm.io/tags/cni/' title="cni" class="post_tag button button_translucent">cni
        </a>
    </span>
    <span class="page_only">&nbsp;·
  <div class="post_share">
    Share on:
    <a href="https://twitter.com/intent/tweet?text=Exploring%20some%20Antrea%20Features&url=https%3a%2f%2fblog.andreasm.io%2f2024%2f04%2f16%2fexploring-some-antrea-features%2f&tw_p=tweetbutton" class="twitter" title="Share on Twitter" target="_blank" rel="nofollow">
      <svg class="icon">
  <title>twitter</title>
  <use xlink:href="#twitter"></use>
</svg>

    </a>
    <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fblog.andreasm.io%2f2024%2f04%2f16%2fexploring-some-antrea-features%2f&t=Exploring%20some%20Antrea%20Features" class="facebook" title="Share on Facebook" target="_blank" rel="nofollow">
      <svg class="icon">
  <title>facebook</title>
  <use xlink:href="#facebook"></use>
</svg>

    </a>
    <a href="#linkedinshare" id = "linkedinshare" class="linkedin" title="Share on LinkedIn" rel="nofollow">
      <svg class="icon">
  <title>linkedin</title>
  <use xlink:href="#linkedin"></use>
</svg>

    </a>
    <a href="https://blog.andreasm.io/2024/04/16/exploring-some-antrea-features/" title="Copy Link" class="link link_yank">
      <svg class="icon">
  <title>copy</title>
  <use xlink:href="#copy"></use>
</svg>

    </a>
  </div>
  </span>
  </div>

      <div class="post_toc">
        <h2>Overview</h2>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#antrea-egress-using-vlan---new-in-antrea-v1150">Antrea Egress using VLAN - new in Antrea v.1.15.0</a>
      <ul>
        <li><a href="#how-to-configure-antrea-egress-using-vlan">How to configure Antrea Egress using VLAN</a></li>
        <li><a href="#antrea-egress-failover">Antrea Egress failover</a></li>
      </ul>
    </li>
    <li><a href="#kube-proxy-vs-antrea-proxy">Kube-Proxy vs Antrea Proxy</a>
      <ul>
        <li><a href="#antreaproxy-and-kube-proxy-together">AntreaProxy AND Kube-Proxy together</a></li>
        <li><a href="#antreaproxy-all">AntreaProxy All</a></li>
      </ul>
    </li>
    <li><a href="#antrea-serviceexternalip">Antrea ServiceExternalIP</a>
      <ul>
        <li><a href="#serviceexternalip-using-kube-proxy-and-ipvs-ip-virtual-server">ServiceExternalIP using Kube-Proxy and IPVS (IP Virtual Server)</a></li>
        <li><a href="#serviceexternalip-using-only-antreaproxy">ServiceExternalIP using only AntreaProxy.</a></li>
      </ul>
    </li>
    <li><a href="#l7flowexporter---new-in-antrea-v1150">L7FlowExporter - new in Antrea v.1.15.0</a></li>
    <li><a href="#node-networkpolicy-and-externalnode-policy">Node NetworkPolicy and ExternalNode Policy</a>
      <ul>
        <li><a href="#node-networkpolicy---new-in-antrea-v115">Node NetworkPolicy - new in Antrea v1.15</a></li>
        <li><a href="#externalnode-policy">ExternalNode Policy</a></li>
      </ul>
    </li>
    <li><a href="#outro">Outro</a></li>
  </ul>
</nav>
      </div>
    
    <div class="post_body"><h1 id="antrea-featuregates">Antrea FeatureGates</h1>
<p>In this post, I will highlight a couple of Antrea features that I'd like to discuss. I will explain how to configure them, why they are useful, and how to use them. Below is some of the features I will cover</p>
<ul>
<li>Egress using VLAN</li>
<li>AntreaProxy</li>
<li>ServiceExternalIP</li>
<li>L7FLowExporter</li>
<li>NodeNetwork Policy</li>
<li>ExternalNode Policy</li>
</ul>
<p>As usual, head over to the official Antrea <a href="https://antrea.io/docs/v1.15.1/">documentation</a> and Antrea <a href="https://github.com/antrea-io/antrea/blob/main/docs/feature-gates.md">Github</a> repo for more information. This post will focus on the upstream version v1.15.1 of Antrea available on Github, my Kubernetes clusters will also be using upstream Kubernetes version 1.28.5+ running on Ubuntu nodes.</p>
<p>Antrea FeatureGates is enabled/disabled using your Helm value file, or editing the Antrea ConfigMap. To quickly get a status over the feature gates, use the <em>antctl</em> cli tool:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">andreasm@linuxmgmt01:~$ antctl get featuregates
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">Antrea Agent Feature Gates
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">FEATUREGATE                     STATUS       VERSION
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">AntreaIPAM                      Disabled     ALPHA
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">AntreaPolicy                    Enabled      BETA
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">AntreaProxy                     Enabled      GA
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">CleanupStaleUDPSvcConntrack     Disabled     ALPHA
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">Egress                          Enabled      BETA
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">EgressSeparateSubnet            Enabled      ALPHA
</span></span><span class="line"><span class="ln">10</span><span class="cl">EgressTrafficShaping            Disabled     ALPHA
</span></span><span class="line"><span class="ln">11</span><span class="cl">EndpointSlice                   Enabled      GA
</span></span><span class="line"><span class="ln">12</span><span class="cl">ExternalNode                    Disabled     ALPHA
</span></span><span class="line"><span class="ln">13</span><span class="cl">FlowExporter                    Disabled     ALPHA
</span></span><span class="line"><span class="ln">14</span><span class="cl">IPsecCertAuth                   Disabled     ALPHA
</span></span><span class="line"><span class="ln">15</span><span class="cl">L7FlowExporter                  Disabled     ALPHA
</span></span><span class="line"><span class="ln">16</span><span class="cl">L7NetworkPolicy                 Disabled     ALPHA
</span></span><span class="line"><span class="ln">17</span><span class="cl">LoadBalancerModeDSR             Disabled     ALPHA
</span></span><span class="line"><span class="ln">18</span><span class="cl">Multicast                       Enabled      BETA
</span></span><span class="line"><span class="ln">19</span><span class="cl">Multicluster                    Disabled     ALPHA
</span></span><span class="line"><span class="ln">20</span><span class="cl">NetworkPolicyStats              Enabled      BETA
</span></span><span class="line"><span class="ln">21</span><span class="cl">NodeNetworkPolicy               Disabled     ALPHA
</span></span><span class="line"><span class="ln">22</span><span class="cl">NodePortLocal                   Enabled      GA
</span></span><span class="line"><span class="ln">23</span><span class="cl">SecondaryNetwork                Disabled     ALPHA
</span></span><span class="line"><span class="ln">24</span><span class="cl">ServiceExternalIP               Enabled      ALPHA
</span></span><span class="line"><span class="ln">25</span><span class="cl">SupportBundleCollection         Disabled     ALPHA
</span></span><span class="line"><span class="ln">26</span><span class="cl">TopologyAwareHints              Enabled      BETA
</span></span><span class="line"><span class="ln">27</span><span class="cl">Traceflow                       Enabled      BETA
</span></span><span class="line"><span class="ln">28</span><span class="cl">TrafficControl                  Disabled     ALPHA
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">Antrea Controller Feature Gates
</span></span><span class="line"><span class="ln">31</span><span class="cl">FEATUREGATE                 STATUS       VERSION
</span></span><span class="line"><span class="ln">32</span><span class="cl">AdminNetworkPolicy          Disabled     ALPHA
</span></span><span class="line"><span class="ln">33</span><span class="cl">AntreaIPAM                  Disabled     ALPHA
</span></span><span class="line"><span class="ln">34</span><span class="cl">AntreaPolicy                Enabled      BETA
</span></span><span class="line"><span class="ln">35</span><span class="cl">Egress                      Enabled      BETA
</span></span><span class="line"><span class="ln">36</span><span class="cl">IPsecCertAuth               Disabled     ALPHA
</span></span><span class="line"><span class="ln">37</span><span class="cl">L7NetworkPolicy             Disabled     ALPHA
</span></span><span class="line"><span class="ln">38</span><span class="cl">Multicast                   Enabled      BETA
</span></span><span class="line"><span class="ln">39</span><span class="cl">Multicluster                Disabled     ALPHA
</span></span><span class="line"><span class="ln">40</span><span class="cl">NetworkPolicyStats          Enabled      BETA
</span></span><span class="line"><span class="ln">41</span><span class="cl">NodeIPAM                    Enabled      BETA
</span></span><span class="line"><span class="ln">42</span><span class="cl">ServiceExternalIP           Enabled      ALPHA
</span></span><span class="line"><span class="ln">43</span><span class="cl">SupportBundleCollection     Disabled     ALPHA
</span></span><span class="line"><span class="ln">44</span><span class="cl">Traceflow                   Enabled      BETA
</span></span></code></pre></div><h2 id="antrea-egress-using-vlan---new-in-antrea-v1150">Antrea Egress using VLAN - new in Antrea v.1.15.0</h2>
<p>I have already covered Antrea Egress in another post <a href="https://blog.andreasm.io/2023/02/20/antrea-egress/">here</a>, where I use Daemonset to install FRR on the worker nodes. This allowed me to advertise the Egress addresses using BGP using a different subnet than the nodes themselves. Back then Antrea did not have support for Egress subnets in different network than the nodes. Now, in Antrea <a href="https://github.com/antrea-io/antrea/releases/tag/v1.15.0">v1.15.0</a> there is support in Antrea Egress to use different subnets. This is a welcome update in Antrea.</p>
<p>Before configuring Antrea Egress, the default behaviour for a pod when &quot;egressing&quot; or communicating externally outside its Kubernetes cluster is that its source address (POD CIDR) is translated using SNAT to the Kubernetes node the pod is currently running on. See below diagram:</p>
<p>
  <figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt="pod-ext-snat"
      
        class="image_figure image_internal image_processed"
        width="1586"
        height="1138"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240417103049244.png"
      
      
    />

    </picture>
</figure>
</p>
<p>Each time a pod needs to communicate outside its k8s node it will get the IP address from the node it is currently residing on.</p>
<p>With Antrea Egress I can specify a specific IP address from a pool (ExternalIPPool) I confgure for the pods to use (for the ones I need Egress configured on). Before Antrea v1.15.0 I could only use the same subnet as the Kubernetes nodes were using, meaning I had to reserve a range in that subnet for Egress usage to avoid IP overlap, unless I did some DIY stuff like static routes or as in my post <a href="https://blog.andreasm.io/2023/02/20/antrea-egress/">here</a>. Now with Antrea v1.15.0 Antrea supports Egress on a different subnet, it even supports using a optional VLAN tag like this:</p>
<p>
  <figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt="egress-vlan"
      
        class="image_figure image_internal image_processed"
        width="1706"
        height="1180"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240417103628196.png"
      
      
    />

    </picture>
</figure>
</p>
<p>I assign a VLAN tag in the ExternalIPPool which uses the same physical interface as the node itself is configured with, like eth0/ens18 etc). This require my node to be placed on a network that allows vlan trunks/in guest tagging, and allows me to easily separate the Egress subnets from the node subnet and specifying different subnets for my Egresses. In simple terms, what it does is creating a vlan interface on the nodes I decide to use as Egress nodes. Like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">11: antrea-ext.181@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc noqueue state UP mode DEFAULT group default
</span></span><span class="line"><span class="ln">2</span><span class="cl">    link/ether bc:24:11:1d:82:f5 brd ff:ff:ff:ff:ff:ff 
</span></span></code></pre></div><p>This then gives me the option create Antrea Egress IP Pools with different subnets, separating them using VLAN, for my pods to use when in need of reaching out externally. **This means I can have my nodes residing on its own VLAN, and my Antrea Egress pools separated on completely different VLANs than my nodes. **</p>
<p>In the diagram below I have configured Antrea Egress with an ExternalIPPool using VLAN and a subnet defined to be 172.18.181.0/24. The nodes themselves reside on the subnet 10.160.1.0/24. So when I apply the Egress resource on a pod (using label selectors) it will grab a free IP from the ExternalIPPool and use an address from that subnet (172.18.181.0/24) when exiting the node. The other pods not configured with Egress resources will still use SNAT and translate their IP into the residing pods ip address (10.160.1.0/24).  This gives me great flexibility not only to control which pods needs to use Egress, but also the flexibility to specify dedicated IP addresses for certain pods to use when egressing, and I can even specify multiple different subnets (see note [here]((which may incur additional management overhead))) using several Antrea Egress IP pools and achieve additional separation to meet different requirements. Controlling access via my firewall makes life much easier as I can allow a specific pod/IP to reach certain services in one part of my environment, where another pod with another subnet defined reach other parts of my environment. Using VLAN also eliminate the need of configuring BGP from my worker nodes to my BGP routers (which may incur additional management overhead), a VLAN is often simpler to create and manage.</p>
<p>
  <figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt="pod-egress-vs-snat"
      
        class="image_figure image_internal image_processed"
        width="1230"
        height="1616"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240418085954372.png"
      
      
    />

    </picture>
</figure>
</p>
<p>A very simple illustration on how my network is configured, for better context.</p>
<p>
  <figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt="network"
      
        class="image_figure image_internal image_processed"
        width="2586"
        height="1472"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240417160828960.png"
      
      
    />

    </picture>
</figure>
</p>
<p>All my nodes are configured on a virtual port group using VLAN 216, using subnet 10.160.1.0/24 and my Egress pool is configured using VLAN 181. My switch is both L2 and L3, its configured with gateway interfaces for some of my networks and routes between the networks configured on the switch. All networks outside the switch is routed to my firewall using BGP.</p>
<h3 id="how-to-configure-antrea-egress-using-vlan">How to configure Antrea Egress using VLAN</h3>
<p>Now that I have explained how this new Antrea Egress works, its time to show how to configure it in my Kubernetes cluster.</p>
<p>The first requirement is that Antrea is on version 1.15.x. To check that execute the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">andreasm@linuxmgmt01:~$ k <span class="nb">exec</span> -it -n kube-system antrea-controller-c47585dbf-6vdsl antctl version
</span></span><span class="line"><span class="ln">2</span><span class="cl">kubectl <span class="nb">exec</span> <span class="o">[</span>POD<span class="o">]</span> <span class="o">[</span>COMMAND<span class="o">]</span> is DEPRECATED and will be removed in a future version. Use kubectl <span class="nb">exec</span> <span class="o">[</span>POD<span class="o">]</span> -- <span class="o">[</span>COMMAND<span class="o">]</span> instead.
</span></span><span class="line"><span class="ln">3</span><span class="cl">antctlVersion: v1.15.1
</span></span><span class="line"><span class="ln">4</span><span class="cl">controllerVersion: v1.15.1
</span></span></code></pre></div><p>Then make sure you have configured the following feature gates in the Antrea configMap:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">antrea-config</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kube-system</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">  </span><span class="nt">antrea-agent.conf</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="sd">    featureGates:
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="sd">      Egress: true
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="sd">      EgressSeparateSubnet: true</span><span class="w">    
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">  </span><span class="nt">antrea-controller.conf</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="sd">    featureGates:
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="sd">      Egress: true</span><span class="w">    
</span></span></span></code></pre></div><p>After editing the Antrea configMap, restart the Antrea controller and agents so they can fetch the updated configMap:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">k rollout restart -n kube-system deployment/antrea-controller
</span></span><span class="line"><span class="ln">2</span><span class="cl">k delete pods -n kube-system -l <span class="nv">component</span><span class="o">=</span>antrea-agent
</span></span></code></pre></div><p>Now I need to create and apply an ExternalIPPool:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">crd.antrea.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ExternalIPPool</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">egress-vlan-external-ip-pool</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">  </span><span class="nt">ipRanges</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">  </span>- <span class="nt">start</span><span class="p">:</span><span class="w"> </span><span class="m">172.18.181.40</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">    </span><span class="nt">end</span><span class="p">:</span><span class="w"> </span><span class="m">172.18.181.50</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">  </span><span class="nt">subnetInfo</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w"> </span><span class="m">172.18.181.1</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">    </span><span class="nt">prefixLength</span><span class="p">:</span><span class="w"> </span><span class="m">24</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">    </span><span class="nt">vlan</span><span class="p">:</span><span class="w"> </span><span class="m">181</span><span class="w"> </span><span class="c"># notice the VLAN setting here - this is a different VLAN than my nodes are using.</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">  </span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">      </span><span class="nt">egress-role</span><span class="p">:</span><span class="w"> </span><span class="l">egress-node</span><span class="w">
</span></span></span></code></pre></div><p>I am using a nodeSelector matching on the label egress-role=egress-node. So I will need to label the nodes I want to be used as Egress nodes, or all of them. The Egress object will failover to the next available node if the active one fails and if I have more than one node labeled accordingly. I can quickly showcase that a bit later.</p>
<p>If I check for any ExternalIPPools I should have one applied now:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get externalippools.crd.antrea.io
</span></span><span class="line"><span class="ln">2</span><span class="cl">NAME                           TOTAL   USED   AGE
</span></span><span class="line"><span class="ln">3</span><span class="cl">egress-vlan-external-ip-pool   <span class="m">11</span>      <span class="m">0</span>      23h
</span></span></code></pre></div><p>Then I will label my nodes:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">k label nodes k8s-node-vm-1-cl-02 egress-role<span class="o">=</span>egress-node
</span></span><span class="line"><span class="ln">2</span><span class="cl">k label nodes k8s-node-vm-2-cl-02 egress-role<span class="o">=</span>egress-node
</span></span><span class="line"><span class="ln">3</span><span class="cl">k label nodes k8s-node-vm-3-cl-02 egress-role<span class="o">=</span>egress-node
</span></span></code></pre></div><p>Now my three control plane nodes can be used as Egress nodes.</p>
<p>I can now apply the Egress resource itself, refering to my ExternalIPPool above, where I will select an Ubuntu pod I already have running:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">crd.antrea.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Egress</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">egress-vlan</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">  </span><span class="nt">appliedTo</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    </span><span class="nt">podSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">      </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">egress-1</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">  </span><span class="nt">externalIPPool</span><span class="p">:</span><span class="w"> </span><span class="l">egress-vlan-external-ip-pool</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="nt">status</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">  </span><span class="nt">egressNode</span><span class="p">:</span><span class="w"> </span><span class="l">k8s-node-vm-2-cl-02</span><span class="w">
</span></span></span></code></pre></div><p>In the appliedTo field I am using podSelector without namespace, so it is a clusterwide selection for any pods using the label app=egress-1. Then I select which ExternalIPPool to use. I am also specifying the preferred node as the Egress node, but as we will see later, if that one becomes unavailable it will failover to next available node.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get egress
</span></span><span class="line"><span class="ln">2</span><span class="cl">NAME          EGRESSIP        AGE   NODE
</span></span><span class="line"><span class="ln">3</span><span class="cl">egress-vlan   172.18.181.40   23h   k8s-node-vm-2-cl-02
</span></span></code></pre></div><p>And the ExternalIPPool now shows me:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get externalippools.crd.antrea.io
</span></span><span class="line"><span class="ln">2</span><span class="cl">NAME                           TOTAL   USED   AGE
</span></span><span class="line"><span class="ln">3</span><span class="cl">egress-vlan-external-ip-pool   <span class="m">11</span>      <span class="m">1</span>      23h
</span></span></code></pre></div><p>If I enter bash of my Ubuntu pod now and ping an external vm, it will use the IP address above (172.18.181.40).</p>
<p>Lets see:</p>
<p>
  <figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt="ping-with-egress"
      
        class="image_figure image_internal image_processed"
        width="2349"
        height="272"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240418150642586.png"
      
      
    />

    </picture>
</figure>
</p>
<p>And just to show that my nodes are using subnet 10.160.1.0/24:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get nodes -o wide
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">NAME                  STATUS   ROLES           AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION       CONTAINER-RUNTIME
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">k8s-cp-vm-1-cl-02     Ready    control-plane   66d   v1.28.5   10.160.1.21   &lt;none&gt;        Ubuntu 22.04.3 LTS   5.15.0-102-generic   containerd://1.7.13
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">k8s-cp-vm-2-cl-02     Ready    control-plane   66d   v1.28.5   10.160.1.22   &lt;none&gt;        Ubuntu 22.04.3 LTS   5.15.0-102-generic   containerd://1.7.13
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">k8s-cp-vm-3-cl-02     Ready    control-plane   66d   v1.28.5   10.160.1.23   &lt;none&gt;        Ubuntu 22.04.3 LTS   5.15.0-102-generic   containerd://1.7.13
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">k8s-node-vm-1-cl-02   Ready    &lt;none&gt;          66d   v1.28.5   10.160.1.25   &lt;none&gt;        Ubuntu 22.04.3 LTS   5.15.0-102-generic   containerd://1.7.13
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">k8s-node-vm-2-cl-02   Ready    &lt;none&gt;          66d   v1.28.5   10.160.1.26   &lt;none&gt;        Ubuntu 22.04.3 LTS   5.15.0-102-generic   containerd://1.7.13
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">k8s-node-vm-3-cl-02   Ready    &lt;none&gt;          66d   v1.28.5   10.160.1.27   &lt;none&gt;        Ubuntu 22.04.3 LTS   5.15.0-102-generic   containerd://1.7.13
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get pod -n egress -owide
</span></span><span class="line"><span class="ln">11</span><span class="cl">NAME                            READY   STATUS    RESTARTS   AGE   IP           NODE                  NOMINATED NODE   READINESS GATES
</span></span><span class="line"><span class="ln">12</span><span class="cl">ubuntu-20-04-59d474f9df-dv9ms   1/1     Running   <span class="m">0</span>          28h   10.30.67.5   k8s-node-vm-1-cl-02   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>Thats it. Works beautifully.</p>
<p>On the node that is currently my Egress node, I will now have a interface called <strong>antrea-ext.181@eth0</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">ubuntu@k8s-node-vm-2-cl-02:~$ ip link
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="m">65536</span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel state UP mode DEFAULT group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    link/ether bc:24:11:1d:82:f5 brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    altname enp0s18
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">3: kube-ipvs0: &lt;BROADCAST,NOARP&gt; mtu <span class="m">1500</span> qdisc noop state DOWN mode DEFAULT group default
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    link/ether d6:a1:1d:13:12:8e brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">4: ovs-system: &lt;BROADCAST,MULTICAST&gt; mtu <span class="m">1500</span> qdisc noop state DOWN mode DEFAULT group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    link/ether 6a:31:ff:05:ab:b1 brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="ln">11</span><span class="cl">5: genev_sys_6081: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">65000</span> qdisc noqueue master ovs-system state UNKNOWN mode DEFAULT group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    link/ether 1a:53:a9:d8:ba:e2 brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="ln">13</span><span class="cl">6: antrea-gw0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1450</span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    link/ether 62:d1:4b:2d:7b:4d brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="ln">15</span><span class="cl">7: antrea-egress0: &lt;BROADCAST,NOARP&gt; mtu <span class="m">1500</span> qdisc noop state DOWN mode DEFAULT group default
</span></span><span class="line"><span class="ln">16</span><span class="cl">    link/ether 72:a2:89:52:08:32 brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="ln">17</span><span class="cl">9: yelb-db--81d702@if2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1450</span> qdisc noqueue master ovs-system state UP mode DEFAULT group default
</span></span><span class="line"><span class="ln">18</span><span class="cl">    link/ether e6:8d:cb:ac:21:66 brd ff:ff:ff:ff:ff:ff link-netns cni-28ac3a0f-cfd6-4823-286a-2334edb7a11c
</span></span><span class="line"><span class="ln">19</span><span class="cl">10: yelb-app-1534fc@if2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1450</span> qdisc noqueue master ovs-system state UP mode DEFAULT group default
</span></span><span class="line"><span class="ln">20</span><span class="cl">    link/ether c6:97:db:c1:97:dd brd ff:ff:ff:ff:ff:ff link-netns cni-3fd6788c-d5e8-8a41-4a2b-e9d622c43a9e
</span></span><span class="line"><span class="ln">21</span><span class="cl">11: antrea-ext.181@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc noqueue state UP mode DEFAULT group default
</span></span><span class="line"><span class="ln">22</span><span class="cl">    link/ether bc:24:11:1d:82:f5 brd ff:ff:ff:ff:ff:ff
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">ubuntu@k8s-node-vm-2-cl-02:~$ ip addr
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="m">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    inet 127.0.0.1/8 scope host lo
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    inet6 ::1/128 scope host
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel state UP group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    link/ether bc:24:11:1d:82:f5 brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="ln">10</span><span class="cl">    altname enp0s18
</span></span><span class="line"><span class="ln">11</span><span class="cl">    inet 10.160.1.26/24 brd 10.160.1.255 scope global eth0
</span></span><span class="line"><span class="ln">12</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="ln">13</span><span class="cl">    inet6 fe80::be24:11ff:fe1d:82f5/64 scope link
</span></span><span class="line"><span class="ln">14</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="ln">15</span><span class="cl">8: antrea-ext.181@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc noqueue state UP group default
</span></span><span class="line"><span class="ln">16</span><span class="cl">    link/ether bc:24:11:1d:82:f5 brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="ln">17</span><span class="cl">    inet 172.18.181.40/24 brd 172.18.181.255 scope global antrea-ext.181
</span></span><span class="line"><span class="ln">18</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="ln">19</span><span class="cl">    inet6 fe80::be24:11ff:fe1d:82f5/64 scope link
</span></span><span class="line"><span class="ln">20</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span></code></pre></div>
<div class="notices info">
    <div class="label">Info</div>
    <p>This interface uses a real VLAN tag. So the port group and the underlaying switch this node is connected to must allow VLAN tags.</p>

  </div>

<p>Just a comment to the above. In my environment I am using Proxmox to host my Kubernetes nodes. I am tagging the &quot;port-group&quot; the actual VM is residing on, but I am also allowing certain other VLANs as trunks on the same port. So if I do &quot;guest&quot; tagging, aka tagging inside the VM the port group needs to respect and forward that tag. The way I solved this with Proxmox was to edit the VM config adding the &quot;trunks=181;216&quot; in the line below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">net0: <span class="nv">virtio</span><span class="o">=</span>BC:24:11:1D:82:F5,bridge<span class="o">=</span>vmbr0,firewall<span class="o">=</span>0,tag<span class="o">=</span>216,trunks<span class="o">=</span>181<span class="p">;</span><span class="m">216</span>
</span></span></code></pre></div><p>The VM needs to be powercycled for this to take effect.</p>
<h3 id="antrea-egress-failover">Antrea Egress failover</h3>
<p>As mentioned above, if my current Egress node fails the Egress gateway will move over to next available node. Let me poweroff the current Egress node and see what happens:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># Before powering off</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get egress
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">NAME          EGRESSIP        AGE   NODE
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">egress-vlan   172.18.181.40   23h   k8s-node-vm-2-cl-02
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"># After powered off</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get egress
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">NAME          EGRESSIP        AGE   NODE
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">egress-vlan   172.18.181.40   23h   k8s-node-vm-3-cl-02
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"># Node status</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get nodes
</span></span><span class="line"><span class="ln">12</span><span class="cl">NAME                  STATUS     ROLES           AGE   VERSION
</span></span><span class="line"><span class="ln">13</span><span class="cl">k8s-cp-vm-1-cl-02     Ready      control-plane   66d   v1.28.5
</span></span><span class="line"><span class="ln">14</span><span class="cl">k8s-cp-vm-2-cl-02     Ready      control-plane   66d   v1.28.5
</span></span><span class="line"><span class="ln">15</span><span class="cl">k8s-cp-vm-3-cl-02     Ready      control-plane   66d   v1.28.5
</span></span><span class="line"><span class="ln">16</span><span class="cl">k8s-node-vm-1-cl-02   Ready      &lt;none&gt;          66d   v1.28.5
</span></span><span class="line"><span class="ln">17</span><span class="cl">k8s-node-vm-2-cl-02   NotReady   &lt;none&gt;          66d   v1.28.5
</span></span><span class="line"><span class="ln">18</span><span class="cl">k8s-node-vm-3-cl-02   Ready      &lt;none&gt;          66d   v1.28.5
</span></span></code></pre></div><p>The failover is pretty quick too.</p>
<p>As soon as the node-2 is back online again the Egress will revert back again, because I have declared it to be on the node-2 in my ExternalIPPool config:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get egress -w
</span></span><span class="line"><span class="ln">2</span><span class="cl">NAME          EGRESSIP        AGE   NODE
</span></span><span class="line"><span class="ln">3</span><span class="cl">egress-vlan   172.18.181.40   23h   k8s-node-vm-3-cl-02
</span></span><span class="line"><span class="ln">4</span><span class="cl">egress-vlan   172.18.181.40   23h   k8s-node-vm-2-cl-02
</span></span></code></pre></div><h2 id="kube-proxy-vs-antrea-proxy">Kube-Proxy vs Antrea Proxy</h2>
<p>This chapter is kind of important to cover before I continue with the next Antrea features as this may have impact on how some of these features operate, and can operate. One should have some understanding of Kube-Proxy and Antrea-Proxy</p>
<p>Comparing kube-proxy and AntreaProxy involves looking at how each handles service traffic management within a Kubernetes cluster.</p>
<p><strong>Kube-Proxy</strong></p>
<ul>
<li>Kube-proxy is running in the Kubernetes cluster as Daemonsets - Kube-Proxy runs in Userspace</li>
</ul>
<ul>
<li>
<p>Kube-proxy is a default component in Kubernetes responsible for IP address translation and load balancing services within the cluster.</p>
</li>
<li>
<p>It can use iptables or IPVS (nftables alpha in k8s 1.29), each with different performance characteristics.</p>
</li>
<li>
<p>The iptables mode is commonly used due to its reliability and moderate performance, managing rules that route traffic to backend pods. IPtables runs in userspace.</p>
</li>
<li>
<p>IPVS mode is known for better performance in large-scale environments because it handles traffic at the kernel level with less overhead than iptables. IPVS runs in Kernelspace</p>
</li>
<li>
<p>While kube-proxy is suitable for many Kubernetes environments, its performance can degrade as the number of services and endpoints increases, especially in iptables mode.</p>
</li>
<li>
<p>Deeply integrated into Kubernetes, kube-proxy watches the Kubernetes API for changes to services and endpoints and updates its rules accordingly.</p>
</li>
</ul>
<p><strong>AntreaProxy</strong></p>
<ul>
<li>
<p>AntreaProxy is part of the Antrea CNI, designed to handle all Kubernetes service traffic using Open vSwitch (OVS) for more efficient packet processing.</p>
</li>
<li>
<p>When enabled, it can completely replace kube-proxy by managing service traffic routing directly at the data plane level within each node.</p>
</li>
<li>
<p>Handles traffic using OVS, which can be more efficient in packet processing compared to traditional iptables. This is beneficial for high-throughput and low-latency network environments.</p>
</li>
<li>
<p>Designed to offer better scalability and performance in large-scale Kubernetes deployments due to its efficient handling of traffic at the OVS level.</p>
</li>
<li>
<p>Integrates with Kubernetes but requires Antrea as the CNI. It monitors the Kubernetes API for changes to services and endpoints, similar to kube-proxy, but uses OVS flow rules instead of IPVS or iptables.</p>
</li>
</ul>
<p><strong>Key Differences</strong></p>
<ul>
<li><strong>Traffic Handling</strong>: Kube-proxy can use iptables or IPVS to manage traffic, which involves modifying Linux networking rules. AntreaProxy uses OVS to direct traffic, which can bypass some of the overhead associated with iptables or IPVS.</li>
<li><strong>Dependency</strong>: Kube-proxy is a standalone component within Kubernetes, while AntreaProxy is part of the Antrea CNI and requires its installation.</li>
<li><strong>Performance and Scalability</strong>: AntreaProxy generally offers better performance and scalability due to its use of OVS, particularly in environments with high numbers of services and endpoints.</li>
</ul>
<p>The choice between kube-proxy and AntreaProxy often comes down to the specific requirements of a Kubernetes deployment, such as scale, performance, and the preferred networking approach.</p>
<h3 id="antreaproxy-and-kube-proxy-together">AntreaProxy AND Kube-Proxy together</h3>
<p>AntreaProxy is enabled by default since Antrea version v0.11. When the Antrea feature gate <em>antreaProxy</em> is set to <em>true</em> Antrea will provide service loadbalancing for ClusterIP services in OVS instead of using kube-proxy and only applies to traffic coming from pods to ClusterIP services. This means we still need to have Kube-Proxy for other services, such as NodePort (external to cluster service) and node to all cluster services (including hostNetwork pods). This is a default setup. Antrea can also act as the only proxy in a Kubernetes cluster, more on that in a chapter later.</p>
<p>When traffic enters the Kubernetes cluster, eg serviceType Loadbalancer or NodePort, or node to service it will be handled by kube-proxy. Traffic originating from a pod to a cluster-service will be handled by AntreaProxy.</p>
<p>An illustration of what AntreaProxy handles when the feature gate AntreaProxy is set to true:</p>
<p>
  <figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt="antreaproxy-enabled"
      
        class="image_figure image_internal image_processed"
        width="2532"
        height="1600"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240422103533076.png"
      
      
    />

    </picture>
</figure>
</p>
<p><em>Stipulated lines illustrates the actual packet-flow, while the non-stipulated lines indicate which component being involved in the Kubernetes cluster to &quot;prepare&quot; for the forwarding of the packet from the yelb-ui pod to the yelb-app service.</em></p>
<p>The below diagrams explains what kube-proxy handles when the AntreaProxy is enabled:</p>
<p><strong>Node to service</strong></p>
<p>
  <figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt="node-to-service"
      
        class="image_figure image_internal image_processed"
        width="2716"
        height="1526"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240422103454372.png"
      
      
    />

    </picture>
</figure>
</p>
<p><strong>External to service</strong></p>
<p>
  <figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt="external-to-service"
      
        class="image_figure image_internal image_processed"
        width="2674"
        height="1774"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240422103643126.png"
      
      
    />

    </picture>
</figure>
</p>
<p>With both AntreaProxy and kube-proxy enabled at the same time we end up having two daemons with each their ruleset to forward traffic inside the Kubernetes cluster like this:</p>
<p>
  <figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt="antproxy-kubeproxy"
      
        class="image_figure image_internal image_processed"
        width="2628"
        height="1508"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240429085611322.png"
      
      
    />

    </picture>
</figure>
</p>
<h3 id="antreaproxy-all">AntreaProxy All</h3>
<p>As mentioned above, there is no need to have both kube-proxy and AntreaProxy. One can remove kube-proxy completely. AntreaProxy can handle all services, external and internal, node to service, external to service, NodePort etc.</p>
<p>To enable AntreaProxy all the following feature-gate needs to be enabled:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln">1</span><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">antrea-config</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kube-system</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w">    </span><span class="nt">antreaProxy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="w">      </span><span class="nt">proxyAll</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><p>With AntreaProxy all is enabled kube-proxy is not automatically removed (if one have a Kubernetes cluster with kube-proxy deployed). So in a cluster with kube-proxy already running, there is a couple of steps that needs to be done to remove kube-proxy and enable AntreaProxy all.</p>
<p>If one enables AntreaProxy:all and Kube-Proxy is still there, Kube-Proxy will take precedence. There is two ways to delete kube-proxy, during cluster bootstrap (<code>kubeadm init --skip-phases=addon/kube-proxy</code>) or post cluster bootstrap. Below I will go through how to delete kube-proxy on a already running cluster with kube-proxy already deployed.</p>
<p>I will follow the offical documentation from Antrea Github repo [here](kubectl -n kube-system delete ds/kube-proxy):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># Delete the kube-proxy DaemonSet</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ kubectl -n kube-system delete ds/kube-proxy
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">daemonset.apps <span class="s2">&#34;kube-proxy&#34;</span> deleted
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"># Delete the kube-proxy ConfigMap to prevent kube-proxy from being re-deployed</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"># by kubeadm during &#34;upgrade apply&#34;. This workaround will not take effect for</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"># kubeadm versions older than v1.19 as the following patch is required:</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"># https://github.com/kubernetes/kubernetes/pull/89593</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ kubectl -n kube-system delete cm/kube-proxy
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">configmap <span class="s2">&#34;kube-proxy&#34;</span> deleted
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"># Delete existing kube-proxy rules; there are several options for doing that</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"># Option 1 (if using kube-proxy in iptables mode), run the following on each Node:</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">iptables-save <span class="p">|</span> grep -v KUBE <span class="p">|</span> iptables-restore
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"># This option is not valid for me as I use IPVS</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"># Option 2 (any mode), restart all Nodes # I chose this option</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"># Option 3 (any mode), run the following on each Node:</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">kube-proxy --cleanup 
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1"># You can create a DaemonSet to easily run the above command on all Nodes, using</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="c1"># the kube-proxy container image</span>
</span></span></code></pre></div><p>After the steps above (icluding the restart of all nodes) I will need to edit the Antrea ConfigMap with the following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">antrea-config</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kube-system</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">  </span><span class="nt">antrea-agent.conf</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="sd">    kubeAPIServerOverride: &#34;https://k8s-dev-cluster-3.domain.int&#34;
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="sd">    antreaProxy:
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="sd">      proxyAll: true</span><span class="w">    
</span></span></span></code></pre></div><p>Last step is to restart the Antrea controller and Antrea agents and see if they come up again.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">k rollout restart -n kube-system deployment/antrea-controller
</span></span><span class="line"><span class="ln">2</span><span class="cl">k delete pods -n kube-system -l <span class="nv">component</span><span class="o">=</span>antrea-agent
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get pods -A
</span></span><span class="line"><span class="ln">2</span><span class="cl">NAMESPACE     NAME                                        READY   STATUS    RESTARTS        AGE
</span></span><span class="line"><span class="ln">3</span><span class="cl">kube-system   antrea-agent-7pc6r                          2/2     Running   <span class="m">0</span>               37s
</span></span><span class="line"><span class="ln">4</span><span class="cl">kube-system   antrea-agent-b6c58                          2/2     Running   <span class="m">0</span>               37s
</span></span><span class="line"><span class="ln">5</span><span class="cl">kube-system   antrea-agent-pj62z                          2/2     Running   <span class="m">0</span>               37s
</span></span><span class="line"><span class="ln">6</span><span class="cl">kube-system   antrea-agent-rcckh                          2/2     Running   <span class="m">0</span>               37s
</span></span><span class="line"><span class="ln">7</span><span class="cl">kube-system   antrea-agent-tftv5                          2/2     Running   <span class="m">0</span>               37s
</span></span><span class="line"><span class="ln">8</span><span class="cl">kube-system   antrea-agent-twpfs                          2/2     Running   <span class="m">0</span>               38s
</span></span><span class="line"><span class="ln">9</span><span class="cl">kube-system   antrea-controller-6bd6b9569c-vhx7n          1/1     Running   <span class="m">0</span>               50s
</span></span></code></pre></div><p>No kube-proxy pods:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get pods -A
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">NAMESPACE     NAME                                        READY   STATUS    RESTARTS        AGE
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">kube-system   antrea-agent-7pc6r                          2/2     Running   <span class="m">0</span>               72s
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">kube-system   antrea-agent-b6c58                          2/2     Running   <span class="m">0</span>               72s
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">kube-system   antrea-agent-pj62z                          2/2     Running   <span class="m">0</span>               72s
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">kube-system   antrea-agent-rcckh                          2/2     Running   <span class="m">0</span>               72s
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">kube-system   antrea-agent-tftv5                          2/2     Running   <span class="m">0</span>               72s
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">kube-system   antrea-agent-twpfs                          2/2     Running   <span class="m">0</span>               73s
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">kube-system   antrea-controller-6bd6b9569c-vhx7n          1/1     Running   <span class="m">0</span>               85s
</span></span><span class="line"><span class="ln">10</span><span class="cl">kube-system   coredns-77f7cc69db-jnh6m                    1/1     Running   <span class="m">1</span> <span class="o">(</span>9m36s ago<span class="o">)</span>   21h
</span></span><span class="line"><span class="ln">11</span><span class="cl">kube-system   coredns-77f7cc69db-wb5qs                    1/1     Running   <span class="m">1</span> <span class="o">(</span>9m3s ago<span class="o">)</span>    21h
</span></span><span class="line"><span class="ln">12</span><span class="cl">kube-system   dns-autoscaler-8576bb9f5b-5n7hv             1/1     Running   <span class="m">1</span> <span class="o">(</span>9m36s ago<span class="o">)</span>   21h
</span></span><span class="line"><span class="ln">13</span><span class="cl">kube-system   kube-apiserver-k8s-cp-vm-1-cl-03            1/1     Running   <span class="m">3</span> <span class="o">(</span>8m55s ago<span class="o">)</span>   21h
</span></span><span class="line"><span class="ln">14</span><span class="cl">kube-system   kube-apiserver-k8s-cp-vm-2-cl-03            1/1     Running   <span class="m">2</span> <span class="o">(</span>9m36s ago<span class="o">)</span>   21h
</span></span><span class="line"><span class="ln">15</span><span class="cl">kube-system   kube-apiserver-k8s-cp-vm-3-cl-03            1/1     Running   <span class="m">2</span> <span class="o">(</span>9m3s ago<span class="o">)</span>    21h
</span></span><span class="line"><span class="ln">16</span><span class="cl">kube-system   kube-controller-manager-k8s-cp-vm-1-cl-03   1/1     Running   <span class="m">4</span> <span class="o">(</span>9m16s ago<span class="o">)</span>   21h
</span></span><span class="line"><span class="ln">17</span><span class="cl">kube-system   kube-controller-manager-k8s-cp-vm-2-cl-03   1/1     Running   <span class="m">4</span> <span class="o">(</span>9m36s ago<span class="o">)</span>   21h
</span></span><span class="line"><span class="ln">18</span><span class="cl">kube-system   kube-controller-manager-k8s-cp-vm-3-cl-03   1/1     Running   <span class="m">4</span> <span class="o">(</span>9m3s ago<span class="o">)</span>    21h
</span></span><span class="line"><span class="ln">19</span><span class="cl">kube-system   kube-scheduler-k8s-cp-vm-1-cl-03            1/1     Running   <span class="m">3</span> <span class="o">(</span>8m45s ago<span class="o">)</span>   21h
</span></span><span class="line"><span class="ln">20</span><span class="cl">kube-system   kube-scheduler-k8s-cp-vm-2-cl-03            1/1     Running   <span class="m">2</span> <span class="o">(</span>9m36s ago<span class="o">)</span>   21h
</span></span><span class="line"><span class="ln">21</span><span class="cl">kube-system   kube-scheduler-k8s-cp-vm-3-cl-03            1/1     Running   <span class="m">3</span> <span class="o">(</span>9m3s ago<span class="o">)</span>    21h
</span></span></code></pre></div><p>No &quot;kube-ipvs0&quot; interface:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">ubuntu@k8s-node-vm-1-cl-03:~$ ip addr
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="m">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    inet 127.0.0.1/8 scope host lo
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    inet6 ::1/128 scope host
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel state UP group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    link/ether bc:24:11:f4:ee:ef brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="ln">10</span><span class="cl">    altname enp0s18
</span></span><span class="line"><span class="ln">11</span><span class="cl">    inet 10.160.1.35/24 brd 10.160.1.255 scope global eth0
</span></span><span class="line"><span class="ln">12</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="ln">13</span><span class="cl">    inet6 fe80::be24:11ff:fef4:eeef/64 scope link
</span></span><span class="line"><span class="ln">14</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="ln">15</span><span class="cl">3: ovs-system: &lt;BROADCAST,MULTICAST&gt; mtu <span class="m">1500</span> qdisc noop state DOWN group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    link/ether ee:a3:e7:de:7d:3c brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="ln">17</span><span class="cl">4: genev_sys_6081: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">65000</span> qdisc noqueue master ovs-system state UNKNOWN group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    link/ether e6:09:e7:ee:1f:fc brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="ln">19</span><span class="cl">    inet6 fe80::64c1:4aff:fe4d:f8b2/64 scope link
</span></span><span class="line"><span class="ln">20</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="ln">21</span><span class="cl">5: antrea-gw0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1450</span> qdisc noqueue state UNKNOWN group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    link/ether 62:78:99:77:56:60 brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="ln">23</span><span class="cl">    inet 10.40.68.1/24 brd 10.40.68.255 scope global antrea-gw0
</span></span><span class="line"><span class="ln">24</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="ln">25</span><span class="cl">    inet6 fe80::6078:99ff:fe77:5660/64 scope link
</span></span><span class="line"><span class="ln">26</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="ln">27</span><span class="cl">6: antrea-egress0: &lt;BROADCAST,NOARP&gt; mtu <span class="m">1500</span> qdisc noop state DOWN group default
</span></span><span class="line"><span class="ln">28</span><span class="cl">    link/ether 3e:77:85:e2:e2:1a brd ff:ff:ff:ff:ff:ff
</span></span></code></pre></div><p>With that out of the way, lets continue on the Antrea features.</p>
<h2 id="antrea-serviceexternalip">Antrea ServiceExternalIP</h2>
<p>ServiceExternalIP is a feature in Antrea to provide external IP addresses for serviceType LoadBalancer. This feature is useful when there is no external/cloud/3rd party loadbalancer available to provide these external IP addresses.</p>
<p>Today ServiceExternalIP supports ip addresses allocated from the same subnet (L2) as the Kubernetes nodes, by reserving a range of addresses for this use. It also supports a different subnet (L3) than the Kubernetes nodes themselves but one have to define static routes (host routes x.x.x.x/32) in the underlaying router/gateway to one or several of the nodes in your Kubernetes Cluster.  After I apply a service using ServiceExternalIP all nodes will be aware of this IP address and handle requests to the service regardless of which host receives them.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># worker node 2</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">ubuntu@k8s-node-vm-2-cl-02:~$ ip addr
</span></span><span class="line"><span class="ln">3</span><span class="cl">3: kube-ipvs0: &lt;BROADCAST,NOARP&gt; mtu <span class="m">1500</span> qdisc noop state DOWN group default
</span></span><span class="line"><span class="ln">4</span><span class="cl">    link/ether d6:a1:1d:13:12:8e brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="ln">5</span><span class="cl">    inet 10.169.1.40/32 scope global kube-ipvs0 <span class="c1"># IP from my ExternalIPPool</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># worker node 1</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">ubuntu@k8s-node-vm-1-cl-02:~$ ip addr
</span></span><span class="line"><span class="ln">3</span><span class="cl">3: kube-ipvs0: &lt;BROADCAST,NOARP&gt; mtu <span class="m">1500</span> qdisc noop state DOWN group default
</span></span><span class="line"><span class="ln">4</span><span class="cl">    link/ether a6:bf:87:cc:53:cc brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="ln">5</span><span class="cl">    inet 10.169.1.40/32 scope global kube-ipvs0
</span></span><span class="line"><span class="ln">6</span><span class="cl">       valid_lft forever preferred_lft forever <span class="c1"># IP from my ExternalIPPool</span>
</span></span></code></pre></div><p>And here one can see IPVS is handling this IP and is available on all nodes (if using kube-proxy with IPVS). So creating a static route and pointing to any of my Kubernetes nodes will get me to the service.</p>

<div class="notices info">
    <div class="label">Info</div>
    <p>When it comes to failure of a node and this happens to be the node you defined as the nexthop you will ofcourse loose access. One could add several routes using cost/distance, but this will not always solve the issue as the router/switch does not really know that the node is gone. It will be kept in the ARP table, and as long as its there (it may be drained after a while), the switch will continue forward traffic to it. This may ofcourse depend on router/switch also which features are implemented and can be used using static routes. There is no BFD, and a VM is not actually disconnecting anything if it goes down.</p>

  </div>

<p>ServiceExternalIP will work with Kube-Proxy using IPVS or IPTables and AntreaProxy where there is no Kube-Proxy.  If using Kube-Proxy with IPVS <em>strictARP</em> must be enabled in the kube-proxy config:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c"># configMap kube-proxy</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">  </span><span class="nt">config.conf</span><span class="p">:</span><span class="w"> </span><span class="p">|-</span><span class="sd">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="sd">    apiVersion: kubeproxy.config.k8s.io/v1alpha1
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="sd">    ipvs:
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="sd">      excludeCIDRs: []
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="sd">      minSyncPeriod: 0s
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="sd">      scheduler: rr
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="sd">      strictARP: true # set to true
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="sd">      syncPeriod: 30s
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="sd">      tcpFinTimeout: 0s
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="sd">      tcpTimeout: 0s
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="sd">      udpTimeout: 0s</span><span class="w">    
</span></span></span></code></pre></div><p>Below I will go through ServiceExternalIP using kube-proxy and only AntreaProxy</p>
<h3 id="serviceexternalip-using-kube-proxy-and-ipvs-ip-virtual-server">ServiceExternalIP using Kube-Proxy and IPVS (IP Virtual Server)</h3>
<p>When using kube-proxy with IPVS kube-proxy sets up and manage the IPVS rules. IPVS residing in the Linux Kernel is then responsible for directing incoming traffic to backend pods, as in my digram below the Yelb-UI pods.</p>
<p>
  <figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt="kube-proxy-ipvs"
      
        class="image_figure image_internal image_processed"
        width="2692"
        height="1430"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240419131227703.png"
      
      
    />

    </picture>
</figure>
</p>
<p><em>Kube-proxy listens on incoming traffic, IPVS forwards the traffic to the corresponding backend-pods.</em></p>
<p>The service and corresponding endpoints:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k describe svc -n yelb yelb-ui
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">Name:                     yelb-ui
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">Namespace:                yelb
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">Labels:                   <span class="nv">app</span><span class="o">=</span>yelb-ui
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">                          <span class="nv">tier</span><span class="o">=</span>frontend
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">Annotations:              service.antrea.io/external-ip-pool: service-external-ip-pool
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">Selector:                 <span class="nv">app</span><span class="o">=</span>yelb-ui,tier<span class="o">=</span>frontend
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">Type:                     LoadBalancer
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">IP Family Policy:         SingleStack
</span></span><span class="line"><span class="ln">10</span><span class="cl">IP Families:              IPv4
</span></span><span class="line"><span class="ln">11</span><span class="cl">IP:                       10.30.48.237
</span></span><span class="line"><span class="ln">12</span><span class="cl">IPs:                      10.30.48.237
</span></span><span class="line"><span class="ln">13</span><span class="cl">LoadBalancer Ingress:     10.169.1.40
</span></span><span class="line"><span class="ln">14</span><span class="cl">Port:                     &lt;unset&gt;  80/TCP
</span></span><span class="line"><span class="ln">15</span><span class="cl">TargetPort:               80/TCP
</span></span><span class="line"><span class="ln">16</span><span class="cl">NodePort:                 &lt;unset&gt;  32611/TCP
</span></span><span class="line"><span class="ln">17</span><span class="cl">Endpoints:                10.30.67.5:80,10.30.68.6:80,10.30.69.2:80
</span></span><span class="line"><span class="ln">18</span><span class="cl">Session Affinity:         None
</span></span><span class="line"><span class="ln">19</span><span class="cl">External Traffic Policy:  Cluster
</span></span><span class="line"><span class="ln">20</span><span class="cl">Events:                   &lt;none&gt;
</span></span></code></pre></div><p>The pods, representing the endpoints:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get pods -n yelb -owide
</span></span><span class="line"><span class="ln">2</span><span class="cl">NAME                            READY   STATUS    RESTARTS      AGE     IP           NODE                  NOMINATED NODE   READINESS GATES
</span></span><span class="line"><span class="ln">3</span><span class="cl">yelb-ui-f544fc74f-mb5m6         1/1     Running   <span class="m">0</span>             41m     10.30.68.6   k8s-node-vm-2-cl-02   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="ln">4</span><span class="cl">yelb-ui-f544fc74f-pztht         1/1     Running   <span class="m">0</span>             2m37s   10.30.67.5   k8s-node-vm-1-cl-02   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="ln">5</span><span class="cl">yelb-ui-f544fc74f-r48rx         1/1     Running   <span class="m">0</span>             2m37s   10.30.69.2   k8s-node-vm-3-cl-02   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>The IPVS loadbalancing in action:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">ubuntu@k8s-node-vm-1-cl-02:~$ sudo ipvsadm -l
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">IP Virtual Server version 1.2.1 <span class="o">(</span><span class="nv">size</span><span class="o">=</span>4096<span class="o">)</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">Prot LocalAddress:Port Scheduler Flags
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">TCP  k8s-node-vm-1-cl-02:32611 rr
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  -&gt; 10-30-67-5.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  -&gt; 10-30-68-6.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  -&gt; 10-30-69-2.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">TCP  k8s-node-vm-1-cl-02.cluster. rr
</span></span><span class="line"><span class="ln">10</span><span class="cl">  -&gt; 10-30-67-5.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  -&gt; 10-30-68-6.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  -&gt; 10-30-69-2.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">TCP  k8s-node-vm-1-cl-02:http rr
</span></span><span class="line"><span class="ln">14</span><span class="cl">  -&gt; 10-30-67-5.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  -&gt; 10-30-68-6.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  -&gt; 10-30-69-2.yelb-ui.yelb.svc. Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># All IPs involved in the yelb-ui service, pod, service etc</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">ubuntu@k8s-node-vm-3-cl-02:~$ sudo ipvsadm -L -n
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">IP Virtual Server version 1.2.1 <span class="o">(</span><span class="nv">size</span><span class="o">=</span>4096<span class="o">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">Prot LocalAddress:Port Scheduler Flags
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">TCP  10.30.63.48:80 rr
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  -&gt; 10.30.68.3:80                Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">TCP  10.30.69.1:31925 rr
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  -&gt; 10.30.68.3:80                Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">TCP  10.160.1.27:31925 rr
</span></span><span class="line"><span class="ln">11</span><span class="cl">  -&gt; 10.30.68.3:80                Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">TCP  10.169.1.40:80 rr
</span></span><span class="line"><span class="ln">13</span><span class="cl">  -&gt; 10.30.68.3:80                Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">0</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">UDP  10.30.0.3:53 rr
</span></span><span class="line"><span class="ln">15</span><span class="cl">  -&gt; 10.30.65.3:53                Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  -&gt; 10.30.66.2:53                Masq    <span class="m">1</span>      <span class="m">0</span>          <span class="m">1</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2$ k get pods -n yelb -owide
</span></span><span class="line"><span class="ln">2</span><span class="cl">NAME                            READY   STATUS    RESTARTS      AGE    IP           NODE                  NOMINATED NODE   READINESS GATES
</span></span><span class="line"><span class="ln">3</span><span class="cl">redis-server-84f4bf49b5-lstpm   1/1     Running   <span class="m">2</span> <span class="o">(</span>4d ago<span class="o">)</span>    71d    10.30.67.4   k8s-node-vm-1-cl-02   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="ln">4</span><span class="cl">yelb-appserver-6dc7cd98-4c6s5   1/1     Running   <span class="m">5</span> <span class="o">(</span>98m ago<span class="o">)</span>   71d    10.30.68.4   k8s-node-vm-2-cl-02   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="ln">5</span><span class="cl">yelb-db-84d6f6fc6c-dlp68        1/1     Running   <span class="m">5</span> <span class="o">(</span>98m ago<span class="o">)</span>   71d    10.30.68.2   k8s-node-vm-2-cl-02   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="ln">6</span><span class="cl">yelb-ui-f544fc74f-vm2b2         1/1     Running   <span class="m">1</span> <span class="o">(</span>98m ago<span class="o">)</span>   123m   10.30.68.3   k8s-node-vm-2-cl-02   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>Next chapter will cover how this looks with AntreaProxy all.</p>
<h3 id="serviceexternalip-using-only-antreaproxy">ServiceExternalIP using only AntreaProxy.</h3>
<p>Using ServiceExternalIP with only AntreaProxy there will be no IPVS, no kube-proxy involved. All rules will be configured in OVS. If there is no kube-proxy configured in the cluster there is no pre-reqs (as above) that needs to be done. To get some insight in how that looks I will dump some output below.</p>
<p>The service and the corresponding endpoints:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">andreasm@linuxmgmt01:~$ k describe svc -n yelb yelb-ui
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">Name:                     yelb-ui
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">Namespace:                yelb
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">Labels:                   <span class="nv">app</span><span class="o">=</span>yelb-ui
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">                          <span class="nv">tier</span><span class="o">=</span>frontend
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">Annotations:              service.antrea.io/external-ip-pool: service-external-ip-pool
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">Selector:                 <span class="nv">app</span><span class="o">=</span>yelb-ui,tier<span class="o">=</span>frontend
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">Type:                     LoadBalancer
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">IP Family Policy:         SingleStack
</span></span><span class="line"><span class="ln">10</span><span class="cl">IP Families:              IPv4
</span></span><span class="line"><span class="ln">11</span><span class="cl">IP:                       10.40.30.39
</span></span><span class="line"><span class="ln">12</span><span class="cl">IPs:                      10.40.30.39
</span></span><span class="line"><span class="ln">13</span><span class="cl">LoadBalancer Ingress:     10.160.1.40
</span></span><span class="line"><span class="ln">14</span><span class="cl">Port:                     &lt;unset&gt;  80/TCP
</span></span><span class="line"><span class="ln">15</span><span class="cl">TargetPort:               80/TCP
</span></span><span class="line"><span class="ln">16</span><span class="cl">NodePort:                 &lt;unset&gt;  31535/TCP
</span></span><span class="line"><span class="ln">17</span><span class="cl">Endpoints:                10.40.67.4:80,10.40.68.3:80,10.40.69.6:80
</span></span><span class="line"><span class="ln">18</span><span class="cl">Session Affinity:         None
</span></span><span class="line"><span class="ln">19</span><span class="cl">External Traffic Policy:  Cluster
</span></span><span class="line"><span class="ln">20</span><span class="cl">Events:                   &lt;none&gt;
</span></span></code></pre></div><p>The pods representing the endpoints:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">andreasm@linuxmgmt01:~$ k get pods -n yelb -owide
</span></span><span class="line"><span class="ln">2</span><span class="cl">NAME                            READY   STATUS    RESTARTS   AGE     IP           NODE                  NOMINATED NODE   READINESS GATES
</span></span><span class="line"><span class="ln">3</span><span class="cl">redis-server-84f4bf49b5-j6g8x   1/1     Running   <span class="m">0</span>          5d22h   10.40.69.3   k8s-node-vm-3-cl-03   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="ln">4</span><span class="cl">yelb-appserver-6dc7cd98-wlflx   1/1     Running   <span class="m">0</span>          5d22h   10.40.69.2   k8s-node-vm-3-cl-03   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="ln">5</span><span class="cl">yelb-db-84d6f6fc6c-qr2kv        1/1     Running   <span class="m">0</span>          5d22h   10.40.67.2   k8s-node-vm-2-cl-03   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="ln">6</span><span class="cl">yelb-ui-f544fc74f-d84gd         1/1     Running   <span class="m">0</span>          56s     10.40.69.6   k8s-node-vm-3-cl-03   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="ln">7</span><span class="cl">yelb-ui-f544fc74f-kvvht         1/1     Running   <span class="m">0</span>          5d22h   10.40.67.4   k8s-node-vm-2-cl-03   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="ln">8</span><span class="cl">yelb-ui-f544fc74f-xqhrk         1/1     Running   <span class="m">0</span>          56s     10.40.68.3   k8s-node-vm-1-cl-03   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>Output from IPVS:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">ubuntu@k8s-node-vm-1-cl-03:~$ sudo ipvsadm -l
</span></span><span class="line"><span class="ln">2</span><span class="cl">IP Virtual Server version 1.2.1 <span class="o">(</span><span class="nv">size</span><span class="o">=</span>4096<span class="o">)</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">Prot LocalAddress:Port Scheduler Flags
</span></span><span class="line"><span class="ln">4</span><span class="cl">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn
</span></span></code></pre></div><p>So much empty..</p>
<p>How does the OVS tables look like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># endpoint pod 1:</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">root@k8s-node-vm-1-cl-03:/# ovs-ofctl dump-flows br-int <span class="p">|</span> grep 10.40.68.3
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"> <span class="nv">cookie</span><span class="o">=</span>0x1010000000000, <span class="nv">duration</span><span class="o">=</span>433.630s, <span class="nv">table</span><span class="o">=</span>1, <span class="nv">n_packets</span><span class="o">=</span>4, <span class="nv">n_bytes</span><span class="o">=</span>168, <span class="nv">idle_age</span><span class="o">=</span>428, <span class="nv">priority</span><span class="o">=</span>200,arp,in_port<span class="o">=</span>4,arp_spa<span class="o">=</span>10.40.68.3,arp_sha<span class="o">=</span>6e:4d:5b:e4:99:c9 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,2<span class="o">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"> <span class="nv">cookie</span><span class="o">=</span>0x1010000000000, <span class="nv">duration</span><span class="o">=</span>433.630s, <span class="nv">table</span><span class="o">=</span>4, <span class="nv">n_packets</span><span class="o">=</span>25, <span class="nv">n_bytes</span><span class="o">=</span>4443, <span class="nv">idle_age</span><span class="o">=</span>2, <span class="nv">priority</span><span class="o">=</span>200,ip,in_port<span class="o">=</span>4,dl_src<span class="o">=</span>6e:4d:5b:e4:99:c9,nw_src<span class="o">=</span>10.40.68.3 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,5<span class="o">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"> <span class="nv">cookie</span><span class="o">=</span>0x1030000000000, <span class="nv">duration</span><span class="o">=</span>427.300s, <span class="nv">table</span><span class="o">=</span>12, <span class="nv">n_packets</span><span class="o">=</span>1, <span class="nv">n_bytes</span><span class="o">=</span>78, <span class="nv">idle_age</span><span class="o">=</span>10, <span class="nv">priority</span><span class="o">=</span>200,tcp,reg3<span class="o">=</span>0xa284403,reg4<span class="o">=</span>0x20050/0x7ffff <span class="nv">actions</span><span class="o">=</span>ct<span class="o">(</span>commit,table<span class="o">=</span>13,zone<span class="o">=</span>65520,nat<span class="o">(</span><span class="nv">dst</span><span class="o">=</span>10.40.68.3:80<span class="o">)</span>,exec<span class="o">(</span>load:0x1-&gt;NXM_NX_CT_MARK<span class="o">[</span>4<span class="o">]</span>,move:NXM_NX_REG0<span class="o">[</span>0..3<span class="o">]</span>-&gt;NXM_NX_CT_MARK<span class="o">[</span>0..3<span class="o">]))</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"> <span class="nv">cookie</span><span class="o">=</span>0x1010000000000, <span class="nv">duration</span><span class="o">=</span>433.630s, <span class="nv">table</span><span class="o">=</span>17, <span class="nv">n_packets</span><span class="o">=</span>28, <span class="nv">n_bytes</span><span class="o">=</span>5264, <span class="nv">idle_age</span><span class="o">=</span>2, <span class="nv">priority</span><span class="o">=</span>200,ip,reg0<span class="o">=</span>0x200/0x200,nw_dst<span class="o">=</span>10.40.68.3 <span class="nv">actions</span><span class="o">=</span>mod_dl_src:62:78:99:77:56:60,mod_dl_dst:6e:4d:5b:e4:99:c9,resubmit<span class="o">(</span>,19<span class="o">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"> <span class="nv">cookie</span><span class="o">=</span>0x1030000000000, <span class="nv">duration</span><span class="o">=</span>427.300s, <span class="nv">table</span><span class="o">=</span>20, <span class="nv">n_packets</span><span class="o">=</span>0, <span class="nv">n_bytes</span><span class="o">=</span>0, <span class="nv">idle_age</span><span class="o">=</span>427, <span class="nv">priority</span><span class="o">=</span>190,ct_state<span class="o">=</span>+new+trk,ip,nw_src<span class="o">=</span>10.40.68.3,nw_dst<span class="o">=</span>10.40.68.3 <span class="nv">actions</span><span class="o">=</span>ct<span class="o">(</span>commit,table<span class="o">=</span>21,zone<span class="o">=</span>65520,exec<span class="o">(</span>load:0x1-&gt;NXM_NX_CT_MARK<span class="o">[</span>5<span class="o">]</span>,load:0x1-&gt;NXM_NX_CT_MARK<span class="o">[</span>6<span class="o">]))</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"># endpoint pod 2:</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">root@k8s-node-vm-1-cl-03:/# ovs-ofctl dump-flows br-int <span class="p">|</span> grep 10.40.67.4
</span></span><span class="line"><span class="ln">10</span><span class="cl"> <span class="nv">cookie</span><span class="o">=</span>0x1030000000000, <span class="nv">duration</span><span class="o">=</span>512942.550s, <span class="nv">table</span><span class="o">=</span>12, <span class="nv">n_packets</span><span class="o">=</span>18, <span class="nv">n_bytes</span><span class="o">=</span>1404, <span class="nv">idle_age</span><span class="o">=</span>65534, <span class="nv">hard_age</span><span class="o">=</span>65534, <span class="nv">priority</span><span class="o">=</span>200,tcp,reg3<span class="o">=</span>0xa284304,reg4<span class="o">=</span>0x20050/0x7ffff <span class="nv">actions</span><span class="o">=</span>ct<span class="o">(</span>commit,table<span class="o">=</span>13,zone<span class="o">=</span>65520,nat<span class="o">(</span><span class="nv">dst</span><span class="o">=</span>10.40.67.4:80<span class="o">)</span>,exec<span class="o">(</span>load:0x1-&gt;NXM_NX_CT_MARK<span class="o">[</span>4<span class="o">]</span>,move:NXM_NX_REG0<span class="o">[</span>0..3<span class="o">]</span>-&gt;NXM_NX_CT_MARK<span class="o">[</span>0..3<span class="o">]))</span>
</span></span></code></pre></div><h2 id="l7flowexporter---new-in-antrea-v1150">L7FlowExporter - new in Antrea v.1.15.0</h2>
<p>FlowExport in Antrea is something I have covered previously <a href="https://blog.andreasm.io/2023/06/01/managing-antrea-in-vsphere-with-tanzu/#flow-exporter---ipfix">here</a>, but this time I would like to have a look at the new Layer7 FlowExport. Lets configure it and see some flows with Layer7 information.</p>
<p>To be able to use the L7FlowExporter and get the additional L7 flow information I need to enable the <code>L7FlowExporter</code> feature gate. So in my Antrea configMap:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln">1</span><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">  </span><span class="nt">antrea-agent.conf</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="sd">      L7FlowExporter: true      </span><span class="w">      
</span></span></span></code></pre></div><p>Restart Antrea controller and agents:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">andreasm@linuxmgmt01:~$ k edit configmaps -n kube-system antrea-config
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">configmap/antrea-config edited
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">andreasm@linuxmgmt01:~$ k rollout restart -n kube-system deployment/antrea-controller
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">deployment.apps/antrea-controller restarted
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">andreasm@linuxmgmt01:~$ k delete pods -n kube-system -l <span class="nv">component</span><span class="o">=</span>antrea-agent
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">pod <span class="s2">&#34;antrea-agent-4wtgw&#34;</span> deleted
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">pod <span class="s2">&#34;antrea-agent-8gjvw&#34;</span> deleted
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">pod <span class="s2">&#34;antrea-agent-h72qd&#34;</span> deleted
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">pod <span class="s2">&#34;antrea-agent-lg52n&#34;</span> deleted
</span></span><span class="line"><span class="ln">10</span><span class="cl">pod <span class="s2">&#34;antrea-agent-z8knw&#34;</span> deleted
</span></span><span class="line"><span class="ln">11</span><span class="cl">pod <span class="s2">&#34;antrea-agent-zf9l6&#34;</span> deleted
</span></span></code></pre></div><p>To further enable the L7 flow information I need to annotate either my pods or a whole namespace with the following key: <code>visibility.antrea.io/l7-export=X</code> the values can be ìngress, egress or both as it depends on which direction I want the L7 flow information. In the example below I will annotate my Ubuntu pod using the value <code>both</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln">1</span><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">    </span><span class="nt">visibility.antrea.io/l7-export</span><span class="p">:</span><span class="w"> </span><span class="l">both</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-20-04</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="w"></span><span class="c"># or just annotate the pod directly</span><span class="w">
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="w"></span><span class="l">k annotate pod -n egress ubuntu-20-04-59d474f9df-dv9ms visibility.antrea.io/l7-export=both</span><span class="w">
</span></span></span></code></pre></div><p>Let see what kind of information I get when I try to access a web page using HTTP from the Ubuntu pod itself.</p>
<p>I will use Theia as my tool to receive and visualize my IPFIX flows, I have already covered Theia <a href="https://blog.andreasm.io/2023/06/01/managing-antrea-in-vsphere-with-tanzu/#theia">here</a>.</p>

<div class="notices info">
    <div class="label">Info</div>
    <p>When enabling the L7FlowExport the current Theia installation does not have the correct columns in place in the Clickhouse DB leading to FlowAggregator pod failing. It will complain about the missing columns. The following tables <em>default.flows</em> and <em>default.flows_local</em> needs to add the following columns:</p>
<ul>
<li>appProtocolName</li>
<li>httpVals</li>
<li>egressNodeName</li>
</ul>
<p>Inside the chi-clickhouse-clickhouse-0-0-0 pod execute the following:</p>
<p>root@chi-clickhouse-clickhouse-0-0-0:/# clickhouse-client</p>
<p>chi-clickhouse-clickhouse-0-0-0.chi-clickhouse-clickhouse-0-0.flow-visibility.svc.cluster.local :) ALTER TABLE default.flows ADD COLUMN appProtocolName String;</p>
<p>Repeat for the other two columns, in both tables</p>

  </div>

<p>Screenshot from the Grafana dashboard:</p>
<p>
  <figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt="http-flow-information"
      
        class="image_figure image_internal image_processed"
        width="2555"
        height="512"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240503134419288.png"
      
      
    />

    </picture>
</figure>
</p>
<p>I can see the HTTP protocol and the httpVals column is displaying this information:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">{&#34;0&#34;:{&#34;hostname&#34;:&#34;www.vg.no&#34;,&#34;url&#34;:&#34;/&#34;,&#34;http_user_agent&#34;:&#34;curl/7.68.0&#34;,&#34;http_content_type&#34;:&#34;&#34;,&#34;http_method&#34;:&#34;GET&#34;,&#34;protocol&#34;:&#34;HTTP/1.1&#34;,&#34;status&#34;:301,&#34;length&#34;:0}}
</span></span></code></pre></div><p>I have remove a lot of columns in the screenshot above for clarity. For more information on Flow-Export head over <a href="https://antrea.io/docs/v2.0.0/docs/network-flow-visibility/#flow-exporter">here</a> and <a href="https://github.com/antrea-io/antrea/blob/main/docs/network-flow-visibility.md">here</a>.</p>
<h2 id="node-networkpolicy-and-externalnode-policy">Node NetworkPolicy and ExternalNode Policy</h2>
<p>In this section I will have a look at two features that makes it possible to secure the Kubernetes nodes themselves using Antrea and external nodes, not being a Kubernetes node but a VM outside of the Kubernetes cluster. There can be many usecases for such a feature. If there is no physical firewall in between the segments or the nodes, still we need to enforce some kind of security to restrict certain lateral movement between nodes and or other VMs or bare-metal servers in the environment. Being able to do microsegmentation is important.</p>
<h3 id="node-networkpolicy---new-in-antrea-v115">Node NetworkPolicy - new in Antrea v1.15</h3>
<p>
  <figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt="node-policy-1"
      
        class="image_figure image_internal image_processed"
        width="1932"
        height="1594"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240505115441833.png"
      
      
    />

    </picture>
</figure>
</p>
<p>The diagram above tries to illustrate a communication pattern where the Kubernetes nodes is hosting a service running on port 80/TCP and some external resources is trying to reach those services. I will define a policy that will only allow access originating from certain subnets and drop all else. If I am exposing the service using an external LoadBalancer I could potentially restrict access to this service coming only from the LoadBalancer itself, nothing else. Lets have a look at the rule itself and apply it in i a real Kubernetes cluster.</p>
<p>The example rule I am using in this case is taken from the official Antrea documentation <a href="https://github.com/antrea-io/antrea/blob/main/docs/antrea-node-network-policy.md">here</a> with some modifications by me.</p>
<p>The rule (notice the kind, it is a ClusterNetworkPolicy):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">crd.antrea.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterNetworkPolicy</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">restrict-http-to-node</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">  </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l">application</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">  </span><span class="nt">appliedTo</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">    </span>- <span class="nt">nodeSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">        </span><span class="nt">matchExpressions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">        </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;kubernetes.io/hostname&#34;</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">          </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;In&#34;</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">          </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;k8s-node-vm-1-cl-02&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;k8s-node-vm-2-cl-02&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;k8s-node-vm-3-cl-02&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">  </span><span class="nt">ingress</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">allow-cidr</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">      </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l">Allow</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">      </span><span class="nt">from</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">        </span>- <span class="nt">ipBlock</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">            </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="m">10.100.5.0</span><span class="l">/24</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">        </span>- <span class="nt">ipBlock</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w">            </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="m">172.18.6.0</span><span class="l">/24</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w">        </span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">drop-other</span><span class="w">
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="w">      </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l">Drop</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="w">        </span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></div><p>The policy above will be applied to all nodes having the key/value label <code>kubernetes.io/hostname: k8s-worker-node</code>allowing port 80/TCP from 10.100.5.0/24 and 172.18.6.0/24 and  block all else trying to reach port 80/TCP.</p>
<p>Now before I can go ahead and apply this policy and I need to enable the feature gate NodeNetworkPolicy:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln">1</span><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">antrea-config</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kube-system</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w">  </span><span class="nt">antrea-agent.conf</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="sd">    featureGates:
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="sd">      NodeNetworkPolicy: true</span><span class="w">    
</span></span></span></code></pre></div><p>Restart all Antrea pods:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">andreasm@linuxmgmt01:~$ k delete pods -n kube-system -l <span class="nv">app</span><span class="o">=</span>antrea
</span></span><span class="line"><span class="ln">2</span><span class="cl">pod <span class="s2">&#34;antrea-agent-gz9nt&#34;</span> deleted
</span></span><span class="line"><span class="ln">3</span><span class="cl">pod <span class="s2">&#34;antrea-agent-mcck5&#34;</span> deleted
</span></span><span class="line"><span class="ln">4</span><span class="cl">pod <span class="s2">&#34;antrea-agent-qqr6l&#34;</span> deleted
</span></span><span class="line"><span class="ln">5</span><span class="cl">pod <span class="s2">&#34;antrea-agent-spmz8&#34;</span> deleted
</span></span><span class="line"><span class="ln">6</span><span class="cl">pod <span class="s2">&#34;antrea-agent-vnll7&#34;</span> deleted
</span></span><span class="line"><span class="ln">7</span><span class="cl">pod <span class="s2">&#34;antrea-agent-xrr2p&#34;</span> deleted
</span></span><span class="line"><span class="ln">8</span><span class="cl">pod <span class="s2">&#34;antrea-controller-576fdb765-h7tbc&#34;</span> deleted
</span></span></code></pre></div><p>After the policy has been applied I can check easily if it is in effect by using the command below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">andreasm@linuxmgmt01:~/prod-cluster-2/antrea-policies$ k get acnp
</span></span><span class="line"><span class="ln">2</span><span class="cl">NAME                    TIER          PRIORITY   DESIRED NODES   CURRENT NODES   AGE
</span></span><span class="line"><span class="ln">3</span><span class="cl">restrict-http-to-node   application   <span class="m">5</span>          <span class="m">3</span>               <span class="m">3</span>               16m
</span></span></code></pre></div><p>My cluster consists of 3 control plane nodes and 3 worker nodes. I can see my policy as been applied to at least 3, which I assume is my worker nodes. Lets dig into that deeper a bit later. But lets see if the policy is being enforced.</p>
<p>From my laptop or from my linux vm, from both subnets that should be allowed:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">andreasm@linuxmgmt01:~$ curl http://10.169.1.40
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">&lt;!doctype html&gt;
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">&lt;html&gt;
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    &lt;meta <span class="nv">charset</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span>&gt;
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    &lt;title&gt;Yelb&lt;/title&gt;
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    &lt;base <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;/&#34;</span>&gt;
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    &lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">&#34;viewport&#34;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&#34;width=device-width, initial-scale=1&#34;</span>&gt;
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    &lt;link <span class="nv">rel</span><span class="o">=</span><span class="s2">&#34;icon&#34;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;image/x-icon&#34;</span> <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;favicon.ico?v=2&#34;</span>&gt;
</span></span><span class="line"><span class="ln">10</span><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="ln">11</span><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="ln">12</span><span class="cl">&lt;yelb&gt;Loading...&lt;/yelb&gt;
</span></span><span class="line"><span class="ln">13</span><span class="cl">&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;inline.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;styles.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;scripts.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;vendor.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;main.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;/body&gt;
</span></span><span class="line"><span class="ln">14</span><span class="cl">&lt;/html&gt;
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1"># From my laptop</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">andreasm@laptop:~$ curl http://10.169.1.40
</span></span><span class="line"><span class="ln">18</span><span class="cl">&lt;!doctype html&gt;
</span></span><span class="line"><span class="ln">19</span><span class="cl">&lt;html&gt;
</span></span><span class="line"><span class="ln">20</span><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="ln">21</span><span class="cl">    &lt;meta <span class="nv">charset</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span>&gt;
</span></span><span class="line"><span class="ln">22</span><span class="cl">    &lt;title&gt;Yelb&lt;/title&gt;
</span></span><span class="line"><span class="ln">23</span><span class="cl">    &lt;base <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;/&#34;</span>&gt;
</span></span><span class="line"><span class="ln">24</span><span class="cl">    &lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">&#34;viewport&#34;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&#34;width=device-width, initial-scale=1&#34;</span>&gt;
</span></span><span class="line"><span class="ln">25</span><span class="cl">    &lt;link <span class="nv">rel</span><span class="o">=</span><span class="s2">&#34;icon&#34;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;image/x-icon&#34;</span> <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;favicon.ico?v=2&#34;</span>&gt;
</span></span><span class="line"><span class="ln">26</span><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="ln">27</span><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="ln">28</span><span class="cl">&lt;yelb&gt;Loading...&lt;/yelb&gt;
</span></span><span class="line"><span class="ln">29</span><span class="cl">&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;inline.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;styles.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;scripts.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;vendor.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;script <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nv">src</span><span class="o">=</span><span class="s2">&#34;main.bundle.js&#34;</span>&gt;&lt;/script&gt;&lt;/body&gt;
</span></span><span class="line"><span class="ln">30</span><span class="cl">&lt;/html&gt;
</span></span></code></pre></div><p>From any other subnet (other machines) from any other subnet not defined as allowed:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">andreasm@linuxmgmt02:~$ ip addr
</span></span><span class="line"><span class="ln">2</span><span class="cl">2: ens18: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc fq_codel state UP group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    link/ether f6:97:82:3b:9a:9e brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="ln">4</span><span class="cl">    inet 172.18.5.40/24 brd 172.18.5.255 scope global ens18
</span></span><span class="line"><span class="ln">5</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="ln">6</span><span class="cl">       
</span></span><span class="line"><span class="ln">7</span><span class="cl">andreasm@linuxmgmt02:~$ curl http://10.169.1.40
</span></span><span class="line"><span class="ln">8</span><span class="cl">curl: <span class="o">(</span>28<span class="o">)</span> Failed to connect to 10.169.1.40 port 80: Connection timed out
</span></span></code></pre></div><p>Another example can be to drop certain ports between the nodes in a Kubernetes cluster itself with an example policy like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">crd.antrea.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterNetworkPolicy</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">egress-drop-node-to-node</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">  </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l">application</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">  </span><span class="nt">appliedTo</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">    </span>- <span class="nt">nodeSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">        </span><span class="nt">matchExpressions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">        </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;kubernetes.io/hostname&#34;</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">          </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;In&#34;</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">          </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;k8s-node-vm-1-cl-02&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;k8s-node-vm-2-cl-02&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;k8s-node-vm-3-cl-02&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">  </span><span class="nt">egress</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">drop-22</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">      </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l">Drop</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">      </span><span class="nt">to</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">        </span>- <span class="nt">nodeSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">            </span><span class="nt">matchExpressions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">            </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;kubernetes.io/hostname&#34;</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w">              </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;In&#34;</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w">              </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;k8s-node-vm-1-cl-02&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;k8s-node-vm-2-cl-02&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;k8s-node-vm-3-cl-02&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w">        </span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">22</span><span class="w">
</span></span></span></code></pre></div><p>
  <figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt="node-2-node-ssh"
      
        class="image_figure image_internal image_processed"
        width="1942"
        height="786"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240505140038911.png"
      
      
    />

    </picture>
</figure>
</p>
<p>Now if I try to reach the any of my Kubernetes worker nodes from any of my Kubernetes nodes using SSH:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># node 1 to node 2 over SSH</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">ubuntu@k8s-node-vm-1-cl-02:~$ ssh ubuntu@10.160.1.26
</span></span><span class="line"><span class="ln">3</span><span class="cl">ssh: connect to host 10.160.1.26 port 22: Connection timed out
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># node 1 to any other machine over SSH</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">ubuntu@k8s-node-vm-1-cl-02:~$ ssh andreasm@10.100.5.10
</span></span><span class="line"><span class="ln">3</span><span class="cl">The authenticity of host <span class="s1">&#39;10.100.5.10 (10.100.5.10)&#39;</span> can<span class="err">&#39;</span>t be established.
</span></span><span class="line"><span class="ln">4</span><span class="cl">ED25519 key fingerprint is SHA256:Ue0UyrCk679JwN8QbaRLviCdEfxg7lnu+3RXVryujA8.
</span></span><span class="line"><span class="ln">5</span><span class="cl">This key is not known by any other names
</span></span><span class="line"><span class="ln">6</span><span class="cl">Are you sure you want to <span class="k">continue</span> connecting <span class="o">(</span>yes/no/<span class="o">[</span>fingerprint<span class="o">])</span>?
</span></span></code></pre></div><p>Play around with this new feature making it possible to also apply and enforce security policies on the nodes themselves opens up for a much more granual and controlled environment if one have these requirements. On edge usecases this can also be very valuable.</p>
<h3 id="externalnode-policy">ExternalNode Policy</h3>
<p>I just want to highlight this feature in its own chapter as I feel it is relevant, and may be a very good combination with the NodePolicy feature. A Kubernetes cluster with its running workload is often depending on external backend services, like external DB/DNS/NTP services hosted somewhere else in the datacenter.</p>
<p>With Antrea ExternalNode policy it is possible to manage security policies on non Kubernetes workload, like any regular virtual machine or bare-metal server using Antrea NetworkPolicy from your Kubernetes/API. See illustration below:</p>
<p>
  <figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt="external-node"
      
        class="image_figure image_internal image_processed"
        width="2256"
        height="1530"
        src="/2024/04/16/exploring-some-antrea-features/images/image-20240505143235685.png"
      
      
    />

    </picture>
</figure>
</p>
<p>For information on how to configure this, head over to the following pages <a href="https://github.com/antrea-io/antrea/blob/main/docs/external-node.md">here</a> and <a href="https://github.com/antrea-io/antrea/blob/main/docs/external-node.md#install-antrea-agent-on-vm">here</a>.</p>
<h2 id="outro">Outro</h2>
<p>Thats it for this time. Some features I find interesting in Antrea, head over to the official Antrea docs page <a href="antrea.io">here</a> and Github repo <a href="https://github.com/antrea-io/antrea/tree/main">here</a> for always updated and more information. Speaking of updated information, in time of writing this blog post Antrea 2.0 is released!
<a href="https://github.com/antrea-io/antrea/releases/tag/v2.0.0">Antrea v2.0</a></p>

    </div>




  </article>
<aside class="sidebar">
  <section class="sidebar_inner">
    <br>
    
  
  <div class="search">
    <input type="search" class="search_field form_field" placeholder='Search...' id="find" autocomplete="off" data-scope='post'>
    <label for="find" class="search_label"><svg class="icon">
  <title>search</title>
  <use xlink:href="#search"></use>
</svg>

    </label>
    
    <div class="search_results results"></div>
  </div>

        <h2>Hi there</h2>
      <div class="author_bio">
        This is Andreas Marqvardsen's blog, a Lead Solution Engineer at VMware by Broadcom. This blog focuses on Kubernetes, Kubernetes infrastructure such as networking and security and stuff he finds interesting.
      </div>
      <a href='https://blog.andreasm.io/about/' class="button mt-1" role="button" title='Read More'>Read More</a>

    
    
    <h2 class="mt-4">Recent Posts</h2>
    <ul class="flex-column">
      <li>
        <a href="https://blog.andreasm.io/2024/08/22/arista-cloudvision-and-avd-using-containerlab/" class="nav-link" title="Arista Cloudvision and AVD using Containerlab">Arista Cloudvision and AVD using Containerlab</a>
      </li>
      <li>
        <a href="https://blog.andreasm.io/2024/06/10/arista-automated-configuration-using-ansible/" class="nav-link" title="Arista Automated Configuration using Ansible">Arista Automated Configuration using Ansible</a>
      </li>
      <li>
        <a href="https://blog.andreasm.io/2024/04/16/exploring-some-antrea-features/" class="nav-link" title="Exploring some Antrea Features">Exploring some Antrea Features</a>
      </li>
      <li>
        <a href="https://blog.andreasm.io/2024/04/08/vsphere-with-tanzu-avi-and-multiple-supervisors/" class="nav-link" title="vSphere with Tanzu - Avi and Multiple Supervisors">vSphere with Tanzu - Avi and Multiple Supervisors</a>
      </li>
      <li>
        <a href="https://blog.andreasm.io/2024/02/04/argo-cd-vsphere-with-tanzu/" class="nav-link" title="Argo CD &amp; vSphere with Tanzu">Argo CD &amp; vSphere with Tanzu</a>
      </li>
      <li>
        <a href="https://blog.andreasm.io/2024/01/15/proxmox-with-opentofu-kubespray-and-kubernetes/" class="nav-link" title="Proxmox with OpenTofu Kubespray and Kubernetes">Proxmox with OpenTofu Kubespray and Kubernetes</a>
      </li>
      <li>
        <a href="https://blog.andreasm.io/2023/12/26/traefik-proxy-in-kubernetes/" class="nav-link" title="Traefik Proxy in Kubernetes">Traefik Proxy in Kubernetes</a>
      </li>
      <li>
        <a href="https://blog.andreasm.io/2023/12/18/a-quick-glance-at-cilium-cni/" class="nav-link" title="A Quick Glance at Cilium CNI">A Quick Glance at Cilium CNI</a>
      </li>
    </ul>
    <div>
      <h2 class="mt-4 taxonomy" id="categories-section">Categories</h2>
      <nav class="tags_nav">
        <a href='https://blog.andreasm.io/categories/kubernetes/' class="post_tag button button_translucent" title="kubernetes">
          KUBERNETES
          <span class="button_tally">42</span>
        </a>
        
        <a href='https://blog.andreasm.io/categories/networking/' class="post_tag button button_translucent" title="networking">
          NETWORKING
          <span class="button_tally">22</span>
        </a>
        
        <a href='https://blog.andreasm.io/categories/tanzu/' class="post_tag button button_translucent" title="tanzu">
          TANZU
          <span class="button_tally">13</span>
        </a>
        
        <a href='https://blog.andreasm.io/categories/cni/' class="post_tag button button_translucent" title="cni">
          CNI
          <span class="button_tally">9</span>
        </a>
        
        <a href='https://blog.andreasm.io/categories/loadbalancing/' class="post_tag button button_translucent" title="loadbalancing">
          LOADBALANCING
          <span class="button_tally">9</span>
        </a>
        
        <a href='https://blog.andreasm.io/categories/security/' class="post_tag button button_translucent" title="security">
          SECURITY
          <span class="button_tally">7</span>
        </a>
        
        <a href='https://blog.andreasm.io/categories/avi/' class="post_tag button button_translucent" title="avi">
          AVI
          <span class="button_tally">6</span>
        </a>
        
        <a href='https://blog.andreasm.io/categories/nsx/' class="post_tag button button_translucent" title="nsx">
          NSX
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://blog.andreasm.io/categories/antrea/' class="post_tag button button_translucent" title="antrea">
          ANTREA
          <span class="button_tally">4</span>
        </a>
        
        <a href='https://blog.andreasm.io/categories/automation/' class="post_tag button button_translucent" title="automation">
          AUTOMATION
          <span class="button_tally">4</span>
        </a>
        
        <a href='https://blog.andreasm.io/categories/blog/' class="post_tag button button_translucent" title="blog">
          BLOG
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://blog.andreasm.io/categories/network/' class="post_tag button button_translucent" title="network">
          NETWORK
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://blog.andreasm.io/categories/provisioning/' class="post_tag button button_translucent" title="provisioning">
          PROVISIONING
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://blog.andreasm.io/categories/vmware-nsx/' class="post_tag button button_translucent" title="vmware nsx">
          VMWARE NSX
          <span class="button_tally">2</span>
        </a>
        
        
        <br>
        <div class="post_tags_toggle button">All Categories</div>
        <div class="post_tags">
          <div class="tags_list">
            
            <a href='https://blog.andreasm.io/categories/antrea/' class=" post_tag button button_translucent" data-position=4 title="antrea">ANTREA<span class="button_tally">4</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/argocd/' class=" post_tag button button_translucent" data-position=1 title="argocd">ARGOCD<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/arista/' class=" post_tag button button_translucent" data-position=1 title="arista">ARISTA<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/automation/' class=" post_tag button button_translucent" data-position=4 title="automation">AUTOMATION<span class="button_tally">4</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/autoscaling/' class=" post_tag button button_translucent" data-position=1 title="autoscaling">AUTOSCALING<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/avi/' class=" post_tag button button_translucent" data-position=6 title="avi">AVI<span class="button_tally">6</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/blog/' class=" post_tag button button_translucent" data-position=2 title="blog">BLOG<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/ceos/' class=" post_tag button button_translucent" data-position=1 title="ceos">CEOS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/certificate/' class=" post_tag button button_translucent" data-position=1 title="certificate">CERTIFICATE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/cni/' class=" post_tag button button_translucent" data-position=9 title="cni">CNI<span class="button_tally">9</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/compliance/' class=" post_tag button button_translucent" data-position=1 title="compliance">COMPLIANCE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/docker/' class=" post_tag button button_translucent" data-position=1 title="docker">DOCKER<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/ebpf/' class=" post_tag button button_translucent" data-position=1 title="ebpf">EBPF<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/github/' class=" post_tag button button_translucent" data-position=1 title="github">GITHUB<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/gitops/' class=" post_tag button button_translucent" data-position=1 title="gitops">GITOPS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/harbor/' class=" post_tag button button_translucent" data-position=1 title="harbor">HARBOR<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/helm/' class=" post_tag button button_translucent" data-position=1 title="helm">HELM<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/home-automation/' class=" post_tag button button_translucent" data-position=1 title="home-automation">HOME-AUTOMATION<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/hugo/' class=" post_tag button button_translucent" data-position=1 title="hugo">HUGO<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/ingress/' class=" post_tag button button_translucent" data-position=1 title="ingress">INGRESS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/kubernetes/' class=" post_tag button button_translucent" data-position=42 title="kubernetes">KUBERNETES<span class="button_tally">42</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/kubernetes-management/' class=" post_tag button button_translucent" data-position=1 title="kubernetes-management">KUBERNETES-MANAGEMENT<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/lcm/' class=" post_tag button button_translucent" data-position=1 title="lcm">LCM<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/lifecycle-management/' class=" post_tag button button_translucent" data-position=1 title="lifecycle-management">LIFECYCLE-MANAGEMENT<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/loadbalancing/' class=" post_tag button button_translucent" data-position=9 title="loadbalancing">LOADBALANCING<span class="button_tally">9</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/management/' class=" post_tag button button_translucent" data-position=1 title="management">MANAGEMENT<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/monitoring/' class=" post_tag button button_translucent" data-position=1 title="monitoring">MONITORING<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/netowkring/' class=" post_tag button button_translucent" data-position=1 title="netowkring">NETOWKRING<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/network/' class=" post_tag button button_translucent" data-position=2 title="network">NETWORK<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/networking/' class=" post_tag button button_translucent" data-position=22 title="networking">NETWORKING<span class="button_tally">22</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/neuvector/' class=" post_tag button button_translucent" data-position=1 title="neuvector">NEUVECTOR<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/nsx/' class=" post_tag button button_translucent" data-position=5 title="nsx">NSX<span class="button_tally">5</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/nsx-alb/' class=" post_tag button button_translucent" data-position=1 title="nsx-alb">NSX-ALB<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/nsx-t/' class=" post_tag button button_translucent" data-position=1 title="nsx-t">NSX-T<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/pinniped/' class=" post_tag button button_translucent" data-position=1 title="pinniped">PINNIPED<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/provisioning/' class=" post_tag button button_translucent" data-position=2 title="provisioning">PROVISIONING<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/rancher/' class=" post_tag button button_translucent" data-position=1 title="rancher">RANCHER<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/rbac/' class=" post_tag button button_translucent" data-position=1 title="rbac">RBAC<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/rke2/' class=" post_tag button button_translucent" data-position=1 title="rke2">RKE2<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/security/' class=" post_tag button button_translucent" data-position=7 title="security">SECURITY<span class="button_tally">7</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/storage/' class=" post_tag button button_translucent" data-position=1 title="storage">STORAGE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/suse/' class=" post_tag button button_translucent" data-position=1 title="suse">SUSE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/tanzu/' class=" post_tag button button_translucent" data-position=13 title="tanzu">TANZU<span class="button_tally">13</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/tanzu-mission-control/' class=" post_tag button button_translucent" data-position=1 title="tanzu mission control">TANZU MISSION CONTROL<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/tkg/' class=" post_tag button button_translucent" data-position=1 title="tkg">TKG<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/tkgi/' class=" post_tag button button_translucent" data-position=1 title="tkgi">TKGI<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/tmc/' class=" post_tag button button_translucent" data-position=1 title="tmc">TMC<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/troubleshooting/' class=" post_tag button button_translucent" data-position=1 title="troubleshooting">TROUBLESHOOTING<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/veos/' class=" post_tag button button_translucent" data-position=1 title="veos">VEOS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/virtualization/' class=" post_tag button button_translucent" data-position=1 title="virtualization">VIRTUALIZATION<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/vmare-nsx-intelligence/' class=" post_tag button button_translucent" data-position=1 title="vmare nsx intelligence">VMARE NSX INTELLIGENCE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/vmware-nsx/' class=" post_tag button button_translucent" data-position=2 title="vmware nsx">VMWARE NSX<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/vmware-cloud/' class=" post_tag button button_translucent" data-position=1 title="vmware-cloud">VMWARE-CLOUD<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/categories/vsphere/' class=" post_tag button button_translucent" data-position=1 title="vsphere">VSPHERE<span class="button_tally">1</span>
            </a>
            
            <div class="tags_sort"><span title="sort alphabetically">[A~Z]</span><span title="sort by count">[0~9]</span>
            </div>
            <span class="tags_hide"><svg class="icon">
            <use xlink:href="#closeme"></use>
          </svg></span>
          </div>
        </div>
      </nav>
    </div>
    <div>
      <h2 class="mt-4 taxonomy" id="tags-section">Tags</h2>
      <nav class="tags_nav">
        <a href='https://blog.andreasm.io/tags/kubernetes/' class="post_tag button button_translucent" title="kubernetes">
          KUBERNETES
          <span class="button_tally">24</span>
        </a>
        
        <a href='https://blog.andreasm.io/tags/tanzu/' class="post_tag button button_translucent" title="tanzu">
          TANZU
          <span class="button_tally">14</span>
        </a>
        
        <a href='https://blog.andreasm.io/tags/nsx/' class="post_tag button button_translucent" title="nsx">
          NSX
          <span class="button_tally">13</span>
        </a>
        
        <a href='https://blog.andreasm.io/tags/antrea/' class="post_tag button button_translucent" title="antrea">
          ANTREA
          <span class="button_tally">12</span>
        </a>
        
        <a href='https://blog.andreasm.io/tags/ako/' class="post_tag button button_translucent" title="ako">
          AKO
          <span class="button_tally">8</span>
        </a>
        
        <a href='https://blog.andreasm.io/tags/avi/' class="post_tag button button_translucent" title="avi">
          AVI
          <span class="button_tally">7</span>
        </a>
        
        <a href='https://blog.andreasm.io/tags/loadbalancing/' class="post_tag button button_translucent" title="loadbalancing">
          LOADBALANCING
          <span class="button_tally">7</span>
        </a>
        
        <a href='https://blog.andreasm.io/tags/security/' class="post_tag button button_translucent" title="security">
          SECURITY
          <span class="button_tally">7</span>
        </a>
        
        <a href='https://blog.andreasm.io/tags/ingress/' class="post_tag button button_translucent" title="ingress">
          INGRESS
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://blog.andreasm.io/tags/networking/' class="post_tag button button_translucent" title="networking">
          NETWORKING
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://blog.andreasm.io/tags/cni/' class="post_tag button button_translucent" title="cni">
          CNI
          <span class="button_tally">4</span>
        </a>
        
        <a href='https://blog.andreasm.io/tags/automation/' class="post_tag button button_translucent" title="automation">
          AUTOMATION
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://blog.andreasm.io/tags/availability/' class="post_tag button button_translucent" title="availability">
          AVAILABILITY
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://blog.andreasm.io/tags/cert-manager/' class="post_tag button button_translucent" title="cert-manager">
          CERT-MANAGER
          <span class="button_tally">3</span>
        </a>
        
        
        <br>
        <div class="post_tags_toggle button">All Tags</div>
        <div class="post_tags">
          <div class="tags_list">
            
            <a href='https://blog.andreasm.io/tags/ako/' class=" post_tag button button_translucent" data-position=8 title="ako">AKO<span class="button_tally">8</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/amko/' class=" post_tag button button_translucent" data-position=1 title="amko">AMKO<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/ansible/' class=" post_tag button button_translucent" data-position=1 title="ansible">ANSIBLE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/antrea/' class=" post_tag button button_translucent" data-position=12 title="antrea">ANTREA<span class="button_tally">12</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/argocd/' class=" post_tag button button_translucent" data-position=1 title="argocd">ARGOCD<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/arista/' class=" post_tag button button_translucent" data-position=1 title="arista">ARISTA<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/authentication/' class=" post_tag button button_translucent" data-position=2 title="authentication">AUTHENTICATION<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/automation/' class=" post_tag button button_translucent" data-position=3 title="automation">AUTOMATION<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/autoscaling/' class=" post_tag button button_translucent" data-position=1 title="autoscaling">AUTOSCALING<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/availability/' class=" post_tag button button_translucent" data-position=3 title="availability">AVAILABILITY<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/avi/' class=" post_tag button button_translucent" data-position=7 title="avi">AVI<span class="button_tally">7</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/ceos/' class=" post_tag button button_translucent" data-position=1 title="ceos">CEOS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/cert-manager/' class=" post_tag button button_translucent" data-position=3 title="cert-manager">CERT-MANAGER<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/certificate/' class=" post_tag button button_translucent" data-position=1 title="certificate">CERTIFICATE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/cilium/' class=" post_tag button button_translucent" data-position=1 title="cilium">CILIUM<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/cni/' class=" post_tag button button_translucent" data-position=4 title="cni">CNI<span class="button_tally">4</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/compliance/' class=" post_tag button button_translucent" data-position=1 title="compliance">COMPLIANCE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/containerlab/' class=" post_tag button button_translucent" data-position=1 title="containerlab">CONTAINERLAB<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/custom-resource-definitions/' class=" post_tag button button_translucent" data-position=1 title="custom-resource-definitions">CUSTOM-RESOURCE-DEFINITIONS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/distributed-firewall/' class=" post_tag button button_translucent" data-position=1 title="distributed-firewall">DISTRIBUTED-FIREWALL<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/dns-service/' class=" post_tag button button_translucent" data-position=1 title="dns-service">DNS-SERVICE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/docker/' class=" post_tag button button_translucent" data-position=2 title="docker">DOCKER<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/ebpf/' class=" post_tag button button_translucent" data-position=1 title="ebpf">EBPF<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/github/' class=" post_tag button button_translucent" data-position=1 title="github">GITHUB<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/gitops/' class=" post_tag button button_translucent" data-position=1 title="gitops">GITOPS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/gslb/' class=" post_tag button button_translucent" data-position=1 title="gslb">GSLB<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/harbor/' class=" post_tag button button_translucent" data-position=1 title="harbor">HARBOR<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/home-assistant/' class=" post_tag button button_translucent" data-position=1 title="home-assistant">HOME-ASSISTANT<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/hugo/' class=" post_tag button button_translucent" data-position=2 title="hugo">HUGO<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/ids/' class=" post_tag button button_translucent" data-position=1 title="ids">IDS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/informational/' class=" post_tag button button_translucent" data-position=2 title="informational">INFORMATIONAL<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/ingress/' class=" post_tag button button_translucent" data-position=5 title="ingress">INGRESS<span class="button_tally">5</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/ips/' class=" post_tag button button_translucent" data-position=1 title="ips">IPS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/keycloak/' class=" post_tag button button_translucent" data-position=1 title="keycloak">KEYCLOAK<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/kubernetes/' class=" post_tag button button_translucent" data-position=24 title="kubernetes">KUBERNETES<span class="button_tally">24</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/kubernetes-api-endpoint/' class=" post_tag button button_translucent" data-position=1 title="kubernetes-api-endpoint">KUBERNETES-API-ENDPOINT<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/kubernetes-management/' class=" post_tag button button_translucent" data-position=1 title="kubernetes-management">KUBERNETES-MANAGEMENT<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/kubespray/' class=" post_tag button button_translucent" data-position=1 title="kubespray">KUBESPRAY<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/lifecycle-management/' class=" post_tag button button_translucent" data-position=1 title="lifecycle-management">LIFECYCLE-MANAGEMENT<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/load-balancing/' class=" post_tag button button_translucent" data-position=1 title="load-balancing">LOAD-BALANCING<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/loadbalancer/' class=" post_tag button button_translucent" data-position=1 title="loadbalancer">LOADBALANCER<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/loadbalancing/' class=" post_tag button button_translucent" data-position=7 title="loadbalancing">LOADBALANCING<span class="button_tally">7</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/lodbalancing/' class=" post_tag button button_translucent" data-position=1 title="lodbalancing">LODBALANCING<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/management/' class=" post_tag button button_translucent" data-position=1 title="management">MANAGEMENT<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/multi-cluster/' class=" post_tag button button_translucent" data-position=1 title="multi-cluster">MULTI-CLUSTER<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/multi-dc/' class=" post_tag button button_translucent" data-position=1 title="multi-dc">MULTI-DC<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/multi-tenancy/' class=" post_tag button button_translucent" data-position=1 title="multi-tenancy">MULTI-TENANCY<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/network/' class=" post_tag button button_translucent" data-position=3 title="network">NETWORK<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/network-policies/' class=" post_tag button button_translucent" data-position=2 title="network-policies">NETWORK-POLICIES<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/networking/' class=" post_tag button button_translucent" data-position=5 title="networking">NETWORKING<span class="button_tally">5</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/neuvector/' class=" post_tag button button_translucent" data-position=1 title="neuvector">NEUVECTOR<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/nfs/' class=" post_tag button button_translucent" data-position=1 title="nfs">NFS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/nsx/' class=" post_tag button button_translucent" data-position=13 title="nsx">NSX<span class="button_tally">13</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/nsx-advanced-loadbalancer/' class=" post_tag button button_translucent" data-position=1 title="nsx advanced loadbalancer">NSX ADVANCED LOADBALANCER<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/nsx-alb/' class=" post_tag button button_translucent" data-position=1 title="nsx-alb">NSX-ALB<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/nsx-application-platform/' class=" post_tag button button_translucent" data-position=1 title="nsx-application-platform">NSX-APPLICATION-PLATFORM<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/nsx-t/' class=" post_tag button button_translucent" data-position=2 title="nsx-t">NSX-T<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/opentofu/' class=" post_tag button button_translucent" data-position=1 title="opentofu">OPENTOFU<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/persistent-storage/' class=" post_tag button button_translucent" data-position=1 title="persistent-storage">PERSISTENT-STORAGE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/pinniped/' class=" post_tag button button_translucent" data-position=1 title="pinniped">PINNIPED<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/provisioning/' class=" post_tag button button_translucent" data-position=2 title="provisioning">PROVISIONING<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/proxmox/' class=" post_tag button button_translucent" data-position=1 title="proxmox">PROXMOX<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/proxy/' class=" post_tag button button_translucent" data-position=1 title="proxy">PROXY<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/pvc/' class=" post_tag button button_translucent" data-position=1 title="pvc">PVC<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/rancher/' class=" post_tag button button_translucent" data-position=1 title="rancher">RANCHER<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/rbac/' class=" post_tag button button_translucent" data-position=1 title="rbac">RBAC<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/registry/' class=" post_tag button button_translucent" data-position=1 title="registry">REGISTRY<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/rke2/' class=" post_tag button button_translucent" data-position=1 title="rke2">RKE2<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/security/' class=" post_tag button button_translucent" data-position=7 title="security">SECURITY<span class="button_tally">7</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/static-content-generator/' class=" post_tag button button_translucent" data-position=1 title="static-content-generator">STATIC-CONTENT-GENERATOR<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/static-site-generator/' class=" post_tag button button_translucent" data-position=1 title="static-site-generator">STATIC-SITE-GENERATOR<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/suse/' class=" post_tag button button_translucent" data-position=2 title="suse">SUSE<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/tanzu/' class=" post_tag button button_translucent" data-position=14 title="tanzu">TANZU<span class="button_tally">14</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/tanzu-kubernetes-grid/' class=" post_tag button button_translucent" data-position=1 title="tanzu-kubernetes-grid">TANZU-KUBERNETES-GRID<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/terraform/' class=" post_tag button button_translucent" data-position=1 title="terraform">TERRAFORM<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/tkg/' class=" post_tag button button_translucent" data-position=1 title="tkg">TKG<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/tkg-2.1/' class=" post_tag button button_translucent" data-position=1 title="tkg 2.1">TKG 2.1<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/tkgi/' class=" post_tag button button_translucent" data-position=1 title="tkgi">TKGI<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/tkgs/' class=" post_tag button button_translucent" data-position=1 title="tkgs">TKGS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/tmc/' class=" post_tag button button_translucent" data-position=1 title="tmc">TMC<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/tmc-local/' class=" post_tag button button_translucent" data-position=1 title="tmc-local">TMC-LOCAL<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/tmc-sm/' class=" post_tag button button_translucent" data-position=1 title="tmc-sm">TMC-SM<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/traefik/' class=" post_tag button button_translucent" data-position=1 title="traefik">TRAEFIK<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/troubleshooting/' class=" post_tag button button_translucent" data-position=2 title="troubleshooting">TROUBLESHOOTING<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/unifi/' class=" post_tag button button_translucent" data-position=1 title="unifi">UNIFI<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/veos/' class=" post_tag button button_translucent" data-position=1 title="veos">VEOS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/vmconaws/' class=" post_tag button button_translucent" data-position=1 title="vmconaws">VMCONAWS<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/vsphere/' class=" post_tag button button_translucent" data-position=2 title="vsphere">VSPHERE<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/vsphere-replication/' class=" post_tag button button_translucent" data-position=1 title="vsphere-replication">VSPHERE-REPLICATION<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/vsphere-with-tanzu/' class=" post_tag button button_translucent" data-position=1 title="vsphere-with-tanzu">VSPHERE-WITH-TANZU<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://blog.andreasm.io/tags/zwave/' class=" post_tag button button_translucent" data-position=1 title="zwave">ZWAVE<span class="button_tally">1</span>
            </a>
            
            <div class="tags_sort"><span title="sort alphabetically">[A~Z]</span><span title="sort by count">[0~9]</span>
            </div>
            <span class="tags_hide"><svg class="icon">
            <use xlink:href="#closeme"></use>
          </svg></span>
          </div>
        </div>
      </nav>
    </div>
  </section>
</aside>

  
</div>
    </main><svg width="0" height="0" class="hidden">
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter">
    <path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68 0 0 1-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043 0-1.924.366-2.643 1.078a3.56 3.56 0 0 0-1.076 2.605c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846 0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47 0 .929.273 1.705.82 2.388a3.623 3.623 0 0 0 2.115 1.291c-.312.08-.641.118-.979.118-.312 0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652 0 0 0 2.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422 0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139 0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77 0 0 0 1.172-4.892v-.468a7.788 7.788 0 0 0 1.84-1.921 8.142 8.142 0 0 1-2.11.593z"
      ></path>
  </symbol>
  <symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail">
    <path  d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar">
    <path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916 0 100v352c0 33.084 26.916 60 60 60h392c33.084 0 60-26.916 60-60V100c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028 0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028 0 20 8.972 20 20v48z"></path>
    <path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github">
    <path d="M255.968 5.329C114.624 5.329 0 120.401 0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384 0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008 0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992 0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584 0 34.368-.32 62.08-.32 70.496 0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab">
    <path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6 0L12.3 74.8z" />
    <path d="M12.3 74.7L.5 111c-1 3.2 0 6.8 3 8.8l101.6 74-92.5-119z"/>
    <path d="M105 193.7l-38.6-119h-54l92.7 119z"/>
    <path d="M105 193.7l38.7-119H66.4l38.7 119z"/>
    <path d="M105 193.7l38.7-119H198l-93 119z"/>
    <path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/>
    <path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6 0L198 74.8z"/> 
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss">
    <circle cx="3.429" cy="20.571" r="3.429"></circle>
    <path d="M11.429 24h4.57C15.999 15.179 8.821 8.001 0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"></path>
    <path d="M24 24C24 10.766 13.234 0 0 0v4.571c10.714 0 19.43 8.714 19.43 19.429z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h362c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="to-top">
    <path d="M604.501 440.509L325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298 0 36.323s26.223 10.024 36.222 0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221 0 9.999-10.023 9.999-26.298 0-36.323z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly">
    <path d="M504.971 239.029L448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c19.851 0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002 0 0 0 400 320v108c0 19.851-16.149 36-36 36h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c46.318 0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568 0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255 0 24-10.745 24-24S205.255 0 192 0h-44c-46.318 0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568 0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255 0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851 0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002 0 0 0 112 192z"></path>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy">
    <path d="M23 2.75A2.75 2.75 0 0 0 20.25 0H8.75A2.75 2.75 0 0 0 6 2.75v13.5A2.75 2.75 0 0 0 8.75 19h11.5A2.75 2.75 0 0 0 23 16.25zM18.25 14.5h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5z"></path>
    <path d="M8.75 20.5a4.255 4.255 0 0 1-4.25-4.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752 0 0 0 1 5.25v16A2.752 2.752 0 0 0 3.75 24h12a2.752 2.752 0 0 0 2.75-2.75v-.75z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme">
    <path d="M284.286 256.002L506.143 34.144c7.811-7.811 7.811-20.475 0-28.285-7.811-7.81-20.475-7.811-28.285 0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285 0-7.81 7.811-7.811 20.475 0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475 0 28.285a19.938 19.938 0 0 0 14.143 5.857 19.94 19.94 0 0 0 14.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475 0-28.285L284.286 256.002z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu">
    <path d="M492 236H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954 0 96s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram">
    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id=youtube>
    <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow">
    <path d="M21 27v-8h3v11H0V19h3v8h18z"></path><path d="M17.1.2L15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8l13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="xing">
    <path d="M18.188 0c-.517 0-.741.325-.927.66 0 0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211 0 .375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016 0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894 0 21.686 0h-3.498zM3.648 4.74c-.211 0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016 0 .021L1.86 16.051c-.099.188-.093.381 0 .529.085.142.239.234.45.234h3.461c.518 0 .766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 71 55" id="discord">
    <path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527 0.41542C45.5603 0.39851 45.468 0.440769 45.4204 0.525289C44.7963 1.6353 44.105 3.0834 43.6209 4.2216C38.1637 3.4046 32.7345 3.4046 27.3892 4.2216C26.905 3.0581 26.1886 1.6353 25.5617 0.525289C25.5141 0.443589 25.4218 0.40133 25.3294 0.41542C20.2584 1.2888 15.4057 2.8186 10.8776 4.8978C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795C1.57795 18.7309 -0.943561 32.1443 0.293408 45.3914C0.299005 45.4562 0.335386 45.5182 0.385761 45.5576C6.45866 50.0174 12.3413 52.7249 18.1147 54.5195C18.2071 54.5477 18.305 54.5139 18.3638 54.4378C19.7295 52.5728 20.9469 50.6063 21.9907 48.5383C22.0523 48.4172 21.9935 48.2735 21.8676 48.2256C19.9366 47.4931 18.0979 46.6 16.3292 45.5858C16.1893 45.5041 16.1781 45.304 16.3068 45.2082C16.679 44.9293 17.0513 44.6391 17.4067 44.3461C17.471 44.2926 17.5606 44.2813 17.6362 44.3151C29.2558 49.6202 41.8354 49.6202 53.3179 44.3151C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433C53.9057 44.6363 54.2779 44.9293 54.6529 45.2082C54.7816 45.304 54.7732 45.5041 54.6333 45.5858C52.8646 46.6197 51.0259 47.4931 49.0921 48.2228C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383C50.038 50.6034 51.2554 52.5699 52.5959 54.435C52.6519 54.5139 52.7526 54.5477 52.845 54.5195C58.6464 52.7249 64.529 50.0174 70.6019 45.5576C70.6551 45.5182 70.6887 45.459 70.6943 45.3942C72.1747 30.0791 68.2147 16.7757 60.1968 4.9823C60.1772 4.9429 60.1437 4.9147 60.1045 4.8978ZM23.7259 37.3253C20.2276 37.3253 17.3451 34.1136 17.3451 30.1693C17.3451 26.225 20.1717 23.0133 23.7259 23.0133C27.308 23.0133 30.1626 26.2532 30.1066 30.1693C30.1066 34.1136 27.28 37.3253 23.7259 37.3253ZM47.3178 37.3253C43.8196 37.3253 40.9371 34.1136 40.9371 30.1693C40.9371 26.225 43.7636 23.0133 47.3178 23.0133C50.9 23.0133 53.7545 26.2532 53.6986 30.1693C53.6986 34.1136 50.9 37.3253 47.3178 37.3253Z"/>
  </symbol>
</svg>


<footer class="footer">
  <div class="footer_inner wrap pale">
    <img src='https://blog.andreasm.io/icons/apple-touch-icon.png' class="icon icon_2 transparent" alt="From 0.985mhz... to several Ghz">
    <p>Copyright&nbsp;2016-&nbsp;<span class="year"></span>&nbsp;FROM 0.985MHZ... TO SEVERAL GHZ. All Rights Reserved</p><a class="to_top" href="#documentTop">
  <svg class="icon">
  <title>to-top</title>
  <use xlink:href="#to-top"></use>
</svg>

</a>

  </div>
</footer>

<script type="text/javascript" src="https://blog.andreasm.io/en/js/bundle.5548d358738600c857a1f05f0459418da7143d4426c66a08bf3f15ded1b39dd2136bf104a559247a909fc4dcc45b8e06bad0870ece4c71ee5303d30550def8bd.js" integrity="sha512-VUjTWHOGAMhXofBfBFlBjacUPUQmxmoIvz8V3tGzndITa/EEpVkkepCfxNzEW44GutCHDs5Mce5TA9MFUN74vQ==" crossorigin="anonymous"></script>

  <script src="https://blog.andreasm.io/js/search.min.95a6a82b7db565e9830200f15d8809e9663868dd57209f6f86afd54bb19568b9fbdfb9b479ebcc5d37e3b2e2136e396c05135d268cd68b21728a0bc176a8a809.js"></script>

  </body>
</html>
