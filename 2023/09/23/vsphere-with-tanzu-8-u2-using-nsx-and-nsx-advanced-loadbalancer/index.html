<!DOCTYPE html>
<html lang="en" dir="ltr" class="scroll-smooth" data-default-appearance="dark"
  data-auto-appearance="true"><head>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>vSphere with Tanzu 8 U2 using NSX AND NSX Advanced Loadbalancer &middot; blog.andreasm.io</title>
  <meta name="title" content="vSphere with Tanzu 8 U2 using NSX AND NSX Advanced Loadbalancer &middot; blog.andreasm.io" />
  
  <meta name="description" content="A quick test on the new feature in vSphere 8 U2 with Tanzu using NSX and NSX Advanced Loadbalancer for Kubernetes API endpoint" />
  <meta name="keywords" content="kubernetes, Loadbalancing, network, nsx, tanzu, " />
  
  
  <link rel="canonical" href="https://blog.andreasm.io/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/" />
  
  
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.48d290696564c2380c4233780f3fd414aa6e2b0b67ed916e9d918c48c05f5b20b641bf892fadd408e43ec21d2feb2ec1fe6fd1f021df2806a254977fe2f80a64.css"
    integrity="sha512-SNKQaWVkwjgMQjN4Dz/UFKpuKwtn7ZFunZGMSMBfWyC2Qb&#43;JL63UCOQ&#43;wh0v6y7B/m/R8CHfKAaiVJd/4vgKZA==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.a85bd6dc99d1fecae166deb56a1fee6375588c72533c4b8c690e4a9ec5a04174ff780e41e2ac770382a8e67818cb2b89766afa3e23965c9102424a080dafbb0c.js"
    integrity="sha512-qFvW3JnR/srhZt61ah/uY3VYjHJTPEuMaQ5KnsWgQXT/eA5B4qx3A4Ko5ngYyyuJdmr6PiOWXJECQkoIDa&#43;7DA=="></script>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.a2d78d78672e549fbfc972ece871725b5478ba0b65708dda20cb97ab80a865eae6d247e1b05a4aec6ebbf78647ec3233bad8b2609ed98eee53cd58aa17128bc7.js"
    integrity="sha512-oteNeGcuVJ&#43;/yXLs6HFyW1R4ugtlcI3aIMuXq4CoZerm0kfhsFpK7G6794ZH7DIzutiyYJ7Zju5TzViqFxKLxw==" data-copy="" data-copied=""></script>
  
  
  
  <script src="/lib/zoom/zoom.min.37d2094687372da3f7343a221a470f6b8806f7891aa46a5a03966af7f0ebd38b9fe536cb154e6ad28f006d184b294525a7c4054b6bbb4be62d8b453b42db99bd.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S&#43;Yti0U7QtuZvQ=="></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="https://blog.andreasm.io/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/">
  <meta property="og:site_name" content="blog.andreasm.io">
  <meta property="og:title" content="vSphere with Tanzu 8 U2 using NSX AND NSX Advanced Loadbalancer">
  <meta property="og:description" content="TKGs with NSX and NSX Advanced Loadbalancer">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-09-23T21:35:17+02:00">
    <meta property="article:modified_time" content="2023-09-23T21:35:17+02:00">
    <meta property="article:tag" content="Kubernetes">
    <meta property="article:tag" content="Loadbalancing">
    <meta property="article:tag" content="Network">
    <meta property="article:tag" content="Nsx">
    <meta property="article:tag" content="Tanzu">
    <meta property="og:image" content="https://blog.andreasm.io/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/feature-vmware_by_broadcom.png">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://blog.andreasm.io/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/feature-vmware_by_broadcom.png">
  <meta name="twitter:title" content="vSphere with Tanzu 8 U2 using NSX AND NSX Advanced Loadbalancer">
  <meta name="twitter:description" content="TKGs with NSX and NSX Advanced Loadbalancer">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "vSphere with Tanzu 8 U2 using NSX AND NSX Advanced Loadbalancer",
    "headline": "vSphere with Tanzu 8 U2 using NSX AND NSX Advanced Loadbalancer",
    "description": "TKGs with NSX and NSX Advanced Loadbalancer",
    "abstract": "A quick test on the new feature in vSphere 8 U2 with Tanzu using NSX and NSX Advanced Loadbalancer for Kubernetes API endpoint",
    "inLanguage": "en",
    "url" : "https:\/\/blog.andreasm.io\/2023\/09\/23\/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer\/",
    "author" : {
      "@type": "Person",
      "name": "Andreas Marqvardsen"
    },
    "copyrightYear": "2023",
    "dateCreated": "2023-09-23T21:35:17\u002b02:00",
    "datePublished": "2023-09-23T21:35:17\u002b02:00",
    
    "dateModified": "2023-09-23T21:35:17\u002b02:00",
    
    "keywords": ["kubernetes","Loadbalancing","network","nsx","tanzu"],
    
    "mainEntityOfPage": "true",
    "wordCount": "4234"
  }]
  </script>


  
  
  <meta name="author" content="Andreas Marqvardsen" />
  
  
  
  <link href="mailto:andreas.marqvardsen[AT]gmail.com" rel="me" />
  
  
  <link href="https://blog.andreasm.io/" rel="me" />
  
  
  <link href="https://github.com/andreasm80" rel="me" />
  
  
  <link href="https://linkedin.com/in/andreas-marqvardsen" rel="me" />
  
  
  <link href="https://vmst.io/@andreasm" rel="me" />
  
  
  <link href="https://x.com/NATsoFast" rel="me" />
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>






















  
  

<script async src="https://www.googletagmanager.com/gtag/js?id=G-TVPYDVE8KR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TVPYDVE8KR');
</script>



  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a>
  </div>
  
  
  <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px]" style="z-index:100">
  <div id="menu-blur" class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div>
  <div class="relative max-w-[64rem] ml-auto mr-auto">
    <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3">
    
    
    
    <div>
        <a href="/" class="flex">
            <span class="sr-only">blog.andreasm.io</span>

            
            <img src="/ynwa2.png" width="300" height="342"
                class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt="blog.andreasm.io" />
            

        </a>
    </div>
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">blog.andreasm.io</a>
            

        </nav>
        <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

            
            
            
  <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Posts
    </p>
</a>



            
            
  <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        About
    </p>
</a>



            
            
  <a href="/categories/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Categories
    </p>
</a>



            
            
  <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Tags
    </p>
</a>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class="ltr:mr-14 rtl:ml-14 flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center space-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400" style="margin-right:5px">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 -mr-2 md:hidden">

        <label id="menu-button" class="block">
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li id="menu-close-button">
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                    
  <li class="mt-1">
    <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Posts
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            About
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/categories/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Categories
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Tags
        </p>
    </a>
</li>




                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>




<script>
    (function () {
        var $mainmenu = $('.main-menu');
        var path = window.location.pathname;
        $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
            $(e).children('p').addClass('active');
        });
    })();
</script>


  </div>
</div>
<script>
  window.addEventListener('scroll', function (e) {
    var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
    var background_blur = document.getElementById('menu-blur');
    background_blur.style.opacity = (scroll / 300);
  });
</script>

  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  
  
  
  
  
  


<div id="hero" class="h-[150px] md:h-[200px]"></div>



    
    <div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"
    style="background-image:url(/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/feature-vmware_by_broadcom.png);">
    


    <div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal">
    </div>
    <div
        class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal">
    </div>
</div>

<div id="background-blur" class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div>
<script>
    window.addEventListener('scroll', function (e) {
        var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        var background_blur = document.getElementById('background-blur');
        background_blur.style.opacity = (scroll / 300)
    });
</script>

  
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/"
      >blog.andreasm.io</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline ">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/posts/"
      >Posts</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/"
      >vSphere with Tanzu 8 U2 using NSX AND NSX Advanced Loadbalancer</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      vSphere with Tanzu 8 U2 using NSX AND NSX Advanced Loadbalancer
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2023-09-23T21:35:17&#43;02:00">23 September 2023</time><span class="px-2 text-primary-500">&middot;</span><span>4234 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">20 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/tanzu/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Tanzu
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/nsx/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    NSX
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/nsx-alb/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    NSX-ALB
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/loadbalancing/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Loadbalancing
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/network/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Network
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/nsx/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Nsx
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/tanzu/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Tanzu
  </span>
</span>
  </span>
  
  
  
  
</div>




    </div>

    
    
    
    
    

    

    
      
      
        
        
<div class="flex author">
  
    
    
      
    
    
      
      <img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width="96" height="96"
      alt="Andreas Marqvardsen" src="/profile.png" />
    
  
  <div class="place-self-center">
    
    <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
      Author
    </div>
    <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
      Andreas Marqvardsen
    </div>
    
    
    <div class="text-sm text-neutral-700 dark:text-neutral-400">Always curious, always learning</div>
    
    <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="mailto:andreas.marqvardsen[AT]gmail.com"
          target="_blank"
          aria-label="Email"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://blog.andreasm.io/"
          target="_blank"
          aria-label="Link"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M172.5 131.1C228.1 75.51 320.5 75.51 376.1 131.1C426.1 181.1 433.5 260.8 392.4 318.3L391.3 319.9C381 334.2 361 337.6 346.7 327.3C332.3 317 328.9 297 339.2 282.7L340.3 281.1C363.2 249 359.6 205.1 331.7 177.2C300.3 145.8 249.2 145.8 217.7 177.2L105.5 289.5C73.99 320.1 73.99 372 105.5 403.5C133.3 431.4 177.3 435 209.3 412.1L210.9 410.1C225.3 400.7 245.3 404 255.5 418.4C265.8 432.8 262.5 452.8 248.1 463.1L246.5 464.2C188.1 505.3 110.2 498.7 60.21 448.8C3.741 392.3 3.741 300.7 60.21 244.3L172.5 131.1zM467.5 380C411 436.5 319.5 436.5 263 380C213 330 206.5 251.2 247.6 193.7L248.7 192.1C258.1 177.8 278.1 174.4 293.3 184.7C307.7 194.1 311.1 214.1 300.8 229.3L299.7 230.9C276.8 262.1 280.4 306.9 308.3 334.8C339.7 366.2 390.8 366.2 422.3 334.8L534.5 222.5C566 191 566 139.1 534.5 108.5C506.7 80.63 462.7 76.99 430.7 99.9L429.1 101C414.7 111.3 394.7 107.1 384.5 93.58C374.2 79.2 377.5 59.21 391.9 48.94L393.5 47.82C451 6.731 529.8 13.25 579.8 63.24C636.3 119.7 636.3 211.3 579.8 267.7L467.5 380z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/andreasm80"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://linkedin.com/in/andreas-marqvardsen"
          target="_blank"
          aria-label="Linkedin"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://vmst.io/@andreasm"
          target="_blank"
          aria-label="Mastodon"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://x.com/NATsoFast"
          target="_blank"
          aria-label="X-Twitter"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
  </span>

</span></a
        >
      
    
  </div>

</div>
  </div>
</div>

      

      

      
      <div class="mb-5"></div>
      

    

  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
     <div
      class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
      <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]">

         <details open id="TOCView"
  class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#pre-requisites-and-assumptions">Pre-requisites and assumptions</a></li>
    <li><a href="#vsphere-preparations---requirements">vSphere preparations - requirements</a></li>
    <li><a href="#nsx-t-preparations">NSX-T preparations</a></li>
    <li><a href="#nsx-alb-preparations---requirements">NSX-ALB preparations - requirements</a>
      <ul>
        <li><a href="#nsx-cloud">NSX cloud</a></li>
        <li><a href="#ipam-profile">IPAM profile</a></li>
        <li><a href="#default-service-engine-group">Default Service-Engine Group</a></li>
        <li><a href="#custom-certificate">Custom Certificate</a></li>
        <li><a href="#summary-of-nsx-alb-pre-requisites">Summary of NSX-ALB pre-requisites</a></li>
      </ul>
    </li>
    <li><a href="#nsx-preparations---requirements---adding-the-nsx-alb-controller-endpoint-using-api">NSX preparations - requirements - adding the NSX-ALB controller endpoint using API</a>
      <ul>
        <li><a href="#adding-the-nsx-alb-to-the-nsx-manager">Adding the NSX-ALB to the NSX manager</a></li>
        <li><a href="#custom-certificate-in-the-nsx-alb-controller">Custom certificate in the NSX-ALB controller</a></li>
      </ul>
    </li>
    <li><a href="#my-nsx-and-nsx-alb-environment-before-wcp-installation">My NSX and NSX-ALB environment before WCP installation</a>
      <ul>
        <li><a href="#nsx-environment-before-wcp-installation">NSX environment before WCP installation</a></li>
        <li><a href="#nsx-alb-environment-before-wcp-installation">NSX-ALB environment before WCP installation</a></li>
      </ul>
    </li>
    <li><a href="#vsphere-with-tanzu-installation">vSphere with Tanzu installation</a></li>
    <li><a href="#my-nsx-and-nsx-alb-environment-after-wcp-installation">My NSX and NSX-ALB environment <strong>after</strong> WCP installation</a>
      <ul>
        <li><a href="#nsx-environment-after-wcp-installation">NSX environment <strong>after</strong> WCP installation</a></li>
        <li><a href="#nsx-alb-environment-after-wcp-installation">NSX-ALB environment <strong>after</strong> WCP installation</a></li>
      </ul>
    </li>
    <li><a href="#creating-vsphere-namespaces-in-other-networks---override-supervisor-workload-network">Creating vSphere Namespaces in other networks - override supervisor workload network</a></li>
    <li><a href="#l4-services-inside-the-workload-clusters">L4 services inside the workload clusters</a></li>
    <li><a href="#l7-services-inside-the-workload-clusters">L7 services inside the workload clusters</a></li>
    <li><a href="#credits">Credits</a></li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#pre-requisites-and-assumptions">Pre-requisites and assumptions</a></li>
    <li><a href="#vsphere-preparations---requirements">vSphere preparations - requirements</a></li>
    <li><a href="#nsx-t-preparations">NSX-T preparations</a></li>
    <li><a href="#nsx-alb-preparations---requirements">NSX-ALB preparations - requirements</a>
      <ul>
        <li><a href="#nsx-cloud">NSX cloud</a></li>
        <li><a href="#ipam-profile">IPAM profile</a></li>
        <li><a href="#default-service-engine-group">Default Service-Engine Group</a></li>
        <li><a href="#custom-certificate">Custom Certificate</a></li>
        <li><a href="#summary-of-nsx-alb-pre-requisites">Summary of NSX-ALB pre-requisites</a></li>
      </ul>
    </li>
    <li><a href="#nsx-preparations---requirements---adding-the-nsx-alb-controller-endpoint-using-api">NSX preparations - requirements - adding the NSX-ALB controller endpoint using API</a>
      <ul>
        <li><a href="#adding-the-nsx-alb-to-the-nsx-manager">Adding the NSX-ALB to the NSX manager</a></li>
        <li><a href="#custom-certificate-in-the-nsx-alb-controller">Custom certificate in the NSX-ALB controller</a></li>
      </ul>
    </li>
    <li><a href="#my-nsx-and-nsx-alb-environment-before-wcp-installation">My NSX and NSX-ALB environment before WCP installation</a>
      <ul>
        <li><a href="#nsx-environment-before-wcp-installation">NSX environment before WCP installation</a></li>
        <li><a href="#nsx-alb-environment-before-wcp-installation">NSX-ALB environment before WCP installation</a></li>
      </ul>
    </li>
    <li><a href="#vsphere-with-tanzu-installation">vSphere with Tanzu installation</a></li>
    <li><a href="#my-nsx-and-nsx-alb-environment-after-wcp-installation">My NSX and NSX-ALB environment <strong>after</strong> WCP installation</a>
      <ul>
        <li><a href="#nsx-environment-after-wcp-installation">NSX environment <strong>after</strong> WCP installation</a></li>
        <li><a href="#nsx-alb-environment-after-wcp-installation">NSX-ALB environment <strong>after</strong> WCP installation</a></li>
      </ul>
    </li>
    <li><a href="#creating-vsphere-namespaces-in-other-networks---override-supervisor-workload-network">Creating vSphere Namespaces in other networks - override supervisor workload network</a></li>
    <li><a href="#l4-services-inside-the-workload-clusters">L4 services inside the workload clusters</a></li>
    <li><a href="#l7-services-inside-the-workload-clusters">L7 services inside the workload clusters</a></li>
    <li><a href="#credits">Credits</a></li>
  </ul>
</nav>
  </div>
</details>

<script>

  var margin = 200;
  var marginError = 50;

  (function () {
    var $window = $(window);
    var $toc = $('#TOCView');
    var tocHeight = $toc.height();

    function onResize() {
      var windowAndMarginHeight = $window.height() - margin;
      if(tocHeight >= windowAndMarginHeight) {
        $toc.css("overflow-y", "scroll")
        $toc.css("max-height", (windowAndMarginHeight + marginError) + "px")
      } else {
        $toc.css("overflow-y", "hidden")
        $toc.css("max-height", "9999999px")
      }
    }

    $window.on('resize', onResize);
    $(document).ready(onResize);
  })();



  (function () {
    var $toc = $('#TableOfContents');
    if ($toc.length > 0) {
      var $window = $(window);

      function onScroll() {
        var currentScroll = $window.scrollTop();
        var h = $('.anchor');
        var id = "";
        h.each(function (i, e) {
          e = $(e);
          if (e.offset().top - $(window).height()/3 <= currentScroll) {
            id = decodeURIComponent(e.attr('id'));
          }
        });
        var active = $toc.find('a.active');      
        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

        active.each(function (i, e) {
          
            $(e).removeClass('active');
          
        });
        $toc.find('a[href="#' + id + '"]').addClass('active')
        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
          $(e).children('a').parents('ul').show();          
        });
      }

      $window.on('scroll', onScroll);
      $(document).ready(function () {
        
        onScroll();
      });
    }
  })();


</script>
   </div>
      </div>
      

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          

<h1 class="relative group">NSX and NSX Advanced Loadbalancer with TKG 
    <div id="nsx-and-nsx-advanced-loadbalancer-with-tkg" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#nsx-and-nsx-advanced-loadbalancer-with-tkg" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>Before vSphere 8 U2 it was not possible to use the NSX Advanced Loadbalancer loadbalancing the Kubernetes control plane nodes when configuring Tanzu or TKG in vSphere using NSX as the networking stack. I am talking about using NSX as an integrated part of the TKG installation (enabling Workload Management and selecting NSX as the network stack). It was of course possible to use NSX as a pure network &ldquo;underlay&rdquo; for TKG, and then use NSX ALB as both L4 and L7 (using AKO) provider. But then one misses out of the &ldquo;magic&rdquo; using NSX as the integrated network provider for TKG like automatic network creation, vrf/ip separation support, NSX policies, vSphere pods etc. One could expose services using servicetype loadBalancer (L4) from the workload clusters with NSX ALB in combination with NSX as the integrated networking stack, but one had to specify the loadBalancerClass to specify NSX-ALB for this, and not all services could be configured with this crd. The control plane nodes or the Kubernetes api endpoint was always exposed/managed by the built-in NSX-T loadbalancer. Now with the release of vSphere 8 U2 it seems like we finally can use NSX and NSX-ALB in combination where all loadbalancing needs are being managed by NSX-ALB, including the control plane nodes/kubernetes api endpoint.</p>
<p>So I am very excited to give this a try and see how it works out, the steps needed to be configured for this to work and how it look like during the installation and after. What happens in the NSX-ALB controller, what happens in the NSX environment.</p>
<div class="notice info">
<p>To enable this feature in this release is only for greenfield deployments.</p>
</div>
<p>What we should end up with in this release is using NSX for all networking and security features, NSX Advanced Loadbalancer for all loadbalancing needs.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924121338731.png"
        alt="nsx-alb"
      />
      
    </figure>
</p>
<p>From the official release <a href="https://docs.vmware.com/en/VMware-vSphere/8.0/rn/vmware-vsphere-with-tanzu-80-release-notes/index.html" target="_blank">notes</a> I have pasted below two features I will discuss in this post. The first one is the major topic of this post of course, but the second one is also a very nice feature that I actually have used a lot in this post. For the full list of new features head over to the official release notes for vSphere 8 U2 <a href="https://docs.vmware.com/en/VMware-vSphere/8.0/rn/vmware-vsphere-80-release-notes/index.html" target="_blank">here</a> and for all the Tanzu related features <a href="https://docs.vmware.com/en/VMware-vSphere/8.0/rn/vmware-vsphere-with-tanzu-80-release-notes/index.html" target="_blank">here</a></p>
<p>The major topic of this post:</p>
<blockquote>
<ul>
<li><strong>Support of NSX Advanced Load Balancer for a Supervisor configured with NSX networking</strong> - You can now enable a Supervisor with NSX Advanced Load Balancer (Avi Networks) for L4 load balancing, as well as load balancing for the control plane nodes of Supervisor and Tanzu Kubernetes Grid clusters with NSX networking. Checkout the <a href="https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-with-tanzu-installation-configuration/GUID-7EE247EB-4736-4BC8-A6B0-0123B6ECC812.html" target="_blank">documentation page</a> for guidance on configuring the NSX Advanced Load Balancer with NSX.</li>
</ul>
</blockquote>
<p>And the nice feature:</p>
<blockquote>
<ul>
<li><strong>Import and export the Supervisor configuration</strong> - In previous versions, activating the Supervisor was a manual step-wise process without the ability to save any configurations. In the current release, you can now export and share the Supervisor configuration with peers in a human-readable format or within a source control system, import configurations to a new Supervisor, and replicate a standard configuration across multiple Supervisors. Checkout the <a href="https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-with-tanzu-installation-configuration/GUID-1AC6E8ED-51E3-4AA5-9331-6E13731A8507.html" target="_blank">documentation</a> for details on how to export and import the Supervisor configuration.</li>
</ul>
</blockquote>


<h2 class="relative group">Pre-requisites and assumptions 
    <div id="pre-requisites-and-assumptions" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#pre-requisites-and-assumptions" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>Before getting started with the installation/enabling TKG in vSphere 8 U2 using NSX-ALB in combination with NSX some requirments need to be met.</p>
<ul>
<li>vSphere 8 U2 - kind of obvious but nice to mention</li>
<li>NSX version 4.1.1 or higher</li>
<li>NSX-ALB version 22.1.4 or higher (yes it is stated in the release notes of vSphere with Tanzu that version 22.1.3 is the supported release)</li>
<li>NSX-ALB Enterprise license</li>
</ul>
<img src=images/image-20230923224222497.png style="width:400px" />
<p>And the usual assumptions (mostly to save some time, as I have covered many of these topics several times before, saving digital ink is saving the environment &#x1f604;
I already have my vSphere 8 U2 environment running, I already have my NSX 4.1.1 environment configured and lastly I already have my NSX-ALB controller 22.1.4 deployed and working. My lab is used for many things so I am not deploying NSX and NSX-ALB from scratch just for this post, they are already running a bunch of other stuff including the NSX-LAB controller. In the next chapters I will go through what I had to prepare on the NSX side (if any) and the NSX-ALB side (there are a couple of steps there).</p>


<h2 class="relative group">vSphere preparations - requirements 
    <div id="vsphere-preparations---requirements" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#vsphere-preparations---requirements" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>I only needed to upgrade my current vSphere 8 U1 environment to vSphere 8 U2, as always starting with the vCenter server using the VAMI interface, then updated the ESXi image in LCM to do a rolling upgrade of the ESXi hosts to 8 U2.</p>


<h2 class="relative group">NSX-T preparations 
    <div id="nsx-t-preparations" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#nsx-t-preparations" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>For information how to install NSX, see my post <a href="https://blog.andreasm.io/2022/10/26/vsphere-8-with-tanzu-using-nsx-t-avi-loadbalancer/" target="_blank">here</a></p>


<h2 class="relative group">NSX-ALB preparations - requirements 
    <div id="nsx-alb-preparations---requirements" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#nsx-alb-preparations---requirements" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>Instead of going through all the steps in configuring the NSX-ALB I will only post the settings that is specific/or needed for the NSX+NSX-ALB feature to work. As I already have a working NSX-ALB environment running and in use for other needs, its not that many changes I had to do. So I will show them here in their own section starting with the cloud. For reference how to install NSX-ALB I have done a post on that <a href="https://blog.andreasm.io/2022/10/26/vsphere-8-with-tanzu-using-nsx-t-avi-loadbalancer/#configure-nsx-cloud-in-avi---network-preparations" target="_blank">here</a>.</p>


<h3 class="relative group">NSX cloud 
    <div id="nsx-cloud" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#nsx-cloud" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>In my NSX-ALB I already have two clouds configured, both of them are NSX clouds. If you start from scratch all the necessary config needs to be done of course. See my posts <a href="https://blog.andreasm.io/2022/10/26/vsphere-8-with-tanzu-using-nsx-t-avi-loadbalancer/#configure-nsx-cloud-in-avi---network-preparations" target="_blank">here</a>. In the NSX cloud I will be using for this I need to enable DHCP. That is done by editing your specific cloud and checking the box DHCP:</p>
<img src=images/image-20230923234304721.png style="width:600px" />
<div class="notice info">
<p>If you happen to have multiple clouds configured it will figure out wich cloud it will use. The NSX manager knows which NSX cloud it must use, most likely because it will use the cloud that is the same NSX the API comes from. In my lab I have two NSX clouds configured, and it will select the correct cloud. My two NSX clouds are two unique NSX instances, if having two NSX clouds of same NSX instance I am not sure how it can select the right cloud.</p>
</div>


<h3 class="relative group">IPAM profile 
    <div id="ipam-profile" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#ipam-profile" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>You need to make sure that you have configured an IPAM profile. Again, I already have that configured. The deployment will use this IPAM profile to configure the new usable VIP networks you define as the ingress cidr in TKG.</p>
<img src=images/image-20230924122526763.png style="width:500px" />
<div class="notice info">
<p>In your IPAM profile it is very important to <strong>not</strong> have the <strong>Allocate ip in VRF</strong> option selected. This must be de-selected.</p>
</div>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20231003171934860.png"
        alt="vrf-option"
      />
      
    </figure>
</p>
<p>Then make sure your NSX cloud has this IPAM profile select:</p>
<img src=images/image-20230924122247879.png style="width:600px" />


<h3 class="relative group">Default Service-Engine Group 
    <div id="default-service-engine-group" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#default-service-engine-group" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>The Default-Service Engine Group in your NSX Cloud will be used as a &ldquo;template&rdquo; group. This means you should configure this default se-group how you want your SEs to be provisioned. From the official documentation:</p>
<blockquote>
<p>The AKO creates one Service Engine Group for each vSphere with Tanzu cluster. The Service Engine Group configuration is derived from the <strong>Default-Group</strong> configuration. Once the <strong>Default-Group</strong> is configured with the required values, any new Service Engine Group created by the AKO will have the same settings. However, changes made to the <strong>Default-Group</strong> configuration will not reflect in an already created Service Engine Group. You must modify the configuration for an existing Service Engine Group separately.</p>
</blockquote>
<p>So in my Default SE-Group I have this configuration:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924123526507.png"
        alt="default-group-1"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924123701723.png"
        alt="default-group-settings"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924123855604.png"
        alt="default-group-settings-cont"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924123935970.png"
        alt="default-group-settings-cont"
      />
      
    </figure>
</p>
<p>Under Scope I have confgured the vSphere cluster, and shared datastore placement.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924124012224.png"
        alt="default-group-setting-cont"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924124145429.png"
        alt="save"
      />
      
    </figure>
</p>
<p>When I am satisified the the settings that suits my need, save and I am done with the Default group configurations.</p>


<h3 class="relative group">Custom Certificate 
    <div id="custom-certificate" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#custom-certificate" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Another requirement is to change the default certificate to a custom one. One can follow the official documentation <a href="https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-with-tanzu-installation-configuration/GUID-5417D45D-62B2-4D50-A20C-7B5551EA5594.html#GUID-D2508827-EF05-40E8-807F-5A34B3C18D6F__GUID-23F40B44-A46F-47B6-A457-C9FF1220E50C" target="_blank">here</a>. For now it is sufficient to just prepare the certificate, dont change the settings in the UI to use the new certificate yet, that is done after the step where you register the NSX-ALB endpoint to the NSX manager.</p>


<h3 class="relative group">Summary of NSX-ALB pre-requisites 
    <div id="summary-of-nsx-alb-pre-requisites" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#summary-of-nsx-alb-pre-requisites" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li>Need to have configured a NSX Cloud with the DHCP option enabled</li>
<li>Created a custom certificate (not configured to be used yet)</li>
<li>Created and configured an IPAM profile, updated the NSX cloud to use this profile, in the IPAM profile <em>Allocate IP in VRF</em> i de-selected.</li>
</ul>


<h2 class="relative group">NSX preparations - requirements - adding the NSX-ALB controller endpoint using API 
    <div id="nsx-preparations---requirements---adding-the-nsx-alb-controller-endpoint-using-api" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#nsx-preparations---requirements---adding-the-nsx-alb-controller-endpoint-using-api" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>I already have a working NSX 4.1.1 environment. The only thing I need to to here is to add the NSX-ALB controller (alb endpoint) so my NSX environment is aware of my NSX-ALB controller. The reason for this is that some configurations in NSX-ALB will be automatically done by NCP during TKG deployment using api. So the NSX manager will need to know the username and password of the NSX-ALB controller or controller-cluster.</p>


<h3 class="relative group">Adding the NSX-ALB to the NSX manager 
    <div id="adding-the-nsx-alb-to-the-nsx-manager" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#adding-the-nsx-alb-to-the-nsx-manager" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>To add NSX-ALB to the NSX manager I will need to do an API call to the NSX manager using curl (or Postman or whatever preferred tool), the below is the call I will be issuing:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -k --location --request PUT <span class="s1">&#39;https://172.24.3.10/policy/api/v1/infra/alb-onboarding-workflow&#39;</span> <span class="se">\ </span><span class="c1">#IP NSX manager cluster IP</span>
</span></span><span class="line"><span class="cl">--header <span class="s1">&#39;X-Allow-Overwrite: True&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>-u admin:password <span class="se">\ </span> <span class="c1">#password and username to the NSX manager in the format username:password</span>
</span></span><span class="line"><span class="cl">--header <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--data-raw <span class="s1">&#39;{
</span></span></span><span class="line"><span class="cl"><span class="s1">&#34;owned_by&#34;: &#34;LCM&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">&#34;cluster_ip&#34;: &#34;172.24.3.50&#34;, # IP NSX-ALB controller or controller cluster IP
</span></span></span><span class="line"><span class="cl"><span class="s1">&#34;infra_admin_username&#34; : &#34;admin&#34;, #username
</span></span></span><span class="line"><span class="cl"><span class="s1">&#34;infra_admin_password&#34; : &#34;password&#34;, #password
</span></span></span><span class="line"><span class="cl"><span class="s1">&#34;dns_servers&#34;: [&#34;172.24.3.1&#34;], #not sure why I need to add this - my ALB is already configured with this
</span></span></span><span class="line"><span class="cl"><span class="s1">&#34;ntp_servers&#34;: [&#34;172.24.3.1&#34;] #not sure why I need to add this - my ALB is already configured with this
</span></span></span><span class="line"><span class="cl"><span class="s1">}&#39;</span>
</span></span></code></pre></div><p>The offical documentation is using this example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -k --location --request PUT <span class="s1">&#39;https://&lt;nsx-mgr-ip&gt;/policy/api/v1/infra/alb-onboarding-workflow&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--header <span class="s1">&#39;X-Allow-Overwrite: True&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--header <span class="s1">&#39;Authorization: Basic &lt;base64 encoding of username:password of NSX Mgr&gt;&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--header <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--data-raw <span class="s1">&#39;{
</span></span></span><span class="line"><span class="cl"><span class="s1">&#34;owned_by&#34;: &#34;LCM&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">&#34;cluster_ip&#34;: &#34;&lt;nsx-alb-controller-cluster-ip&gt;&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">&#34;infra_admin_username&#34; : &#34;username&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">&#34;infra_admin_password&#34; : &#34;password&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">&#34;dns_servers&#34;: [&#34;&lt;dns-servers-ips&gt;&#34;],
</span></span></span><span class="line"><span class="cl"><span class="s1">&#34;ntp_servers&#34;: [&#34;&lt;ntp-servers-ips&gt;&#34;]
</span></span></span><span class="line"><span class="cl"><span class="s1">}&#39;</span>
</span></span></code></pre></div><p>I had issues authenticating using header, and I did not want to use time to troubleshoot why. I think one of the reasons is that I need to genereate some auth token etc&hellip;</p>
<p>Anyway, after a successful api call. You should get this output:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;connection_info&#34;</span> : <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;username&#34;</span> : <span class="s2">&#34;\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;tenant&#34;</span> : <span class="s2">&#34;admin&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;expires_at&#34;</span> : <span class="s2">&#34;2023-09-22T18:22:22.627Z&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;managed_by&#34;</span> : <span class="s2">&#34;LCM&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;status&#34;</span> : <span class="s2">&#34;DEACTIVATE_PROVIDER&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;certificate&#34;</span> : <span class="s2">&#34;-----BEGIN CERTIFICATE-----\nMIIDRTCCAi2gAwIBAgIUCcOSYBrBybt6zHfJKojPnX/fZ8xD8azd9mWp4oksVA1vHXzbWdsY\nw/Tdr3zTOEgEjn9mflE/aBhsahEhhaZfKtZtLO/OnvSZZtaMlHvlsHgfl8nOqhLh\nGBJzNNwIS8sjzi8E1/y3TI3kVshoCclL9A==\n-----END CERTIFICATE-----\n&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;enforcement_point_address&#34;</span> : <span class="s2">&#34;172.24.3.50&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;resource_type&#34;</span> : <span class="s2">&#34;AviConnectionInfo&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;auto_enforce&#34;</span> : true,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;resource_type&#34;</span> : <span class="s2">&#34;EnforcementPoint&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;id&#34;</span> : <span class="s2">&#34;alb-endpoint&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;display_name&#34;</span> : <span class="s2">&#34;alb-endpoint&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;path&#34;</span> : <span class="s2">&#34;/infra/sites/default/enforcement-points/alb-endpoint&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;relative_path&#34;</span> : <span class="s2">&#34;alb-endpoint&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;parent_path&#34;</span> : <span class="s2">&#34;/infra/sites/default&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;remote_path&#34;</span> : <span class="s2">&#34;&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;unique_id&#34;</span> : <span class="s2">&#34;8ef2126e-9311-40ff-bd6d-08c51017326c&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;realization_id&#34;</span> : <span class="s2">&#34;8ef2126e-9311-40ff-bd6d-08c51017326c&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;owner_id&#34;</span> : <span class="s2">&#34;4b04712e-498d-42d0-ad90-7ab06c398c60&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;marked_for_delete&#34;</span> : false,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;overridden&#34;</span> : false,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;_create_time&#34;</span> : 1695385329242,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;_create_user&#34;</span> : <span class="s2">&#34;admin&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;_last_modified_time&#34;</span> : 1695385329242,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;_last_modified_user&#34;</span> : <span class="s2">&#34;admin&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;_system_owned&#34;</span> : false,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;_protection&#34;</span> : <span class="s2">&#34;NOT_PROTECTED&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;_revision&#34;</span> : <span class="m">0</span>
</span></span></code></pre></div><p>You can also do the following API call to verify if the NSX-ALB controller has been added:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@ubuntu02:~$ curl -s -k -u admin:password https://172.24.3.10/policy/api/v1/infra/sites/default/enforcement-points/alb-endpoint
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;connection_info&#34;</span> : <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;username&#34;</span> : <span class="s2">&#34;\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;tenant&#34;</span> : <span class="s2">&#34;admin&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;expires_at&#34;</span> : <span class="s2">&#34;2023-09-24T02:00:05.362Z&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;managed_by&#34;</span> : <span class="s2">&#34;LCM&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;status&#34;</span> : <span class="s2">&#34;DEACTIVATE_PROVIDER&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;certificate&#34;</span> : <span class="s2">&#34;-----BEGIN CERTIFICATE-----\nMIIGy2k9O+hp6fX+iG5BGDurG8hP8A\nKI96AUNxV39pXOBIqBr/sL3v/24DVz85ObAvIzoWnTak9ZhZyP4jUfZD/w21xdXz\nKaTJ5ioC+M6RLRKVVJ159lrm3A==\n-----END CERTIFICATE-----\n&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;enforcement_point_address&#34;</span> : <span class="s2">&#34;172.24.3.50&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;resource_type&#34;</span> : <span class="s2">&#34;AviConnectionInfo&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;auto_enforce&#34;</span> : true,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;resource_type&#34;</span> : <span class="s2">&#34;EnforcementPoint&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;id&#34;</span> : <span class="s2">&#34;alb-endpoint&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;display_name&#34;</span> : <span class="s2">&#34;alb-endpoint&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;path&#34;</span> : <span class="s2">&#34;/infra/sites/default/enforcement-points/alb-endpoint&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;relative_path&#34;</span> : <span class="s2">&#34;alb-endpoint&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;parent_path&#34;</span> : <span class="s2">&#34;/infra/sites/default&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;remote_path&#34;</span> : <span class="s2">&#34;&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;unique_id&#34;</span> : <span class="s2">&#34;8ef2126e-9311-40ff-bd6d-08c51017326c&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;realization_id&#34;</span> : <span class="s2">&#34;8ef2126e-9311-40ff-bd6d-08c51017326c&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;owner_id&#34;</span> : <span class="s2">&#34;4b04712e-498d-42d0-ad90-7ab06c398c60&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;marked_for_delete&#34;</span> : false,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;overridden&#34;</span> : false,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;_create_time&#34;</span> : 1695385329242,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;_create_user&#34;</span> : <span class="s2">&#34;admin&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;_last_modified_time&#34;</span> : 1695499205391,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;_last_modified_user&#34;</span> : <span class="s2">&#34;system&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;_system_owned&#34;</span> : false,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;_protection&#34;</span> : <span class="s2">&#34;NOT_PROTECTED&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;_revision&#34;</span> : <span class="m">7</span>
</span></span></code></pre></div><p>The &ldquo;certificate&rdquo; you get back should be the current certificate on the NSX-ALB controller. More on that later.</p>
<p>Thats it on the NSX manager side.</p>
<div class="notice info">
<p>After you a have done the above operation and you log back into the NSX-ALB controller this <em>welcome</em> wizard pops up. Just click cancel on it.</p>
</div>
<img src=images/image-20230924180433828.png style="width:500px" />
<p>I figured out a way to disable this initial setup-wizard instead fo going through it via the UI.
SSH into the NSX-ALB controller, enter into <strong>shell</strong> and enter the following commands:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">### Show the current systemconfiguration</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>admin:172-24-3-50<span class="o">]</span>: &gt; show systemconfiguration
</span></span><span class="line"><span class="cl">+----------------------------------+------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field                            <span class="p">|</span> Value                              <span class="p">|</span>
</span></span><span class="line"><span class="cl">+----------------------------------+------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> uuid                             <span class="p">|</span> default                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> dns_configuration                <span class="p">|</span>                                    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   server_list<span class="o">[</span>1<span class="o">]</span>                 <span class="p">|</span> 172.24.3.1                         <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ntp_configuration                <span class="p">|</span>                                    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   ntp_servers<span class="o">[</span>1<span class="o">]</span>                 <span class="p">|</span>                                    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     server                       <span class="p">|</span> 172.24.3.1                         <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> portal_configuration             <span class="p">|</span>                                    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   enable_https                   <span class="p">|</span> True                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   redirect_to_https              <span class="p">|</span> True                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   enable_http                    <span class="p">|</span> True                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   sslkeyandcertificate_refs<span class="o">[</span>1<span class="o">]</span>   <span class="p">|</span> tkgm-cert-controller               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   use_uuid_from_input            <span class="p">|</span> False                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   sslprofile_ref                 <span class="p">|</span> System-Standard-Portal             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   enable_clickjacking_protection <span class="p">|</span> True                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   allow_basic_authentication     <span class="p">|</span> True                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   password_strength_check        <span class="p">|</span> False                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   disable_remote_cli_shell       <span class="p">|</span> False                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   disable_swagger                <span class="p">|</span> False                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   api_force_timeout              <span class="p">|</span> <span class="m">24</span> hours                           <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   minimum_password_length        <span class="p">|</span> <span class="m">8</span>                                  <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> global_tenant_config             <span class="p">|</span>                                    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   tenant_vrf                     <span class="p">|</span> False                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   se_in_provider_context         <span class="p">|</span> True                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   tenant_access_to_provider_se   <span class="p">|</span> True                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> email_configuration              <span class="p">|</span>                                    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   smtp_type                      <span class="p">|</span> SMTP_LOCAL_HOST                    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   from_email                     <span class="p">|</span> admin@avicontroller.net            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   mail_server_name               <span class="p">|</span> localhost                          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   mail_server_port               <span class="p">|</span> <span class="m">25</span>                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   disable_tls                    <span class="p">|</span> False                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> docker_mode                      <span class="p">|</span> False                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssh_ciphers<span class="o">[</span>1<span class="o">]</span>                   <span class="p">|</span> aes128-ctr                         <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssh_ciphers<span class="o">[</span>2<span class="o">]</span>                   <span class="p">|</span> aes256-ctr                         <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssh_hmacs<span class="o">[</span>1<span class="o">]</span>                     <span class="p">|</span> hmac-sha2-512-etm@openssh.com      <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssh_hmacs<span class="o">[</span>2<span class="o">]</span>                     <span class="p">|</span> hmac-sha2-256-etm@openssh.com      <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssh_hmacs<span class="o">[</span>3<span class="o">]</span>                     <span class="p">|</span> hmac-sha2-512                      <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> default_license_tier             <span class="p">|</span> ENTERPRISE                         <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> secure_channel_configuration     <span class="p">|</span>                                    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   sslkeyandcertificate_refs<span class="o">[</span>1<span class="o">]</span>   <span class="p">|</span> System-Default-Secure-Channel-Cert <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> welcome_workflow_complete        <span class="p">|</span> False                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> fips_mode                        <span class="p">|</span> False                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> enable_cors                      <span class="p">|</span> False                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> common_criteria_mode             <span class="p">|</span> False                              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> host_key_algorithm_exclude       <span class="p">|</span>                                    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> kex_algorithm_exclude            <span class="p">|</span>                                    <span class="p">|</span>
</span></span><span class="line"><span class="cl">+----------------------------------+------------------------------------+
</span></span></code></pre></div><p>Notice the <strong>welcome_workflow_complete</strong> is set to <em>False</em>. Set this to true using the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>admin:172-24-3-50<span class="o">]</span>: &gt; configure systemconfiguration welcome_workflow_complete <span class="m">1</span>
</span></span></code></pre></div><p>Or</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>admin:172-24-3-50<span class="o">]</span>: &gt; configure systemconfiguration
</span></span><span class="line"><span class="cl"><span class="o">[</span>admin:172-24-3-50-configure<span class="o">]</span>: &gt; welcome_workflow_complete <span class="o">(</span>hit henter<span class="o">)</span>
</span></span></code></pre></div><p>If you show the systemconfiguration again now it should be changed to True&hellip;  Logout and back in to the NSX-ALB gui and you should not be asked to do the initial setup wizard.</p>


<h3 class="relative group">Custom certificate in the NSX-ALB controller 
    <div id="custom-certificate-in-the-nsx-alb-controller" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#custom-certificate-in-the-nsx-alb-controller" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>After adding the NSX-ALB endpoint, configure NSX-ALB to use the newly created custom certificate created earlier. Head over to Administration -&gt; System Settings:</p>
<img src=images/image-20230924172714152.png style="width:500px" />
<p>Click edit and adjust the settings accordingly, and make sure to select the custom certificate.
<img src=images/image-20230924172906945.png style="width:650px" /></p>
<p>Check the option <strong>Allow Basic Authentication</strong> and update the field <strong>SSL/TLS Certificate</strong> with the custom certificate. Click save.</p>
<p>Now the pre-requisities has been done, and its time to get started with the WCP installation.</p>


<h2 class="relative group">My NSX and NSX-ALB environment before WCP installation 
    <div id="my-nsx-and-nsx-alb-environment-before-wcp-installation" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#my-nsx-and-nsx-alb-environment-before-wcp-installation" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>Before I head over and do the actual WCP installation, I will first just take a couple of screenshots from my NSX environment as a <em>before and after</em>.</p>


<h3 class="relative group">NSX environment before WCP installation 
    <div id="nsx-environment-before-wcp-installation" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#nsx-environment-before-wcp-installation" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>I have three Tier-0s configured, whereas I will only use the <strong>stc-tier-0</strong> (the one with most objects connected to it) in this post.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924173532263.png"
        alt="topology"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924173728814.png"
        alt="tier-0s"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924173753060.png"
        alt="tier-1"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924173819028.png"
        alt="segments"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924173844376.png"
        alt="loadbalancers"
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924173908475.png"
        alt="dhcp"
      />
      
    </figure>
</p>


<h3 class="relative group">NSX-ALB environment before WCP installation 
    <div id="nsx-alb-environment-before-wcp-installation" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#nsx-alb-environment-before-wcp-installation" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>One Virtual Service (my DNS service).</p>
<img src=images/image-20230924183846058.png style="width:500px" />
<p>IPAM and DNS profile (IPAM only needed for WCP)</p>
<img src=images/image-20230924183939637.png style="width:600px" />
<p>Content of my current IPAM profile</p>
<img src=images/image-20230924184213835.png style="width:600px" />
<p>My clouds configured</p>
<img src=images/image-20230924184328374.png style="width:600px" />
<p>Current networks configured in my stc-nsx-cloud</p>
<img src=images/image-20230924184430974.png style="width:700px" />
<p>Current running Service Engines</p>
<img src=images/image-20230924184535313.png style="width:650px" />
<p>My Service Engine Groups</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924184621433.png"
        alt="service-engines"
      />
      
    </figure>
</p>
<p>My configured Network Profiles</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924184753284.png"
        alt="network-profiles"
      />
      
    </figure>
</p>
<p>Then my VRF contexts, only configured for the other services I have been running.</p>
<img src=images/image-20230924184932135.png style="width:600px" />
<p>Now that we have all the before screenshots, lets do the vSphere with Tanzu installation and see how it goes.</p>


<h2 class="relative group">vSphere with Tanzu installation 
    <div id="vsphere-with-tanzu-installation" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#vsphere-with-tanzu-installation" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>There is nothing different in the UI when it comes to this specific feature, I select NSX as the networkl and populate the fields as normal. But I will list the steps here any way.</p>
<div class="notice info">
<p>I will use the new Import and Export feature as I already have done this installation several times. The first time I filled everything in manually then at the end of the wizard I clicked <strong>Export configuration</strong> and saved my config. So now I just have to import the config and go through all the fiels using next, and change something if needed, then finish.</p>
</div>
<p>Here is how to choose the export, select it and a download dialog will pop up. To use it later for import extract the content and select the file called <strong>wcp-config.json</strong></p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924185550151.png"
        alt="image-20230924185550151"
      />
      
    </figure>
</p>
<p>Get Started</p>
<img src=images/image-20230924185759488.png style="width:600px" />
<p>Import Config</p>
<img src=images/image-20230924185823471.png style="width:800px" />
<img src=images/image-20230924185840791.png style="width:600px" />
<img src=images/image-20230924185910320.png style="width:600px" />
<p>Import, and now all fields are populated.</p>
<p>The wcp-config.json file content:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;specVersion&#34;</span><span class="p">:</span><span class="s2">&#34;1.0&#34;</span><span class="p">,</span><span class="nt">&#34;supervisorSpec&#34;</span><span class="p">:{</span><span class="nt">&#34;supervisorName&#34;</span><span class="p">:</span><span class="s2">&#34;stc-svc&#34;</span><span class="p">},</span><span class="nt">&#34;envSpec&#34;</span><span class="p">:{</span><span class="nt">&#34;vcenterDetails&#34;</span><span class="p">:{</span><span class="nt">&#34;vcenterAddress&#34;</span><span class="p">:</span><span class="s2">&#34;vcsa.cpod-nsxam-stc.az-stc.cloud-garage.net&#34;</span><span class="p">,</span><span class="nt">&#34;vcenterCluster&#34;</span><span class="p">:</span><span class="s2">&#34;Cluster&#34;</span><span class="p">}},</span><span class="nt">&#34;tkgsComponentSpec&#34;</span><span class="p">:{</span><span class="nt">&#34;tkgsStoragePolicySpec&#34;</span><span class="p">:{</span><span class="nt">&#34;masterStoragePolicy&#34;</span><span class="p">:</span><span class="s2">&#34;vSAN Default Storage Policy&#34;</span><span class="p">,</span><span class="nt">&#34;imageStoragePolicy&#34;</span><span class="p">:</span><span class="s2">&#34;vSAN Default Storage Policy&#34;</span><span class="p">,</span><span class="nt">&#34;ephemeralStoragePolicy&#34;</span><span class="p">:</span><span class="s2">&#34;vSAN Default Storage Policy&#34;</span><span class="p">},</span><span class="nt">&#34;tkgsMgmtNetworkSpec&#34;</span><span class="p">:{</span><span class="nt">&#34;tkgsMgmtNetworkName&#34;</span><span class="p">:</span><span class="s2">&#34;ls-mgmt&#34;</span><span class="p">,</span><span class="nt">&#34;tkgsMgmtIpAssignmentMode&#34;</span><span class="p">:</span><span class="s2">&#34;STATICRANGE&#34;</span><span class="p">,</span><span class="nt">&#34;tkgsMgmtNetworkStartingIp&#34;</span><span class="p">:</span><span class="s2">&#34;10.13.10.20&#34;</span><span class="p">,</span><span class="nt">&#34;tkgsMgmtNetworkGatewayCidr&#34;</span><span class="p">:</span><span class="s2">&#34;10.13.10.1/24&#34;</span><span class="p">,</span><span class="nt">&#34;tkgsMgmtNetworkDnsServers&#34;</span><span class="p">:[</span><span class="s2">&#34;172.24.3.1&#34;</span><span class="p">],</span><span class="nt">&#34;tkgsMgmtNetworkSearchDomains&#34;</span><span class="p">:[</span><span class="s2">&#34;cpod-nsxam-stc.az-stc.cloud-garage.net&#34;</span><span class="p">],</span><span class="nt">&#34;tkgsMgmtNetworkNtpServers&#34;</span><span class="p">:[</span><span class="s2">&#34;172.24.3.1&#34;</span><span class="p">]},</span><span class="nt">&#34;tkgsNcpClusterNetworkInfo&#34;</span><span class="p">:{</span><span class="nt">&#34;tkgsClusterDistributedSwitch&#34;</span><span class="p">:</span><span class="s2">&#34;VDSwitch&#34;</span><span class="p">,</span><span class="nt">&#34;tkgsNsxEdgeCluster&#34;</span><span class="p">:</span><span class="s2">&#34;SomeEdgeCluster&#34;</span><span class="p">,</span><span class="nt">&#34;tkgsNsxTier0Gateway&#34;</span><span class="p">:</span><span class="s2">&#34;stc-tier-0&#34;</span><span class="p">,</span><span class="nt">&#34;tkgsNamespaceSubnetPrefix&#34;</span><span class="p">:</span><span class="mi">28</span><span class="p">,</span><span class="nt">&#34;tkgsRoutedMode&#34;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nt">&#34;tkgsNamespaceNetworkCidrs&#34;</span><span class="p">:[</span><span class="s2">&#34;10.13.80.0/23&#34;</span><span class="p">],</span><span class="nt">&#34;tkgsIngressCidrs&#34;</span><span class="p">:[</span><span class="s2">&#34;10.13.90.0/24&#34;</span><span class="p">],</span><span class="nt">&#34;tkgsEgressCidrs&#34;</span><span class="p">:[],</span><span class="nt">&#34;tkgsWorkloadDnsServers&#34;</span><span class="p">:[</span><span class="s2">&#34;172.24.3.1&#34;</span><span class="p">],</span><span class="nt">&#34;tkgsWorkloadServiceCidr&#34;</span><span class="p">:</span><span class="s2">&#34;10.96.0.0/23&#34;</span><span class="p">},</span><span class="nt">&#34;apiServerDnsNames&#34;</span><span class="p">:[],</span><span class="nt">&#34;controlPlaneSize&#34;</span><span class="p">:</span><span class="s2">&#34;SMALL&#34;</span><span class="p">}}</span>
</span></span></code></pre></div><img src=images/image-20230924190126489.png style="width:600px" />
<img src=images/image-20230924190213682.png style="width:900px" />
<img src=images/image-20230924190229995.png style="width:900px" />
<img src=images/image-20230924190246528.png style="width:900px" />
<img src=images/image-20230924190318440.png style="width:900px" />
<p>I am deselecting NAT as I dont need that.</p>
<img src=images/image-20230924190351709.png style="width:900px" />
<p>Now, its just clicking finish and monitor the progress.</p>
<img src=images/image-20230924190430363.png style="width:900px" />
<p>One will soon see two new Virtual Services being created, two new service engines (according to my default-service-engine group config) being deployed.</p>
<img src=images/image-20230924194912944.png style="width:800px" />
<img src=images/image-20230924195553894.png style="width:800px" />
<p>When everything is ready and available the virtual services will become yellow/green (fully green after a while as it depends on how long the VS is down before it becomes available/up):</p>
<img src=images/image-20230924201245492.png style="width:800px" />
<p>And in vCenter the Workload Management progress:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924201423641.png"
        alt="wcp-status"
      />
      
    </figure>
</p>
<p>Can I reach it?</p>
<img src=images/image-20230924201632228.png style="width:600px" />
<p>Yes!</p>
<p>This is really really nice.</p>
<p>Now next chapters will go through what has been done in my NSX environment and the NSX-ALB environment.</p>


<h2 class="relative group">My NSX and NSX-ALB environment <strong>after</strong> WCP installation 
    <div id="my-nsx-and-nsx-alb-environment-after-wcp-installation" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#my-nsx-and-nsx-alb-environment-after-wcp-installation" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>Now that everything is green and joy. Let us have a check inside and see what has been configured.</p>


<h3 class="relative group">NSX environment <strong>after</strong> WCP installation 
    <div id="nsx-environment-after-wcp-installation" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#nsx-environment-after-wcp-installation" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Topology view:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924202349408.png"
        alt="Topology"
      />
      
    </figure>
</p>
<p>A new Tier-1 I can see, with two new segments, with some VMs in each.</p>
<p>Below I can see the new Tier-1</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924202624637.png"
        alt="tier-1"
      />
      
    </figure>
</p>
<p>In the new Tier-1 router it has also automatically added the static routes for the VIP to the SEs:</p>
<img src=images/image-20230924204541994.png style="width:700px" />
<img src=images/image-20230924204610255.png style="width:700px" />
<p>These static routes needs to be either advertised by the Tier-0 using either BGP or OSPF, or manually created static routes in the network infrastructure. I am using BGP.</p>
<p>The two new segments:</p>
<p>Avi-domain-c8:507&hellip; This segment is where my NSX-ALB Service Engines Dataplane network is located.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924202720238.png"
        alt="avi-doamain"
      />
      
    </figure>
</p>
<p>and the second segment vm-domain-c8:507.. is where the default workload network for my Supervisor Control Plane nodes is placed.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924202818930.png"
        alt="vm-domain"
      />
      
    </figure>
</p>
<p>Now, what is under Loadbalancing:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924203026514.png"
        alt="dlb"
      />
      
    </figure>
</p>
<p>It has created a distributed loadbalancer where all virtual servers are kubernetes services using the services CIDR:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924203124396.png"
        alt="dlb-vs"
      />
      
    </figure>
</p>
<p>The NSX Distributed Loadbalancer is used for the ClusterIP services running inside the Supervisor, the ones that are running on the ESXi hosts. The LoadBalancer services is handled by NSX-ALB.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@ubuntu02:~/avi_nsxt_wcp$ k get svc -A
</span></span><span class="line"><span class="cl">NAMESPACE                                   NAME                                                             TYPE           CLUSTER-IP    EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>                         AGE
</span></span><span class="line"><span class="cl">default                                     kubernetes                                                       ClusterIP      10.96.0.1     &lt;none&gt;        443/TCP                         15h
</span></span><span class="line"><span class="cl">kube-system                                 docker-registry                                                  ClusterIP      10.96.0.37    &lt;none&gt;        5000/TCP                        15h
</span></span><span class="line"><span class="cl">kube-system                                 kube-apiserver-authproxy-svc                                     ClusterIP      10.96.0.243   &lt;none&gt;        8443/TCP                        14h
</span></span><span class="line"><span class="cl">kube-system                                 kube-apiserver-lb-svc                                            LoadBalancer   10.96.0.201   10.13.90.1    443:32163/TCP,6443:31957/TCP    15h
</span></span><span class="line"><span class="cl">kube-system                                 kube-dns                                                         ClusterIP      10.96.0.10    &lt;none&gt;        53/UDP,53/TCP,9153/TCP          15h
</span></span><span class="line"><span class="cl">kube-system                                 snapshot-validation-service                                      ClusterIP      10.96.0.128   &lt;none&gt;        443/TCP                         15h
</span></span><span class="line"><span class="cl">ns-stc-1                                    cluster-1-76996f5b17a254b02e55a                                  LoadBalancer   10.96.0.239   10.13.92.2    80:30165/TCP                    12h
</span></span><span class="line"><span class="cl">ns-stc-1                                    cluster-1-control-plane-service                                  LoadBalancer   10.96.1.157   10.13.92.1    6443:30363/TCP                  13h
</span></span><span class="line"><span class="cl">vmware-system-appplatform-operator-system   packaging-api                                                    ClusterIP      10.96.0.87    &lt;none&gt;        443/TCP                         14h
</span></span><span class="line"><span class="cl">vmware-system-appplatform-operator-system   vmware-system-appplatform-operator-controller-manager-service    ClusterIP      None          &lt;none&gt;        &lt;none&gt;                          15h
</span></span><span class="line"><span class="cl">vmware-system-appplatform-operator-system   vmware-system-psp-operator-k8s-cloud-operator-service            ClusterIP      10.96.1.101   &lt;none&gt;        29002/TCP                       15h
</span></span><span class="line"><span class="cl">vmware-system-appplatform-operator-system   vmware-system-psp-operator-service                               ClusterIP      None          &lt;none&gt;        &lt;none&gt;                          15h
</span></span><span class="line"><span class="cl">vmware-system-appplatform-operator-system   vmware-system-psp-operator-webhook-service                       ClusterIP      10.96.1.84    &lt;none&gt;        443/TCP                         15h
</span></span><span class="line"><span class="cl">vmware-system-capw                          capi-controller-manager-metrics-service                          ClusterIP      10.96.1.47    &lt;none&gt;        9844/TCP                        15h
</span></span><span class="line"><span class="cl">vmware-system-capw                          capi-kubeadm-bootstrap-controller-manager-metrics-service        ClusterIP      10.96.1.67    &lt;none&gt;        9845/TCP                        15h
</span></span><span class="line"><span class="cl">vmware-system-capw                          capi-kubeadm-bootstrap-webhook-service                           ClusterIP      10.96.0.170   &lt;none&gt;        443/TCP                         15h
</span></span><span class="line"><span class="cl">vmware-system-capw                          capi-kubeadm-control-plane-controller-manager-metrics-service    ClusterIP      10.96.1.48    &lt;none&gt;        9848/TCP                        15h
</span></span><span class="line"><span class="cl">vmware-system-capw                          capi-kubeadm-control-plane-webhook-service                       ClusterIP      10.96.0.102   &lt;none&gt;        443/TCP                         15h
</span></span><span class="line"><span class="cl">vmware-system-capw                          capi-webhook-service                                             ClusterIP      10.96.1.248   &lt;none&gt;        443/TCP                         15h
</span></span><span class="line"><span class="cl">vmware-system-capw                          capv-webhook-service                                             ClusterIP      10.96.1.124   &lt;none&gt;        443/TCP                         15h
</span></span><span class="line"><span class="cl">vmware-system-capw                          capw-controller-manager-metrics-service                          ClusterIP      10.96.1.252   &lt;none&gt;        9846/TCP                        15h
</span></span><span class="line"><span class="cl">vmware-system-capw                          capw-webhook-service                                             ClusterIP      10.96.0.101   &lt;none&gt;        443/TCP                         15h
</span></span><span class="line"><span class="cl">vmware-system-cert-manager                  cert-manager                                                     ClusterIP      10.96.0.158   &lt;none&gt;        9402/TCP                        15h
</span></span><span class="line"><span class="cl">vmware-system-cert-manager                  cert-manager-webhook                                             ClusterIP      10.96.0.134   &lt;none&gt;        443/TCP                         15h
</span></span><span class="line"><span class="cl">vmware-system-csi                           vmware-system-csi-webhook-service                                ClusterIP      10.96.1.130   &lt;none&gt;        443/TCP                         15h
</span></span><span class="line"><span class="cl">vmware-system-csi                           vsphere-csi-controller                                           LoadBalancer   10.96.0.108   10.13.90.2    2112:30383/TCP,2113:31530/TCP   15h
</span></span><span class="line"><span class="cl">vmware-system-imageregistry                 vmware-system-imageregistry-controller-manager-metrics-service   ClusterIP      10.96.0.47    &lt;none&gt;        9857/TCP                        14h
</span></span><span class="line"><span class="cl">vmware-system-imageregistry                 vmware-system-imageregistry-webhook-service                      ClusterIP      10.96.1.108   &lt;none&gt;        443/TCP                         14h
</span></span><span class="line"><span class="cl">vmware-system-license-operator              vmware-system-license-operator-webhook-service                   ClusterIP      10.96.1.51    &lt;none&gt;        443/TCP                         15h
</span></span><span class="line"><span class="cl">vmware-system-netop                         vmware-system-netop-controller-manager-metrics-service           ClusterIP      10.96.0.234   &lt;none&gt;        9851/TCP                        15h
</span></span><span class="line"><span class="cl">vmware-system-nsop                          vmware-system-nsop-webhook-service                               ClusterIP      10.96.1.73    &lt;none&gt;        443/TCP                         15h
</span></span><span class="line"><span class="cl">vmware-system-nsx                           nsx-operator                                                     ClusterIP      10.96.0.150   &lt;none&gt;        8093/TCP                        15h
</span></span><span class="line"><span class="cl">vmware-system-pinniped                      pinniped-concierge-api                                           ClusterIP      10.96.1.204   &lt;none&gt;        443/TCP                         14h
</span></span><span class="line"><span class="cl">vmware-system-pinniped                      pinniped-supervisor                                              ClusterIP      10.96.1.139   &lt;none&gt;        12001/TCP                       14h
</span></span><span class="line"><span class="cl">vmware-system-pinniped                      pinniped-supervisor-api                                          ClusterIP      10.96.1.94    &lt;none&gt;        443/TCP                         14h
</span></span><span class="line"><span class="cl">vmware-system-tkg                           tanzu-addons-manager-webhook-service                             ClusterIP      10.96.1.18    &lt;none&gt;        443/TCP                         14h
</span></span><span class="line"><span class="cl">vmware-system-tkg                           tanzu-featuregates-webhook-service                               ClusterIP      10.96.0.160   &lt;none&gt;        443/TCP                         14h
</span></span><span class="line"><span class="cl">vmware-system-tkg                           tkgs-plugin-service                                              ClusterIP      10.96.1.31    &lt;none&gt;        8099/TCP                        14h
</span></span><span class="line"><span class="cl">vmware-system-tkg                           tkr-conversion-webhook-service                                   ClusterIP      10.96.0.249   &lt;none&gt;        443/TCP                         14h
</span></span><span class="line"><span class="cl">vmware-system-tkg                           tkr-resolver-cluster-webhook-service                             ClusterIP      10.96.1.146   &lt;none&gt;        443/TCP                         14h
</span></span><span class="line"><span class="cl">vmware-system-tkg                           vmware-system-tkg-controller-manager-metrics-service             ClusterIP      10.96.1.147   &lt;none&gt;        9847/TCP                        14h
</span></span><span class="line"><span class="cl">vmware-system-tkg                           vmware-system-tkg-state-metrics-service                          ClusterIP      10.96.1.174   &lt;none&gt;        8443/TCP                        14h
</span></span><span class="line"><span class="cl">vmware-system-tkg                           vmware-system-tkg-webhook-service                                ClusterIP      10.96.0.167   &lt;none&gt;        443/TCP                         14h
</span></span><span class="line"><span class="cl">vmware-system-vmop                          vmware-system-vmop-controller-manager-metrics-service            ClusterIP      10.96.0.71    &lt;none&gt;        9848/TCP                        15h
</span></span><span class="line"><span class="cl">vmware-system-vmop                          vmware-system-vmop-web-console-validator                         ClusterIP      10.96.0.41    &lt;none&gt;        80/TCP                          15h
</span></span><span class="line"><span class="cl">vmware-system-vmop                          vmware-system-vmop-webhook-service                               ClusterIP      10.96.0.182   &lt;none&gt;        443/TCP                         15h
</span></span><span class="line"><span class="cl">andreasm@ubuntu02:~/avi_nsxt_wcp$ k get nodes
</span></span><span class="line"><span class="cl">NAME                                           STATUS   ROLES                  AGE   VERSION
</span></span><span class="line"><span class="cl">4234784dcf1b9d8d15d541fab8855b55               Ready    control-plane,master   15h   v1.26.4+vmware.wcp.0
</span></span><span class="line"><span class="cl">4234e1920ede3cad62bcd3ce8bd2f2dc               Ready    control-plane,master   15h   v1.26.4+vmware.wcp.0
</span></span><span class="line"><span class="cl">4234f25d5bdc9796ce1e247a4190bb58               Ready    control-plane,master   15h   v1.26.4+vmware.wcp.0
</span></span><span class="line"><span class="cl">esx01.cpod-nsxam-stc.az-stc.cloud-garage.net   Ready    agent                  15h   v1.26.4-sph-79b2bd9
</span></span><span class="line"><span class="cl">esx02.cpod-nsxam-stc.az-stc.cloud-garage.net   Ready    agent                  15h   v1.26.4-sph-79b2bd9
</span></span><span class="line"><span class="cl">esx03.cpod-nsxam-stc.az-stc.cloud-garage.net   Ready    agent                  15h   v1.26.4-sph-79b2bd9
</span></span><span class="line"><span class="cl">esx04.cpod-nsxam-stc.az-stc.cloud-garage.net   Ready    agent                  15h   v1.26.4-sph-79b2bd9
</span></span></code></pre></div><p>And lastly it has also created a DHCP server for the Service Engines Dataplane interfaces.</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924203326754.png"
        alt="dhcp-server-se-dataplane"
      />
      
    </figure>
</p>


<h3 class="relative group">NSX-ALB environment <strong>after</strong> WCP installation 
    <div id="nsx-alb-environment-after-wcp-installation" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#nsx-alb-environment-after-wcp-installation" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Two new Virtual Services, one for the the Supervisor Kubernetes API and the other for the CSI controller (monitoring?)</p>
<img src=images/image-20230924203717951.png style="width:600px" />
<p>The content of my IPAM profile:</p>
<p>It has added a new usable network there.</p>
<img src=images/image-20230924203905123.png style="width:800px" />
<p>It has added a new Data Network in my NSX cloud</p>
<img src=images/image-20230924204018631.png style="width:800px" />
<p>Two new Service Engines</p>
<img src=images/image-20230924204114039.png style="width:800px" />
<p>Dataplane network for these two new SEs</p>
<img src=images/image-20230924204818493.png style="width:800px" />
<p>One new Service Engine Group</p>
<img src=images/image-20230924204213823.png style="width:800px" />
<p>Two new Network Profiles</p>
<p>(notice the ingress cidr network profile (VIP) is placed in the global vrf)</p>
<img src=images/image-20231006101952239.png style="width:800px" />
<p>One new VRF context</p>
<img src=images/image-20230924204406099.png style="width:800px" />
<p>Now I can consume my newly provisioned Supervisor cluster through NSX-ALB - In the next chapters I have provisioned a workload cluster in a different network, different from the default workload network of the Supervisor. Then I will provision some L4 services (serviceType loadBalancer) and Ingress (L7) inside this cluster. Lets see what happens</p>


<h2 class="relative group">Creating vSphere Namespaces in other networks - override supervisor workload network 
    <div id="creating-vsphere-namespaces-in-other-networks---override-supervisor-workload-network" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#creating-vsphere-namespaces-in-other-networks---override-supervisor-workload-network" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>I went ahead and created a new vSphere Namespace with these settings:</p>
<img src=images/image-20230924211606562.png style="width:700px" />
<p>Immediately after, it also created some new objects in NSX like a new Tier-1, segments etc similar to what it does before vSphere 8 U2. Then in NSX-ALB new network profiles and VRF context, creating the network profile for the SEs in the new VRF <em>t1-domain-xxxxxx-xxxxx-xxx-xxx-x-ns-stc-1</em>.</p>
<p>The ingress cidr (VIP) network profile <em>vcf-ako-net-domain-c8:5071d9d4-373d-49aa-a202-4c4ed81adc3b-ns-stc-1</em> was created using the global vrf.
If you remember I deselected the option in my IPAM profile <strong>Allocate ip in VRF</strong>, so it will use the global vrf here also (as in the initial deployment of the Supervisor cluster).</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20231006104304250.png"
        alt="new-network-pfofiles"
      />
      
    </figure>
</p>
<p>Now I can deploy my workload cluster in the newly created vSphere namespace.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@ubuntu02:~/avi_nsxt_wcp$ k apply -f cluster-1-default.yaml
</span></span><span class="line"><span class="cl">cluster.cluster.x-k8s.io/cluster-1 created
</span></span></code></pre></div><p>In NSX-ALB shortly after a new VS is created</p>
<img src=images/image-20230924212304461.png style="width:600px" />
<p>The already exisiting Service Engines has been reconfigured adding a second dataplane interface, using same subnet, but in two different VRF contexts. So it should work just fine.</p>
<img src=images/image-20230924212903744.png style="width:800px" />
<img src=images/image-20230924212953162.png style="width:700px" />
<p>Now I just need to wait for the nodes to be provisioned.</p>
<p>In the meantime I checked the T1 created for this workload cluster and it has been so kind to create the static routes for me there also:</p>
<img src=images/image-20230924212543369.png style="width:600px" />
<p>Virtual service is now green, so the control plane vm is up and running.</p>
<img src=images/image-20230924215203267.png style="width:700px" />
<p>Cluster ready, and I can test some services from it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@ubuntu02:~/avi_nsxt_wcp$ k get nodes
</span></span><span class="line"><span class="cl">NAME                                            STATUS   ROLES           AGE     VERSION
</span></span><span class="line"><span class="cl">cluster-1-f82lv-fdvw8                           Ready    control-plane   12m     v1.26.5+vmware.2-fips.1
</span></span><span class="line"><span class="cl">cluster-1-node-pool-01-tb4tw-555756bd56-76qv6   Ready    &lt;none&gt;          8m39s   v1.26.5+vmware.2-fips.1
</span></span><span class="line"><span class="cl">cluster-1-node-pool-01-tb4tw-555756bd56-klgcs   Ready    &lt;none&gt;          8m39s   v1.26.5+vmware.2-fips.1
</span></span></code></pre></div>

<h2 class="relative group">L4 services inside the workload clusters 
    <div id="l4-services-inside-the-workload-clusters" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#l4-services-inside-the-workload-clusters" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>This test is fairly straightforward. I have deployed my test application Yelb. This creates a web-frontend and exposes it via serviceType loadBalancer. As soon as I deploy it NSX-ALB will create the virtual service using the same VIP range or Ingress range defined in the vSphere Namespace:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924220552633.png"
        alt="VIP-range"
      />
      
    </figure>
</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@ubuntu02:~/examples$ k get pods -n yelb
</span></span><span class="line"><span class="cl">NAME                              READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">redis-server-56d97cc8c-f42fr      1/1     Running   <span class="m">0</span>          7m2s
</span></span><span class="line"><span class="cl">yelb-appserver-65855b7ffd-p74r8   1/1     Running   <span class="m">0</span>          7m2s
</span></span><span class="line"><span class="cl">yelb-db-6f78dc6f8f-qbj2v          1/1     Running   <span class="m">0</span>          7m2s
</span></span><span class="line"><span class="cl">yelb-ui-5c5b8d8887-bbwxl          1/1     Running   <span class="m">0</span>          79s
</span></span><span class="line"><span class="cl">andreasm@ubuntu02:~/examples$ k get svc -n yelb
</span></span><span class="line"><span class="cl">NAME             TYPE           CLUSTER-IP      EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>        AGE
</span></span><span class="line"><span class="cl">redis-server     ClusterIP      20.10.173.143   &lt;none&gt;        6379/TCP       7m10s
</span></span><span class="line"><span class="cl">yelb-appserver   ClusterIP      20.10.215.161   &lt;none&gt;        4567/TCP       7m9s
</span></span><span class="line"><span class="cl">yelb-db          ClusterIP      20.10.208.242   &lt;none&gt;        5432/TCP       7m9s
</span></span><span class="line"><span class="cl">yelb-ui          LoadBalancer   20.10.120.42    10.13.92.2    80:30917/TCP   87s
</span></span></code></pre></div><img src=images/image-20230924220648398.png style="width:700px" />
<p>This works fine, now my diagram can look like this:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        src="/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/images/image-20230924221805268.png"
        alt="kube-api-and-l4"
      />
      
    </figure>
</p>
<p>Next step is to deploy an Ingress</p>


<h2 class="relative group">L7 services inside the workload clusters 
    <div id="l7-services-inside-the-workload-clusters" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#l7-services-inside-the-workload-clusters" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>If I check my newly deployed workload cluster, there is no AKO pod running.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@ubuntu02:~/avi_nsxt_wcp$ k get pods -A
</span></span><span class="line"><span class="cl">NAMESPACE                      NAME                                                            READY   STATUS      RESTARTS        AGE
</span></span><span class="line"><span class="cl">kube-system                    antrea-agent-4fzbm                                              2/2     Running     <span class="m">0</span>               7m15s
</span></span><span class="line"><span class="cl">kube-system                    antrea-agent-v94js                                              2/2     Running     <span class="m">0</span>               7m16s
</span></span><span class="line"><span class="cl">kube-system                    antrea-agent-w6fqr                                              2/2     Running     <span class="m">0</span>               8m20s
</span></span><span class="line"><span class="cl">kube-system                    antrea-controller-797ffdc4df-2p4km                              1/1     Running     <span class="m">0</span>               8m20s
</span></span><span class="line"><span class="cl">kube-system                    coredns-794978f977-4pjvl                                        1/1     Running     <span class="m">0</span>               7m8s
</span></span><span class="line"><span class="cl">kube-system                    coredns-794978f977-xz76z                                        1/1     Running     <span class="m">0</span>               10m
</span></span><span class="line"><span class="cl">kube-system                    docker-registry-cluster-1-f82lv-fdvw8                           1/1     Running     <span class="m">0</span>               11m
</span></span><span class="line"><span class="cl">kube-system                    docker-registry-cluster-1-node-pool-01-tb4tw-555756bd56-76qv6   1/1     Running     <span class="m">0</span>               5m59s
</span></span><span class="line"><span class="cl">kube-system                    docker-registry-cluster-1-node-pool-01-tb4tw-555756bd56-klgcs   1/1     Running     <span class="m">0</span>               5m58s
</span></span><span class="line"><span class="cl">kube-system                    etcd-cluster-1-f82lv-fdvw8                                      1/1     Running     <span class="m">0</span>               11m
</span></span><span class="line"><span class="cl">kube-system                    kube-apiserver-cluster-1-f82lv-fdvw8                            1/1     Running     <span class="m">0</span>               11m
</span></span><span class="line"><span class="cl">kube-system                    kube-controller-manager-cluster-1-f82lv-fdvw8                   1/1     Running     <span class="m">0</span>               11m
</span></span><span class="line"><span class="cl">kube-system                    kube-proxy-2mch7                                                1/1     Running     <span class="m">0</span>               7m16s
</span></span><span class="line"><span class="cl">kube-system                    kube-proxy-dd2hm                                                1/1     Running     <span class="m">0</span>               7m15s
</span></span><span class="line"><span class="cl">kube-system                    kube-proxy-pmc2c                                                1/1     Running     <span class="m">0</span>               11m
</span></span><span class="line"><span class="cl">kube-system                    kube-scheduler-cluster-1-f82lv-fdvw8                            1/1     Running     <span class="m">0</span>               11m
</span></span><span class="line"><span class="cl">kube-system                    metrics-server-6cdbbbf775-kqbfm                                 1/1     Running     <span class="m">0</span>               8m15s
</span></span><span class="line"><span class="cl">kube-system                    snapshot-controller-59d996bd4c-m7dqv                            1/1     Running     <span class="m">0</span>               8m23s
</span></span><span class="line"><span class="cl">secretgen-controller           secretgen-controller-b68787489-js8dj                            1/1     Running     <span class="m">0</span>               8m5s
</span></span><span class="line"><span class="cl">tkg-system                     kapp-controller-b4dfc4659-kggg7                                 2/2     Running     <span class="m">0</span>               9m
</span></span><span class="line"><span class="cl">tkg-system                     tanzu-capabilities-controller-manager-7c8dc68b84-7mv9v          1/1     Running     <span class="m">0</span>               7m38s
</span></span><span class="line"><span class="cl">vmware-system-antrea           register-placeholder-9n4kk                                      0/1     Completed   <span class="m">0</span>               8m20s
</span></span><span class="line"><span class="cl">vmware-system-auth             guest-cluster-auth-svc-rxt9v                                    1/1     Running     <span class="m">0</span>               7m18s
</span></span><span class="line"><span class="cl">vmware-system-cloud-provider   guest-cluster-cloud-provider-844cdc6ffc-54957                   1/1     Running     <span class="m">0</span>               8m25s
</span></span><span class="line"><span class="cl">vmware-system-csi              vsphere-csi-controller-7db59f4569-lxzkc                         7/7     Running     <span class="m">0</span>               8m23s
</span></span><span class="line"><span class="cl">vmware-system-csi              vsphere-csi-node-2pmlj                                          3/3     Running     <span class="m">3</span> <span class="o">(</span>6m2s ago<span class="o">)</span>    7m15s
</span></span><span class="line"><span class="cl">vmware-system-csi              vsphere-csi-node-9kr82                                          3/3     Running     <span class="m">4</span> <span class="o">(</span>6m10s ago<span class="o">)</span>   8m23s
</span></span><span class="line"><span class="cl">vmware-system-csi              vsphere-csi-node-9pxc8                                          3/3     Running     <span class="m">3</span> <span class="o">(</span>6m2s ago<span class="o">)</span>    7m16s
</span></span></code></pre></div><p>So what will happen if I try to deploy an Ingress?</p>
<p>Nothing, as there is no IngressClass available.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">andreasm@ubuntu02:~/examples$ k get ingressclasses.networking.k8s.io
</span></span><span class="line"><span class="cl">No resources found
</span></span></code></pre></div><p>So this means we still need to deploy AKO to be able to use Ingress. I have a post of how that is done <a href="https://blog.andreasm.io/2022/10/26/vsphere-8-with-tanzu-using-nsx-t-avi-loadbalancer/#configure-avi-as-ingress-controller-l7-with-nsx-as-l4-lb" target="_blank">here</a> where NSX is providing the IP addresses for the Ingress, but I expect now it will be NSX-ALB providing the IP addresses using the ingress cidr configured in the namespace. So the only difference is NSX-ALB is providing it instead of NSX.</p>
<p>This concludes this post.</p>


<h2 class="relative group">Credits 
    <div id="credits" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#credits" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>A big thanks goes to Tom Schwaller, Container Networking TPM @VMware, (Twitter/X handle @tom_schwaller), for getting me started on this post, and for providing useful insights on the requirements for getting this to work.</p>

          
          
          
        </div>
        
        

        
        
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://blog.andreasm.io/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/&amp;title=vSphere%20with%20Tanzu%208%20U2%20using%20NSX%20AND%20NSX%20Advanced%20Loadbalancer"
      title="Share on LinkedIn"
      aria-label="Share on LinkedIn"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://twitter.com/intent/tweet/?url=https://blog.andreasm.io/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/&amp;text=vSphere%20with%20Tanzu%208%20U2%20using%20NSX%20AND%20NSX%20Advanced%20Loadbalancer"
      title="Tweet on Twitter"
      aria-label="Tweet on Twitter"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://s2f.kytta.dev/?text=vSphere%20with%20Tanzu%208%20U2%20using%20NSX%20AND%20NSX%20Advanced%20Loadbalancer%20https://blog.andreasm.io/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/"
      title=""
      aria-label=""
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="mailto:?body=https://blog.andreasm.io/2023/09/23/vsphere-with-tanzu-8-u2-using-nsx-and-nsx-advanced-loadbalancer/&amp;subject=vSphere%20with%20Tanzu%208%20U2%20using%20NSX%20AND%20NSX%20Advanced%20Loadbalancer"
      title="Send via email"
      aria-label="Send via email"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>


    </a>
      
    
  </section>


        


<h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2>
<section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3">
  
  

  <a href="/2024/04/08/vsphere-with-tanzu-avi-and-multiple-supervisors/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/2024/04/08/vsphere-with-tanzu-avi-and-multiple-supervisors/feature-vmware_by_broadcom.png);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/2024/04/08/vsphere-with-tanzu-avi-and-multiple-supervisors/">vSphere with Tanzu - Avi and Multiple Supervisors</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-04-08T14:56:56&#43;02:00">8 April 2024</time><span class="px-2 text-primary-500">&middot;</span><span>1632 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">8 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/tanzu/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Tanzu
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/nsx/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    NSX
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/avi/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    AVI
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/loadbalancing/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Loadbalancing
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/networking/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Networking
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/avi/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Avi
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/nsx/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Nsx
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/multi-tenancy/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Multi-Tenancy
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
        <div class="py-1 prose dark:prose-invert">
          In this post I will try to describe how to use the new NSX and Avi together integration in vSphere with Tanzu in combination with several Supervisor clusters using only 1 NSX manager cluster and 1 Avi controller cluster
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
  

  <a href="/2022/10/26/vsphere-8-with-tanzu-using-nsx-t-avi-loadbalancer/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/2022/10/26/vsphere-8-with-tanzu-using-nsx-t-avi-loadbalancer/feature-logo-vmware-tanzu.png);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/2022/10/26/vsphere-8-with-tanzu-using-nsx-t-avi-loadbalancer/">vSphere 8 with Tanzu using NSX-T & Avi LoadBalancer</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2022-10-26T12:03:35&#43;02:00">26 October 2022</time><span class="px-2 text-primary-500">&middot;</span><span>6151 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">29 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/tanzu/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Tanzu
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/networking/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Networking
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/nsx/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    NSX
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/avi/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    AVI
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/tanzu/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Tanzu
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/network/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Network
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/lodbalancing/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Lodbalancing
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/ingress/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Ingress
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
        <div class="py-1 prose dark:prose-invert">
          Deploy Tanzu in vSphere 8 with NSX and Avi Loadbalancer: # This post will go through how to install Tanzu in vSphere 8 using NSX networking (including built in L4 loadbalancer) and Avi as L7 loadbalancer.
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
  

  <a href="/2023/04/14/tanzu-with-vsphere-and-different-tier-0s/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/2023/04/14/tanzu-with-vsphere-and-different-tier-0s/feature-vmware_by_broadcom.png);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/2023/04/14/tanzu-with-vsphere-and-different-tier-0s/">Tanzu with vSphere and different Tier-0s</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2023-04-14T13:24:41&#43;02:00">14 April 2023</time><span class="px-2 text-primary-500">&middot;</span><span>8227 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">39 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/kubernetes/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Kubernetes
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/tanzu/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Tanzu
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/networking/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Networking
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/nsx/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Nsx
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/tanzu/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Tanzu
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/network/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Network
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
        <div class="py-1 prose dark:prose-invert">
          This post will take you trough how to configre Tanzu with vSphere using NSX with multiple Tier-0 and VRF Tier-0 gateways. It will also show you how to do this using DCLI and API
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
</section>

  
      </div>
     
      
      
        
        
          
          
        
      <script>
        var oid = "views_posts\/2023-09-23-vsphere_8_U2_with_tanzu_nsx_alb\/index.md"
        var oid_likes = "likes_posts\/2023-09-23-vsphere_8_U2_with_tanzu_nsx_alb\/index.md"
      </script>
      
      
      <script type="text/javascript" src="/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js" integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q&#43;oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script>
      
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/2023/09/19/vsphere-with-tanzu-and-haproxy/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >vSphere with Tanzu and HAproxy</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2023-09-19T09:38:19&#43;02:00">19 September 2023</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/2023/09/25/antrea-multi-cluster-in-tkg-and-vsphere-with-tanzu/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Antrea Multi-cluster - in TKG and vSphere with Tanzu</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2023-09-25T10:59:30&#43;02:00">25 September 2023</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top" title="Scroll to top">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
    <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex flex-col list-none sm:flex-row">
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/tags/"
            title="">
            
            Tags
          </a>
        </li>
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/categories/"
            title="">
            
            Categories
          </a>
        </li>
        
      </ul>
    </nav>
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      &copy;
      2024
      Andreas Marqvardsen
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js" integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="https://blog.andreasm.io/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
